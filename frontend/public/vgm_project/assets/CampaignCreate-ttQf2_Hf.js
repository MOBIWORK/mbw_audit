import{r as a,j as e,R as L,y as M,F as k,z as A,a4 as G,S as J,ah as W,a as F,P as H,G as I,M as D,Y as P,B,T as X,D as K,a1 as Y,W as $,a2 as Q,aB as U,a3 as Z,V as z,H as ee}from"./main-ZqBQIJMP.js";const te=[{label:"Hoạt động",value:"Open"},{label:"Đóng",value:"Close"}];function ne({form:o,onCampaignStatusChange:p}){const[i,c]=a.useState("Open"),g=m=>{c(m),p(m)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 pt-6 pb-[58px]",children:[e.jsxs(L,{children:[e.jsx(M,{span:8,children:e.jsx(k,{label:"Tên chiến dịch",name:"campaign_name",required:!0,children:e.jsx(A,{})})}),e.jsx(M,{span:8,children:e.jsx(k,{label:"Thời gian bắt đầu",name:"campaign_start",required:!0,children:e.jsx(G,{showTime:!0})})}),e.jsx(M,{span:8,children:e.jsx(k,{label:"Thời gian kết thúc",name:"campaign_end",required:!0,children:e.jsx(G,{showTime:!0})})})]}),e.jsxs(L,{className:"pt-2",children:[e.jsx(M,{span:8,children:e.jsx(k,{label:"Trạng thái",name:"campaign_status",children:e.jsx(J,{defaultValue:"Open",options:te,onChange:g})})}),e.jsx(M,{span:8,children:e.jsx(k,{label:"Mô tả",name:"campaign_description",children:e.jsx(W,{className:"bg-[#F5F7FA]",autoSize:{minRows:3,maxRows:5}})})})]})]})})}function ae({onChangeCategory:o}){const[p,i]=a.useState(!1),[c,g]=a.useState([]),[m,y]=a.useState([]),[h,b]=a.useState(""),[u,j]=a.useState([]);a.useEffect(()=>{d()},[]),a.useEffect(()=>{d()},[h]);const d=async()=>{let s='/api/resource/VGM_Category?fields=["*"]';h!=null&&h!=""&&(s+=`&filters=[["category_name", "like", "%${h}%"]]`);const t=await F.get(s);if(t&&t.data){let n=t.data.map(l=>({...l,key:l.name}));for(let l=0;l<n.length;l++){let O=`/api/resource/VGM_Product?fields=["name","product_code","product_name"]&&filters=[["category","=","${n[l].name}"]]`,R=await F.get(O);if(R!=null&&R.data!=null){n[l].product_num=R.data.length;let q=R.data.map(V=>({...V,key:V.name}));n[l].products=q}else n[l].product_num=0,n[l].products=[]}y(n)}},C=s=>{b(s.target.value)},N={selectedRowKeys:c,onChange:(s,t)=>{g(s)}},v=()=>{let s=[];for(let t=0;t<c.length;t++){let n=m.filter(l=>l.name==c[t]);n!=null&&n.length>0&&(n[0].stt=s.length+1,s.push(n[0]))}j(s),o(s),S()},r=c.length>0,x=()=>{i(!0)},f=()=>{i(!1)},S=()=>{i(!1)},w=s=>{const t=u.filter(n=>n.name!==s.name);j(t),o(t)},T=(s,t)=>{const n=[{title:"Mã sản phẩm",dataIndex:"product_code",key:"product_code"},{title:"Tên sản phẩm",dataIndex:"product_name",key:"product_name"}];return e.jsx(X,{columns:n,dataSource:s.products,pagination:!1})},_=[{title:"STT",dataIndex:"stt",key:"stt"},{title:"Danh mục sản phẩm",dataIndex:"category_name",key:"category_name"},{title:"Số lượng sản phẩm",dataIndex:"product_num",key:"product_num"},{title:"",key:"",render:s=>e.jsx("a",{children:e.jsx(K,{onClick:()=>w(s)})})}];return e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Sản phẩm"}),e.jsxs("div",{onClick:x,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(H,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn danh mục"})]}),e.jsx("div",{className:"pt-6 ml-4",children:e.jsx(I,{columns:_,expandable:{expandedRowRender:T,defaultExpandedRowKeys:["0"]},dataSource:u})}),e.jsxs(D,{width:990,title:"Chọn danh mục sản phẩm",open:p,onOk:f,onCancel:S,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{className:"w-[320px] border-none pt-4",children:e.jsx(A,{value:h,onChange:C,placeholder:"Tìm kiếm danh mục sản phẩm",prefix:e.jsx(P,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:r?`Đã chọn ${c.length} danh mục`:""}),e.jsx(B,{type:"primary",onClick:v,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(I,{rowSelection:N,columns:[{title:"Danh mục sản phẩm",dataIndex:"category_name",key:"category_name"},{title:"Số lượng sản phẩm",dataIndex:"product_num",key:"product_num"}],dataSource:m})})]})]})}function se({onChangeCustomer:o}){const[p,i]=a.useState(!1),[c,g]=a.useState([]),[m,y]=a.useState([]),[h,b]=a.useState([]),[u,j]=a.useState([]),[d,C]=a.useState(""),E=[{title:"ID",dataIndex:"customer_code",key:"customer_code",render:t=>e.jsx("a",{children:t})},{title:"Tên khách hàng",key:"customer_name",dataIndex:"customer_name"},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group"},{title:"Địa chỉ",key:"customer_primary_address",dataIndex:"customer_primary_address"},{title:"",key:"action",render:(t,n)=>e.jsx("a",{children:e.jsx(K,{onClick:()=>T(n)})})}];a.useEffect(()=>{N()},[]),a.useEffect(()=>{let t=h;d!=null&&d!=""&&(t=h.filter(n=>n.customer_name.toLowerCase().includes(d.toLowerCase()))),y(t)},[d]);const N=async()=>{let t=[{key:"Nguyễn huệ",name:"Nguyễn huệ",customer_code:"BH0054807122022",customer_name:"Nguyễn huệ",customer_group:"Hệ thống siêu thị",customer_primary_address:""},{key:"Anh Huy",name:"Anh Huy",customer_code:"BH0057724022023",customer_name:"Anh Huy",customer_group:"Hệ thống siêu thị",customer_primary_address:"CT1, Cổ Nhuế 2, Bắc Từ Liêm, Hà Nội-Billing-4"},{key:"Anh Trọng",name:"Anh Trọng",customer_code:"BH0051611082022",customer_name:"Anh Trọng",customer_group:"Khách hàng mua buôn",customer_primary_address:"Ngõ 135 Vũ Tông Phan, Khương Đình, Thanh Xuân, Hà Nội, Việt Nam-Billing"}];y(t),b(t)},v=()=>{i(!0)},r=()=>{i(!1)},x=()=>{i(!1)},f=t=>{C(t.target.value)},S=t=>{g(t)},w=()=>{let t=[];for(let n=0;n<c.length;n++){let l=m.filter(O=>O.name==c[n]);l!=null&&l.length>0&&t.push(l[0])}j(t),o(t),x()},T=t=>{const n=u.filter(l=>l.name!==t.name);j(n),o(n)},_={selectedRowKeys:c,onChange:S},s=c.length>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Danh sách khách hàng"}),e.jsxs("div",{onClick:v,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(H,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn khách hàng"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(I,{columns:E,dataSource:u}),";"]}),e.jsxs(D,{width:990,title:"Chọn khách hàng",open:p,onOk:r,onCancel:x,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{className:"w-[320px] border-none pt-4",children:e.jsx(A,{value:d,onChange:f,placeholder:"Tìm kiếm tên khách hàng",prefix:e.jsx(P,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:s?`Đã chọn ${c.length} khách hàng`:""}),e.jsx(B,{type:"primary",onClick:w,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(I,{rowSelection:_,columns:[{title:"ID",dataIndex:"customer_code",key:"customer_code",render:t=>e.jsx("a",{children:t})},{title:"Tên khách hàng",key:"customer_name",dataIndex:"customer_name"},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group"},{title:"Địa chỉ",key:"customer_primary_address",dataIndex:"customer_primary_address"}],dataSource:m})})]})]})})}const le=[{title:"Mã nhân viên",dataIndex:"name",key:"name",render:o=>e.jsx("a",{children:o})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name"},{title:"Email",dataIndex:"email",key:"email"}];function re({onChangeEmployees:o}){const[p,i]=a.useState(!1),[c,g]=a.useState([]),[m,y]=a.useState([]),[h,b]=a.useState([]),[u,j]=a.useState(""),[d,C]=a.useState([]),E=[{title:"Mã nhân viên",dataIndex:"name",key:"name",render:t=>e.jsx("a",{children:t})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name"},{title:"Email",dataIndex:"email",key:"email"},{title:"",key:"",render:t=>e.jsx("a",{children:e.jsx(K,{onClick:()=>T(t)})})}];a.useEffect(()=>{N()},[]),a.useEffect(()=>{let t=h;u!=null&&u!=""&&(t=h.filter(n=>n.employee_name.toLowerCase().includes(u.toLowerCase()))),y(t)},[u]);const N=async()=>{let n=[{email:"hoanganh@gmail.com",name:"HR-EMP-00014",employee_name:"Hoàng Anh"},{email:"hapt@mbw.vn",name:"HR-EMP-00013",employee_name:"Hà PT"},{email:"lamthatnhanh111@gmail.com",name:"HR-EMP-00012",employee_name:"Vương Linh"},{email:"haudang130197@gmail.com",name:"HR-EMP-00011",employee_name:"Đặng Hậu"}].map(l=>({...l,key:l.name}));y(n),b(n)},v=()=>{i(!0)},r=()=>{i(!1)},x=()=>{i(!1)},f=t=>{g(t)},S=t=>{j(t.target.value)},w=()=>{let t=[];for(let n=0;n<c.length;n++){let l=m.filter(O=>O.name==c[n]);l!=null&&l.length>0&&t.push(l[0])}C(t),o(t),x()},T=t=>{const n=d.filter(l=>l.name!==t.name);C(n),o(n)},_={selectedRowKeys:c,onChange:f},s=c.length>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Danh sách nhân viên"}),e.jsxs("div",{onClick:v,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(H,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn nhân viên"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(I,{columns:E,dataSource:d}),";"]}),e.jsxs(D,{width:990,title:"Chọn nhân viên",open:p,onOk:r,onCancel:x,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{className:"w-[320px] border-none pt-4",children:e.jsx(A,{value:u,onChange:S,placeholder:"Tìm kiếm tên nhân viên",prefix:e.jsx(P,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:s?`Đã chọn ${c.length} nhân viên`:""}),e.jsx(B,{type:"primary",onClick:w,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(I,{rowSelection:_,columns:le,dataSource:m})})]})]})})}function ce(){const o=Y(),[p]=$.useForm(),[i,c]=a.useState("Open"),[g,m]=a.useState([]),[y,h]=a.useState([]),[b,u]=a.useState([]),j=async()=>{let r=p.getFieldsValue(),x=g.map(s=>s.name),f=y.map(s=>s.name),S=b.map(s=>s.name),w="/api/resource/VGM_Campaign",T={campaign_name:r.campaign_name,campaign_description:r.campaign_description,start_date:d(r.campaign_start),end_date:d(r.campaign_end),campaign_status:i,products:JSON.stringify(x),employees:JSON.stringify(f),retails:JSON.stringify(S)},_=await F.post(w,T);_!=null&&_.data!=null?(z.success("Thêm mới thành công"),o("/campaign")):z.error("Thêm mới thất bại")},d=r=>new Date(r).toISOString().slice(0,19).replace("T"," "),C=r=>{c(r)},E=r=>{m(r)},N=r=>{h(r)},v=r=>{u(r)};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Thêm mới chiến dịch",icon:e.jsx("p",{onClick:()=>o("/campaign"),className:"mr-2 cursor-pointer",children:e.jsx(U,{})}),buttons:[{label:"Thêm mới",type:"primary",size:"20px",className:"flex items-center",action:j}]}),e.jsx("div",{className:"bg-white pt-4 rounded-xl",children:e.jsx($,{layout:"vertical",form:p,children:e.jsx(Z,{defaultActiveKey:"1",items:[{label:e.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:e.jsx(ne,{form:p,onCampaignStatusChange:C})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Sản phẩm"}),key:"2",children:e.jsx(ae,{onChangeCategory:E})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Nhân viên bán hàng"}),key:"3",children:e.jsx(re,{onChangeEmployees:N})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"4",children:e.jsx(se,{onChangeCustomer:v})}],indicatorSize:r=>r-18})})})]})}function ie(){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsx("title",{children:" Campaign Create"})}),e.jsx(ce,{})]})}export{ie as default};
