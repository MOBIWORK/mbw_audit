import{K as Eo,g as pf,u as Vl,e as ff,C as mf,m as gf,f as _f,r as ye,h as ed,i as td,k as Ms,N as yf,l as id,n as xf,I as vf,o as bf,E as wf,p as Sf,q as Tf,s as Cf,t as If,v as Ef,w as Mf,x as rd,A as Af,_ as kf,a as is,j as de,R as Yc,y as Ki,F as lr,z as jl,S as qr,G as ih,D as Pf,J as nd,L as zf,O as Df,Q as Lf,U as ya,V as Vu,W as eh,X as Rf,Y as sd,B as Ol,Z as Bf,$ as Ff,M as th,a0 as Jc,a1 as Of,a2 as Nf,a3 as Vf,H as jf}from"./main-ZqBQIJMP.js";import{U as $f}from"./index-aXuC21JB.js";import{L as Uf,a as qf}from"./index.esm-_kSkCyBH.js";const Zf=M=>{const{componentCls:z,notificationMarginEdge:G,animationMaxHeight:W}=M,Y=`${z}-notice`,ae=new Eo("antNotificationFadeIn",{"0%":{transform:"translate3d(100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}}),ce=new Eo("antNotificationTopFadeIn",{"0%":{top:-W,opacity:0},"100%":{top:0,opacity:1}}),c=new Eo("antNotificationBottomFadeIn",{"0%":{bottom:M.calc(W).mul(-1).equal(),opacity:0},"100%":{bottom:0,opacity:1}}),xe=new Eo("antNotificationLeftFadeIn",{"0%":{transform:"translate3d(-100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}});return{[z]:{[`&${z}-top, &${z}-bottom`]:{marginInline:0,[Y]:{marginInline:"auto auto"}},[`&${z}-top`]:{[`${z}-fade-enter${z}-fade-enter-active, ${z}-fade-appear${z}-fade-appear-active`]:{animationName:ce}},[`&${z}-bottom`]:{[`${z}-fade-enter${z}-fade-enter-active, ${z}-fade-appear${z}-fade-appear-active`]:{animationName:c}},[`&${z}-topRight, &${z}-bottomRight`]:{[`${z}-fade-enter${z}-fade-enter-active, ${z}-fade-appear${z}-fade-appear-active`]:{animationName:ae}},[`&${z}-topLeft, &${z}-bottomLeft`]:{marginRight:{value:0,_skip_check_:!0},marginLeft:{value:G,_skip_check_:!0},[Y]:{marginInlineEnd:"auto",marginInlineStart:0},[`${z}-fade-enter${z}-fade-enter-active, ${z}-fade-appear${z}-fade-appear-active`]:{animationName:xe}}}}},Gf=Zf,Hf=["top","topLeft","topRight","bottom","bottomLeft","bottomRight"],Wf={topLeft:"left",topRight:"right",bottomLeft:"left",bottomRight:"right",top:"left",bottom:"left"},Xf=(M,z)=>{const{componentCls:G}=M;return{[`${G}-${z}`]:{[`&${G}-stack > ${G}-notice-wrapper`]:{[z.startsWith("top")?"top":"bottom"]:0,[Wf[z]]:{value:0,_skip_check_:!0}}}}},Kf=M=>{const z={};for(let G=1;G<M.notificationStackLayer;G++)z[`&:nth-last-child(${G+1})`]={overflow:"hidden",[`& > ${M.componentCls}-notice`]:{opacity:0,transition:`opacity ${M.motionDurationMid}`}};return Object.assign({[`&:not(:nth-last-child(-n+${M.notificationStackLayer}))`]:{opacity:0,overflow:"hidden",color:"transparent",pointerEvents:"none"}},z)},Yf=M=>{const z={};for(let G=1;G<M.notificationStackLayer;G++)z[`&:nth-last-child(${G+1})`]={background:M.colorBgBlur,backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"};return Object.assign({},z)},Jf=M=>{const{componentCls:z}=M;return Object.assign({[`${z}-stack`]:{[`& > ${z}-notice-wrapper`]:Object.assign({transition:`all ${M.motionDurationSlow}, backdrop-filter 0s`,position:"absolute"},Kf(M))},[`${z}-stack:not(${z}-stack-expanded)`]:{[`& > ${z}-notice-wrapper`]:Object.assign({},Yf(M))},[`${z}-stack${z}-stack-expanded`]:{[`& > ${z}-notice-wrapper`]:{"&:not(:nth-last-child(-n + 1))":{opacity:1,overflow:"unset",color:"inherit",pointerEvents:"auto",[`& > ${M.componentCls}-notice`]:{opacity:1}},"&:after":{content:'""',position:"absolute",height:M.margin,width:"100%",insetInline:0,bottom:M.calc(M.margin).mul(-1).equal(),background:"transparent",pointerEvents:"auto"}}}},Hf.map(G=>Xf(M,G)).reduce((G,W)=>Object.assign(Object.assign({},G),W),{}))},Qf=Jf,ad=M=>{const{iconCls:z,componentCls:G,boxShadow:W,fontSizeLG:Y,notificationMarginBottom:ae,borderRadiusLG:ce,colorSuccess:c,colorInfo:xe,colorWarning:H,colorError:Ve,colorTextHeading:He,notificationBg:Ae,notificationPadding:Xe,notificationMarginEdge:it,fontSize:yt,lineHeight:xt,width:lt,notificationIconSize:At,colorText:bt}=M,nt=`${G}-notice`;return{position:"relative",marginBottom:ae,marginInlineStart:"auto",background:Ae,borderRadius:ce,boxShadow:W,[nt]:{padding:Xe,width:lt,maxWidth:`calc(100vw - ${Vl(M.calc(it).mul(2).equal())})`,overflow:"hidden",lineHeight:xt,wordWrap:"break-word"},[`${G}-close-icon`]:{fontSize:yt,cursor:"pointer"},[`${nt}-message`]:{marginBottom:M.marginXS,color:He,fontSize:Y,lineHeight:M.lineHeightLG},[`${nt}-description`]:{fontSize:yt,color:bt},[`${nt}-closable ${nt}-message`]:{paddingInlineEnd:M.paddingLG},[`${nt}-with-icon ${nt}-message`]:{marginBottom:M.marginXS,marginInlineStart:M.calc(M.marginSM).add(At).equal(),fontSize:Y},[`${nt}-with-icon ${nt}-description`]:{marginInlineStart:M.calc(M.marginSM).add(At).equal(),fontSize:yt},[`${nt}-icon`]:{position:"absolute",fontSize:At,lineHeight:1,[`&-success${z}`]:{color:c},[`&-info${z}`]:{color:xe},[`&-warning${z}`]:{color:H},[`&-error${z}`]:{color:Ve}},[`${nt}-close`]:{position:"absolute",top:M.notificationPaddingVertical,insetInlineEnd:M.notificationPaddingHorizontal,color:M.colorIcon,outline:"none",width:M.notificationCloseButtonSize,height:M.notificationCloseButtonSize,borderRadius:M.borderRadiusSM,transition:`background-color ${M.motionDurationMid}, color ${M.motionDurationMid}`,display:"flex",alignItems:"center",justifyContent:"center","&:hover":{color:M.colorIconHover,backgroundColor:M.closeBtnHoverBg}},[`${nt}-btn`]:{float:"right",marginTop:M.marginSM}}},em=M=>{const{componentCls:z,notificationMarginBottom:G,notificationMarginEdge:W,motionDurationMid:Y,motionEaseInOut:ae}=M,ce=`${z}-notice`,c=new Eo("antNotificationFadeOut",{"0%":{maxHeight:M.animationMaxHeight,marginBottom:G},"100%":{maxHeight:0,marginBottom:0,paddingTop:0,paddingBottom:0,opacity:0}});return[{[z]:Object.assign(Object.assign({},ff(M)),{position:"fixed",zIndex:M.zIndexPopup,marginRight:{value:W,_skip_check_:!0},[`${z}-hook-holder`]:{position:"relative"},[`${z}-fade-appear-prepare`]:{opacity:"0 !important"},[`${z}-fade-enter, ${z}-fade-appear`]:{animationDuration:M.motionDurationMid,animationTimingFunction:ae,animationFillMode:"both",opacity:0,animationPlayState:"paused"},[`${z}-fade-leave`]:{animationTimingFunction:ae,animationFillMode:"both",animationDuration:Y,animationPlayState:"paused"},[`${z}-fade-enter${z}-fade-enter-active, ${z}-fade-appear${z}-fade-appear-active`]:{animationPlayState:"running"},[`${z}-fade-leave${z}-fade-leave-active`]:{animationName:c,animationPlayState:"running"},"&-rtl":{direction:"rtl",[`${ce}-btn`]:{float:"left"}}})},{[z]:{[`${ce}-wrapper`]:Object.assign({},ad(M))}}]},od=M=>({zIndexPopup:M.zIndexPopupBase+mf+50,width:384,closeBtnHoverBg:M.wireframe?"transparent":M.colorFillContent}),ld=M=>{const z=M.paddingMD,G=M.paddingLG;return gf(M,{notificationBg:M.colorBgElevated,notificationPaddingVertical:z,notificationPaddingHorizontal:G,notificationIconSize:M.calc(M.fontSizeLG).mul(M.lineHeightLG).equal(),notificationCloseButtonSize:M.calc(M.controlHeightLG).mul(.55).equal(),notificationMarginBottom:M.margin,notificationPadding:`${Vl(M.paddingMD)} ${Vl(M.paddingContentHorizontalLG)}`,notificationMarginEdge:M.marginLG,animationMaxHeight:150,notificationStackLayer:3})},cd=pf("Notification",M=>{const z=ld(M);return[em(z),Gf(z),Qf(z)]},od),tm=_f(["Notification","PurePanel"],M=>{const z=`${M.componentCls}-notice`,G=ld(M);return{[`${z}-pure-panel`]:Object.assign(Object.assign({},ad(G)),{width:G.width,maxWidth:`calc(100vw - ${Vl(M.calc(G.notificationMarginEdge).mul(2).equal())})`,margin:0})}},od);var im=function(M,z){var G={};for(var W in M)Object.prototype.hasOwnProperty.call(M,W)&&z.indexOf(W)<0&&(G[W]=M[W]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Y=0,W=Object.getOwnPropertySymbols(M);Y<W.length;Y++)z.indexOf(W[Y])<0&&Object.prototype.propertyIsEnumerable.call(M,W[Y])&&(G[W[Y]]=M[W[Y]]);return G};function rh(M,z){return z===null||z===!1?null:z||ye.createElement("span",{className:`${M}-close-x`},ye.createElement(id,{className:`${M}-close-icon`}))}const rm={success:xf,info:vf,error:bf,warning:wf},hd=M=>{const{prefixCls:z,icon:G,type:W,message:Y,description:ae,btn:ce,role:c="alert"}=M;let xe=null;return G?xe=ye.createElement("span",{className:`${z}-icon`},G):W&&(xe=ye.createElement(rm[W]||null,{className:Ms(`${z}-icon`,`${z}-icon-${W}`)})),ye.createElement("div",{className:Ms({[`${z}-with-icon`]:xe}),role:c},xe,ye.createElement("div",{className:`${z}-message`},Y),ye.createElement("div",{className:`${z}-description`},ae),ce&&ye.createElement("div",{className:`${z}-btn`},ce))},nm=M=>{const{prefixCls:z,className:G,icon:W,type:Y,message:ae,description:ce,btn:c,closable:xe=!0,closeIcon:H,className:Ve}=M,He=im(M,["prefixCls","className","icon","type","message","description","btn","closable","closeIcon","className"]),{getPrefixCls:Ae}=ye.useContext(ed),Xe=z||Ae("notification"),it=`${Xe}-notice`,yt=td(Xe),[xt,lt,At]=cd(Xe,yt);return xt(ye.createElement("div",{className:Ms(`${it}-pure-panel`,lt,G,At,yt)},ye.createElement(tm,{prefixCls:Xe}),ye.createElement(yf,Object.assign({},He,{prefixCls:Xe,eventKey:"pure",duration:null,closable:xe,className:Ms({notificationClassName:Ve}),closeIcon:rh(Xe,H),content:ye.createElement(hd,{prefixCls:it,icon:W,type:Y,message:ae,description:ce,btn:c})}))))},sm=nm;function am(M,z,G){let W;switch(M){case"top":W={left:"50%",transform:"translateX(-50%)",right:"auto",top:z,bottom:"auto"};break;case"topLeft":W={left:0,top:z,bottom:"auto"};break;case"topRight":W={right:0,top:z,bottom:"auto"};break;case"bottom":W={left:"50%",transform:"translateX(-50%)",right:"auto",top:"auto",bottom:G};break;case"bottomLeft":W={left:0,top:"auto",bottom:G};break;default:W={right:0,top:"auto",bottom:G};break}return W}function om(M){return{motionName:`${M}-fade`}}var lm=function(M,z){var G={};for(var W in M)Object.prototype.hasOwnProperty.call(M,W)&&z.indexOf(W)<0&&(G[W]=M[W]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Y=0,W=Object.getOwnPropertySymbols(M);Y<W.length;Y++)z.indexOf(W[Y])<0&&Object.prototype.propertyIsEnumerable.call(M,W[Y])&&(G[W[Y]]=M[W[Y]]);return G};const ju=24,cm=4.5,hm="topRight",um=M=>{let{children:z,prefixCls:G}=M;const W=td(G),[Y,ae,ce]=cd(G,W);return Y(ye.createElement(If,{classNames:{list:Ms(ae,ce,W)}},z))},dm=(M,z)=>{let{prefixCls:G,key:W}=z;return ye.createElement(um,{prefixCls:G,key:W},M)},pm=ye.forwardRef((M,z)=>{const{top:G,bottom:W,prefixCls:Y,getContainer:ae,maxCount:ce,rtl:c,onAllRemoved:xe,stack:H}=M,{getPrefixCls:Ve,getPopupContainer:He,notification:Ae}=ye.useContext(ed),[,Xe]=Tf(),it=Y||Ve("notification"),yt=nt=>am(nt,G??ju,W??ju),xt=()=>Ms({[`${it}-rtl`]:c}),lt=()=>om(it),[At,bt]=Cf({prefixCls:it,style:yt,className:xt,motion:lt,closable:!0,closeIcon:rh(it),duration:cm,getContainer:()=>ae?.()||He?.()||document.body,maxCount:ce,onAllRemoved:xe,renderNotifications:dm,stack:H===!1?!1:{threshold:typeof H=="object"?H?.threshold:void 0,offset:8,gap:Xe.margin}});return ye.useImperativeHandle(z,()=>Object.assign(Object.assign({},At),{prefixCls:it,notification:Ae})),bt});function ud(M){const z=ye.useRef(null);return Sf(),[ye.useMemo(()=>{const W=c=>{var xe;if(!z.current)return;const{open:H,prefixCls:Ve,notification:He}=z.current,Ae=`${Ve}-notice`,{message:Xe,description:it,icon:yt,type:xt,btn:lt,className:At,style:bt,role:nt="alert",closeIcon:ut}=c,li=lm(c,["message","description","icon","type","btn","className","style","role","closeIcon"]),cr=rh(Ae,ut);return H(Object.assign(Object.assign({placement:(xe=M?.placement)!==null&&xe!==void 0?xe:hm},li),{content:ye.createElement(hd,{prefixCls:Ae,icon:yt,type:xt,message:Xe,description:it,btn:lt,role:nt}),className:Ms(xt&&`${Ae}-${xt}`,At,He?.className),style:Object.assign(Object.assign({},He?.style),bt),closeIcon:cr,closable:!!cr}))},ae={open:W,destroy:c=>{var xe,H;c!==void 0?(xe=z.current)===null||xe===void 0||xe.close(c):(H=z.current)===null||H===void 0||H.destroy()}};return["success","info","warning","error"].forEach(c=>{ae[c]=xe=>W(Object.assign(Object.assign({},xe),{type:c}))}),ae},[]),ye.createElement(pm,Object.assign({key:"notification-holder"},M,{ref:z}))]}function fm(M){return ud(M)}let Ur=null,Nl=M=>M(),$l=[],Ul={};function $u(){const{prefixCls:M,getContainer:z,rtl:G,maxCount:W,top:Y,bottom:ae}=Ul,ce=M??rd().getPrefixCls("notification"),c=z?.()||document.body;return{prefixCls:ce,getContainer:()=>c,rtl:G,maxCount:W,top:Y,bottom:ae}}const mm=ye.forwardRef((M,z)=>{const[G,W]=ye.useState($u),[Y,ae]=ud(G),ce=rd(),c=ce.getRootPrefixCls(),xe=ce.getIconPrefixCls(),H=ce.getTheme(),Ve=()=>{W($u)};return ye.useEffect(Ve,[]),ye.useImperativeHandle(z,()=>{const He=Object.assign({},Y);return Object.keys(He).forEach(Ae=>{He[Ae]=function(){return Ve(),Y[Ae].apply(Y,arguments)}}),{instance:He,sync:Ve}}),ye.createElement(Mf,{prefixCls:c,iconPrefixCls:xe,theme:H},ae)});function nh(){if(!Ur){const M=document.createDocumentFragment(),z={fragment:M};Ur=z,Nl(()=>{Ef(ye.createElement(mm,{ref:G=>{const{instance:W,sync:Y}=G||{};Promise.resolve().then(()=>{!z.instance&&W&&(z.instance=W,z.sync=Y,nh())})}}),M)});return}Ur.instance&&($l.forEach(M=>{switch(M.type){case"open":{Nl(()=>{Ur.instance.open(Object.assign(Object.assign({},Ul),M.config))});break}case"destroy":Nl(()=>{Ur?.instance.destroy(M.key)});break}}),$l=[])}function gm(M){Ul=Object.assign(Object.assign({},Ul),M),Nl(()=>{var z;(z=Ur?.sync)===null||z===void 0||z.call(Ur)})}function dd(M){$l.push({type:"open",config:M}),nh()}function _m(M){$l.push({type:"destroy",key:M}),nh()}const ym=["success","info","warning","error"],xm={open:dd,destroy:_m,config:gm,useNotification:fm,_InternalPanelDoNotUseOrYouWillBeFired:sm},pd=xm;ym.forEach(M=>{pd[M]=z=>dd(Object.assign(Object.assign({},z),{type:M}))});var vm={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};const bm=vm;var wm=function(z,G){return ye.createElement(Af,kf({},z,{ref:G,icon:bm}))};const Sm=ye.forwardRef(wm),Tm=[{label:"Hoạt động",value:"Active"},{label:"Khóa",value:"Lock"}],Cm=[{label:"Thêm khách hàng",value:"add"},{label:"Chọn khách hàng",value:"Choose"},{label:"Import khách hàng",value:"Import"}],sh=[{title:"Mã khách hàng",dataIndex:"customer_id",key:"customerid"},{title:"Tên khách hàng",dataIndex:"customer_name",key:"customername"}],fd=[{title:"Địa chỉ",dataIndex:"display_address",key:"display_address"},{title:"Số điện thoại",dataIndex:"phone_number",key:"phone_number"}],md=[{customer_id:"431456",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:"1;2;3;4;5"},{customer_id:"4314s56",customer_name:"Chu Văn A",display_address:"CT1 Chung cư bộ công an",phone_number:"0123456789",frequency:""}],Im=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],Em={customer_type:"Loại khách hàng",customer_group:"Nhóm khách hàng",city:"Tỉnh/Thành phố",district:"Quận/huyện",ward:"Phường/xã"},Mm=[{label:"Thứ 2",value:"Thứ 2"},{label:"Thứ 3",value:"Thứ 3"},{label:"Thứ 4",value:"Thứ 4"},{label:"Thứ 5",value:"Thứ 5"},{label:"Thứ 6",value:"Thứ 6"},{label:"Thứ 7",value:"Thứ 7"},{label:"Chủ nhật",value:"Chủ nhật"}];let Fl;const Am=(M,z)=>{console.log(M),Fl&&(clearTimeout(Fl),Fl=null),M?Fl=setTimeout(()=>{z(M)},300):z("")};function km(){const[M,z]=ye.useState(""),[G,W]=ye.useState([]),[Y,ae]=ye.useState([]);ye.useEffect(()=>{(async()=>{let c=await is.get("/api/method/mbw_dms.api.router.get_team_sale");W(c.result.map(xe=>({label:xe,value:xe})))})()},[]),ye.useEffect(()=>{(async()=>{let c=await is.get("/api/method/frappe.desk.search.search_link",{params:{txt:M,doctype:"Employee",ignore_user_permissions:0,reference_doctype:"Attendance",query:"erpnext.controllers.queries.employee_query"}}),{results:xe}=c;ae(xe.map(H=>({value:H.value,label:H.description})))})()},[M]),console.log("listEmployees",Y);const ce=c=>{Am(c,z)};return de.jsxs("div",{className:"p-4 pt-[43px] pb-[58px]",children:[de.jsxs(Yc,{children:[de.jsx(Ki,{span:12,children:de.jsx(lr,{label:"Mã tuyến",name:"channel_code",required:!0,children:de.jsx(jl,{})})}),de.jsx(Ki,{span:12,children:de.jsx(lr,{label:"Tên tuyến",name:"channel_name",required:!0,children:de.jsx(jl,{})})})]}),de.jsxs(Yc,{children:[de.jsx(Ki,{span:12,children:de.jsx(lr,{label:"Team sale",name:"team_sale",required:!0,children:de.jsx(qr,{showSearch:!0,options:G,defaultActiveFirstOption:!1})})}),de.jsx(Ki,{span:12,children:de.jsx(lr,{label:"Nhân viên",name:"employee",required:!0,children:de.jsx(qr,{showSearch:!0,notFoundContent:null,onSearch:ce,options:Y})})})]}),de.jsxs(Yc,{children:[de.jsx(Ki,{span:12,children:de.jsx(lr,{label:"Ngày đi tuyến",name:"travel_date",required:!0,children:de.jsx(qr,{options:Mm})})}),de.jsx(Ki,{span:12,children:de.jsx(lr,{label:"Trạng thái",name:"status",children:de.jsx(qr,{options:Tm,defaultValue:"Active"})})})]})]})}const Pm=({size:M=20})=>de.jsx("svg",{width:M,height:M,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:de.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.0267 1.13334C11.5534 0.501676 12.5792 0.933342 12.4959 1.75168L11.9076 7.50001H16.6667C16.8251 7.50007 16.9801 7.54524 17.1137 7.63024C17.2473 7.71523 17.3539 7.83653 17.4211 7.97993C17.4882 8.12333 17.5132 8.2829 17.4929 8.43994C17.4726 8.59698 17.4081 8.74501 17.3067 8.86668L8.97339 18.8667C8.44672 19.4983 7.42089 19.0667 7.50422 18.2483L8.09255 12.5H3.33339C3.17504 12.4999 3.01999 12.4548 2.88639 12.3698C2.75279 12.2848 2.64617 12.1635 2.57902 12.0201C2.51187 11.8767 2.48696 11.7171 2.50721 11.5601C2.52747 11.403 2.59205 11.255 2.69339 11.1333L11.0267 1.13334Z",fill:"currentColor"})}),zm=({size:M=20})=>de.jsxs("svg",{width:M,height:M,viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[de.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9.83847 8.58794C10.1411 8.46187 10.4827 8.4689 10.7798 8.60732L15.0763 10.6088C15.6604 10.8809 15.9133 11.5749 15.6412 12.159C15.3691 12.7431 14.6751 12.996 14.091 12.7239L11.4888 11.5117L11.653 20.2421L15.7503 22.1045V15.7497C15.7503 15.1053 16.2727 14.583 16.917 14.583C17.5613 14.583 18.0837 15.1053 18.0837 15.7497V22.1663L22.7503 20.2219V13.4163C22.7503 12.772 23.2727 12.2497 23.917 12.2497C24.5613 12.2497 25.0837 12.772 25.0837 13.4163V20.9997C25.0837 21.4707 24.8005 21.8955 24.3657 22.0766L17.3657 24.9933C17.0666 25.1179 16.7292 25.1125 16.4342 24.9784L10.5003 22.2812L4.56643 24.9784C4.20532 25.1426 3.78555 25.112 3.45204 24.8972C3.11854 24.6825 2.91699 24.313 2.91699 23.9163V12.2497C2.91699 11.7787 3.20019 11.3539 3.63494 11.1728L9.83847 8.58794ZM9.31945 20.2549L9.15297 11.4013L5.25033 13.0275V22.1045L9.31945 20.2549Z",fill:"currentColor"}),de.jsx("path",{d:"M19.8337 8.61425C20.478 8.61425 21.0003 8.09192 21.0003 7.44759C21.0003 6.80326 20.478 6.28092 19.8337 6.28092C19.1893 6.28092 18.667 6.80326 18.667 7.44759C18.667 8.09192 19.1893 8.61425 19.8337 8.61425Z",fill:"currentColor"}),de.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M19.8337 2.33301C17.2197 2.33301 15.167 4.52385 15.167 7.1293C15.167 7.85019 15.4274 8.59094 15.7195 9.21916C16.0229 9.8717 16.4198 10.5259 16.8094 11.1056C17.5898 12.2664 18.4067 13.2245 18.579 13.4238L18.5825 13.4278C18.89 13.7803 19.3411 13.9997 19.8337 13.9997C20.3262 13.9997 20.7773 13.7803 21.0848 13.4278L21.0883 13.4238C21.2606 13.2245 22.0776 12.2664 22.8579 11.1056C23.2476 10.5259 23.6444 9.8717 23.9478 9.21916C24.2399 8.59094 24.5003 7.85019 24.5003 7.1293C24.5003 4.52385 22.4476 2.33301 19.8337 2.33301ZM17.5003 7.1293C17.5003 5.7318 18.5876 4.66634 19.8337 4.66634C21.0797 4.66634 22.167 5.7318 22.167 7.1293C22.167 7.33968 22.0764 7.70972 21.832 8.23544C21.5989 8.73683 21.2738 9.2797 20.9214 9.80382C20.5368 10.376 20.1392 10.8972 19.8337 11.2802C19.5281 10.8972 19.1305 10.376 18.7459 9.80382C18.3936 9.2797 18.0684 8.73683 17.8353 8.23544C17.5909 7.70972 17.5003 7.33968 17.5003 7.1293Z",fill:"currentColor"})]}),Dm=({size:M=20,fill:z="#1877F2"})=>de.jsx("svg",{width:M,height:M,viewBox:"0 0 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:de.jsx("path",{d:"M23.1875 5.25H10.9375C10.6094 5.25 10.3314 5.36393 10.1035 5.5918C9.87565 5.81966 9.76172 6.09766 9.76172 6.42578C9.76172 6.73568 9.87565 7.00456 10.1035 7.23242C10.3314 7.46029 10.6094 7.57422 10.9375 7.57422H23.1875C23.4974 7.57422 23.7663 7.46029 23.9941 7.23242C24.222 7.00456 24.3359 6.73568 24.3359 6.42578C24.3359 6.09766 24.222 5.81966 23.9941 5.5918C23.7663 5.36393 23.4974 5.25 23.1875 5.25ZM23.1875 12.25H10.9375C10.6094 12.25 10.3314 12.3639 10.1035 12.5918C9.87565 12.8197 9.76172 13.0977 9.76172 13.4258C9.76172 13.7357 9.87565 14.0046 10.1035 14.2324C10.3314 14.4603 10.6094 14.5742 10.9375 14.5742H23.1875C23.4974 14.5742 23.7663 14.4603 23.9941 14.2324C24.222 14.0046 24.3359 13.7357 24.3359 13.4258C24.3359 13.0977 24.222 12.8197 23.9941 12.5918C23.7663 12.3639 23.4974 12.25 23.1875 12.25ZM23.1875 19.25H10.9375C10.6094 19.25 10.3314 19.3639 10.1035 19.5918C9.87565 19.8197 9.76172 20.0977 9.76172 20.4258C9.76172 20.7357 9.87565 21.0046 10.1035 21.2324C10.3314 21.4603 10.6094 21.5742 10.9375 21.5742H23.1875C23.4974 21.5742 23.7663 21.4603 23.9941 21.2324C24.222 21.0046 24.3359 20.7357 24.3359 20.4258C24.3359 20.0977 24.222 19.8197 23.9941 19.5918C23.7663 19.3639 23.4974 19.25 23.1875 19.25ZM5.25 18.6758C5.72396 18.6758 6.13411 18.8444 6.48047 19.1816C6.82682 19.5189 7 19.9336 7 20.4258C7 20.8997 6.82682 21.3099 6.48047 21.6562C6.13411 22.0026 5.72396 22.1758 5.25 22.1758C4.75781 22.1758 4.3431 22.0026 4.00586 21.6562C3.66862 21.3099 3.5 20.8997 3.5 20.4258C3.5 19.9336 3.66862 19.5189 4.00586 19.1816C4.3431 18.8444 4.75781 18.6758 5.25 18.6758ZM5.25 15.1758C4.75781 15.1758 4.3431 15.0026 4.00586 14.6562C3.66862 14.3099 3.5 13.8997 3.5 13.4258C3.5 12.9336 3.66862 12.5189 4.00586 12.1816C4.3431 11.8444 4.75781 11.6758 5.25 11.6758C5.72396 11.6758 6.13411 11.8444 6.48047 12.1816C6.82682 12.5189 7 12.9336 7 13.4258C7 13.8997 6.82682 14.3099 6.48047 14.6562C6.13411 15.0026 5.72396 15.1758 5.25 15.1758ZM5.25 8.17578C4.75781 8.17578 4.3431 8.0026 4.00586 7.65625C3.66862 7.3099 3.5 6.89974 3.5 6.42578C3.5 5.93359 3.66862 5.51888 4.00586 5.18164C4.3431 4.8444 4.75781 4.67578 5.25 4.67578C5.72396 4.67578 6.13411 4.8444 6.48047 5.18164C6.82682 5.51888 7 5.93359 7 6.42578C7 6.89974 6.82682 7.3099 6.48047 7.65625C6.13411 8.0026 5.72396 8.17578 5.25 8.17578Z",fill:"currentColor"})});function Lm({data:M,handleData:z}){const G=[{title:"Stt",dataIndex:"stt",key:"stt",render:(W,Y,ae)=>ae+1},...sh,...fd,{title:"Tần suất",dataIndex:"frequency",key:"frequency",render:(W,Y)=>de.jsx(qr,{mode:"multiple",options:Im,style:{width:"100%"},placeholder:"Chọn tần suất",onChange:ae=>{z(ce=>ce.map(c=>(c.customer_id==Y.customer_id&&(c.frequency=ae.toString().replaceAll(",",";")),c)))},defaultValue:W?W.split(";"):[]})},{title:"Hành động",dataIndex:"",key:"action",render:(W,Y)=>de.jsx("div",{className:"flex justify-center",onClick:()=>{z(ae=>[...ae.filter(ce=>ce.customer_id!=Y.customer_id)])},children:de.jsx(Pf,{})})}];return de.jsx("div",{className:"p-4",children:de.jsx(ih,{columns:G,dataSource:M,pagination:!1})})}const Rm=ye.createContext(null);function Bm(M,z){const G=Array.isArray(M)?M[0]:M?M.x:0,W=Array.isArray(M)?M[1]:M?M.y:0,Y=Array.isArray(z)?z[0]:z?z.x:0,ae=Array.isArray(z)?z[1]:z?z.y:0;return G===Y&&W===ae}function on(M,z){if(M===z)return!0;if(!M||!z)return!1;if(Array.isArray(M)){if(!Array.isArray(z)||M.length!==z.length)return!1;for(let G=0;G<M.length;G++)if(!on(M[G],z[G]))return!1;return!0}else if(Array.isArray(z))return!1;if(typeof M=="object"&&typeof z=="object"){const G=Object.keys(M),W=Object.keys(z);if(G.length!==W.length)return!1;for(const Y of G)if(!z.hasOwnProperty(Y)||!on(M[Y],z[Y]))return!1;return!0}return!1}function Fm(M){const z=M.clone();return z.pixelsToGLUnits=M.pixelsToGLUnits,z}function Uu(M,z){if(!M.getProjection)return;const G=M.getProjection(),W=z.getProjection();on(G,W)||z.setProjection(G)}function qu(M){return{longitude:M.center.lng,latitude:M.center.lat,zoom:M.zoom,pitch:M.pitch,bearing:M.bearing,padding:M.padding}}function Zu(M,z){const G=z.viewState||z;let W=!1;if("longitude"in G&&"latitude"in G){const Y=M.center;M.center=new Y.constructor(G.longitude,G.latitude),W=W||Y!==M.center}if("zoom"in G){const Y=M.zoom;M.zoom=G.zoom,W=W||Y!==M.zoom}if("bearing"in G){const Y=M.bearing;M.bearing=G.bearing,W=W||Y!==M.bearing}if("pitch"in G){const Y=M.pitch;M.pitch=G.pitch,W=W||Y!==M.pitch}return G.padding&&!M.isPaddingEqual(G.padding)&&(W=!0,M.padding=G.padding),W}const Om=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Gu(M){if(!M)return null;if(typeof M=="string"||("toJS"in M&&(M=M.toJS()),!M.layers))return M;const z={};for(const W of M.layers)z[W.id]=W;const G=M.layers.map(W=>{let Y=null;"interactive"in W&&(Y=Object.assign({},W),delete Y.interactive);const ae=z[W.ref];if(ae){Y=Y||Object.assign({},W),delete Y.ref;for(const ce of Om)ce in ae&&(Y[ce]=ae[ce])}return Y||W});return{...M,layers:G}}var Hu={};const Wu={version:8,sources:{},layers:[]},Xu={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Qc={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Ku={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Nm=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Vm=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class xa{constructor(z,G,W){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=Y=>{const ae=this.props[Ku[Y.type]];ae?ae(Y):Y.type==="error"&&console.error(Y.error)},this._onPointerEvent=Y=>{(Y.type==="mousemove"||Y.type==="mouseout")&&this._updateHover(Y);const ae=this.props[Xu[Y.type]];ae&&(this.props.interactiveLayerIds&&Y.type!=="mouseover"&&Y.type!=="mouseout"&&(Y.features=this._hoveredFeatures||this._queryRenderedFeatures(Y.point)),ae(Y),delete Y.features)},this._onCameraEvent=Y=>{if(!this._internalUpdate){const ae=this.props[Qc[Y.type]];ae&&ae(Y)}Y.type in this._deferredEvents&&(this._deferredEvents[Y.type]=!1)},this._MapClass=z,this.props=G,this._initialize(W)}get map(){return this._map}get transform(){return this._renderTransform}setProps(z){const G=this.props;this.props=z;const W=this._updateSettings(z,G);W&&this._createShadowTransform(this._map);const Y=this._updateSize(z),ae=this._updateViewState(z,!0);this._updateStyle(z,G),this._updateStyleComponents(z,G),this._updateHandlers(z,G),(W||Y||ae&&!this._map.isMoving())&&this.redraw()}static reuse(z,G){const W=xa.savedMaps.pop();if(!W)return null;const Y=W.map,ae=Y.getContainer();for(G.className=ae.className;ae.childNodes.length>0;)G.appendChild(ae.childNodes[0]);Y._container=G;const ce=Y._resizeObserver;ce&&(ce.disconnect(),ce.observe(G)),W.setProps({...z,styleDiffing:!1}),Y.resize();const{initialViewState:c}=z;return c&&(c.bounds?Y.fitBounds(c.bounds,{...c.fitBoundsOptions,duration:0}):W._updateViewState(c,!1)),Y.isStyleLoaded()?Y.fire("load"):Y.once("styledata",()=>Y.fire("load")),Y._update(),W}_initialize(z){const{props:G}=this,{mapStyle:W=Wu}=G,Y={...G,...G.initialViewState,accessToken:G.mapboxAccessToken||jm()||null,container:z,style:Gu(W)},ae=Y.initialViewState||Y.viewState||Y;if(Object.assign(Y,{center:[ae.longitude||0,ae.latitude||0],zoom:ae.zoom||0,pitch:ae.pitch||0,bearing:ae.bearing||0}),G.gl){const Ve=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=Ve,G.gl)}const ce=new this._MapClass(Y);ae.padding&&ce.setPadding(ae.padding),G.cursor&&(ce.getCanvas().style.cursor=G.cursor),this._createShadowTransform(ce);const c=ce._render;ce._render=Ve=>{this._inRender=!0,c.call(ce,Ve),this._inRender=!1};const xe=ce._renderTaskQueue.run;ce._renderTaskQueue.run=Ve=>{xe.call(ce._renderTaskQueue,Ve),this._onBeforeRepaint()},ce.on("render",()=>this._onAfterRepaint());const H=ce.fire;ce.fire=this._fireEvent.bind(this,H),ce.on("resize",()=>{this._renderTransform.resize(ce.transform.width,ce.transform.height)}),ce.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Uu(ce.transform,this._renderTransform)}),ce.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const Ve in Xu)ce.on(Ve,this._onPointerEvent);for(const Ve in Qc)ce.on(Ve,this._onCameraEvent);for(const Ve in Ku)ce.on(Ve,this._onEvent);this._map=ce}recycle(){const G=this.map.getContainer().querySelector("[mapboxgl-children]");G?.remove(),xa.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const z=this._map;!this._inRender&&z.style&&(z._frame&&(z._frame.cancel(),z._frame=null),z._render())}_createShadowTransform(z){const G=Fm(z.transform);z.painter.transform=G,this._renderTransform=G}_updateSize(z){const{viewState:G}=z;if(G){const W=this._map;if(G.width!==W.transform.width||G.height!==W.transform.height)return W.resize(),!0}return!1}_updateViewState(z,G){if(this._internalUpdate)return!1;const W=this._map,Y=this._renderTransform,{zoom:ae,pitch:ce,bearing:c}=Y,xe=W.isMoving();xe&&(Y.cameraElevationReference="sea");const H=Zu(Y,{...qu(W.transform),...z});if(xe&&(Y.cameraElevationReference="ground"),H&&G){const Ve=this._deferredEvents;Ve.move=!0,Ve.zoom||(Ve.zoom=ae!==Y.zoom),Ve.rotate||(Ve.rotate=c!==Y.bearing),Ve.pitch||(Ve.pitch=ce!==Y.pitch)}return xe||Zu(W.transform,z),H}_updateSettings(z,G){const W=this._map;let Y=!1;for(const ae of Nm)if(ae in z&&!on(z[ae],G[ae])){Y=!0;const ce=W[`set${ae[0].toUpperCase()}${ae.slice(1)}`];ce?.call(W,z[ae])}return Y}_updateStyle(z,G){if(z.cursor!==G.cursor&&(this._map.getCanvas().style.cursor=z.cursor||""),z.mapStyle!==G.mapStyle){const{mapStyle:W=Wu,styleDiffing:Y=!0}=z,ae={diff:Y};return"localIdeographFontFamily"in z&&(ae.localIdeographFontFamily=z.localIdeographFontFamily),this._map.setStyle(Gu(W),ae),!0}return!1}_updateStyleComponents(z,G){const W=this._map;let Y=!1;return W.isStyleLoaded()&&("light"in z&&W.setLight&&!on(z.light,G.light)&&(Y=!0,W.setLight(z.light)),"fog"in z&&W.setFog&&!on(z.fog,G.fog)&&(Y=!0,W.setFog(z.fog)),"terrain"in z&&W.setTerrain&&!on(z.terrain,G.terrain)&&(!z.terrain||W.getSource(z.terrain.source))&&(Y=!0,W.setTerrain(z.terrain))),Y}_updateHandlers(z,G){var W,Y;const ae=this._map;let ce=!1;for(const c of Vm){const xe=(W=z[c])!==null&&W!==void 0?W:!0,H=(Y=G[c])!==null&&Y!==void 0?Y:!0;on(xe,H)||(ce=!0,xe?ae[c].enable(xe):ae[c].disable())}return ce}_queryRenderedFeatures(z){const G=this._map,W=G.transform,{interactiveLayerIds:Y=[]}=this.props;try{return G.transform=this._renderTransform,G.queryRenderedFeatures(z,{layers:Y.filter(G.getLayer.bind(G))})}catch{return[]}finally{G.transform=W}}_updateHover(z){var G;const{props:W}=this;if(W.interactiveLayerIds&&(W.onMouseMove||W.onMouseEnter||W.onMouseLeave)){const ae=z.type,ce=((G=this._hoveredFeatures)===null||G===void 0?void 0:G.length)>0,c=this._queryRenderedFeatures(z.point),xe=c.length>0;!xe&&ce&&(z.type="mouseleave",this._onPointerEvent(z)),this._hoveredFeatures=c,xe&&!ce&&(z.type="mouseenter",this._onPointerEvent(z)),z.type=ae}else this._hoveredFeatures=null}_fireEvent(z,G,W){const Y=this._map,ae=Y.transform,ce=typeof G=="string"?G:G.type;return ce==="move"&&this._updateViewState(this.props,!1),ce in Qc&&(typeof G=="object"&&(G.viewState=qu(ae)),this._map.isMoving())?(Y.transform=this._renderTransform,z.call(Y,G,W),Y.transform=ae,Y):(z.call(Y,G,W),Y)}_onBeforeRepaint(){const z=this._map;this._internalUpdate=!0;for(const W in this._deferredEvents)this._deferredEvents[W]&&z.fire(W);this._internalUpdate=!1;const G=this._map.transform;z.transform=this._renderTransform,this._onAfterRepaint=()=>{Uu(this._renderTransform,G),z.transform=G}}}xa.savedMaps=[];function jm(){let M=null;if(typeof location<"u"){const z=/access_token=([^&\/]*)/.exec(location.search);M=z&&z[1]}try{M=M||Hu.MapboxAccessToken}catch{}try{M=M||Hu.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return M}const $m=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Um(M){if(!M)return null;const z=M.map,G={getMap:()=>z,getCenter:()=>M.transform.center,getZoom:()=>M.transform.zoom,getBearing:()=>M.transform.bearing,getPitch:()=>M.transform.pitch,getPadding:()=>M.transform.padding,getBounds:()=>M.transform.getBounds(),project:W=>{const Y=z.transform;z.transform=M.transform;const ae=z.project(W);return z.transform=Y,ae},unproject:W=>{const Y=z.transform;z.transform=M.transform;const ae=z.unproject(W);return z.transform=Y,ae},queryTerrainElevation:(W,Y)=>{const ae=z.transform;z.transform=M.transform;const ce=z.queryTerrainElevation(W,Y);return z.transform=ae,ce},queryRenderedFeatures:(W,Y)=>{const ae=z.transform;z.transform=M.transform;const ce=z.queryRenderedFeatures(W,Y);return z.transform=ae,ce}};for(const W of qm(z))!(W in G)&&!$m.includes(W)&&(G[W]=z[W].bind(z));return G}function qm(M){const z=new Set;let G=M;for(;G;){for(const W of Object.getOwnPropertyNames(G))W[0]!=="_"&&typeof M[W]=="function"&&W!=="fire"&&W!=="setEventedParent"&&z.add(W);G=Object.getPrototypeOf(G)}return Array.from(z)}const Zm=typeof document<"u"?ye.useLayoutEffect:ye.useEffect,Gm=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Hm(M,z){for(const W of Gm)W in z&&(M[W]=z[W]);const{RTLTextPlugin:G="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=z;G&&M.getRTLTextPluginStatus&&M.getRTLTextPluginStatus()==="unavailable"&&M.setRTLTextPlugin(G,W=>{W&&console.error(W)},!0)}const Mo=ye.createContext(null);function Wm(M,z,G){const W=ye.useContext(Rm),[Y,ae]=ye.useState(null),ce=ye.useRef(),{current:c}=ye.useRef({mapLib:null,map:null});ye.useEffect(()=>{const Ve=M.mapLib;let He=!0,Ae;return Promise.resolve(Ve||G).then(Xe=>{if(!He)return;if(!Xe)throw new Error("Invalid mapLib");const it="Map"in Xe?Xe:Xe.default;if(!it.Map)throw new Error("Invalid mapLib");if(Hm(it,M),!it.supported||it.supported(M))M.reuseMaps&&(Ae=xa.reuse(M,ce.current)),Ae||(Ae=new xa(it.Map,M,ce.current)),c.map=Um(Ae),c.mapLib=it,ae(Ae),W?.onMapMount(c.map,M.id);else throw new Error("Map is not supported by this browser")}).catch(Xe=>{const{onError:it}=M;it?it({type:"error",target:null,originalEvent:null,error:Xe}):console.error(Xe)}),()=>{He=!1,Ae&&(W?.onMapUnmount(M.id),M.reuseMaps?Ae.recycle():Ae.destroy())}},[]),Zm(()=>{Y&&Y.setProps(M)}),ye.useImperativeHandle(z,()=>c.map,[Y]);const xe=ye.useMemo(()=>({position:"relative",width:"100%",height:"100%",...M.style}),[M.style]),H={height:"100%"};return ye.createElement("div",{id:M.id,ref:ce,style:xe},Y&&ye.createElement(Mo.Provider,{value:c},ye.createElement("div",{"mapboxgl-children":"",style:H},M.children)))}const Xm=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function As(M,z){if(!M||!z)return;const G=M.style;for(const W in z){const Y=z[W];Number.isFinite(Y)&&!Xm.test(W)?G[W]=`${Y}px`:G[W]=Y}}function Km(M,z){const{map:G,mapLib:W}=ye.useContext(Mo),Y=ye.useRef({props:M});Y.current.props=M;const ae=ye.useMemo(()=>{let yt=!1;ye.Children.forEach(M.children,At=>{At&&(yt=!0)});const xt={...M,element:yt?document.createElement("div"):null},lt=new W.Marker(xt);return lt.setLngLat([M.longitude,M.latitude]),lt.getElement().addEventListener("click",At=>{var bt,nt;(nt=(bt=Y.current.props).onClick)===null||nt===void 0||nt.call(bt,{type:"click",target:lt,originalEvent:At})}),lt.on("dragstart",At=>{var bt,nt;const ut=At;ut.lngLat=ae.getLngLat(),(nt=(bt=Y.current.props).onDragStart)===null||nt===void 0||nt.call(bt,ut)}),lt.on("drag",At=>{var bt,nt;const ut=At;ut.lngLat=ae.getLngLat(),(nt=(bt=Y.current.props).onDrag)===null||nt===void 0||nt.call(bt,ut)}),lt.on("dragend",At=>{var bt,nt;const ut=At;ut.lngLat=ae.getLngLat(),(nt=(bt=Y.current.props).onDragEnd)===null||nt===void 0||nt.call(bt,ut)}),lt},[]);ye.useEffect(()=>(ae.addTo(G.getMap()),()=>{ae.remove()}),[]);const{longitude:ce,latitude:c,offset:xe,style:H,draggable:Ve=!1,popup:He=null,rotation:Ae=0,rotationAlignment:Xe="auto",pitchAlignment:it="auto"}=M;return ye.useEffect(()=>{As(ae.getElement(),H)},[H]),ye.useImperativeHandle(z,()=>ae,[]),(ae.getLngLat().lng!==ce||ae.getLngLat().lat!==c)&&ae.setLngLat([ce,c]),xe&&!Bm(ae.getOffset(),xe)&&ae.setOffset(xe),ae.isDraggable()!==Ve&&ae.setDraggable(Ve),ae.getRotation()!==Ae&&ae.setRotation(Ae),ae.getRotationAlignment()!==Xe&&ae.setRotationAlignment(Xe),ae.getPitchAlignment()!==it&&ae.setPitchAlignment(it),ae.getPopup()!==He&&ae.setPopup(He),nd.createPortal(M.children,ae.getElement())}ye.memo(ye.forwardRef(Km));function Yu(M){return new Set(M?M.trim().split(/\s+/):[])}function Ym(M,z){const{map:G,mapLib:W}=ye.useContext(Mo),Y=ye.useMemo(()=>document.createElement("div"),[]),ae=ye.useRef({props:M});ae.current.props=M;const ce=ye.useMemo(()=>{const c={...M},xe=new W.Popup(c);return xe.setLngLat([M.longitude,M.latitude]),xe.once("open",H=>{var Ve,He;(He=(Ve=ae.current.props).onOpen)===null||He===void 0||He.call(Ve,H)}),xe},[]);if(ye.useEffect(()=>{const c=xe=>{var H,Ve;(Ve=(H=ae.current.props).onClose)===null||Ve===void 0||Ve.call(H,xe)};return ce.on("close",c),ce.setDOMContent(Y).addTo(G.getMap()),()=>{ce.off("close",c),ce.isOpen()&&ce.remove()}},[]),ye.useEffect(()=>{As(ce.getElement(),M.style)},[M.style]),ye.useImperativeHandle(z,()=>ce,[]),ce.isOpen()&&((ce.getLngLat().lng!==M.longitude||ce.getLngLat().lat!==M.latitude)&&ce.setLngLat([M.longitude,M.latitude]),M.offset&&!on(ce.options.offset,M.offset)&&ce.setOffset(M.offset),(ce.options.anchor!==M.anchor||ce.options.maxWidth!==M.maxWidth)&&(ce.options.anchor=M.anchor,ce.setMaxWidth(M.maxWidth)),ce.options.className!==M.className)){const c=Yu(ce.options.className),xe=Yu(M.className);for(const H of c)xe.has(H)||ce.removeClassName(H);for(const H of xe)c.has(H)||ce.addClassName(H);ce.options.className=M.className}return nd.createPortal(M.children,Y)}ye.memo(ye.forwardRef(Ym));function Ao(M,z,G,W){const Y=ye.useContext(Mo),ae=ye.useMemo(()=>M(Y),[]);return ye.useEffect(()=>{const ce=W||G||z,c=typeof z=="function"&&typeof G=="function"?z:null,xe=typeof G=="function"?G:typeof z=="function"?z:null,{map:H}=Y;return H.hasControl(ae)||(H.addControl(ae,ce?.position),c&&c(Y)),()=>{xe&&xe(Y),H.hasControl(ae)&&H.removeControl(ae)}},[]),ae}function Jm(M){const z=Ao(({mapLib:G})=>new G.AttributionControl(M),{position:M.position});return ye.useEffect(()=>{As(z._container,M.style)},[M.style]),null}ye.memo(Jm);function Qm(M){const z=Ao(({mapLib:G})=>new G.FullscreenControl({container:M.containerId&&document.getElementById(M.containerId)}),{position:M.position});return ye.useEffect(()=>{As(z._controlContainer,M.style)},[M.style]),null}ye.memo(Qm);function eg(M,z){const G=ye.useRef({props:M}),W=Ao(({mapLib:Y})=>{const ae=new Y.GeolocateControl(M),ce=ae._setupUI;return ae._setupUI=c=>{ae._container.hasChildNodes()||ce(c)},ae.on("geolocate",c=>{var xe,H;(H=(xe=G.current.props).onGeolocate)===null||H===void 0||H.call(xe,c)}),ae.on("error",c=>{var xe,H;(H=(xe=G.current.props).onError)===null||H===void 0||H.call(xe,c)}),ae.on("outofmaxbounds",c=>{var xe,H;(H=(xe=G.current.props).onOutOfMaxBounds)===null||H===void 0||H.call(xe,c)}),ae.on("trackuserlocationstart",c=>{var xe,H;(H=(xe=G.current.props).onTrackUserLocationStart)===null||H===void 0||H.call(xe,c)}),ae.on("trackuserlocationend",c=>{var xe,H;(H=(xe=G.current.props).onTrackUserLocationEnd)===null||H===void 0||H.call(xe,c)}),ae},{position:M.position});return G.current.props=M,ye.useImperativeHandle(z,()=>W,[]),ye.useEffect(()=>{As(W._container,M.style)},[M.style]),null}ye.memo(ye.forwardRef(eg));function tg(M){const z=Ao(({mapLib:G})=>new G.NavigationControl(M),{position:M.position});return ye.useEffect(()=>{As(z._container,M.style)},[M.style]),null}ye.memo(tg);function ig(M){const z=Ao(({mapLib:ae})=>new ae.ScaleControl(M),{position:M.position}),G=ye.useRef(M),W=G.current;G.current=M;const{style:Y}=M;return M.maxWidth!==void 0&&M.maxWidth!==W.maxWidth&&(z.options.maxWidth=M.maxWidth),M.unit!==void 0&&M.unit!==W.unit&&z.setUnit(M.unit),ye.useEffect(()=>{As(z._container,Y)},[Y]),null}ye.memo(ig);function Ju(M,z){if(!M)throw new Error(z)}let rg=0;function ng(M,z,G){if(M.style&&M.style._loaded){const W={...G};return delete W.id,delete W.children,M.addSource(z,W),M.getSource(z)}return null}function sg(M,z,G){Ju(z.id===G.id,"source id changed"),Ju(z.type===G.type,"source type changed");let W="",Y=0;for(const ce in z)ce!=="children"&&ce!=="id"&&!on(G[ce],z[ce])&&(W=ce,Y++);if(!Y)return;const ae=z.type;if(ae==="geojson")M.setData(z.data);else if(ae==="image")M.updateImage({url:z.url,coordinates:z.coordinates});else if("setCoordinates"in M&&Y===1&&W==="coordinates")M.setCoordinates(z.coordinates);else if("setUrl"in M)switch(W){case"url":M.setUrl(z.url);break;case"tiles":M.setTiles(z.tiles);break}else console.warn(`Unable to update <Source> prop: ${W}`)}function ag(M){const z=ye.useContext(Mo).map.getMap(),G=ye.useRef(M),[,W]=ye.useState(0),Y=ye.useMemo(()=>M.id||`jsx-source-${rg++}`,[]);ye.useEffect(()=>{if(z){const ce=()=>setTimeout(()=>W(c=>c+1),0);return z.on("styledata",ce),ce(),()=>{var c;if(z.off("styledata",ce),z.style&&z.style._loaded&&z.getSource(Y)){const xe=(c=z.getStyle())===null||c===void 0?void 0:c.layers;if(xe)for(const H of xe)H.source===Y&&z.removeLayer(H.id);z.removeSource(Y)}}}},[z]);let ae=z&&z.style&&z.getSource(Y);return ae?sg(ae,M,G.current):ae=ng(z,Y,M),G.current=M,ae&&ye.Children.map(M.children,ce=>ce&&ye.cloneElement(ce,{source:Y}))||null}const og=zf(()=>import("./mapbox-gl-FD4ghjK4.js").then(M=>M.m),__vite__mapDeps([0,1,2])),lg=ye.forwardRef(function(z,G){return Wm(z,G,og)}),cg=ag;var gd={exports:{}};(function(M,z){(function(G,W){M.exports=W()})(Df,function(){var G,W,Y;function ae(c,xe){if(!G)G=xe;else if(!W)W=xe;else{var H="var sharedChunk = {}; ("+G+")(sharedChunk); ("+W+")(sharedChunk);",Ve={};G(Ve),Y=xe(Ve),typeof window<"u"&&(Y.workerUrl=window.URL.createObjectURL(new Blob([H],{type:"text/javascript"})))}}ae(["exports"],function(c){function xe(i,e,r,s){return new(r||(r=Promise))(function(o,u){function p(x){try{_(s.next(x))}catch(b){u(b)}}function f(x){try{_(s.throw(x))}catch(b){u(b)}}function _(x){var b;x.done?o(x.value):(b=x.value,b instanceof r?b:new r(function(T){T(b)})).then(p,f)}_((s=s.apply(i,e||[])).next())})}function H(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var Ve=He;function He(i,e){this.x=i,this.y=e}He.prototype={clone:function(){return new He(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),o=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},He.convert=function(i){return i instanceof He?i:Array.isArray(i)?new He(i[0],i[1]):i};var Ae=H(Ve),Xe=it;function it(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}it.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var o=this.sampleCurveX(r)-i;if(Math.abs(o)<e)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=o/u}var p=0,f=1;for(r=i,s=0;s<20&&(o=this.sampleCurveX(r),!(Math.abs(o-i)<e));s++)i>o?p=r:f=r,r=.5*(f-p)+p;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var yt=H(Xe);let xt,lt;function At(){return xt==null&&(xt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),xt}function bt(){if(lt==null&&(lt=!1,At())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let s=0;s<5*5;s++){const o=4*s;e.fillStyle=`rgb(${o},${o+1},${o+2})`,e.fillRect(s%5,Math.floor(s/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){lt=!0;break}}}return lt||!1}function nt(i,e,r,s){const o=new yt(i,e,r,s);return function(u){return o.solve(u)}}const ut=nt(.25,.1,.25,1);function li(i,e,r){return Math.min(r,Math.max(e,i))}function cr(i,e,r){const s=r-e,o=((i-e)%s+s)%s+e;return o===e?r:o}function ci(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let ks=1;function Bt(i,e,r){const s={};for(const o in i)s[o]=e.call(r||this,i[o],o,i);return s}function kn(i,e,r){const s={};for(const o in i)e.call(r||this,i[o],o,i)&&(s[o]=i[o]);return s}function hr(i){return Array.isArray(i)?i.map(hr):typeof i=="object"&&i?Bt(i,hr):i}const Zr={};function bi(i){Zr[i]||(typeof console<"u"&&console.warn(i),Zr[i]=!0)}function Ni(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Mr(i){let e=0;for(let r,s,o=0,u=i.length,p=u-1;o<u;p=o++)r=i[o],s=i[p],e+=(s.x-r.x)*(r.y+s.y);return e}function Yi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ln=null;function rs(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Ps="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ns(i,e,r,s,o){return xe(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const u=new VideoFrame(i,{timestamp:0});try{const p=u?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const f=p.startsWith("BGR"),_=new Uint8ClampedArray(s*o*4);if(yield u.copyTo(_,function(x,b,T,I,k){const P=4*Math.max(-b,0),R=(Math.max(0,T)-T)*I*4+P,j=4*I,q=Math.max(0,b),te=Math.max(0,T);return{rect:{x:q,y:te,width:Math.min(x.width,b+I)-q,height:Math.min(x.height,T+k)-te},layout:[{offset:R,stride:j}]}}(i,e,r,s,o)),f)for(let x=0;x<_.length;x+=4){const b=_[x];_[x]=_[x+2],_[x+2]=b}return _}finally{u.close()}})}let gr,kt,Ai,cn;const Pn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(Ai||(Ai=document.createElement("a")),Ai.href=i,Ai.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(cn==null&&(cn=matchMedia("(prefers-reduced-motion: reduce)")),cn.matches)}},zn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Gr extends Error{constructor(e,r,s,o){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=o}}const ur=Yi()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ji=i=>zn.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function ss(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:ur(),signal:r.signal});let o=!1,u=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),u||fetch(s).then(p=>p.ok?(f=>{(i.type==="arrayBuffer"||i.type==="image"?f.arrayBuffer():i.type==="json"?f.json():f.text()).then(_=>{u||(o=!0,e(null,_,f.headers.get("Cache-Control"),f.headers.get("Expires")))}).catch(_=>{u||e(new Error(_.message))})})(p):p.blob().then(f=>e(new Gr(p.status,p.statusText,i.url,f)))).catch(p=>{p.code!==20&&e(new Error(p.message))}),{cancel:()=>{u=!0,o||r.abort()}}}const Hr=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Yi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Yi())return(Ji(i.url)||ss)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(ur())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ss(i,e);if(Yi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,o){const u=new XMLHttpRequest;u.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(u.responseType="arraybuffer");for(const p in s.headers)u.setRequestHeader(p,s.headers[p]);return s.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=s.credentials==="include",u.onerror=()=>{o(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(s.type==="json")try{p=JSON.parse(u.response)}catch(f){return o(f)}o(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else{const p=new Blob([u.response],{type:u.getResponseHeader("Content-Type")});o(new Gr(u.status,u.statusText,s.url,p))}},u.send(s.body),{cancel:()=>u.abort()}}(i,e)},as=function(i,e){return Hr(ci(i,{type:"arrayBuffer"}),e)};function Ar(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Dn(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function hn(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class Wr{constructor(e,r={}){ci(this,r),this.type=e}}class Xr extends Wr{constructor(e,r={}){super("error",ci({error:e},r))}}class un{on(e,r){return this._listeners=this._listeners||{},Dn(e,r,this._listeners),this}off(e,r){return hn(e,r,this._listeners),hn(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Dn(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new Wr(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const o=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const f of o)f.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const f of u)hn(s,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(ci(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Xr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ki=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Qi(i,e){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return ki.forEach(s=>{s in e&&(r[s]=e[s])}),r}function It(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!It(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!It(i[r],e[r]))return!1;return!0}return i===e}const ft={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function _r(i,e,r){r.push({command:ft.addSource,args:[i,e[i]]})}function Ln(i,e,r){e.push({command:ft.removeSource,args:[i]}),r[i]=!0}function kr(i,e,r,s){Ln(i,r,s),_r(i,e,r)}function zs(i,e,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!It(i[r][s],e[r][s]))return!1;for(s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&s!=="data"&&!It(i[r][s],e[r][s]))return!1;return!0}function Rn(i,e,r,s,o,u){let p;for(p in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,p)&&(It(i[p],e[p])||r.push({command:u,args:[s,p,e[p],o]}));for(p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(i,p)&&(It(i[p],e[p])||r.push({command:u,args:[s,p,e[p],o]}))}function Kr(i){return i.id}function dn(i,e){return i[e.id]=e,i}class Te{constructor(e,r,s,o){this.message=(e?`${e}: `:"")+s,o&&(this.identifier=o),r!=null&&r.__line__&&(this.line=r.__line__)}}function yr(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}class jt extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class pn{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,o]of r)this.bindings[s]=o}concat(e){return new pn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Pr={kind:"null"},Ie={kind:"number"},et={kind:"string"},Ke={kind:"boolean"},wi={kind:"color"},xr={kind:"object"},Je={kind:"value"},zr={kind:"collator"},O={kind:"formatted"},C={kind:"padding"},E={kind:"resolvedImage"},D={kind:"variableAnchorOffsetCollection"};function V(i,e){return{kind:"array",itemType:i,N:e}}function $(i){if(i.kind==="array"){const e=$(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ie=[Pr,Ie,et,Ke,wi,O,xr,V(Je),C,E,D];function K(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!K(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of ie)if(!K(r,e))return null}}return`Expected ${$(i)} but found ${$(e)} instead.`}function Z(i,e){return e.some(r=>r.kind===i.kind)}function ee(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ue(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const pe=.96422,ge=.82521,$e=4/29,We=6/29,Re=3*We*We,qe=We*We*We,Ye=Math.PI/180,vt=180/Math.PI;function Tt(i){return(i%=360)<0&&(i+=360),i}function pt([i,e,r,s]){let o,u;const p=mi((.2225045*(i=dt(i))+.7168786*(e=dt(e))+.0606169*(r=dt(r)))/1);i===e&&e===r?o=u=p:(o=mi((.4360747*i+.3850649*e+.1430804*r)/pe),u=mi((.0139322*i+.0971045*e+.7141733*r)/ge));const f=116*p-16;return[f<0?0:f,500*(o-p),200*(p-u),s]}function dt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function mi(i){return i>qe?Math.pow(i,1/3):i/Re+$e}function Et([i,e,r,s]){let o=(i+16)/116,u=isNaN(e)?o:o+e/500,p=isNaN(r)?o:o-r/200;return o=1*hi(o),u=pe*hi(u),p=ge*hi(p),[Yt(3.1338561*u-1.6168667*o-.4906146*p),Yt(-.9787684*u+1.9161415*o+.033454*p),Yt(.0719453*u-.2289914*o+1.4052427*p),s]}function Yt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function hi(i){return i>We?i*i*i:Re*(i-$e)}function er(i){return parseInt(i.padEnd(2,i),16)/255}function ko(i,e){return Bn(e?i/100:i,0,1)}function Bn(i,e,r){return Math.min(Math.max(e,i),r)}function Fn(i){return!i.some(Number.isNaN)}const ql={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class wt{constructor(e,r,s,o=1,u=!0){this.r=e,this.g=r,this.b=s,this.a=o,u||(this.r*=o,this.g*=o,this.b*=o,o||this.overwriteGetter("rgb",[e,r,s,o]))}static parse(e){if(e instanceof wt)return e;if(typeof e!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const o=ql[s];if(o){const[p,f,_]=o;return[p/255,f/255,_/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const p=s.length<6?1:2;let f=1;return[er(s.slice(f,f+=p)),er(s.slice(f,f+=p)),er(s.slice(f,f+=p)),er(s.slice(f,f+p)||"ff")]}if(s.startsWith("rgb")){const p=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[f,_,x,b,T,I,k,P,R,j,q,te]=p,X=[b||" ",k||" ",j].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const re=[x,I,R].join(""),se=re==="%%%"?100:re===""?255:0;if(se){const me=[Bn(+_/se,0,1),Bn(+T/se,0,1),Bn(+P/se,0,1),q?ko(+q,te):1];if(Fn(me))return me}}return}}const u=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(u){const[p,f,_,x,b,T,I,k,P]=u,R=[_||" ",b||" ",I].join("");if(R==="  "||R==="  /"||R===",,"||R===",,,"){const j=[+f,Bn(+x,0,100),Bn(+T,0,100),k?ko(+k,P):1];if(Fn(j))return function([q,te,X,re]){function se(me){const ze=(me+q/30)%12,Fe=te*Math.min(X,1-X);return X-Fe*Math.max(-1,Math.min(ze-3,9-ze,1))}return q=Tt(q),te/=100,X/=100,[se(0),se(8),se(4),re]}(j)}}}(e);return r?new wt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:s,a:o}=this,u=o||1/0;return this.overwriteGetter("rgb",[e/u,r/u,s/u,o])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,s,o,u]=pt(e),p=Math.sqrt(s*s+o*o);return[Math.round(1e4*p)?Tt(Math.atan2(o,s)*vt):NaN,p,r,u]}(this.rgb))}get lab(){return this.overwriteGetter("lab",pt(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,s,o]=this.rgb;return`rgba(${[e,r,s].map(u=>Math.round(255*u)).join(",")},${o})`}}wt.black=new wt(0,0,0,1),wt.white=new wt(1,1,1,1),wt.transparent=new wt(0,0,0,0),wt.red=new wt(1,0,0,1);class va{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ds{constructor(e,r,s,o,u){this.text=e,this.image=r,this.scale=s,this.fontStack=o,this.textColor=u}}class gi{constructor(e){this.sections=e}static fromString(e){return new gi([new Ds(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof gi?e:gi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Vi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Vi)return e;if(typeof e=="number")return new Vi([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Vi(e)}}toString(){return JSON.stringify(this.values)}}const Zl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class tr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof tr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const s=e[r],o=e[r+1];if(typeof s!="string"||!Zl.has(s)||!Array.isArray(o)||o.length!==2||typeof o[0]!="number"||typeof o[1]!="number")return}return new tr(e)}}toString(){return JSON.stringify(this.values)}}class ui{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ui({name:e,available:!1}):null}}function Ls(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function On(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof wt||i instanceof va||i instanceof gi||i instanceof Vi||i instanceof tr||i instanceof ui)return!0;if(Array.isArray(i)){for(const e of i)if(!On(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!On(i[e]))return!1;return!0}return!1}function Ft(i){if(i===null)return Pr;if(typeof i=="string")return et;if(typeof i=="boolean")return Ke;if(typeof i=="number")return Ie;if(i instanceof wt)return wi;if(i instanceof va)return zr;if(i instanceof gi)return O;if(i instanceof Vi)return C;if(i instanceof tr)return D;if(i instanceof ui)return E;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const o=Ft(s);if(r){if(r===o)continue;r=Je;break}r=o}return V(r||Je,e)}return xr}function mt(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof wt||i instanceof gi||i instanceof Vi||i instanceof tr||i instanceof ui?i.toString():JSON.stringify(i)}class fn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!On(e[1]))return r.error("invalid value");const s=e[1];let o=Ft(s);const u=r.expectedType;return o.kind!=="array"||o.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(o=u),new fn(o,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class $t{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Rs={string:et,number:Ie,boolean:Ke,object:xr};class ir{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,o=1;const u=e[0];if(u==="array"){let f,_;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in Rs)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=Rs[x],o++}else f=Je;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);_=e[2],o++}s=V(f,_)}else{if(!Rs[u])throw new Error(`Types doesn't contain name = ${u}`);s=Rs[u]}const p=[];for(;o<e.length;o++){const f=r.parse(e[o],o,Je);if(!f)return null;p.push(f)}return new ir(s,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!K(this.type,Ft(s)))return s;if(r===this.args.length-1)throw new $t(`Expected value to be of type ${$(this.type)}, but found ${$(Ft(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ba={"to-boolean":Ke,"to-color":wi,"to-number":Ie,"to-string":et};class Yr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!ba[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const o=ba[s],u=[];for(let p=1;p<e.length;p++){const f=r.parse(e[p],p,Je);if(!f)return null;u.push(f)}return new Yr(o,u)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,s;for(const o of this.args){if(r=o.evaluate(e),s=null,r instanceof wt)return r;if(typeof r=="string"){const u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ls(r[0],r[1],r[2],r[3]),!s))return new wt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new $t(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(e);const o=Vi.parse(r);if(o)return o}throw new $t(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(e);const o=tr.parse(r);if(o)return o}throw new $t(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const o=Number(r);if(!isNaN(o))return o}throw new $t(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return gi.fromString(mt(this.args[0].evaluate(e)));case"resolvedImage":return ui.fromString(mt(this.args[0].evaluate(e)));default:return mt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Po=["Unknown","Point","LineString","Polygon"];class wa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Po[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=wt.parse(e)),r}}class Bs{constructor(e,r,s=[],o,u=new pn,p=[]){this.registry=e,this.path=s,this.key=s.map(f=>`[${f}]`).join(""),this.scope=u,this.errors=p,this.expectedType=o,this._isConstant=r}parse(e,r,s,o,u={}){return r?this.concat(r,s,o)._parse(e,u):this._parse(e,u)}_parse(e,r){function s(o,u,p){return p==="assert"?new ir(u,[o]):p==="coerce"?new Yr(u,[o]):o}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=e[0];if(typeof o!="string")return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[o];if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,_=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||_.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string")if(f.kind!=="padding"||_.kind!=="value"&&_.kind!=="number"&&_.kind!=="array")if(f.kind!=="variableAnchorOffsetCollection"||_.kind!=="value"&&_.kind!=="array"){if(this.checkSubtype(f,_))return null}else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"assert")}if(!(p instanceof fn)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const f=new wa;try{p=new fn(p.type,p.evaluate(f))}catch(_){return this.error(_.message),null}}return p}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const o=typeof e=="number"?this.path.concat(e):this.path,u=s?this.scope.concat(s):this.scope;return new Bs(this.registry,this._isConstant,o,r||null,u,this.errors)}error(e,...r){const s=`${this.key}${r.map(o=>`[${o}]`).join("")}`;this.errors.push(new jt(s,e))}checkSubtype(e,r){const s=K(e,r);return s&&this.error(s),s}}class Fs{constructor(e,r,s){this.type=zr,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const o=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Ke);if(!o)return null;const u=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Ke);if(!u)return null;let p=null;return s.locale&&(p=r.parse(s.locale,1,et),!p)?null:new Fs(o,u,p)}evaluate(e){return new va(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Jr=8192;function Sa(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function os(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function zo(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,o=Math.pow(2,e.z);return[Math.round(r*o*Jr),Math.round(s*o*Jr)]}function Gl(i,e,r){const s=i[0]-e[0],o=i[1]-e[1],u=i[0]-r[0],p=i[1]-r[1];return s*p-u*o==0&&s*u<=0&&o*p<=0}function Ta(i,e){let r=!1;for(let p=0,f=e.length;p<f;p++){const _=e[p];for(let x=0,b=_.length;x<b-1;x++){if(Gl(i,_[x],_[x+1]))return!1;(o=_[x])[1]>(s=i)[1]!=(u=_[x+1])[1]>s[1]&&s[0]<(u[0]-o[0])*(s[1]-o[1])/(u[1]-o[1])+o[0]&&(r=!r)}}var s,o,u;return r}function Ca(i,e){for(let r=0;r<e.length;r++)if(Ta(i,e[r]))return!0;return!1}function Do(i,e,r,s){const o=s[0]-r[0],u=s[1]-r[1],p=(i[0]-r[0])*u-o*(i[1]-r[1]),f=(e[0]-r[0])*u-o*(e[1]-r[1]);return p>0&&f<0||p<0&&f>0}function Hl(i,e,r){for(const x of r)for(let b=0;b<x.length-1;++b)if((f=[(p=x[b+1])[0]-(u=x[b])[0],p[1]-u[1]])[0]*(_=[(o=e)[0]-(s=i)[0],o[1]-s[1]])[1]-f[1]*_[0]!=0&&Do(s,o,u,p)&&Do(u,p,s,o))return!0;var s,o,u,p,f,_;return!1}function Lo(i,e){for(let r=0;r<i.length;++r)if(!Ta(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Hl(i[r],i[r+1],e))return!1;return!0}function Ro(i,e){for(let r=0;r<e.length;r++)if(Lo(i,e[r]))return!0;return!1}function Os(i,e,r){const s=[];for(let o=0;o<i.length;o++){const u=[];for(let p=0;p<i[o].length;p++){const f=zo(i[o][p],r);Sa(e,f),u.push(f)}s.push(u)}return s}function Bo(i,e,r){const s=[];for(let o=0;o<i.length;o++){const u=Os(i[o],e,r);s.push(u)}return s}function Fo(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const o=.5*s;let u=i[0]-r[0]>o?-s:r[0]-i[0]>o?s:0;u===0&&(u=i[0]-r[2]>o?-s:r[2]-i[0]>o?s:0),i[0]+=u}Sa(e,i)}function Ia(i,e,r,s){const o=Math.pow(2,s.z)*Jr,u=[s.x*Jr,s.y*Jr],p=[];for(const f of i)for(const _ of f){const x=[_.x+u[0],_.y+u[1]];Fo(x,e,r,o),p.push(x)}return p}function Ea(i,e,r,s){const o=Math.pow(2,s.z)*Jr,u=[s.x*Jr,s.y*Jr],p=[];for(const _ of i){const x=[];for(const b of _){const T=[b.x+u[0],b.y+u[1]];Sa(e,T),x.push(T)}p.push(x)}if(e[2]-e[0]<=o/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const _ of p)for(const x of _)Fo(x,e,r,o)}var f;return p}class mn{constructor(e,r){this.type=Ke,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(On(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let o=0;o<s.features.length;++o){const u=s.features[o].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new mn(s,s.features[o].geometry)}else if(s.type==="Feature"){const o=s.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new mn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new mn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const o=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const f=Os(s.coordinates,u,p),_=Ia(r.geometry(),o,u,p);if(!os(o,u))return!1;for(const x of _)if(!Ta(x,f))return!1}if(s.type==="MultiPolygon"){const f=Bo(s.coordinates,u,p),_=Ia(r.geometry(),o,u,p);if(!os(o,u))return!1;for(const x of _)if(!Ca(x,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const o=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const f=Os(s.coordinates,u,p),_=Ea(r.geometry(),o,u,p);if(!os(o,u))return!1;for(const x of _)if(!Lo(x,f))return!1}if(s.type==="MultiPolygon"){const f=Bo(s.coordinates,u,p),_=Ea(r.geometry(),o,u,p);if(!os(o,u))return!1;for(const x of _)if(!Ro(x,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ns{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Ns(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class rr{constructor(e,r,s,o){this.name=e,this.type=r,this._evaluate=s,this.args=o}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],o=rr.definitions[s];if(!o)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(o)?o[0]:o.type,p=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,f=p.filter(([x])=>!Array.isArray(x)||x.length===e.length-1);let _=null;for(const[x,b]of f){_=new Bs(r.registry,Vs,r.path,null,r.scope);const T=[];let I=!1;for(let k=1;k<e.length;k++){const P=e[k],R=Array.isArray(x)?x[k-1]:x.type,j=_.parse(P,1+T.length,R);if(!j){I=!0;break}T.push(j)}if(!I)if(Array.isArray(x)&&x.length!==T.length)_.error(`Expected ${x.length} arguments, but found ${T.length} instead.`);else{for(let k=0;k<T.length;k++){const P=Array.isArray(x)?x[k]:x.type,R=T[k];_.concat(k+1).checkSubtype(P,R.type)}if(_.errors.length===0)return new rr(s,u,b,T)}}if(f.length===1)r.errors.push(..._.errors);else{const x=(f.length?f:p).map(([T])=>{return I=T,Array.isArray(I)?`(${I.map($).join(", ")})`:`(${$(I.type)}...)`;var I}).join(" | "),b=[];for(let T=1;T<e.length;T++){const I=r.parse(e[T],1+b.length);if(!I)return null;b.push($(I.type))}r.error(`Expected arguments of type ${x}, but found (${b.join(", ")}) instead.`)}return null}static register(e,r){rr.definitions=r;for(const s in r)e[s]=rr}}function Vs(i){if(i instanceof Ns)return Vs(i.boundExpression);if(i instanceof rr&&i.name==="error"||i instanceof Fs||i instanceof mn)return!1;const e=i instanceof Yr||i instanceof ir;let r=!0;return i.eachChild(s=>{r=e?r&&Vs(s):r&&s instanceof fn}),!!r&&js(i)&&$s(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function js(i){if(i instanceof rr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof mn)return!1;let e=!0;return i.eachChild(r=>{e&&!js(r)&&(e=!1)}),e}function ls(i){if(i instanceof rr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!ls(r)&&(e=!1)}),e}function $s(i,e){if(i instanceof rr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!$s(s,e)&&(r=!1)}),r}function Nn(i,e){const r=i.length-1;let s,o,u=0,p=r,f=0;for(;u<=p;)if(f=Math.floor((u+p)/2),s=i[f],o=i[f+1],s<=e){if(f===r||e<o)return f;u=f+1}else{if(!(s>e))throw new $t("Input is not a number.");p=f-1}return 0}class Qr{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[o,u]of s)this.labels.push(o),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Ie);if(!s)return null;const o=[];let u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let p=1;p<e.length;p+=2){const f=p===1?-1/0:e[p],_=e[p+1],x=p,b=p+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(o.length&&o[o.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const T=r.parse(_,b,u);if(!T)return null;u=u||T.type,o.push([f,T])}return new Qr(u,s,o)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const o=this.input.evaluate(e);if(o<=r[0])return s[0].evaluate(e);const u=r.length;return o>=r[u-1]?s[u-1].evaluate(e):s[Nn(r,o)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ct(i,e,r){return i+r*(e-i)}function Us(i,e,r){return i.map((s,o)=>ct(s,e[o],r))}const ji={number:ct,color:function(i,e,r,s="rgb"){switch(s){case"rgb":{const[o,u,p,f]=Us(i.rgb,e.rgb,r);return new wt(o,u,p,f,!1)}case"hcl":{const[o,u,p,f]=i.hcl,[_,x,b,T]=e.hcl;let I,k;if(isNaN(o)||isNaN(_))isNaN(o)?isNaN(_)?I=NaN:(I=_,p!==1&&p!==0||(k=x)):(I=o,b!==1&&b!==0||(k=u));else{let te=_-o;_>o&&te>180?te-=360:_<o&&o-_>180&&(te+=360),I=o+r*te}const[P,R,j,q]=function([te,X,re,se]){return te=isNaN(te)?0:te*Ye,Et([re,Math.cos(te)*X,Math.sin(te)*X,se])}([I,k??ct(u,x,r),ct(p,b,r),ct(f,T,r)]);return new wt(P,R,j,q,!1)}case"lab":{const[o,u,p,f]=Et(Us(i.lab,e.lab,r));return new wt(o,u,p,f,!1)}}},array:Us,padding:function(i,e,r){return new Vi(Us(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const s=i.values,o=e.values;if(s.length!==o.length)throw new $t(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const u=[];for(let p=0;p<s.length;p+=2){if(s[p]!==o[p])throw new $t(`Cannot interpolate values containing mismatched anchors. from[${p}]: ${s[p]}, to[${p}]: ${o[p]}`);u.push(s[p]);const[f,_]=s[p+1],[x,b]=o[p+1];u.push([ct(f,x,r),ct(_,b,r)])}return new tr(u)}};class $i{constructor(e,r,s,o,u){this.type=e,this.operator=r,this.interpolation=s,this.input=o,this.labels=[],this.outputs=[];for(const[p,f]of u)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,r,s,o){let u=0;if(e.name==="exponential")u=Ma(r,e.base,s,o);else if(e.name==="linear")u=Ma(r,1,s,o);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new yt(p[0],p[1],p[2],p[3]).solve(Ma(r,1,s,o))}return u}static parse(e,r){let[s,o,u,...p]=e;if(!Array.isArray(o)||o.length===0)return r.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){const x=o[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:x}}else{if(o[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const x=o.slice(1);if(x.length!==4||x.some(b=>typeof b!="number"||b<0||b>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,Ie),!u)return null;const f=[];let _=null;s==="interpolate-hcl"||s==="interpolate-lab"?_=wi:r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(let x=0;x<p.length;x+=2){const b=p[x],T=p[x+1],I=x+3,k=x+4;if(typeof b!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(f.length&&f[f.length-1][0]>=b)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const P=r.parse(T,k,_);if(!P)return null;_=_||P.type,f.push([b,P])}return ue(_,Ie)||ue(_,wi)||ue(_,C)||ue(_,D)||ue(_,V(Ie))?new $i(_,s,o,u,f):r.error(`Type ${$(_)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const o=this.input.evaluate(e);if(o<=r[0])return s[0].evaluate(e);const u=r.length;if(o>=r[u-1])return s[u-1].evaluate(e);const p=Nn(r,o),f=$i.interpolationFactor(this.interpolation,o,r[p],r[p+1]),_=s[p].evaluate(e),x=s[p+1].evaluate(e);switch(this.operator){case"interpolate":return ji[this.type.kind](_,x,f);case"interpolate-hcl":return ji.color(_,x,f,"hcl");case"interpolate-lab":return ji.color(_,x,f,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ma(i,e,r,s){const o=s-r,u=i-r;return o===0?0:e===1?u/o:(Math.pow(e,u)-1)/(Math.pow(e,o)-1)}class qs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const o=r.expectedType;o&&o.kind!=="value"&&(s=o);const u=[];for(const f of e.slice(1)){const _=r.parse(f,1+u.length,s,void 0,{typeAnnotation:"omit"});if(!_)return null;s=s||_.type,u.push(_)}if(!s)throw new Error("No output type");const p=o&&u.some(f=>K(o,f.type));return new qs(p?Je:s,u)}evaluate(e){let r,s=null,o=0;for(const u of this.args)if(o++,s=u.evaluate(e),s&&s instanceof ui&&!s.available&&(r||(r=s.name),s=null,o===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Zs{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const f=r.parse(e[u+1],u+1);if(!f)return null;s.push([p,f])}const o=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return o?new Zs(s,o):null}outputDefined(){return this.result.outputDefined()}}class Aa{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Ie),o=r.parse(e[2],2,V(r.expectedType||Je));return s&&o?new Aa(o.type.itemType,s,o):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new $t(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new $t(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new $t(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ka{constructor(e,r){this.type=Ke,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Je),o=r.parse(e[2],2,Je);return s&&o?Z(s.type,[Ke,et,Ie,Pr,Je])?new ka(s,o):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!ee(r,["boolean","string","number","null"]))throw new $t(`Expected first argument to be of type boolean, string, number or null, but found ${$(Ft(r))} instead.`);if(!ee(s,["string","array"]))throw new $t(`Expected second argument to be of type array or string, but found ${$(Ft(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Gs{constructor(e,r,s){this.type=Ie,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Je),o=r.parse(e[2],2,Je);if(!s||!o)return null;if(!Z(s.type,[Ke,et,Ie,Pr,Je]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(s.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,Ie);return u?new Gs(s,o,u):null}return new Gs(s,o)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!ee(r,["boolean","string","number","null"]))throw new $t(`Expected first argument to be of type boolean, string, number or null, but found ${$(Ft(r))} instead.`);if(!ee(s,["string","array"]))throw new $t(`Expected second argument to be of type array or string, but found ${$(Ft(s))} instead.`);if(this.fromIndex){const o=this.fromIndex.evaluate(e);return s.indexOf(r,o)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Pa{constructor(e,r,s,o,u,p){this.inputType=e,this.type=r,this.input=s,this.cases=o,this.outputs=u,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const u={},p=[];for(let x=2;x<e.length-1;x+=2){let b=e[x];const T=e[x+1];Array.isArray(b)||(b=[b]);const I=r.concat(x);if(b.length===0)return I.error("Expected at least one branch label.");for(const P of b){if(typeof P!="number"&&typeof P!="string")return I.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return I.error("Numeric branch labels must be integer values.");if(s){if(I.checkSubtype(s,Ft(P)))return null}else s=Ft(P);if(u[String(P)]!==void 0)return I.error("Branch labels must be unique.");u[String(P)]=p.length}const k=r.parse(T,x,o);if(!k)return null;o=o||k.type,p.push(k)}const f=r.parse(e[1],1,Je);if(!f)return null;const _=r.parse(e[e.length-1],e.length-1,o);return _?f.type.kind!=="value"&&r.concat(1).checkSubtype(s,f.type)?null:new Pa(s,o,f,u,p,_):null}evaluate(e){const r=this.input.evaluate(e);return(Ft(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class za{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const o=[];for(let p=1;p<e.length-1;p+=2){const f=r.parse(e[p],p,Ke);if(!f)return null;const _=r.parse(e[p+1],p+1,s);if(!_)return null;o.push([f,_]),s=s||_.type}const u=r.parse(e[e.length-1],e.length-1,s);if(!u)return null;if(!s)throw new Error("Can't infer output type");return new za(s,o,u)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Hs{constructor(e,r,s,o){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Je),o=r.parse(e[2],2,Ie);if(!s||!o)return null;if(!Z(s.type,[V(Je),et,Je]))return r.error(`Expected first argument to be of type array or string, but found ${$(s.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,Ie);return u?new Hs(s.type,s,o,u):null}return new Hs(s.type,s,o)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!ee(r,["string","array"]))throw new $t(`Expected first argument to be of type array or string, but found ${$(Ft(r))} instead.`);if(this.endIndex){const o=this.endIndex.evaluate(e);return r.slice(s,o)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Oo(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function No(i,e,r,s){return s.compare(e,r)===0}function Vn(i,e,r){const s=i!=="=="&&i!=="!=";return class _d{constructor(u,p,f){this.type=Ke,this.lhs=u,this.rhs=p,this.collator=f,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const f=u[0];let _=p.parse(u[1],1,Je);if(!_)return null;if(!Oo(f,_.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${$(_.type)}'.`);let x=p.parse(u[2],2,Je);if(!x)return null;if(!Oo(f,x.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${$(x.type)}'.`);if(_.type.kind!==x.type.kind&&_.type.kind!=="value"&&x.type.kind!=="value")return p.error(`Cannot compare types '${$(_.type)}' and '${$(x.type)}'.`);s&&(_.type.kind==="value"&&x.type.kind!=="value"?_=new ir(x.type,[_]):_.type.kind!=="value"&&x.type.kind==="value"&&(x=new ir(_.type,[x])));let b=null;if(u.length===4){if(_.type.kind!=="string"&&x.type.kind!=="string"&&_.type.kind!=="value"&&x.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(b=p.parse(u[3],3,zr),!b)return null}return new _d(_,x,b)}evaluate(u){const p=this.lhs.evaluate(u),f=this.rhs.evaluate(u);if(s&&this.hasUntypedArgument){const _=Ft(p),x=Ft(f);if(_.kind!==x.kind||_.kind!=="string"&&_.kind!=="number")throw new $t(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${_.kind}, ${x.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const _=Ft(p),x=Ft(f);if(_.kind!=="string"||x.kind!=="string")return e(u,p,f)}return this.collator?r(u,p,f,this.collator.evaluate(u)):e(u,p,f)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}}}const Wl=Vn("==",function(i,e,r){return e===r},No),Xl=Vn("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!No(0,e,r,s)}),Kl=Vn("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),Yl=Vn(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),Jl=Vn("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),Ql=Vn(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class Da{constructor(e,r,s,o,u){this.type=et,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=o,this.maxFractionDigits=u}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Ie);if(!s)return null;const o=e[2];if(typeof o!="object"||Array.isArray(o))return r.error("NumberFormat options argument must be an object.");let u=null;if(o.locale&&(u=r.parse(o.locale,1,et),!u))return null;let p=null;if(o.currency&&(p=r.parse(o.currency,1,et),!p))return null;let f=null;if(o["min-fraction-digits"]&&(f=r.parse(o["min-fraction-digits"],1,Ie),!f))return null;let _=null;return o["max-fraction-digits"]&&(_=r.parse(o["max-fraction-digits"],1,Ie),!_)?null:new Da(s,u,p,f,_)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ws{constructor(e){this.type=O,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const o=[];let u=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;let _=null;if(f["font-scale"]&&(_=r.parse(f["font-scale"],1,Ie),!_))return null;let x=null;if(f["text-font"]&&(x=r.parse(f["text-font"],1,V(et)),!x))return null;let b=null;if(f["text-color"]&&(b=r.parse(f["text-color"],1,wi),!b))return null;const T=o[o.length-1];T.scale=_,T.font=x,T.textColor=b}else{const _=r.parse(e[p],1,Je);if(!_)return null;const x=_.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,o.push({content:_,scale:null,font:null,textColor:null})}}return new Ws(o)}evaluate(e){return new gi(this.sections.map(r=>{const s=r.content.evaluate(e);return Ft(s)===E?new Ds("",s,null,null,null):new Ds(mt(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class La{constructor(e){this.type=E,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,et);return s?new La(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=ui.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ra{constructor(e){this.type=Ie,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${$(s.type)} instead.`):new Ra(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new $t(`Expected value to be of type string or array, but found ${$(Ft(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const jn={"==":Wl,"!=":Xl,">":Yl,"<":Kl,">=":Ql,"<=":Jl,array:ir,at:Aa,boolean:ir,case:za,coalesce:qs,collator:Fs,format:Ws,image:La,in:ka,"index-of":Gs,interpolate:$i,"interpolate-hcl":$i,"interpolate-lab":$i,length:Ra,let:Zs,literal:fn,match:Pa,number:ir,"number-format":Da,object:ir,slice:Hs,step:Qr,string:ir,"to-boolean":Yr,"to-color":Yr,"to-number":Yr,"to-string":Yr,var:Ns,within:mn};function Vo(i,[e,r,s,o]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const u=o?o.evaluate(i):1,p=Ls(e,r,s,u);if(p)throw new $t(p);return new wt(e/255,r/255,s/255,u,!1)}function jo(i,e){return i in e}function Ba(i,e){const r=e[i];return r===void 0?null:r}function gn(i){return{type:i}}function $o(i){return{result:"success",value:i}}function en(i){return{result:"error",value:i}}function $n(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Uo(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Fa(i){return!!i.expression&&i.expression.interpolated}function gt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ot(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function ec(i){return i}function ht(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",o=s||!(s||i.property!==void 0),u=i.type||(Fa(e)?"exponential":"interval");if(r||e.type==="padding"){const b=r?wt.parse:Vi.parse;(i=yr({},i)).stops&&(i.stops=i.stops.map(T=>[T[0],b(T[1])])),i.default=b(i.default?i.default:e.default)}if(i.colorSpace&&(p=i.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var p;let f,_,x;if(u==="exponential")f=cs;else if(u==="interval")f=Lt;else if(u==="categorical"){f=Nt,_=Object.create(null);for(const b of i.stops)_[b[0]]=b[1];x=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);f=qo}if(s){const b={},T=[];for(let P=0;P<i.stops.length;P++){const R=i.stops[P],j=R[0].zoom;b[j]===void 0&&(b[j]={zoom:j,type:i.type,property:i.property,default:i.default,stops:[]},T.push(j)),b[j].stops.push([R[0].value,R[1]])}const I=[];for(const P of T)I.push([b[P].zoom,ht(b[P],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:$i.interpolationFactor.bind(void 0,k),zoomStops:I.map(P=>P[0]),evaluate:({zoom:P},R)=>cs({stops:I,base:i.base},e,P).evaluate(P,R)}}if(o){const b=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:$i.interpolationFactor.bind(void 0,b),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>f(i,e,T,_,x)}}return{kind:"source",evaluate(b,T){const I=T&&T.properties?T.properties[i.property]:void 0;return I===void 0?_n(i.default,e.default):f(i,e,I,_,x)}}}function _n(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Nt(i,e,r,s,o){return _n(typeof r===o?s[r]:void 0,i.default,e.default)}function Lt(i,e,r){if(gt(r)!=="number")return _n(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const o=Nn(i.stops.map(u=>u[0]),r);return i.stops[o][1]}function cs(i,e,r){const s=i.base!==void 0?i.base:1;if(gt(r)!=="number")return _n(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const u=Nn(i.stops.map(b=>b[0]),r),p=function(b,T,I,k){const P=k-I,R=b-I;return P===0?0:T===1?R/P:(Math.pow(T,R)-1)/(Math.pow(T,P)-1)}(r,s,i.stops[u][0],i.stops[u+1][0]),f=i.stops[u][1],_=i.stops[u+1][1],x=ji[e.type]||ec;return typeof f.evaluate=="function"?{evaluate(...b){const T=f.evaluate.apply(void 0,b),I=_.evaluate.apply(void 0,b);if(T!==void 0&&I!==void 0)return x(T,I,p,i.colorSpace)}}:x(f,_,p,i.colorSpace)}function qo(i,e,r){switch(e.type){case"color":r=wt.parse(r);break;case"formatted":r=gi.fromString(r.toString());break;case"resolvedImage":r=ui.fromString(r.toString());break;case"padding":r=Vi.parse(r);break;default:gt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return _n(r,i.default,e.default)}rr.register(jn,{error:[{kind:"error"},[et],(i,[e])=>{throw new $t(e.evaluate(i))}],typeof:[et,[Je],(i,[e])=>$(Ft(e.evaluate(i)))],"to-rgba":[V(Ie,4),[wi],(i,[e])=>{const[r,s,o,u]=e.evaluate(i).rgb;return[255*r,255*s,255*o,u]}],rgb:[wi,[Ie,Ie,Ie],Vo],rgba:[wi,[Ie,Ie,Ie,Ie],Vo],has:{type:Ke,overloads:[[[et],(i,[e])=>jo(e.evaluate(i),i.properties())],[[et,xr],(i,[e,r])=>jo(e.evaluate(i),r.evaluate(i))]]},get:{type:Je,overloads:[[[et],(i,[e])=>Ba(e.evaluate(i),i.properties())],[[et,xr],(i,[e,r])=>Ba(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Je,[et],(i,[e])=>Ba(e.evaluate(i),i.featureState||{})],properties:[xr,[],i=>i.properties()],"geometry-type":[et,[],i=>i.geometryType()],id:[Je,[],i=>i.id()],zoom:[Ie,[],i=>i.globals.zoom],"heatmap-density":[Ie,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ie,[],i=>i.globals.lineProgress||0],accumulated:[Je,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ie,gn(Ie),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[Ie,gn(Ie),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:Ie,overloads:[[[Ie,Ie],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ie],(i,[e])=>-e.evaluate(i)]]},"/":[Ie,[Ie,Ie],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ie,[Ie,Ie],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ie,[],()=>Math.LN2],pi:[Ie,[],()=>Math.PI],e:[Ie,[],()=>Math.E],"^":[Ie,[Ie,Ie],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ie,[Ie],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ie,[Ie],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ie,[Ie],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ie,[Ie],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ie,[Ie],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ie,[Ie],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ie,[Ie],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ie,[Ie],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ie,[Ie],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ie,[Ie],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ie,gn(Ie),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ie,gn(Ie),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ie,[Ie],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ie,[Ie],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ie,[Ie],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ie,[Ie],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Ke,[et,Je],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Ke,[Je],(i,[e])=>i.id()===e.value],"filter-type-==":[Ke,[et],(i,[e])=>i.geometryType()===e.value],"filter-<":[Ke,[et,Je],(i,[e,r])=>{const s=i.properties()[e.value],o=r.value;return typeof s==typeof o&&s<o}],"filter-id-<":[Ke,[Je],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[Ke,[et,Je],(i,[e,r])=>{const s=i.properties()[e.value],o=r.value;return typeof s==typeof o&&s>o}],"filter-id->":[Ke,[Je],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[Ke,[et,Je],(i,[e,r])=>{const s=i.properties()[e.value],o=r.value;return typeof s==typeof o&&s<=o}],"filter-id-<=":[Ke,[Je],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[Ke,[et,Je],(i,[e,r])=>{const s=i.properties()[e.value],o=r.value;return typeof s==typeof o&&s>=o}],"filter-id->=":[Ke,[Je],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[Ke,[Je],(i,[e])=>e.value in i.properties()],"filter-has-id":[Ke,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ke,[V(et)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ke,[V(Je)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Ke,[et,V(Je)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Ke,[et,V(Je)],(i,[e,r])=>function(s,o,u,p){for(;u<=p;){const f=u+p>>1;if(o[f]===s)return!0;o[f]>s?p=f-1:u=f+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Ke,overloads:[[[Ke,Ke],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[gn(Ke),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ke,overloads:[[[Ke,Ke],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[gn(Ke),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Ke,[Ke],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Ke,[et],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[et,[et],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[et,[et],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[et,gn(Je),(i,e)=>e.map(r=>mt(r.evaluate(i))).join("")],"resolved-locale":[et,[zr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Oa{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new wa,this._defaultValue=r?(s=r).type==="color"&&Ot(s.default)?new wt(0,0,0,0):s.type==="color"?wt.parse(s.default)||null:s.type==="padding"?Vi.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?tr.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,o,u,p){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=o,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,o,u,p){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=o,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null;try{const f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new $t(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(f)} instead.`);return f}catch(f){return this._warningHistory[f.message]||(this._warningHistory[f.message]=!0,typeof console<"u"&&console.warn(f.message)),this._defaultValue}}}function Xs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in jn}function Ks(i,e){const r=new Bs(jn,Vs,[],e?function(o){const u={color:wi,string:et,number:Ie,enum:et,boolean:Ke,formatted:O,padding:C,resolvedImage:E,variableAnchorOffsetCollection:D};return o.type==="array"?V(u[o.value]||Je,o.length):u[o.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?$o(new Oa(s,e)):en(r.errors)}class Na{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!ls(r.expression)}evaluateWithoutErrorHandling(e,r,s,o,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,o,u,p)}evaluate(e,r,s,o,u,p){return this._styleExpression.evaluate(e,r,s,o,u,p)}}class Ys{constructor(e,r,s,o){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ls(r.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,r,s,o,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,o,u,p)}evaluate(e,r,s,o,u,p){return this._styleExpression.evaluate(e,r,s,o,u,p)}interpolationFactor(e,r,s){return this.interpolationType?$i.interpolationFactor(this.interpolationType,e,r,s):0}}function Va(i,e){const r=Ks(i,e);if(r.result==="error")return r;const s=r.value.expression,o=js(s);if(!o&&!$n(e))return en([new jt("","data expressions not supported")]);const u=$s(s,["zoom"]);if(!u&&!Uo(e))return en([new jt("","zoom expressions not supported")]);const p=us(s);return p||u?p instanceof jt?en([p]):p instanceof $i&&!Fa(e)?en([new jt("",'"interpolate" expressions cannot be used with this property')]):$o(p?new Ys(o?"camera":"composite",r.value,p.labels,p instanceof $i?p.interpolation:void 0):new Na(o?"constant":"source",r.value)):en([new jt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class hs{constructor(e,r){this._parameters=e,this._specification=r,yr(this,ht(this._parameters,this._specification))}static deserialize(e){return new hs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function us(i){let e=null;if(i instanceof Zs)e=us(i.result);else if(i instanceof qs){for(const r of i.args)if(e=us(r),e)break}else(i instanceof Qr||i instanceof $i)&&i.input instanceof rr&&i.input.name==="zoom"&&(e=i);return e instanceof jt||i.eachChild(r=>{const s=us(r);s instanceof jt?e=s:!e&&s?e=new jt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new jt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ds(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ds(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const tc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ja(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ds(i)||(i=Js(i));const e=Ks(i,tc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,o)=>e.value.evaluate(r,s,{},o),needGeometry:Zo(i)}}function ic(i,e){return i<e?-1:i>e?1:0}function Zo(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Zo(i[e]))return!0;return!1}function Js(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?$a(i[1],i[2],"=="):e==="!="?ps($a(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?$a(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Js))):e==="all"?["all"].concat(i.slice(1).map(Js)):e==="none"?["all"].concat(i.slice(1).map(Js).map(ps)):e==="in"?Go(i[1],i.slice(2)):e==="!in"?ps(Go(i[1],i.slice(2))):e==="has"?Ho(i[1]):e==="!has"?ps(Ho(i[1])):e!=="within"||i;var r}function $a(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Go(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(ic)]]:["filter-in-small",i,["literal",e]]}}function Ho(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ps(i){return["!",i]}function Qs(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let o="[";for(const u of i)o+=`${Qs(u)},`;return`${o}]`}const r=Object.keys(i).sort();let s="{";for(let o=0;o<r.length;o++)s+=`${JSON.stringify(r[o])}:${Qs(i[r[o]])},`;return`${s}}`}function ea(i){let e="";for(const r of ki)e+=`/${Qs(i[r])}`;return e}function Wo(i){const e=i.value;return e?[new Te(i.key,e,"constants have been deprecated as of v8")]:[]}function Ut(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function yn(i){if(Array.isArray(i))return i.map(yn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=yn(i[r]);return e}return Ut(i)}function Pi(i){const e=i.key,r=i.value,s=i.valueSpec||{},o=i.objectElementValidators||{},u=i.style,p=i.styleSpec,f=i.validateSpec;let _=[];const x=gt(r);if(x!=="object")return[new Te(e,r,`object expected, ${x} found`)];for(const b in r){const T=b.split(".")[0],I=s[T]||s["*"];let k;if(o[T])k=o[T];else if(s[T])k=f;else if(o["*"])k=o["*"];else{if(!s["*"]){_.push(new Te(e,r[b],`unknown property "${b}"`));continue}k=f}_=_.concat(k({key:(e&&`${e}.`)+b,value:r[b],valueSpec:I,style:u,styleSpec:p,object:r,objectKey:b,validateSpec:f},r))}for(const b in s)o[b]||s[b].required&&s[b].default===void 0&&r[b]===void 0&&_.push(new Te(e,r,`missing required property "${b}"`));return _}function Un(i){const e=i.value,r=i.valueSpec,s=i.style,o=i.styleSpec,u=i.key,p=i.arrayElementValidator||i.validateSpec;if(gt(e)!=="array")return[new Te(u,e,`array expected, ${gt(e)} found`)];if(r.length&&e.length!==r.length)return[new Te(u,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Te(u,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let f={type:r.value,values:r.values};o.$version<7&&(f.function=r.function),gt(r.value)==="object"&&(f=r.value);let _=[];for(let x=0;x<e.length;x++)_=_.concat(p({array:e,arrayIndex:x,value:e[x],valueSpec:f,validateSpec:i.validateSpec,style:s,styleSpec:o,key:`${u}[${x}]`}));return _}function fs(i){const e=i.key,r=i.value,s=i.valueSpec;let o=gt(r);return o==="number"&&r!=r&&(o="NaN"),o!=="number"?[new Te(e,r,`number expected, ${o} found`)]:"minimum"in s&&r<s.minimum?[new Te(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Te(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function ta(i){const e=i.valueSpec,r=Ut(i.value.type);let s,o,u,p={};const f=r!=="categorical"&&i.value.property===void 0,_=!f,x=gt(i.value.stops)==="array"&&gt(i.value.stops[0])==="array"&&gt(i.value.stops[0][0])==="object",b=Pi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(k){if(r==="identity")return[new Te(k.key,k.value,'identity function may not have a "stops" property')];let P=[];const R=k.value;return P=P.concat(Un({key:k.key,value:R,valueSpec:k.valueSpec,validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:T})),gt(R)==="array"&&R.length===0&&P.push(new Te(k.key,R,"array must have at least one stop")),P},default:function(k){return k.validateSpec({key:k.key,value:k.value,valueSpec:e,validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec})}}});return r==="identity"&&f&&b.push(new Te(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||b.push(new Te(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Fa(i.valueSpec)&&b.push(new Te(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(_&&!$n(i.valueSpec)?b.push(new Te(i.key,i.value,"property functions not supported")):f&&!Uo(i.valueSpec)&&b.push(new Te(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!x||i.value.property!==void 0||b.push(new Te(i.key,i.value,'"property" property is required')),b;function T(k){let P=[];const R=k.value,j=k.key;if(gt(R)!=="array")return[new Te(j,R,`array expected, ${gt(R)} found`)];if(R.length!==2)return[new Te(j,R,`array length 2 expected, length ${R.length} found`)];if(x){if(gt(R[0])!=="object")return[new Te(j,R,`object expected, ${gt(R[0])} found`)];if(R[0].zoom===void 0)return[new Te(j,R,"object stop key must have zoom")];if(R[0].value===void 0)return[new Te(j,R,"object stop key must have value")];if(u&&u>Ut(R[0].zoom))return[new Te(j,R[0].zoom,"stop zoom values must appear in ascending order")];Ut(R[0].zoom)!==u&&(u=Ut(R[0].zoom),o=void 0,p={}),P=P.concat(Pi({key:`${j}[0]`,value:R[0],valueSpec:{zoom:{}},validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{zoom:fs,value:I}}))}else P=P.concat(I({key:`${j}[0]`,value:R[0],valueSpec:{},validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec},R));return Xs(yn(R[1]))?P.concat([new Te(`${j}[1]`,R[1],"expressions are not allowed in function stops.")]):P.concat(k.validateSpec({key:`${j}[1]`,value:R[1],valueSpec:e,validateSpec:k.validateSpec,style:k.style,styleSpec:k.styleSpec}))}function I(k,P){const R=gt(k.value),j=Ut(k.value),q=k.value!==null?k.value:P;if(s){if(R!==s)return[new Te(k.key,q,`${R} stop domain type must match previous stop domain type ${s}`)]}else s=R;if(R!=="number"&&R!=="string"&&R!=="boolean")return[new Te(k.key,q,"stop domain value must be a number, string, or boolean")];if(R!=="number"&&r!=="categorical"){let te=`number expected, ${R} found`;return $n(e)&&r===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(k.key,q,te)]}return r!=="categorical"||R!=="number"||isFinite(j)&&Math.floor(j)===j?r!=="categorical"&&R==="number"&&o!==void 0&&j<o?[new Te(k.key,q,"stop domain values must appear in ascending order")]:(o=j,r==="categorical"&&j in p?[new Te(k.key,q,"stop domain values must be unique")]:(p[j]=!0,[])):[new Te(k.key,q,`integer expected, found ${j}`)]}}function xn(i){const e=(i.expressionContext==="property"?Va:Ks)(yn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Te(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Te(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ls(r))return[new Te(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!ls(r))return[new Te(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!$s(r,["zoom","feature-state"]))return[new Te(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!js(r))return[new Te(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ms(i){const e=i.key,r=i.value,s=i.valueSpec,o=[];return Array.isArray(s.values)?s.values.indexOf(Ut(r))===-1&&o.push(new Te(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Ut(r))===-1&&o.push(new Te(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),o}function qn(i){return ds(yn(i.value))?xn(yr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Xo(i)}function Xo(i){const e=i.value,r=i.key;if(gt(e)!=="array")return[new Te(r,e,`array expected, ${gt(e)} found`)];const s=i.styleSpec;let o,u=[];if(e.length<1)return[new Te(r,e,"filter array must have at least 1 element")];switch(u=u.concat(ms({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ut(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ut(e[1])==="$type"&&u.push(new Te(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new Te(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(o=gt(e[1]),o!=="string"&&u.push(new Te(`${r}[1]`,e[1],`string expected, ${o} found`)));for(let p=2;p<e.length;p++)o=gt(e[p]),Ut(e[1])==="$type"?u=u.concat(ms({key:`${r}[${p}]`,value:e[p],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):o!=="string"&&o!=="number"&&o!=="boolean"&&u.push(new Te(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)u=u.concat(Xo({key:`${r}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":o=gt(e[1]),e.length!==2?u.push(new Te(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):o!=="string"&&u.push(new Te(`${r}[1]`,e[1],`string expected, ${o} found`));break;case"within":o=gt(e[1]),e.length!==2?u.push(new Te(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):o!=="object"&&u.push(new Te(`${r}[1]`,e[1],`object expected, ${o} found`))}return u}function Ko(i,e){const r=i.key,s=i.validateSpec,o=i.style,u=i.styleSpec,p=i.value,f=i.objectKey,_=u[`${e}_${i.layerType}`];if(!_)return[];const x=f.match(/^(.*)-transition$/);if(e==="paint"&&x&&_[x[1]]&&_[x[1]].transition)return s({key:r,value:p,valueSpec:u.transition,style:o,styleSpec:u});const b=i.valueSpec||_[f];if(!b)return[new Te(r,p,`unknown property "${f}"`)];let T;if(gt(p)==="string"&&$n(b)&&!b.tokens&&(T=/^{([^}]+)}$/.exec(p)))return[new Te(r,p,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const I=[];return i.layerType==="symbol"&&(f==="text-field"&&o&&!o.glyphs&&I.push(new Te(r,p,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&Ot(yn(p))&&Ut(p.type)==="identity"&&I.push(new Te(r,p,'"text-font" does not support identity functions'))),I.concat(s({key:i.key,value:p,valueSpec:b,style:o,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:f}))}function Yo(i){return Ko(i,"paint")}function Jo(i){return Ko(i,"layout")}function Qo(i){let e=[];const r=i.value,s=i.key,o=i.style,u=i.styleSpec;r.type||r.ref||e.push(new Te(s,r,'either "type" or "ref" is required'));let p=Ut(r.type);const f=Ut(r.ref);if(r.id){const _=Ut(r.id);for(let x=0;x<i.arrayIndex;x++){const b=o.layers[x];Ut(b.id)===_&&e.push(new Te(s,r.id,`duplicate layer id "${r.id}", previously used at line ${b.id.__line__}`))}}if("ref"in r){let _;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&e.push(new Te(s,r[x],`"${x}" is prohibited for ref layers`))}),o.layers.forEach(x=>{Ut(x.id)===f&&(_=x)}),_?_.ref?e.push(new Te(s,r.ref,"ref cannot reference another ref layer")):p=Ut(_.type):e.push(new Te(s,r.ref,`ref layer "${f}" not found`))}else if(p!=="background")if(r.source){const _=o.sources&&o.sources[r.source],x=_&&Ut(_.type);_?x==="vector"&&p==="raster"?e.push(new Te(s,r.source,`layer "${r.id}" requires a raster source`)):x!=="raster-dem"&&p==="hillshade"?e.push(new Te(s,r.source,`layer "${r.id}" requires a raster-dem source`)):x==="raster"&&p!=="raster"?e.push(new Te(s,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&p!=="hillshade"?e.push(new Te(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||x==="geojson"&&_.lineMetrics||e.push(new Te(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Te(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Te(s,r.source,`source "${r.source}" not found`))}else e.push(new Te(s,r,'missing required property "source"'));return e=e.concat(Pi({key:s,value:r,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:qn,layout:_=>Pi({layer:r,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":x=>Jo(yr({layerType:p},x))}}),paint:_=>Pi({layer:r,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":x=>Yo(yr({layerType:p},x))}})}})),e}function vr(i){const e=i.value,r=i.key,s=gt(e);return s!=="string"?[new Te(r,e,`string expected, ${s} found`)]:[]}const gs={promoteId:function({key:i,value:e}){if(gt(e)==="string")return vr({key:i,value:e});{const r=[];for(const s in e)r.push(...vr({key:`${i}.${s}`,value:e[s]}));return r}}};function Ui(i){const e=i.value,r=i.key,s=i.styleSpec,o=i.style,u=i.validateSpec;if(!e.type)return[new Te(r,e,'"type" is required')];const p=Ut(e.type);let f;switch(p){case"vector":case"raster":return f=Pi({key:r,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:gs,validateSpec:u}),f;case"raster-dem":return f=function(_){var x;const b=(x=_.sourceName)!==null&&x!==void 0?x:"",T=_.value,I=_.styleSpec,k=I.source_raster_dem,P=_.style;let R=[];const j=gt(T);if(T===void 0)return R;if(j!=="object")return R.push(new Te("source_raster_dem",T,`object expected, ${j} found`)),R;const q=Ut(T.encoding)==="custom",te=["redFactor","greenFactor","blueFactor","baseShift"],X=_.value.encoding?`"${_.value.encoding}"`:"Default";for(const re in T)!q&&te.includes(re)?R.push(new Te(re,T[re],`In "${b}": "${re}" is only valid when "encoding" is set to "custom". ${X} encoding found`)):k[re]?R=R.concat(_.validateSpec({key:re,value:T[re],valueSpec:k[re],validateSpec:_.validateSpec,style:P,styleSpec:I})):R.push(new Te(re,T[re],`unknown property "${re}"`));return R}({sourceName:r,value:e,style:i.style,styleSpec:s,validateSpec:u}),f;case"geojson":if(f=Pi({key:r,value:e,valueSpec:s.source_geojson,style:o,styleSpec:s,validateSpec:u,objectElementValidators:gs}),e.cluster)for(const _ in e.clusterProperties){const[x,b]=e.clusterProperties[_],T=typeof x=="string"?[x,["accumulated"],["get",_]]:x;f.push(...xn({key:`${r}.${_}.map`,value:b,validateSpec:u,expressionContext:"cluster-map"})),f.push(...xn({key:`${r}.${_}.reduce`,value:T,validateSpec:u,expressionContext:"cluster-reduce"}))}return f;case"video":return Pi({key:r,value:e,valueSpec:s.source_video,style:o,validateSpec:u,styleSpec:s});case"image":return Pi({key:r,value:e,valueSpec:s.source_image,style:o,validateSpec:u,styleSpec:s});case"canvas":return[new Te(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ms({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:o,validateSpec:u,styleSpec:s})}}function _s(i){const e=i.value,r=i.styleSpec,s=r.light,o=i.style;let u=[];const p=gt(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new Te("light",e,`object expected, ${p} found`)]),u;for(const f in e){const _=f.match(/^(.*)-transition$/);u=u.concat(_&&s[_[1]]&&s[_[1]].transition?i.validateSpec({key:f,value:e[f],valueSpec:r.transition,validateSpec:i.validateSpec,style:o,styleSpec:r}):s[f]?i.validateSpec({key:f,value:e[f],valueSpec:s[f],validateSpec:i.validateSpec,style:o,styleSpec:r}):[new Te(f,e[f],`unknown property "${f}"`)])}return u}function el(i){const e=i.value,r=i.styleSpec,s=r.terrain,o=i.style;let u=[];const p=gt(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new Te("terrain",e,`object expected, ${p} found`)]),u;for(const f in e)u=u.concat(s[f]?i.validateSpec({key:f,value:e[f],valueSpec:s[f],validateSpec:i.validateSpec,style:o,styleSpec:r}):[new Te(f,e[f],`unknown property "${f}"`)]);return u}function tl(i){let e=[];const r=i.value,s=i.key;if(Array.isArray(r)){const o=[],u=[];for(const p in r)r[p].id&&o.includes(r[p].id)&&e.push(new Te(s,r,`all the sprites' ids must be unique, but ${r[p].id} is duplicated`)),o.push(r[p].id),r[p].url&&u.includes(r[p].url)&&e.push(new Te(s,r,`all the sprites' URLs must be unique, but ${r[p].url} is duplicated`)),u.push(r[p].url),e=e.concat(Pi({key:`${s}[${p}]`,value:r[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return vr({key:s,value:r})}const il={"*":()=>[],array:Un,boolean:function(i){const e=i.value,r=i.key,s=gt(e);return s!=="boolean"?[new Te(r,e,`boolean expected, ${s} found`)]:[]},number:fs,color:function(i){const e=i.key,r=i.value,s=gt(r);return s!=="string"?[new Te(e,r,`color expected, ${s} found`)]:wt.parse(String(r))?[]:[new Te(e,r,`color expected, "${r}" found`)]},constants:Wo,enum:ms,filter:qn,function:ta,layer:Qo,object:Pi,source:Ui,light:_s,terrain:el,string:vr,formatted:function(i){return vr(i).length===0?[]:xn(i)},resolvedImage:function(i){return vr(i).length===0?[]:xn(i)},padding:function(i){const e=i.key,r=i.value;if(gt(r)==="array"){if(r.length<1||r.length>4)return[new Te(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let o=[];for(let u=0;u<r.length;u++)o=o.concat(i.validateSpec({key:`${e}[${u}]`,value:r[u],validateSpec:i.validateSpec,valueSpec:s}));return o}return fs({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,s=gt(r),o=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new Te(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let u=[];for(let p=0;p<r.length;p+=2)u=u.concat(ms({key:`${e}[${p}]`,value:r[p],valueSpec:o.layout_symbol["text-anchor"]})),u=u.concat(Un({key:`${e}[${p+1}]`,value:r[p+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:o}));return u},sprite:tl};function Dr(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=Dr,r.expression&&Ot(Ut(e))?ta(i):r.expression&&Xs(yn(e))?xn(i):r.type&&il[r.type]?il[r.type](i):Pi(yr({},i,{valueSpec:r.type?s[r.type]:r}))}function rl(i){const e=i.value,r=i.key,s=vr(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Te(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Te(r,e,'"glyphs" url must include a "{range}" token'))),s}function nr(i,e=he){let r=[];return r=r.concat(Dr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Dr,objectElementValidators:{glyphs:rl,"*":()=>[]}})),i.constants&&(r=r.concat(Wo({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:Dr}))),ia(r)}function Lr(i){return function(e){return i({...e,validateSpec:Dr})}}function ia(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function Rr(i){return function(...e){return ia(i.apply(this,e))}}nr.source=Rr(Lr(Ui)),nr.sprite=Rr(Lr(tl)),nr.glyphs=Rr(Lr(rl)),nr.light=Rr(Lr(_s)),nr.terrain=Rr(Lr(el)),nr.layer=Rr(Lr(Qo)),nr.filter=Rr(Lr(qn)),nr.paintProperty=Rr(Lr(Yo)),nr.layoutProperty=Rr(Lr(Jo));const Br=nr,rc=Br.light,Ua=Br.paintProperty,nl=Br.layoutProperty;function ra(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new Xr(new Error(s.message))),r=!0;return r}class Zn{constructor(e,r,s){const o=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(r=p[1])+2*(s=p[2]);for(let _=0;_<this.d*this.d;_++){const x=p[3+_],b=p[3+_+1];o.push(x===b?null:p.subarray(x,b))}const f=p[3+o.length+1];this.keys=p.subarray(p[3+o.length],f),this.bboxes=p.subarray(f),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let p=0;p<this.d*this.d;p++)o.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const u=s/r*e;this.min=-u,this.max=e+u}insert(e,r,s,o,u){this._forEachCell(r,s,o,u,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(o),this.bboxes.push(u)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,o,u,p){this.cells[u].push(p)}query(e,r,s,o,u){const p=this.min,f=this.max;if(e<=p&&r<=p&&f<=s&&f<=o&&!u)return Array.prototype.slice.call(this.keys);{const _=[];return this._forEachCell(e,r,s,o,this._queryCell,_,{},u),_}}_queryCell(e,r,s,o,u,p,f,_){const x=this.cells[u];if(x!==null){const b=this.keys,T=this.bboxes;for(let I=0;I<x.length;I++){const k=x[I];if(f[k]===void 0){const P=4*k;(_?_(T[P+0],T[P+1],T[P+2],T[P+3]):e<=T[P+2]&&r<=T[P+3]&&s>=T[P+0]&&o>=T[P+1])?(f[k]=!0,p.push(b[k])):f[k]=!1}}}}_forEachCell(e,r,s,o,u,p,f,_){const x=this._convertToCellCoord(e),b=this._convertToCellCoord(r),T=this._convertToCellCoord(s),I=this._convertToCellCoord(o);for(let k=x;k<=T;k++)for(let P=b;P<=I;P++){const R=this.d*P+k;if((!_||_(this._convertFromCellCoord(k),this._convertFromCellCoord(P),this._convertFromCellCoord(k+1),this._convertFromCellCoord(P+1)))&&u.call(this,e,r,s,o,R,p,f,_))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let p=0;p<this.cells.length;p++)s+=this.cells[p].length;const o=new Int32Array(r+s+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;let u=r;for(let p=0;p<e.length;p++){const f=e[p];o[3+p]=u,o.set(f,u),u+=f.length}return o[3+e.length]=u,o.set(this.keys,u),u+=this.keys.length,o[3+e.length+1]=u,o.set(this.bboxes,u),u+=this.bboxes.length,o.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new Zn(e.buffer)}}const Fr={};function De(i,e,r={}){if(Fr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Fr[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}De("Object",Object),De("TransferableGridIndex",Zn),De("Color",wt),De("Error",Error),De("AJAXError",Gr),De("ResolvedImage",ui),De("StylePropertyFunction",hs),De("StyleExpression",Oa,{omit:["_evaluator"]}),De("ZoomDependentExpression",Ys),De("ZoomConstantExpression",Na),De("CompoundExpression",rr,{omit:["_evaluate"]});for(const i in jn)jn[i]._classRegistryKey||De(`Expression_${i}`,jn[i]);function na(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function tn(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(na(i)||rs(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(tn(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!Fr[s])throw new Error(`${s} is not registered.`);const o=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&o===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const u in i){if(!i.hasOwnProperty(u)||Fr[s].omit.indexOf(u)>=0)continue;const p=i[u];o[u]=Fr[s].shallow.indexOf(u)>=0?p:tn(p,e)}i instanceof Error&&(o.message=i.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(o.$name=s),o}throw new Error("can't serialize object of type "+typeof i)}function Gn(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||na(i)||rs(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Gn);if(typeof i=="object"){const e=i.$name||"Object";if(!Fr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Fr[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const o of Object.keys(i)){if(o==="$name")continue;const u=i[o];s[o]=Fr[e].shallow.indexOf(o)>=0?u:Gn(u)}return s}throw new Error("can't deserialize object of type "+typeof i)}class sl{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Pe={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function qa(i){for(const e of i)if(Ga(e.charCodeAt(0)))return!0;return!1}function Za(i){for(const e of i)if(!nc(e.charCodeAt(0)))return!1;return!0}function nc(i){return!(Pe.Arabic(i)||Pe["Arabic Supplement"](i)||Pe["Arabic Extended-A"](i)||Pe["Arabic Presentation Forms-A"](i)||Pe["Arabic Presentation Forms-B"](i))}function Ga(i){return!(i!==746&&i!==747&&(i<4352||!(Pe["Bopomofo Extended"](i)||Pe.Bopomofo(i)||Pe["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Pe["CJK Compatibility Ideographs"](i)||Pe["CJK Compatibility"](i)||Pe["CJK Radicals Supplement"](i)||Pe["CJK Strokes"](i)||!(!Pe["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Pe["CJK Unified Ideographs Extension A"](i)||Pe["CJK Unified Ideographs"](i)||Pe["Enclosed CJK Letters and Months"](i)||Pe["Hangul Compatibility Jamo"](i)||Pe["Hangul Jamo Extended-A"](i)||Pe["Hangul Jamo Extended-B"](i)||Pe["Hangul Jamo"](i)||Pe["Hangul Syllables"](i)||Pe.Hiragana(i)||Pe["Ideographic Description Characters"](i)||Pe.Kanbun(i)||Pe["Kangxi Radicals"](i)||Pe["Katakana Phonetic Extensions"](i)||Pe.Katakana(i)&&i!==12540||!(!Pe["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Pe["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Pe["Unified Canadian Aboriginal Syllabics"](i)||Pe["Unified Canadian Aboriginal Syllabics Extended"](i)||Pe["Vertical Forms"](i)||Pe["Yijing Hexagram Symbols"](i)||Pe["Yi Syllables"](i)||Pe["Yi Radicals"](i))))}function al(i){return!(Ga(i)||function(e){return!!(Pe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Pe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Pe["Letterlike Symbols"](e)||Pe["Number Forms"](e)||Pe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Pe["Control Pictures"](e)&&e!==9251||Pe["Optical Character Recognition"](e)||Pe["Enclosed Alphanumerics"](e)||Pe["Geometric Shapes"](e)||Pe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Pe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Pe["CJK Symbols and Punctuation"](e)||Pe.Katakana(e)||Pe["Private Use Area"](e)||Pe["CJK Compatibility Forms"](e)||Pe["Small Form Variants"](e)||Pe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function ol(i){return i>=1424&&i<=2303||Pe["Arabic Presentation Forms-A"](i)||Pe["Arabic Presentation Forms-B"](i)}function ll(i,e){return!(!e&&ol(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Pe.Khmer(i))}function sc(i){for(const e of i)if(ol(e.charCodeAt(0)))return!0;return!1}const Ha="deferred",Wa="loading",Xa="loaded";let Ka=null,zi="unavailable",rn=null;const ys=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(zi="error"),Ka&&Ka(i)};function Ya(){xs.fire(new Wr("pluginStateChange",{pluginStatus:zi,pluginURL:rn}))}const xs=new un,Ja=function(){return zi},cl=function(){if(zi!==Ha||!rn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");zi=Wa,Ya(),rn&&as({url:rn},i=>{i?ys(i):(zi=Xa,Ya())})},qi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>zi===Xa||qi.applyArabicShaping!=null,isLoading:()=>zi===Wa,setState(i){if(!Yi())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");zi=i.pluginStatus,rn=i.pluginURL},isParsed(){if(!Yi())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return qi.applyArabicShaping!=null&&qi.processBidirectionalText!=null&&qi.processStyledBidirectionalText!=null},getPluginURL(){if(!Yi())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return rn}};class Pt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new sl,this.transition={})}isSupportedScript(e){return function(r,s){for(const o of r)if(!ll(o.charCodeAt(0),s))return!1;return!0}(e,qi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class sa{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,o){if(Ot(s))return new hs(s,o);if(Xs(s)){const u=Va(s,o);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=s;return o.type==="color"&&typeof s=="string"?u=wt.parse(s):o.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?o.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(u=tr.parse(s)):u=Vi.parse(s),{kind:"constant",evaluate:()=>u}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Qa{constructor(e){this.property=e,this.value=new sa(e,void 0)}transitioned(e,r){return new ul(this.property,this.value,r,ci({},e.transition,this.transition),e.now)}untransitioned(){return new ul(this.property,this.value,null,{},0)}}class hl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return hr(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Qa(this._values[e].property)),this._values[e].value=new sa(this._values[e].property,r===null?void 0:hr(r))}getTransition(e){return hr(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Qa(this._values[e].property)),this._values[e].transition=hr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const o=this.getTransition(r);o!==void 0&&(e[`${r}-transition`]=o)}return e}transitioned(e,r){const s=new dl(this._properties);for(const o of Object.keys(this._values))s._values[o]=this._values[o].transitioned(e,r._values[o]);return s}untransitioned(){const e=new dl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class ul{constructor(e,r,s,o,u){this.property=e,this.value=r,this.begin=u+o.delay||0,this.end=this.begin+o.duration||0,e.specification.transition&&(o.delay||o.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const o=e.now||0,u=this.value.possiblyEvaluate(e,r,s),p=this.prior;if(p){if(o>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(o<this.begin)return p.possiblyEvaluate(e,r,s);{const f=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,s),u,function(_){if(_<=0)return 0;if(_>=1)return 1;const x=_*_,b=x*_;return 4*(_<.5?b:3*(_-x)+b-.75)}(f))}}return u}}class dl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const o=new aa(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].possiblyEvaluate(e,r,s);return o}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ac{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return hr(this._values[e].value)}setValue(e,r){this._values[e]=new sa(this._values[e].property,r===null?void 0:hr(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const o=new aa(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].possiblyEvaluate(e,r,s);return o}}class Si{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,o){return this.property.evaluate(this.value,this.parameters,e,r,s,o)}}class aa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class je{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const o=ji[this.specification.type];return o?o(e,r,s):e}}class Ze{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,o){return new Si(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,o)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Si(this,{kind:"constant",value:void 0},e.parameters);const o=ji[this.specification.type];if(o){const u=o(e.value.value,r.value.value,s);return new Si(this,{kind:"constant",value:u},e.parameters)}return e}evaluate(e,r,s,o,u,p){return e.kind==="constant"?e.value:e.evaluate(r,s,o,u,p)}}class vs extends Ze{possiblyEvaluate(e,r,s,o){if(e.value===void 0)return new Si(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},s,o),p=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,f=this._calculate(p,p,p,r);return new Si(this,{kind:"constant",value:f},r)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Si(this,{kind:"constant",value:u},r)}return new Si(this,e.expression,r)}evaluate(e,r,s,o,u,p){if(e.kind==="source"){const f=e.evaluate(r,s,o,u,p);return this._calculate(f,f,f,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,o),e.evaluate({zoom:Math.floor(r.zoom)},s,o),e.evaluate({zoom:Math.floor(r.zoom)+1},s,o),r):e.value}_calculate(e,r,s,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class eo{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,o){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},s,o);return this._calculate(u,u,u,r)}return this._calculate(e.expression.evaluate(new Pt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Pt(Math.floor(r.zoom),r)),e.expression.evaluate(new Pt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class to{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,o){return!!e.expression.evaluate(r,null,{},s,o)}interpolate(){return!1}}class Wt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const o=this.defaultPropertyValues[r]=new sa(s,void 0),u=this.defaultTransitionablePropertyValues[r]=new Qa(s);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=o.possiblyEvaluate({})}}}De("DataDrivenProperty",Ze),De("DataConstantProperty",je),De("CrossFadedDataDrivenProperty",vs),De("CrossFadedProperty",eo),De("ColorRampProperty",to);const io="-transition";class sr extends un{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ac(r.layout)),r.paint)){this._transitionablePaint=new hl(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new aa(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(nl,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(io)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(Ua,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(io))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const o=this._transitionablePaint._values[e],u=o.property.specification["property-type"]==="cross-faded-data-driven",p=o.value.isDataDriven(),f=o.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const _=this._transitionablePaint._values[e].value;return _.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(e,f,_)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),kn(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,o,u={}){return(!u||u.validate!==!1)&&ra(this,e.call(Br,{key:r,layerType:this.type,objectKey:s,value:o,styleSpec:he,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Si&&$n(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const pl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vn{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Vt(i,e=1){let r=0,s=0;return{members:i.map(o=>{const u=pl[o.type].BYTES_PER_ELEMENT,p=r=Hn(r,Math.max(e,u)),f=o.components||1;return s=Math.max(s,u),r+=u*f,{name:o.name,type:o.type,components:f,offset:p}}),size:Hn(r,Math.max(s,e)),alignment:e}}function Hn(i,e){return Math.ceil(i/e)*e}class bs extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const o=2*e;return this.int16[o+0]=r,this.int16[o+1]=s,e}}bs.prototype.bytesPerElement=4,De("StructArrayLayout2i4",bs);class ws extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const u=3*e;return this.int16[u+0]=r,this.int16[u+1]=s,this.int16[u+2]=o,e}}ws.prototype.bytesPerElement=6,De("StructArrayLayout3i6",ws);class bn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,o)}emplace(e,r,s,o,u){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=o,this.int16[p+3]=u,e}}bn.prototype.bytesPerElement=8,De("StructArrayLayout4i8",bn);class ro extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,o,u,p)}emplace(e,r,s,o,u,p,f){const _=6*e;return this.int16[_+0]=r,this.int16[_+1]=s,this.int16[_+2]=o,this.int16[_+3]=u,this.int16[_+4]=p,this.int16[_+5]=f,e}}ro.prototype.bytesPerElement=12,De("StructArrayLayout2i4i12",ro);class no extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,o,u,p)}emplace(e,r,s,o,u,p,f){const _=4*e,x=8*e;return this.int16[_+0]=r,this.int16[_+1]=s,this.uint8[x+4]=o,this.uint8[x+5]=u,this.uint8[x+6]=p,this.uint8[x+7]=f,e}}no.prototype.bytesPerElement=8,De("StructArrayLayout2i4ub8",no);class Wn extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const o=2*e;return this.float32[o+0]=r,this.float32[o+1]=s,e}}Wn.prototype.bytesPerElement=8,De("StructArrayLayout2f8",Wn);class so extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,u,p,f,_,x,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,s,o,u,p,f,_,x,b)}emplace(e,r,s,o,u,p,f,_,x,b,T){const I=10*e;return this.uint16[I+0]=r,this.uint16[I+1]=s,this.uint16[I+2]=o,this.uint16[I+3]=u,this.uint16[I+4]=p,this.uint16[I+5]=f,this.uint16[I+6]=_,this.uint16[I+7]=x,this.uint16[I+8]=b,this.uint16[I+9]=T,e}}so.prototype.bytesPerElement=20,De("StructArrayLayout10ui20",so);class ao extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,u,p,f,_,x,b,T,I){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,s,o,u,p,f,_,x,b,T,I)}emplace(e,r,s,o,u,p,f,_,x,b,T,I,k){const P=12*e;return this.int16[P+0]=r,this.int16[P+1]=s,this.int16[P+2]=o,this.int16[P+3]=u,this.uint16[P+4]=p,this.uint16[P+5]=f,this.uint16[P+6]=_,this.uint16[P+7]=x,this.int16[P+8]=b,this.int16[P+9]=T,this.int16[P+10]=I,this.int16[P+11]=k,e}}ao.prototype.bytesPerElement=24,De("StructArrayLayout4i4ui4i24",ao);class _t extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const u=3*e;return this.float32[u+0]=r,this.float32[u+1]=s,this.float32[u+2]=o,e}}_t.prototype.bytesPerElement=12,De("StructArrayLayout3f12",_t);class h extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}h.prototype.bytesPerElement=4,De("StructArrayLayout1ul4",h);class t extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,u,p,f,_,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,o,u,p,f,_,x)}emplace(e,r,s,o,u,p,f,_,x,b){const T=10*e,I=5*e;return this.int16[T+0]=r,this.int16[T+1]=s,this.int16[T+2]=o,this.int16[T+3]=u,this.int16[T+4]=p,this.int16[T+5]=f,this.uint32[I+3]=_,this.uint16[T+8]=x,this.uint16[T+9]=b,e}}t.prototype.bytesPerElement=20,De("StructArrayLayout6i1ul2ui20",t);class n extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,o,u,p)}emplace(e,r,s,o,u,p,f){const _=6*e;return this.int16[_+0]=r,this.int16[_+1]=s,this.int16[_+2]=o,this.int16[_+3]=u,this.int16[_+4]=p,this.int16[_+5]=f,e}}n.prototype.bytesPerElement=12,De("StructArrayLayout2i2i2i12",n);class a extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,o,u)}emplace(e,r,s,o,u,p){const f=4*e,_=8*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=o,this.int16[_+6]=u,this.int16[_+7]=p,e}}a.prototype.bytesPerElement=16,De("StructArrayLayout2f1f2i16",a);class l extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,o)}emplace(e,r,s,o,u){const p=12*e,f=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=s,this.float32[f+1]=o,this.float32[f+2]=u,e}}l.prototype.bytesPerElement=12,De("StructArrayLayout2ub2f12",l);class d extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=s,this.uint16[u+2]=o,e}}d.prototype.bytesPerElement=6,De("StructArrayLayout3ui6",d);class m extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,o,u,p,f,_,x,b,T,I,k,P,R,j,q){const te=this.length;return this.resize(te+1),this.emplace(te,e,r,s,o,u,p,f,_,x,b,T,I,k,P,R,j,q)}emplace(e,r,s,o,u,p,f,_,x,b,T,I,k,P,R,j,q,te){const X=24*e,re=12*e,se=48*e;return this.int16[X+0]=r,this.int16[X+1]=s,this.uint16[X+2]=o,this.uint16[X+3]=u,this.uint32[re+2]=p,this.uint32[re+3]=f,this.uint32[re+4]=_,this.uint16[X+10]=x,this.uint16[X+11]=b,this.uint16[X+12]=T,this.float32[re+7]=I,this.float32[re+8]=k,this.uint8[se+36]=P,this.uint8[se+37]=R,this.uint8[se+38]=j,this.uint32[re+10]=q,this.int16[X+22]=te,e}}m.prototype.bytesPerElement=48,De("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",m);class g extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,o,u,p,f,_,x,b,T,I,k,P,R,j,q,te,X,re,se,me,ze,Fe,ke,Me,Se,Le){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,e,r,s,o,u,p,f,_,x,b,T,I,k,P,R,j,q,te,X,re,se,me,ze,Fe,ke,Me,Se,Le)}emplace(e,r,s,o,u,p,f,_,x,b,T,I,k,P,R,j,q,te,X,re,se,me,ze,Fe,ke,Me,Se,Le,Ce){const be=32*e,Ue=16*e;return this.int16[be+0]=r,this.int16[be+1]=s,this.int16[be+2]=o,this.int16[be+3]=u,this.int16[be+4]=p,this.int16[be+5]=f,this.int16[be+6]=_,this.int16[be+7]=x,this.uint16[be+8]=b,this.uint16[be+9]=T,this.uint16[be+10]=I,this.uint16[be+11]=k,this.uint16[be+12]=P,this.uint16[be+13]=R,this.uint16[be+14]=j,this.uint16[be+15]=q,this.uint16[be+16]=te,this.uint16[be+17]=X,this.uint16[be+18]=re,this.uint16[be+19]=se,this.uint16[be+20]=me,this.uint16[be+21]=ze,this.uint16[be+22]=Fe,this.uint32[Ue+12]=ke,this.float32[Ue+13]=Me,this.float32[Ue+14]=Se,this.uint16[be+30]=Le,this.uint16[be+31]=Ce,e}}g.prototype.bytesPerElement=64,De("StructArrayLayout8i15ui1ul2f2ui64",g);class y extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}y.prototype.bytesPerElement=4,De("StructArrayLayout1f4",y);class v extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const u=3*e;return this.uint16[6*e+0]=r,this.float32[u+1]=s,this.float32[u+2]=o,e}}v.prototype.bytesPerElement=12,De("StructArrayLayout1ui2f12",v);class w extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const u=4*e;return this.uint32[2*e+0]=r,this.uint16[u+2]=s,this.uint16[u+3]=o,e}}w.prototype.bytesPerElement=8,De("StructArrayLayout1ul2ui8",w);class S extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const o=2*e;return this.uint16[o+0]=r,this.uint16[o+1]=s,e}}S.prototype.bytesPerElement=4,De("StructArrayLayout2ui4",S);class A extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}A.prototype.bytesPerElement=2,De("StructArrayLayout1ui2",A);class F extends qt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s,o)}emplace(e,r,s,o,u){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=o,this.float32[p+3]=u,e}}F.prototype.bytesPerElement=16,De("StructArrayLayout4f16",F);class B extends vn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ae(this.anchorPointX,this.anchorPointY)}}B.prototype.size=20;class N extends t{get(e){return new B(this,e)}}De("CollisionBoxArray",N);class L extends vn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}L.prototype.size=48;class J extends m{get(e){return new L(this,e)}}De("PlacedSymbolArray",J);class ne extends vn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ne.prototype.size=64;class U extends g{get(e){return new ne(this,e)}}De("SymbolInstanceArray",U);class Q extends y{getoffsetX(e){return this.float32[1*e+0]}}De("GlyphOffsetArray",Q);class oe extends ws{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}De("SymbolLineVertexArray",oe);class le extends vn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}le.prototype.size=12;class fe extends v{get(e){return new le(this,e)}}De("TextAnchorOffsetArray",fe);class ve extends vn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ve.prototype.size=8;class _e extends w{get(e){return new ve(this,e)}}De("FeatureIndexArray",_e);class we extends bs{}class Be extends bs{}class st extends bs{}class Ee extends ro{}class Ge extends no{}class Oe extends Wn{}class St extends so{}class rt extends ao{}class Qe extends _t{}class at extends h{}class Zt extends n{}class Mt extends l{}class di extends d{}class ei extends S{}const Xt=Vt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zi}=Xt;class zt{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,o){let u=this.segments[this.segments.length-1];return e>zt.MAX_VERTEX_ARRAY_LENGTH&&bi(`Max vertices per segment is ${zt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>zt.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==o)&&(u={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},o!==void 0&&(u.sortKey=o),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,o){return new zt([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:o,vaos:{},sortKey:0}])}}function br(i,e){return 256*(i=li(Math.floor(i),0,255))+li(Math.floor(e),0,255)}zt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,De("SegmentVector",zt);const wr=Vt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var nn={exports:{}},wn={exports:{}};wn.exports=function(i,e){var r,s,o,u,p,f,_,x;for(s=i.length-(r=3&i.length),o=e,p=3432918353,f=461845907,x=0;x<s;)_=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24,++x,o=27492+(65535&(u=5*(65535&(o=(o^=_=(65535&(_=(_=(65535&_)*p+(((_>>>16)*p&65535)<<16)&4294967295)<<15|_>>>17))*f+(((_>>>16)*f&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(_=0,r){case 3:_^=(255&i.charCodeAt(x+2))<<16;case 2:_^=(255&i.charCodeAt(x+1))<<8;case 1:o^=_=(65535&(_=(_=(65535&(_^=255&i.charCodeAt(x)))*p+(((_>>>16)*p&65535)<<16)&4294967295)<<15|_>>>17))*f+(((_>>>16)*f&65535)<<16)&4294967295}return o^=i.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0};var Xn=wn.exports,_i={exports:{}};_i.exports=function(i,e){for(var r,s=i.length,o=e^s,u=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(u)|(255&i.charCodeAt(++u))<<8|(255&i.charCodeAt(++u))<<16|(255&i.charCodeAt(++u))<<24))+((1540483477*(r>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++u;switch(s){case 3:o^=(255&i.charCodeAt(u+2))<<16;case 2:o^=(255&i.charCodeAt(u+1))<<8;case 1:o=1540483477*(65535&(o^=255&i.charCodeAt(u)))+((1540483477*(o>>>16)&65535)<<16)}return o=1540483477*(65535&(o^=o>>>13))+((1540483477*(o>>>16)&65535)<<16),(o^=o>>>15)>>>0};var pi=Xn,Ti=_i.exports;nn.exports=pi,nn.exports.murmur3=pi,nn.exports.murmur2=Ti;var Sn=H(nn.exports);class Gt{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,o){this.ids.push(ti(e)),this.positions.push(r,s,o)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=ti(e);let s=0,o=this.ids.length-1;for(;s<o;){const p=s+o>>1;this.ids[p]>=r?o=p:s=p+1}const u=[];for(;this.ids[s]===r;)u.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return u}static serialize(e,r){const s=new Float64Array(e.ids),o=new Uint32Array(e.positions);return Di(s,o,0,s.length-1),r&&r.push(s.buffer,o.buffer),{ids:s,positions:o}}static deserialize(e){const r=new Gt;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function ti(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Sn(String(i))}function Di(i,e,r,s){for(;r<s;){const o=i[r+s>>1];let u=r-1,p=s+1;for(;;){do u++;while(i[u]<o);do p--;while(i[p]>o);if(u>=p)break;Ht(i,u,p),Ht(e,3*u,3*p),Ht(e,3*u+1,3*p+1),Ht(e,3*u+2,3*p+2)}p-r<s-p?(Di(i,e,r,p),r=p+1):(Di(i,e,p+1,s),s=p)}}function Ht(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}De("FeaturePositionMap",Gt);class Tn{constructor(e,r){this.gl=e.gl,this.location=r}}class oa extends Tn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class fl extends Tn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ml extends Tn{constructor(e,r){super(e,r),this.current=wt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const oc=new Float32Array(16);function oo(i){return[br(255*i.r,255*i.g),br(255*i.b,255*i.a)]}class Sr{constructor(e,r,s){this.value=e,this.uniformNames=r.map(o=>`u_${o}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new ml(e,r):new oa(e,r)}}class Cn{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,o){const u=o==="u_pattern_to"?this.patternTo:o==="u_pattern_from"?this.patternFrom:o==="u_pixel_ratio_to"?this.pixelRatioTo:o==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&e.set(u)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new fl(e,r):new oa(e,r)}}class Tr{constructor(e,r,s,o){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,r,s,o,u){const p=this.paintVertexArray.length,f=this.expression.evaluate(new Pt(0),r,{},o,[],u);this.paintVertexArray.resize(e),this._setPaintValue(p,e,f)}updatePaintArray(e,r,s,o){const u=this.expression.evaluate({zoom:0},s,o);this._setPaintValue(e,r,u)}_setPaintValue(e,r,s){if(this.type==="color"){const o=oo(s);for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,o[0],o[1])}else{for(let o=e;o<r;o++)this.paintVertexArray.emplace(o,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ar{constructor(e,r,s,o,u,p){this.expression=e,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=s,this.useIntegerZoom=o,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,s,o,u){const p=this.expression.evaluate(new Pt(this.zoom),r,{},o,[],u),f=this.expression.evaluate(new Pt(this.zoom+1),r,{},o,[],u),_=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,p,f)}updatePaintArray(e,r,s,o){const u=this.expression.evaluate({zoom:this.zoom},s,o),p=this.expression.evaluate({zoom:this.zoom+1},s,o);this._setPaintValue(e,r,u,p)}_setPaintValue(e,r,s,o){if(this.type==="color"){const u=oo(s),p=oo(o);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,u[0],u[1],p[0],p[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,s,o);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,o=li(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(o)}getBinding(e,r,s){return new oa(e,r)}}class Cr{constructor(e,r,s,o,u,p){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=o,this.layerId=p,this.zoomInPaintVertexArray=new u,this.zoomOutPaintVertexArray=new u}populatePaintArray(e,r,s){const o=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(o,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,o,u){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],u)}_setPaintValues(e,r,s,o){if(!o||!s)return;const{min:u,mid:p,max:f}=s,_=o[u],x=o[p],b=o[f];if(_&&x&&b)for(let T=e;T<r;T++)this.zoomInPaintVertexArray.emplace(T,x.tl[0],x.tl[1],x.br[0],x.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],x.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(T,x.tl[0],x.tl[1],x.br[0],x.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],x.pixelRatio,b.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,wr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,wr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class lo{constructor(e,r,s){this.binders={},this._buffers=[];const o=[];for(const u in e.paint._values){if(!s(u))continue;const p=e.paint.get(u);if(!(p instanceof Si&&$n(p.property.specification)))continue;const f=yd(u,e.type),_=p.value,x=p.property.specification.type,b=p.property.useIntegerZoom,T=p.property.specification["property-type"],I=T==="cross-faded"||T==="cross-faded-data-driven";if(_.kind==="constant")this.binders[u]=I?new Cn(_.value,f):new Sr(_.value,f,x),o.push(`/u_${u}`);else if(_.kind==="source"||I){const k=ah(u,x,"source");this.binders[u]=I?new Cr(_,x,b,r,k,e.id):new Tr(_,f,x,k),o.push(`/a_${u}`)}else{const k=ah(u,x,"composite");this.binders[u]=new ar(_,f,x,b,r,k),o.push(`/z_${u}`)}}this.cacheKey=o.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Tr||r instanceof ar?r.maxValue:0}populatePaintArrays(e,r,s,o,u){for(const p in this.binders){const f=this.binders[p];(f instanceof Tr||f instanceof ar||f instanceof Cr)&&f.populatePaintArray(e,r,s,o,u)}}setConstantPatternPositions(e,r){for(const s in this.binders){const o=this.binders[s];o instanceof Cn&&o.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,o,u){let p=!1;for(const f in e){const _=r.getPositions(f);for(const x of _){const b=s.feature(x.index);for(const T in this.binders){const I=this.binders[T];if((I instanceof Tr||I instanceof ar||I instanceof Cr)&&I.expression.isStateDependent===!0){const k=o.paint.get(T);I.expression=k.value,I.updatePaintArray(x.start,x.end,b,e[f],u),p=!0}}}}return p}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Sr||s instanceof Cn)&&e.push(...s.uniformNames.map(o=>`#define HAS_UNIFORM_${o}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Tr||s instanceof ar)for(let o=0;o<s.paintVertexAttributes.length;o++)e.push(s.paintVertexAttributes[o].name);else if(s instanceof Cr)for(let o=0;o<wr.members.length;o++)e.push(wr.members[o].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Sr||s instanceof Cn||s instanceof ar)for(const o of s.uniformNames)e.push(o)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Sr||u instanceof Cn||u instanceof ar){for(const p of u.uniformNames)if(r[p]){const f=u.getBinding(e,r[p],p);s.push({name:p,property:o,binding:f})}}}return s}setUniforms(e,r,s,o){for(const{name:u,property:p,binding:f}of r)this.binders[p].setUniform(f,o,s.get(p),u)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof Cr){const o=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;o&&this._buffers.push(o)}else(s instanceof Tr||s instanceof ar)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof Tr||s instanceof ar||s instanceof Cr)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Tr||r instanceof ar||r instanceof Cr)&&r.destroy()}}}class Or{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const o of e)this.programConfigurations[o.id]=new lo(o,r,s);this.needsUpload=!1,this._featureMap=new Gt,this._bufferOffset=0}populatePaintArrays(e,r,s,o,u,p){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,r,o,u,p);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,o){for(const u of s)this.needsUpload=this.programConfigurations[u.id].updatePaintArrays(e,this._featureMap,r,u,o)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function yd(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function ah(i,e,r){const s={color:{source:Wn,composite:F},number:{source:y,composite:Wn}},o=function(u){return{"line-pattern":{source:St,composite:St},"fill-pattern":{source:St,composite:St},"fill-extrusion-pattern":{source:St,composite:St}}[u]}(i);return o&&o[r]||s[e][r]}De("ConstantBinder",Sr),De("CrossFadedConstantBinder",Cn),De("SourceExpressionBinder",Tr),De("CrossFadedCompositeBinder",Cr),De("CompositeExpressionBinder",ar),De("ProgramConfiguration",lo,{omit:["_buffers"]}),De("ProgramConfigurationSet",Or);const Jt=8192,lc=Math.pow(2,14)-1,oh=-lc-1;function Ss(i){const e=Jt/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const o=r[s];for(let u=0;u<o.length;u++){const p=o[u],f=Math.round(p.x*e),_=Math.round(p.y*e);p.x=li(f,oh,lc),p.y=li(_,oh,lc),(f<p.x||f>p.x+1||_<p.y||_>p.y+1)&&bi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ts(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ss(i):[]}}function gl(i,e,r,s,o){i.emplaceBack(2*e+(s+1)/2,2*r+(o+1)/2)}class cc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Be,this.indexArray=new di,this.segments=new zt,this.programConfigurations=new Or(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const o=this.layers[0],u=[];let p=null,f=!1;o.type==="circle"&&(p=o.layout.get("circle-sort-key"),f=!p.isConstant());for(const{feature:_,id:x,index:b,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,k=Ts(_,I);if(!this.layers[0]._featureFilter.filter(new Pt(this.zoom),k,s))continue;const P=f?p.evaluate(k,{},s):void 0,R={id:x,properties:_.properties,type:_.type,sourceLayerIndex:T,index:b,geometry:I?k.geometry:Ss(_),patterns:{},sortKey:P};u.push(R)}f&&u.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of u){const{geometry:x,index:b,sourceLayerIndex:T}=_,I=e[b].feature;this.addFeature(_,x,b,s),r.featureIndex.insert(I,x,b,T,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zi),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,o){for(const u of r)for(const p of u){const f=p.x,_=p.y;if(f<0||f>=Jt||_<0||_>=Jt)continue;const x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),b=x.vertexLength;gl(this.layoutVertexArray,f,_,-1,-1),gl(this.layoutVertexArray,f,_,1,-1),gl(this.layoutVertexArray,f,_,1,1),gl(this.layoutVertexArray,f,_,-1,1),this.indexArray.emplaceBack(b,b+1,b+2),this.indexArray.emplaceBack(b,b+3,b+2),x.vertexLength+=4,x.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},o)}}function lh(i,e){for(let r=0;r<i.length;r++)if(la(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(la(i,e[r]))return!0;return!!hc(i,e)}function xd(i,e,r){return!!la(i,e)||!!uc(e,i,r)}function ch(i,e){if(i.length===1)return uh(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let o=0;o<s.length;o++)if(la(i,s[o]))return!0}for(let r=0;r<i.length;r++)if(uh(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(hc(i,e[r]))return!0;return!1}function vd(i,e,r){if(i.length>1){if(hc(i,e))return!0;for(let s=0;s<e.length;s++)if(uc(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(uc(i[s],e,r))return!0;return!1}function hc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],o=i[r+1];for(let u=0;u<e.length-1;u++)if(bd(s,o,e[u],e[u+1]))return!0}return!1}function bd(i,e,r,s){return Ni(i,r,s)!==Ni(e,r,s)&&Ni(i,e,r)!==Ni(i,e,s)}function uc(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let o=1;o<e.length;o++)if(hh(i,e[o-1],e[o])<s)return!0;return!1}function hh(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const o=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(o<0?e:o>1?r:r.sub(e)._mult(o)._add(e))}function uh(i,e){let r,s,o,u=!1;for(let p=0;p<i.length;p++){r=i[p];for(let f=0,_=r.length-1;f<r.length;_=f++)s=r[f],o=r[_],s.y>e.y!=o.y>e.y&&e.x<(o.x-s.x)*(e.y-s.y)/(o.y-s.y)+s.x&&(u=!u)}return u}function la(i,e){let r=!1;for(let s=0,o=i.length-1;s<i.length;o=s++){const u=i[s],p=i[o];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(r=!r)}return r}function wd(i,e,r){const s=r[0],o=r[2];if(i.x<s.x&&e.x<s.x||i.x>o.x&&e.x>o.x||i.y<s.y&&e.y<s.y||i.y>o.y&&e.y>o.y)return!1;const u=Ni(i,e,r[0]);return u!==Ni(i,e,r[1])||u!==Ni(i,e,r[2])||u!==Ni(i,e,r[3])}function co(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function _l(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function yl(i,e,r,s,o){if(!e[0]&&!e[1])return i;const u=Ae.convert(e)._mult(o);r==="viewport"&&u._rotate(-s);const p=[];for(let f=0;f<i.length;f++)p.push(i[f].sub(u));return p}let dh,ph;De("CircleBucket",cc,{omit:["layers"]});var Sd={get paint(){return ph=ph||new Wt({"circle-radius":new Ze(he.paint_circle["circle-radius"]),"circle-color":new Ze(he.paint_circle["circle-color"]),"circle-blur":new Ze(he.paint_circle["circle-blur"]),"circle-opacity":new Ze(he.paint_circle["circle-opacity"]),"circle-translate":new je(he.paint_circle["circle-translate"]),"circle-translate-anchor":new je(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new je(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new je(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ze(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ze(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ze(he.paint_circle["circle-stroke-opacity"])})},get layout(){return dh=dh||new Wt({"circle-sort-key":new Ze(he.layout_circle["circle-sort-key"])})}},Li=1e-6,ca=typeof Float32Array<"u"?Float32Array:Array;function dc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function fh(i,e,r){var s=e[0],o=e[1],u=e[2],p=e[3],f=e[4],_=e[5],x=e[6],b=e[7],T=e[8],I=e[9],k=e[10],P=e[11],R=e[12],j=e[13],q=e[14],te=e[15],X=r[0],re=r[1],se=r[2],me=r[3];return i[0]=X*s+re*f+se*T+me*R,i[1]=X*o+re*_+se*I+me*j,i[2]=X*u+re*x+se*k+me*q,i[3]=X*p+re*b+se*P+me*te,i[4]=(X=r[4])*s+(re=r[5])*f+(se=r[6])*T+(me=r[7])*R,i[5]=X*o+re*_+se*I+me*j,i[6]=X*u+re*x+se*k+me*q,i[7]=X*p+re*b+se*P+me*te,i[8]=(X=r[8])*s+(re=r[9])*f+(se=r[10])*T+(me=r[11])*R,i[9]=X*o+re*_+se*I+me*j,i[10]=X*u+re*x+se*k+me*q,i[11]=X*p+re*b+se*P+me*te,i[12]=(X=r[12])*s+(re=r[13])*f+(se=r[14])*T+(me=r[15])*R,i[13]=X*o+re*_+se*I+me*j,i[14]=X*u+re*x+se*k+me*q,i[15]=X*p+re*b+se*P+me*te,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var ho,Td=fh;function xl(i,e,r){var s=e[0],o=e[1],u=e[2],p=e[3];return i[0]=r[0]*s+r[4]*o+r[8]*u+r[12]*p,i[1]=r[1]*s+r[5]*o+r[9]*u+r[13]*p,i[2]=r[2]*s+r[6]*o+r[10]*u+r[14]*p,i[3]=r[3]*s+r[7]*o+r[11]*u+r[15]*p,i}ho=new ca(4),ca!=Float32Array&&(ho[0]=0,ho[1]=0,ho[2]=0,ho[3]=0);class Cd extends sr{constructor(e){super(e,Sd)}createBucket(e){return new cc(e)}queryRadius(e){const r=e;return co("circle-radius",this,r)+co("circle-stroke-width",this,r)+_l(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,s,o,u,p,f,_){const x=yl(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,f),b=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),T=this.paint.get("circle-pitch-alignment")==="map",I=T?x:function(P,R){return P.map(j=>mh(j,R))}(x,_),k=T?b*f:b;for(const P of o)for(const R of P){const j=T?R:mh(R,_);let q=k;const te=xl([],[R.x,R.y,0,1],_);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?q*=te[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(q*=p.cameraToCenterDistance/te[3]),xd(I,j,q))return!0}return!1}}function mh(i,e){const r=xl([],[i.x,i.y,0,1],e);return new Ae(r[0]/r[3],r[1]/r[3])}class gh extends cc{}let _h;De("HeatmapBucket",gh,{omit:["layers"]});var Id={get paint(){return _h=_h||new Wt({"heatmap-radius":new Ze(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ze(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new je(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new to(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new je(he.paint_heatmap["heatmap-opacity"])})}};function pc(i,{width:e,height:r},s,o){if(o){if(o instanceof Uint8ClampedArray)o=new Uint8Array(o.buffer);else if(o.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${o.length} but got: ${e*r*s}`)}else o=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=o,i}function yh(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const o=pc({},{width:e,height:r},s);fc(i,o,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=o.data}function fc(i,e,r,s,o,u){if(o.width===0||o.height===0)return e;if(o.width>i.width||o.height>i.height||r.x>i.width-o.width||r.y>i.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>e.width||o.height>e.height||s.x>e.width-o.width||s.y>e.height-o.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,f=e.data;if(p===f)throw new Error("srcData equals dstData, so image is already copied");for(let _=0;_<o.height;_++){const x=((r.y+_)*i.width+r.x)*u,b=((s.y+_)*e.width+s.x)*u;for(let T=0;T<o.width*u;T++)f[b+T]=p[x+T]}return e}class uo{constructor(e,r){pc(this,e,1,r)}resize(e){yh(this,e,1)}clone(){return new uo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,o,u){fc(e,r,s,o,u,1)}}class dr{constructor(e,r){pc(this,e,4,r)}resize(e){yh(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new dr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,o,u){fc(e,r,s,o,u,4)}}function xh(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,o=i.image||new dr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const u=(p,f,_)=>{e[i.evaluationKey]=_;const x=i.expression.evaluate(e);o.data[p+f+0]=Math.floor(255*x.r/x.a),o.data[p+f+1]=Math.floor(255*x.g/x.a),o.data[p+f+2]=Math.floor(255*x.b/x.a),o.data[p+f+3]=Math.floor(255*x.a)};if(i.clips)for(let p=0,f=0;p<s;++p,f+=4*r)for(let _=0,x=0;_<r;_++,x+=4){const b=_/(r-1),{start:T,end:I}=i.clips[p];u(f,x,T*(1-b)+I*b)}else for(let p=0,f=0;p<r;p++,f+=4)u(0,f,p/(r-1));return o}De("AlphaImage",uo),De("RGBAImage",dr);class Ed extends sr{createBucket(e){return new gh(e)}constructor(e){super(e,Id),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let vh;var Md={get paint(){return vh=vh||new Wt({"hillshade-illumination-direction":new je(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new je(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new je(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new je(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new je(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new je(he.paint_hillshade["hillshade-accent-color"])})}};class Ad extends sr{constructor(e){super(e,Md)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const kd=Vt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pd}=kd;var mc={exports:{}};function vl(i,e,r){r=r||2;var s,o,u,p,f,_,x,b=e&&e.length,T=b?e[0]*r:i.length,I=bh(i,0,T,r,!0),k=[];if(!I||I.next===I.prev)return k;if(b&&(I=function(R,j,q,te){var X,re,se,me=[];for(X=0,re=j.length;X<re;X++)(se=bh(R,j[X]*te,X<re-1?j[X+1]*te:R.length,te,!1))===se.next&&(se.steiner=!0),me.push(Nd(se));for(me.sort(Bd),X=0;X<me.length;X++)q=Fd(me[X],q);return q}(i,e,I,r)),i.length>80*r){s=u=i[0],o=p=i[1];for(var P=r;P<T;P+=r)(f=i[P])<s&&(s=f),(_=i[P+1])<o&&(o=_),f>u&&(u=f),_>p&&(p=_);x=(x=Math.max(u-s,p-o))!==0?32767/x:0}return po(I,k,r,s,o,x,0),k}function bh(i,e,r,s,o){var u,p;if(o===yc(i,e,r,s)>0)for(u=e;u<r;u+=s)p=Th(u,i[u],i[u+1],p);else for(u=r-s;u>=e;u-=s)p=Th(u,i[u],i[u+1],p);return p&&bl(p,p.next)&&(mo(p),p=p.next),p}function Cs(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!bl(s,s.next)&&Kt(s.prev,s,s.next)!==0)s=s.next;else{if(mo(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function po(i,e,r,s,o,u,p){if(i){!p&&u&&function(b,T,I,k){var P=b;do P.z===0&&(P.z=gc(P.x,P.y,T,I,k)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==b);P.prevZ.nextZ=null,P.prevZ=null,function(R){var j,q,te,X,re,se,me,ze,Fe=1;do{for(q=R,R=null,re=null,se=0;q;){for(se++,te=q,me=0,j=0;j<Fe&&(me++,te=te.nextZ);j++);for(ze=Fe;me>0||ze>0&&te;)me!==0&&(ze===0||!te||q.z<=te.z)?(X=q,q=q.nextZ,me--):(X=te,te=te.nextZ,ze--),re?re.nextZ=X:R=X,X.prevZ=re,re=X;q=te}re.nextZ=null,Fe*=2}while(se>1)}(P)}(i,s,o,u);for(var f,_,x=i;i.prev!==i.next;)if(f=i.prev,_=i.next,u?Dd(i,s,o,u):zd(i))e.push(f.i/r|0),e.push(i.i/r|0),e.push(_.i/r|0),mo(i),i=_.next,x=_.next;else if((i=_)===x){p?p===1?po(i=Ld(Cs(i),e,r),e,r,s,o,u,2):p===2&&Rd(i,e,r,s,o,u):po(Cs(i),e,r,s,o,u,1);break}}}function zd(i){var e=i.prev,r=i,s=i.next;if(Kt(e,r,s)>=0)return!1;for(var o=e.x,u=r.x,p=s.x,f=e.y,_=r.y,x=s.y,b=o<u?o<p?o:p:u<p?u:p,T=f<_?f<x?f:x:_<x?_:x,I=o>u?o>p?o:p:u>p?u:p,k=f>_?f>x?f:x:_>x?_:x,P=s.next;P!==e;){if(P.x>=b&&P.x<=I&&P.y>=T&&P.y<=k&&ha(o,f,u,_,p,x,P.x,P.y)&&Kt(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function Dd(i,e,r,s){var o=i.prev,u=i,p=i.next;if(Kt(o,u,p)>=0)return!1;for(var f=o.x,_=u.x,x=p.x,b=o.y,T=u.y,I=p.y,k=f<_?f<x?f:x:_<x?_:x,P=b<T?b<I?b:I:T<I?T:I,R=f>_?f>x?f:x:_>x?_:x,j=b>T?b>I?b:I:T>I?T:I,q=gc(k,P,e,r,s),te=gc(R,j,e,r,s),X=i.prevZ,re=i.nextZ;X&&X.z>=q&&re&&re.z<=te;){if(X.x>=k&&X.x<=R&&X.y>=P&&X.y<=j&&X!==o&&X!==p&&ha(f,b,_,T,x,I,X.x,X.y)&&Kt(X.prev,X,X.next)>=0||(X=X.prevZ,re.x>=k&&re.x<=R&&re.y>=P&&re.y<=j&&re!==o&&re!==p&&ha(f,b,_,T,x,I,re.x,re.y)&&Kt(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;X&&X.z>=q;){if(X.x>=k&&X.x<=R&&X.y>=P&&X.y<=j&&X!==o&&X!==p&&ha(f,b,_,T,x,I,X.x,X.y)&&Kt(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;re&&re.z<=te;){if(re.x>=k&&re.x<=R&&re.y>=P&&re.y<=j&&re!==o&&re!==p&&ha(f,b,_,T,x,I,re.x,re.y)&&Kt(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function Ld(i,e,r){var s=i;do{var o=s.prev,u=s.next.next;!bl(o,u)&&wh(o,s,s.next,u)&&fo(o,u)&&fo(u,o)&&(e.push(o.i/r|0),e.push(s.i/r|0),e.push(u.i/r|0),mo(s),mo(s.next),s=i=u),s=s.next}while(s!==i);return Cs(s)}function Rd(i,e,r,s,o,u){var p=i;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&Vd(p,f)){var _=Sh(p,f);return p=Cs(p,p.next),_=Cs(_,_.next),po(p,e,r,s,o,u,0),void po(_,e,r,s,o,u,0)}f=f.next}p=p.next}while(p!==i)}function Bd(i,e){return i.x-e.x}function Fd(i,e){var r=function(o,u){var p,f=u,_=o.x,x=o.y,b=-1/0;do{if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){var T=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(T<=_&&T>b&&(b=T,p=f.x<f.next.x?f:f.next,T===_))return p}f=f.next}while(f!==u);if(!p)return null;var I,k=p,P=p.x,R=p.y,j=1/0;f=p;do _>=f.x&&f.x>=P&&_!==f.x&&ha(x<R?_:b,x,P,R,x<R?b:_,x,f.x,f.y)&&(I=Math.abs(x-f.y)/(_-f.x),fo(f,o)&&(I<j||I===j&&(f.x>p.x||f.x===p.x&&Od(p,f)))&&(p=f,j=I)),f=f.next;while(f!==k);return p}(i,e);if(!r)return e;var s=Sh(r,i);return Cs(s,s.next),Cs(r,r.next)}function Od(i,e){return Kt(i.prev,i,e.prev)<0&&Kt(e.next,i,i.next)<0}function gc(i,e,r,s,o){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*o|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Nd(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function ha(i,e,r,s,o,u,p,f){return(o-p)*(e-f)>=(i-p)*(u-f)&&(i-p)*(s-f)>=(r-p)*(e-f)&&(r-p)*(u-f)>=(o-p)*(s-f)}function Vd(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var o=r;do{if(o.i!==r.i&&o.next.i!==r.i&&o.i!==s.i&&o.next.i!==s.i&&wh(o,o.next,r,s))return!0;o=o.next}while(o!==r);return!1}(i,e)&&(fo(i,e)&&fo(e,i)&&function(r,s){var o=r,u=!1,p=(r.x+s.x)/2,f=(r.y+s.y)/2;do o.y>f!=o.next.y>f&&o.next.y!==o.y&&p<(o.next.x-o.x)*(f-o.y)/(o.next.y-o.y)+o.x&&(u=!u),o=o.next;while(o!==r);return u}(i,e)&&(Kt(i.prev,i,e.prev)||Kt(i,e.prev,e))||bl(i,e)&&Kt(i.prev,i,i.next)>0&&Kt(e.prev,e,e.next)>0)}function Kt(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function bl(i,e){return i.x===e.x&&i.y===e.y}function wh(i,e,r,s){var o=Sl(Kt(i,e,r)),u=Sl(Kt(i,e,s)),p=Sl(Kt(r,s,i)),f=Sl(Kt(r,s,e));return o!==u&&p!==f||!(o!==0||!wl(i,r,e))||!(u!==0||!wl(i,s,e))||!(p!==0||!wl(r,i,s))||!(f!==0||!wl(r,e,s))}function wl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Sl(i){return i>0?1:i<0?-1:0}function fo(i,e){return Kt(i.prev,i,i.next)<0?Kt(i,e,i.next)>=0&&Kt(i,i.prev,e)>=0:Kt(i,e,i.prev)<0||Kt(i,i.next,e)<0}function Sh(i,e){var r=new _c(i.i,i.x,i.y),s=new _c(e.i,e.x,e.y),o=i.next,u=e.prev;return i.next=e,e.prev=i,r.next=o,o.prev=r,s.next=r,r.prev=s,u.next=s,s.prev=u,s}function Th(i,e,r,s){var o=new _c(i,e,r);return s?(o.next=s.next,o.prev=s,s.next.prev=o,s.next=o):(o.prev=o,o.next=o),o}function mo(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function _c(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yc(i,e,r,s){for(var o=0,u=e,p=r-s;u<r;u+=s)o+=(i[p]-i[u])*(i[u+1]+i[p+1]),p=u;return o}mc.exports=vl,mc.exports.default=vl,vl.deviation=function(i,e,r,s){var o=e&&e.length,u=Math.abs(yc(i,0,o?e[0]*r:i.length,r));if(o)for(var p=0,f=e.length;p<f;p++)u-=Math.abs(yc(i,e[p]*r,p<f-1?e[p+1]*r:i.length,r));var _=0;for(p=0;p<s.length;p+=3){var x=s[p]*r,b=s[p+1]*r,T=s[p+2]*r;_+=Math.abs((i[x]-i[T])*(i[b+1]-i[x+1])-(i[x]-i[b])*(i[T+1]-i[x+1]))}return u===0&&_===0?0:Math.abs((_-u)/u)},vl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,o=0;o<i.length;o++){for(var u=0;u<i[o].length;u++)for(var p=0;p<e;p++)r.vertices.push(i[o][u][p]);o>0&&r.holes.push(s+=i[o-1].length)}return r};var Ch=H(mc.exports);function jd(i,e,r,s,o){Ih(i,e,r||0,s||i.length-1,o||$d)}function Ih(i,e,r,s,o){for(;s>r;){if(s-r>600){var u=s-r+1,p=e-r+1,f=Math.log(u),_=.5*Math.exp(2*f/3),x=.5*Math.sqrt(f*_*(u-_)/u)*(p-u/2<0?-1:1);Ih(i,e,Math.max(r,Math.floor(e-p*_/u+x)),Math.min(s,Math.floor(e+(u-p)*_/u+x)),o)}var b=i[e],T=r,I=s;for(go(i,r,e),o(i[s],b)>0&&go(i,r,s);T<I;){for(go(i,T,I),T++,I--;o(i[T],b)<0;)T++;for(;o(i[I],b)>0;)I--}o(i[r],b)===0?go(i,r,I):go(i,++I,s),I<=e&&(r=I+1),e<=I&&(s=I-1)}}function go(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function $d(i,e){return i<e?-1:i>e?1:0}function xc(i,e){const r=i.length;if(r<=1)return[i];const s=[];let o,u;for(let p=0;p<r;p++){const f=Mr(i[p]);f!==0&&(i[p].area=Math.abs(f),u===void 0&&(u=f<0),u===f<0?(o&&s.push(o),o=[i[p]]):o.push(i[p]))}if(o&&s.push(o),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(jd(s[p],e,1,s[p].length-1,Ud),s[p]=s[p].slice(0,e));return s}function Ud(i,e){return e.area-i.area}function vc(i,e,r){const s=r.patternDependencies;let o=!1;for(const u of e){const p=u.paint.get(`${i}-pattern`);p.isConstant()||(o=!0);const f=p.constantOr(null);f&&(o=!0,s[f.to]=!0,s[f.from]=!0)}return o}function bc(i,e,r,s,o){const u=o.patternDependencies;for(const p of e){const f=p.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let _=f.evaluate({zoom:s-1},r,{},o.availableImages),x=f.evaluate({zoom:s},r,{},o.availableImages),b=f.evaluate({zoom:s+1},r,{},o.availableImages);_=_&&_.name?_.name:_,x=x&&x.name?x.name:x,b=b&&b.name?b.name:b,u[_]=!0,u[x]=!0,u[b]=!0,r.patterns[p.id]={min:_,mid:x,max:b}}}return r}class wc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new st,this.indexArray=new di,this.indexArray2=new ei,this.programConfigurations=new Or(e.layers,e.zoom),this.segments=new zt,this.segments2=new zt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=vc("fill",this.layers,r);const o=this.layers[0].layout.get("fill-sort-key"),u=!o.isConstant(),p=[];for(const{feature:f,id:_,index:x,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,I=Ts(f,T);if(!this.layers[0]._featureFilter.filter(new Pt(this.zoom),I,s))continue;const k=u?o.evaluate(I,{},s,r.availableImages):void 0,P={id:_,properties:f.properties,type:f.type,sourceLayerIndex:b,index:x,geometry:T?I.geometry:Ss(f),patterns:{},sortKey:k};p.push(P)}u&&p.sort((f,_)=>f.sortKey-_.sortKey);for(const f of p){const{geometry:_,index:x,sourceLayerIndex:b}=f;if(this.hasPattern){const T=bc("fill",this.layers,f,this.zoom,r);this.patternFeatures.push(T)}else this.addFeature(f,_,x,s,{});r.featureIndex.insert(e[x].feature,_,x,b,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,o,u){for(const p of xc(r,500)){let f=0;for(const k of p)f+=k.length;const _=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray),x=_.vertexLength,b=[],T=[];for(const k of p){if(k.length===0)continue;k!==p[0]&&T.push(b.length/2);const P=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),R=P.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(R+k.length-1,R),b.push(k[0].x),b.push(k[0].y);for(let j=1;j<k.length;j++)this.layoutVertexArray.emplaceBack(k[j].x,k[j].y),this.indexArray2.emplaceBack(R+j-1,R+j),b.push(k[j].x),b.push(k[j].y);P.vertexLength+=k.length,P.primitiveLength+=k.length}const I=Ch(b,T);for(let k=0;k<I.length;k+=3)this.indexArray.emplaceBack(x+I[k],x+I[k+1],x+I[k+2]);_.vertexLength+=f,_.primitiveLength+=I.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,o)}}let Eh,Mh;De("FillBucket",wc,{omit:["layers","patternFeatures"]});var qd={get paint(){return Mh=Mh||new Wt({"fill-antialias":new je(he.paint_fill["fill-antialias"]),"fill-opacity":new Ze(he.paint_fill["fill-opacity"]),"fill-color":new Ze(he.paint_fill["fill-color"]),"fill-outline-color":new Ze(he.paint_fill["fill-outline-color"]),"fill-translate":new je(he.paint_fill["fill-translate"]),"fill-translate-anchor":new je(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new vs(he.paint_fill["fill-pattern"])})},get layout(){return Eh=Eh||new Wt({"fill-sort-key":new Ze(he.layout_fill["fill-sort-key"])})}};class Zd extends sr{constructor(e){super(e,qd)}recalculate(e,r){super.recalculate(e,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new wc(e)}queryRadius(){return _l(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,s,o,u,p,f){return ch(yl(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,f),o)}isTileClipped(){return!0}}const Gd=Vt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Hd=Vt([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Wd}=Gd;var Kn={},Xd=Ve,Ah=ua;function ua(i,e,r,s,o){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=o,i.readFields(Kd,this,e)}function Kd(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,o){for(var u=s.readVarint()+s.pos;s.pos<u;){var p=o._keys[s.readVarint()],f=o._values[s.readVarint()];o.properties[p]=f}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Yd(i){for(var e,r,s=0,o=0,u=i.length,p=u-1;o<u;p=o++)s+=((r=i[p]).x-(e=i[o]).x)*(e.y+r.y);return s}ua.types=["Unknown","Point","LineString","Polygon"],ua.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,o=0,u=0,p=0,f=[];i.pos<r;){if(o<=0){var _=i.readVarint();s=7&_,o=_>>3}if(o--,s===1||s===2)u+=i.readSVarint(),p+=i.readSVarint(),s===1&&(e&&f.push(e),e=[]),e.push(new Xd(u,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&f.push(e),f},ua.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,o=0,u=0,p=1/0,f=-1/0,_=1/0,x=-1/0;i.pos<e;){if(s<=0){var b=i.readVarint();r=7&b,s=b>>3}if(s--,r===1||r===2)(o+=i.readSVarint())<p&&(p=o),o>f&&(f=o),(u+=i.readSVarint())<_&&(_=u),u>x&&(x=u);else if(r!==7)throw new Error("unknown command "+r)}return[p,_,f,x]},ua.prototype.toGeoJSON=function(i,e,r){var s,o,u=this.extent*Math.pow(2,r),p=this.extent*i,f=this.extent*e,_=this.loadGeometry(),x=ua.types[this.type];function b(k){for(var P=0;P<k.length;P++){var R=k[P];k[P]=[360*(R.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(R.y+f)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(s=0;s<_.length;s++)T[s]=_[s][0];b(_=T);break;case 2:for(s=0;s<_.length;s++)b(_[s]);break;case 3:for(_=function(k){var P=k.length;if(P<=1)return[k];for(var R,j,q=[],te=0;te<P;te++){var X=Yd(k[te]);X!==0&&(j===void 0&&(j=X<0),j===X<0?(R&&q.push(R),R=[k[te]]):R.push(k[te]))}return R&&q.push(R),q}(_),s=0;s<_.length;s++)for(o=0;o<_[s].length;o++)b(_[s][o])}_.length===1?_=_[0]:x="Multi"+x;var I={type:"Feature",geometry:{type:x,coordinates:_},properties:this.properties};return"id"in this&&(I.id=this.id),I};var Jd=Ah,kh=Ph;function Ph(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Qd,this,e),this.length=this._features.length}function Qd(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var o=null,u=s.readVarint()+s.pos;s.pos<u;){var p=s.readVarint()>>3;o=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return o}(r))}Ph.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Jd(this._pbf,e,this.extent,this._keys,this._values)};var ep=kh;function tp(i,e,r){if(i===3){var s=new ep(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}Kn.VectorTile=function(i,e){this.layers=i.readFields(tp,{},e)},Kn.VectorTileFeature=Ah,Kn.VectorTileLayer=kh;const ip=Kn.VectorTileFeature.types,Sc=Math.pow(2,13);function _o(i,e,r,s,o,u,p,f){i.emplaceBack(e,r,2*Math.floor(s*Sc)+p,o*Sc*2,u*Sc*2,Math.round(f))}class Tc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ee,this.centroidVertexArray=new we,this.indexArray=new di,this.programConfigurations=new Or(e.layers,e.zoom),this.segments=new zt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=vc("fill-extrusion",this.layers,r);for(const{feature:o,id:u,index:p,sourceLayerIndex:f}of e){const _=this.layers[0]._featureFilter.needGeometry,x=Ts(o,_);if(!this.layers[0]._featureFilter.filter(new Pt(this.zoom),x,s))continue;const b={id:u,sourceLayerIndex:f,index:p,geometry:_?x.geometry:Ss(o),properties:o.properties,type:o.type,patterns:{}};this.hasPattern?this.features.push(bc("fill-extrusion",this.layers,b,this.zoom,r)):this.addFeature(b,b.geometry,p,s,{}),r.featureIndex.insert(o,b.geometry,p,f,this.index,!0)}}addFeatures(e,r,s){for(const o of this.features){const{geometry:u}=o;this.addFeature(o,u,o.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wd),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Hd.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,o,u){const p={x:0,y:0,vertexCount:0};for(const f of xc(r,500)){let _=0;for(const P of f)_+=P.length;let x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const P of f){if(P.length===0||np(P))continue;let R=0;for(let j=0;j<P.length;j++){const q=P[j];if(j>=1){const te=P[j-1];if(!rp(q,te)){x.vertexLength+4>zt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const X=q.sub(te)._perp()._unit(),re=te.dist(q);R+re>32768&&(R=0),_o(this.layoutVertexArray,q.x,q.y,X.x,X.y,0,0,R),_o(this.layoutVertexArray,q.x,q.y,X.x,X.y,0,1,R),p.x+=2*q.x,p.y+=2*q.y,p.vertexCount+=2,R+=re,_o(this.layoutVertexArray,te.x,te.y,X.x,X.y,0,0,R),_o(this.layoutVertexArray,te.x,te.y,X.x,X.y,0,1,R),p.x+=2*te.x,p.y+=2*te.y,p.vertexCount+=2;const se=x.vertexLength;this.indexArray.emplaceBack(se,se+2,se+1),this.indexArray.emplaceBack(se+1,se+2,se+3),x.vertexLength+=4,x.primitiveLength+=2}}}}if(x.vertexLength+_>zt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray)),ip[e.type]!=="Polygon")continue;const b=[],T=[],I=x.vertexLength;for(const P of f)if(P.length!==0){P!==f[0]&&T.push(b.length/2);for(let R=0;R<P.length;R++){const j=P[R];_o(this.layoutVertexArray,j.x,j.y,0,0,1,1,0),p.x+=j.x,p.y+=j.y,p.vertexCount+=1,b.push(j.x),b.push(j.y)}}const k=Ch(b,T);for(let P=0;P<k.length;P+=3)this.indexArray.emplaceBack(I+k[P],I+k[P+2],I+k[P+1]);x.primitiveLength+=k.length/3,x.vertexLength+=_}for(let f=0;f<p.vertexCount;f++)this.centroidVertexArray.emplaceBack(Math.floor(p.x/p.vertexCount),Math.floor(p.y/p.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,o)}}function rp(i,e){return i.x===e.x&&(i.x<0||i.x>Jt)||i.y===e.y&&(i.y<0||i.y>Jt)}function np(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Jt)||i.every(e=>e.y<0)||i.every(e=>e.y>Jt)}let zh;De("FillExtrusionBucket",Tc,{omit:["layers","features"]});var sp={get paint(){return zh=zh||new Wt({"fill-extrusion-opacity":new je(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ze(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new je(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new je(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vs(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ze(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ze(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new je(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ap extends sr{constructor(e){super(e,sp)}createBucket(e){return new Tc(e)}queryRadius(){return _l(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,s,o,u,p,f,_){const x=yl(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,f),b=this.paint.get("fill-extrusion-height").evaluate(r,s),T=this.paint.get("fill-extrusion-base").evaluate(r,s),I=function(P,R,j,q){const te=[];for(const X of P){const re=[X.x,X.y,0,1];xl(re,re,R),te.push(new Ae(re[0]/re[3],re[1]/re[3]))}return te}(x,_),k=function(P,R,j,q){const te=[],X=[],re=q[8]*R,se=q[9]*R,me=q[10]*R,ze=q[11]*R,Fe=q[8]*j,ke=q[9]*j,Me=q[10]*j,Se=q[11]*j;for(const Le of P){const Ce=[],be=[];for(const Ue of Le){const Ne=Ue.x,tt=Ue.y,Dt=q[0]*Ne+q[4]*tt+q[12],Rt=q[1]*Ne+q[5]*tt+q[13],ri=q[2]*Ne+q[6]*tt+q[14],or=q[3]*Ne+q[7]*tt+q[15],Ri=ri+me,Qt=or+ze,fi=Dt+Fe,xi=Rt+ke,Bi=ri+Me,Fi=or+Se,ni=new Ae((Dt+re)/Qt,(Rt+se)/Qt);ni.z=Ri/Qt,Ce.push(ni);const si=new Ae(fi/Fi,xi/Fi);si.z=Bi/Fi,be.push(si)}te.push(Ce),X.push(be)}return[te,X]}(o,T,b,_);return function(P,R,j){let q=1/0;ch(j,R)&&(q=Dh(j,R[0]));for(let te=0;te<R.length;te++){const X=R[te],re=P[te];for(let se=0;se<X.length-1;se++){const me=X[se],ze=[me,X[se+1],re[se+1],re[se],me];lh(j,ze)&&(q=Math.min(q,Dh(j,ze)))}}return q!==1/0&&q}(k[0],k[1],I)}}function yo(i,e){return i.x*e.x+i.y*e.y}function Dh(i,e){if(i.length===1){let r=0;const s=e[r++];let o;for(;!o||s.equals(o);)if(o=e[r++],!o)return 1/0;for(;r<e.length;r++){const u=e[r],p=i[0],f=o.sub(s),_=u.sub(s),x=p.sub(s),b=yo(f,f),T=yo(f,_),I=yo(_,_),k=yo(x,f),P=yo(x,_),R=b*I-T*T,j=(I*k-T*P)/R,q=(b*P-T*k)/R,te=s.z*(1-j-q)+o.z*j+u.z*q;if(isFinite(te))return te}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const op=Vt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:lp}=op,cp=Vt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:hp}=cp,up=Kn.VectorTileFeature.types,dp=Math.cos(Math.PI/180*37.5),Lh=Math.pow(2,14)/.5;class Cc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ge,this.layoutVertexArray2=new Oe,this.indexArray=new di,this.programConfigurations=new Or(e.layers,e.zoom),this.segments=new zt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=vc("line",this.layers,r);const o=this.layers[0].layout.get("line-sort-key"),u=!o.isConstant(),p=[];for(const{feature:f,id:_,index:x,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,I=Ts(f,T);if(!this.layers[0]._featureFilter.filter(new Pt(this.zoom),I,s))continue;const k=u?o.evaluate(I,{},s):void 0,P={id:_,properties:f.properties,type:f.type,sourceLayerIndex:b,index:x,geometry:T?I.geometry:Ss(f),patterns:{},sortKey:k};p.push(P)}u&&p.sort((f,_)=>f.sortKey-_.sortKey);for(const f of p){const{geometry:_,index:x,sourceLayerIndex:b}=f;if(this.hasPattern){const T=bc("line",this.layers,f,this.zoom,r);this.patternFeatures.push(T)}else this.addFeature(f,_,x,s,{});r.featureIndex.insert(e[x].feature,_,x,b,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,hp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,o,u){const p=this.layers[0].layout,f=p.get("line-join").evaluate(e,{}),_=p.get("line-cap"),x=p.get("line-miter-limit"),b=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const T of r)this.addLine(T,e,f,_,x,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,o)}addLine(e,r,s,o,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=up[r.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let x=0;for(;x<_-1&&e[x].equals(e[x+1]);)x++;if(_<(f?3:2))return;s==="bevel"&&(u=1.05);const b=this.overscaling<=16?15*Jt/(512*this.overscaling):0,T=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let I,k,P,R,j;this.e1=this.e2=-1,f&&(I=e[_-2],j=e[x].sub(I)._unit()._perp());for(let q=x;q<_;q++){if(P=q===_-1?f?e[x+1]:void 0:e[q+1],P&&e[q].equals(P))continue;j&&(R=j),I&&(k=I),I=e[q],j=P?P.sub(I)._unit()._perp():R,R=R||j;let te=R.add(j);te.x===0&&te.y===0||te._unit();const X=R.x*j.x+R.y*j.y,re=te.x*j.x+te.y*j.y,se=re!==0?1/re:1/0,me=2*Math.sqrt(2-2*re),ze=re<dp&&k&&P,Fe=R.x*j.y-R.y*j.x>0;if(ze&&q>x){const Se=I.dist(k);if(Se>2*b){const Le=I.sub(I.sub(k)._mult(b/Se)._round());this.updateDistance(k,Le),this.addCurrentVertex(Le,R,0,0,T),k=Le}}const ke=k&&P;let Me=ke?s:f?"butt":o;if(ke&&Me==="round"&&(se<p?Me="miter":se<=2&&(Me="fakeround")),Me==="miter"&&se>u&&(Me="bevel"),Me==="bevel"&&(se>2&&(Me="flipbevel"),se<u&&(Me="miter")),k&&this.updateDistance(k,I),Me==="miter")te._mult(se),this.addCurrentVertex(I,te,0,0,T);else if(Me==="flipbevel"){if(se>100)te=j.mult(-1);else{const Se=se*R.add(j).mag()/R.sub(j).mag();te._perp()._mult(Se*(Fe?-1:1))}this.addCurrentVertex(I,te,0,0,T),this.addCurrentVertex(I,te.mult(-1),0,0,T)}else if(Me==="bevel"||Me==="fakeround"){const Se=-Math.sqrt(se*se-1),Le=Fe?Se:0,Ce=Fe?0:Se;if(k&&this.addCurrentVertex(I,R,Le,Ce,T),Me==="fakeround"){const be=Math.round(180*me/Math.PI/20);for(let Ue=1;Ue<be;Ue++){let Ne=Ue/be;if(Ne!==.5){const Dt=Ne-.5;Ne+=Ne*Dt*(Ne-1)*((1.0904+X*(X*(3.55645-1.43519*X)-3.2452))*Dt*Dt+(.848013+X*(.215638*X-1.06021)))}const tt=j.sub(R)._mult(Ne)._add(R)._unit()._mult(Fe?-1:1);this.addHalfVertex(I,tt.x,tt.y,!1,Fe,0,T)}}P&&this.addCurrentVertex(I,j,-Le,-Ce,T)}else if(Me==="butt")this.addCurrentVertex(I,te,0,0,T);else if(Me==="square"){const Se=k?1:-1;this.addCurrentVertex(I,te,Se,Se,T)}else Me==="round"&&(k&&(this.addCurrentVertex(I,R,0,0,T),this.addCurrentVertex(I,R,1,1,T,!0)),P&&(this.addCurrentVertex(I,j,-1,-1,T,!0),this.addCurrentVertex(I,j,0,0,T)));if(ze&&q<_-1){const Se=I.dist(P);if(Se>2*b){const Le=I.add(P.sub(I)._mult(b/Se)._round());this.updateDistance(I,Le),this.addCurrentVertex(Le,j,0,0,T),I=Le}}}}addCurrentVertex(e,r,s,o,u,p=!1){const f=r.y*o-r.x,_=-r.y-r.x*o;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,p,!1,s,u),this.addHalfVertex(e,f,_,p,!0,-o,u),this.distance>Lh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,s,o,u,p))}addHalfVertex({x:e,y:r},s,o,u,p,f,_){const x=.5*(this.lineClips?this.scaledDistance*(Lh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*o)+128,1+(f===0?0:f<0?-1:1)|(63&x)<<2,x>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const b=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),_.primitiveLength++),p?this.e2=b:this.e1=b}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let Rh,Bh;De("LineBucket",Cc,{omit:["layers","patternFeatures"]});var Fh={get paint(){return Bh=Bh||new Wt({"line-opacity":new Ze(he.paint_line["line-opacity"]),"line-color":new Ze(he.paint_line["line-color"]),"line-translate":new je(he.paint_line["line-translate"]),"line-translate-anchor":new je(he.paint_line["line-translate-anchor"]),"line-width":new Ze(he.paint_line["line-width"]),"line-gap-width":new Ze(he.paint_line["line-gap-width"]),"line-offset":new Ze(he.paint_line["line-offset"]),"line-blur":new Ze(he.paint_line["line-blur"]),"line-dasharray":new eo(he.paint_line["line-dasharray"]),"line-pattern":new vs(he.paint_line["line-pattern"]),"line-gradient":new to(he.paint_line["line-gradient"])})},get layout(){return Rh=Rh||new Wt({"line-cap":new je(he.layout_line["line-cap"]),"line-join":new Ze(he.layout_line["line-join"]),"line-miter-limit":new je(he.layout_line["line-miter-limit"]),"line-round-limit":new je(he.layout_line["line-round-limit"]),"line-sort-key":new Ze(he.layout_line["line-sort-key"])})}};class pp extends Ze{possiblyEvaluate(e,r){return r=new Pt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,s,o){return r=ci({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,s,o)}}let Tl;class fp extends sr{constructor(e){super(e,Fh),this.gradientVersion=0,Tl||(Tl=new pp(Fh.paint.properties["line-width"].specification),Tl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Qr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Tl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Cc(e)}queryRadius(e){const r=e,s=Oh(co("line-width",this,r),co("line-gap-width",this,r)),o=co("line-offset",this,r);return s/2+Math.abs(o)+_l(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,s,o,u,p,f){const _=yl(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,f),x=f/2*Oh(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),b=this.paint.get("line-offset").evaluate(r,s);return b&&(o=function(T,I){const k=[];for(let P=0;P<T.length;P++){const R=T[P],j=[];for(let q=0;q<R.length;q++){const te=R[q-1],X=R[q],re=R[q+1],se=q===0?new Ae(0,0):X.sub(te)._unit()._perp(),me=q===R.length-1?new Ae(0,0):re.sub(X)._unit()._perp(),ze=se._add(me)._unit(),Fe=ze.x*me.x+ze.y*me.y;Fe!==0&&ze._mult(1/Fe),j.push(ze._mult(I)._add(X))}k.push(j)}return k}(o,b*f)),function(T,I,k){for(let P=0;P<I.length;P++){const R=I[P];if(T.length>=3){for(let j=0;j<R.length;j++)if(la(T,R[j]))return!0}if(vd(T,R,k))return!0}return!1}(_,o,x)}isTileClipped(){return!0}}function Oh(i,e){return e>0?e+2*i:i}const mp=Vt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gp=Vt([{name:"a_projected_pos",components:3,type:"Float32"}],4);Vt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const _p=Vt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Vt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Nh=Vt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),yp=Vt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function xp(i,e,r){return i.sections.forEach(s=>{s.text=function(o,u,p){const f=u.layout.get("text-transform").evaluate(p,{});return f==="uppercase"?o=o.toLocaleUpperCase():f==="lowercase"&&(o=o.toLocaleLowerCase()),qi.applyArabicShaping&&(o=qi.applyArabicShaping(o)),o}(s.text,e,r)}),i}Vt([{name:"triangle",components:3,type:"Uint16"}]),Vt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Vt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Vt([{type:"Float32",name:"offsetX"}]),Vt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Vt([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const xo={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var ii=24,Vh=Ct,jh=function(i,e,r,s,o){var u,p,f=8*o-s-1,_=(1<<f)-1,x=_>>1,b=-7,T=r?o-1:0,I=r?-1:1,k=i[e+T];for(T+=I,u=k&(1<<-b)-1,k>>=-b,b+=f;b>0;u=256*u+i[e+T],T+=I,b-=8);for(p=u&(1<<-b)-1,u>>=-b,b+=s;b>0;p=256*p+i[e+T],T+=I,b-=8);if(u===0)u=1-x;else{if(u===_)return p?NaN:1/0*(k?-1:1);p+=Math.pow(2,s),u-=x}return(k?-1:1)*p*Math.pow(2,u-s)},$h=function(i,e,r,s,o,u){var p,f,_,x=8*u-o-1,b=(1<<x)-1,T=b>>1,I=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=s?0:u-1,P=s?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=b):(p=Math.floor(Math.log(e)/Math.LN2),e*(_=Math.pow(2,-p))<1&&(p--,_*=2),(e+=p+T>=1?I/_:I*Math.pow(2,1-T))*_>=2&&(p++,_/=2),p+T>=b?(f=0,p=b):p+T>=1?(f=(e*_-1)*Math.pow(2,o),p+=T):(f=e*Math.pow(2,T-1)*Math.pow(2,o),p=0));o>=8;i[r+k]=255&f,k+=P,f/=256,o-=8);for(p=p<<o|f,x+=o;x>0;i[r+k]=255&p,k+=P,p/=256,x-=8);i[r+k-P]|=128*R};function Ct(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ct.Varint=0,Ct.Fixed64=1,Ct.Bytes=2,Ct.Fixed32=5;var Ic=4294967296,Uh=1/Ic,qh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function In(i){return i.type===Ct.Bytes?i.readVarint()+i.pos:i.pos+1}function da(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Zh(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var o=r.pos-1;o>=i;o--)r.buf[o+s]=r.buf[o]}function vp(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function bp(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function wp(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Sp(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Tp(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Cp(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Ip(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Ep(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Mp(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Cl(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function pa(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Gh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Ct.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),o=s>>3,u=this.pos;this.type=7&s,i(o,e,this),this.pos===u&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Cl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Gh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Cl(this.buf,this.pos)+Cl(this.buf,this.pos+4)*Ic;return this.pos+=8,i},readSFixed64:function(){var i=Cl(this.buf,this.pos)+Gh(this.buf,this.pos+4)*Ic;return this.pos+=8,i},readFloat:function(){var i=jh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=jh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(o,u,p){var f,_,x=p.buf;if(f=(112&(_=x[p.pos++]))>>4,_<128||(f|=(127&(_=x[p.pos++]))<<3,_<128)||(f|=(127&(_=x[p.pos++]))<<10,_<128)||(f|=(127&(_=x[p.pos++]))<<17,_<128)||(f|=(127&(_=x[p.pos++]))<<24,_<128)||(f|=(1&(_=x[p.pos++]))<<31,_<128))return da(o,f,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&qh?function(r,s,o){return qh.decode(r.subarray(s,o))}(this.buf,e,i):function(r,s,o){for(var u="",p=s;p<o;){var f,_,x,b=r[p],T=null,I=b>239?4:b>223?3:b>191?2:1;if(p+I>o)break;I===1?b<128&&(T=b):I===2?(192&(f=r[p+1]))==128&&(T=(31&b)<<6|63&f)<=127&&(T=null):I===3?(_=r[p+2],(192&(f=r[p+1]))==128&&(192&_)==128&&((T=(15&b)<<12|(63&f)<<6|63&_)<=2047||T>=55296&&T<=57343)&&(T=null)):I===4&&(_=r[p+2],x=r[p+3],(192&(f=r[p+1]))==128&&(192&_)==128&&(192&x)==128&&((T=(15&b)<<18|(63&f)<<12|(63&_)<<6|63&x)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,I=1):T>65535&&(T-=65536,u+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),u+=String.fromCharCode(T),p+=I}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ct.Bytes)return i.push(this.readVarint(e));var r=In(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ct.Bytes)return i.push(this.readSVarint());var e=In(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ct.Bytes)return i.push(this.readBoolean());var e=In(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ct.Bytes)return i.push(this.readFloat());var e=In(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ct.Bytes)return i.push(this.readDouble());var e=In(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ct.Bytes)return i.push(this.readFixed32());var e=In(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ct.Bytes)return i.push(this.readSFixed32());var e=In(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ct.Bytes)return i.push(this.readFixed64());var e=In(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ct.Bytes)return i.push(this.readSFixed64());var e=In(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ct.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ct.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ct.Fixed32)this.pos+=4;else{if(e!==Ct.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),pa(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),pa(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),pa(this.buf,-1&i,this.pos),pa(this.buf,Math.floor(i*Uh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),pa(this.buf,-1&i,this.pos),pa(this.buf,Math.floor(i*Uh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,o;if(e>=0?(s=e%4294967296|0,o=e/4294967296|0):(o=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,o=o+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(u,p,f){f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,f.buf[f.pos]=127&(u>>>=7)}(s,0,r),function(u,p){var f=(7&u)<<4;p.buf[p.pos++]|=f|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(o,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,o,u){for(var p,f,_=0;_<o.length;_++){if((p=o.charCodeAt(_))>55295&&p<57344){if(!f){p>56319||_+1===o.length?(s[u++]=239,s[u++]=191,s[u++]=189):f=p;continue}if(p<56320){s[u++]=239,s[u++]=191,s[u++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(s[u++]=239,s[u++]=191,s[u++]=189,f=null);p<128?s[u++]=p:(p<2048?s[u++]=p>>6|192:(p<65536?s[u++]=p>>12|224:(s[u++]=p>>18|240,s[u++]=p>>12&63|128),s[u++]=p>>6&63|128),s[u++]=63&p|128)}return u}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Zh(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),$h(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),$h(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&Zh(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Ct.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,vp,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,bp,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Tp,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,wp,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Sp,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Cp,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Ip,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Ep,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Mp,e)},writeBytesField:function(i,e){this.writeTag(i,Ct.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ct.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ct.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ct.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ct.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ct.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ct.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ct.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ct.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ct.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Ec=H(Vh);const Mc=3;function Ap(i,e,r){i===1&&r.readMessage(kp,e)}function kp(i,e,r){if(i===3){const{id:s,bitmap:o,width:u,height:p,left:f,top:_,advance:x}=r.readMessage(Pp,{});e.push({id:s,bitmap:new uo({width:u+2*Mc,height:p+2*Mc},o),metrics:{width:u,height:p,left:f,top:_,advance:x}})}}function Pp(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Hh=Mc;function Wh(i){let e=0,r=0;for(const p of i)e+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,f)=>f.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let o=0,u=0;for(const p of i)for(let f=s.length-1;f>=0;f--){const _=s[f];if(!(p.w>_.w||p.h>_.h)){if(p.x=_.x,p.y=_.y,u=Math.max(u,p.y+p.h),o=Math.max(o,p.x+p.w),p.w===_.w&&p.h===_.h){const x=s.pop();f<s.length&&(s[f]=x)}else p.h===_.h?(_.x+=p.w,_.w-=p.w):p.w===_.w?(_.y+=p.h,_.h-=p.h):(s.push({x:_.x+p.w,y:_.y,w:_.w-p.w,h:p.h}),_.y+=p.h,_.h-=p.h);break}}return{w:o,h:u,fill:e/(o*u)||0}}const Gi=1;class Ac{constructor(e,{pixelRatio:r,version:s,stretchX:o,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=o,this.stretchY=u,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+Gi,this.paddedRect.y+Gi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Gi,this.paddedRect.y+this.paddedRect.h-Gi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Gi)/this.pixelRatio,(this.paddedRect.h-2*Gi)/this.pixelRatio]}}class Xh{constructor(e,r){const s={},o={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,s,u),this.addImages(r,o,u);const{w:p,h:f}=Wh(u),_=new dr({width:p||1,height:f||1});for(const x in e){const b=e[x],T=s[x].paddedRect;dr.copy(b.data,_,{x:0,y:0},{x:T.x+Gi,y:T.y+Gi},b.data)}for(const x in r){const b=r[x],T=o[x].paddedRect,I=T.x+Gi,k=T.y+Gi,P=b.data.width,R=b.data.height;dr.copy(b.data,_,{x:0,y:0},{x:I,y:k},b.data),dr.copy(b.data,_,{x:0,y:R-1},{x:I,y:k-1},{width:P,height:1}),dr.copy(b.data,_,{x:0,y:0},{x:I,y:k+R},{width:P,height:1}),dr.copy(b.data,_,{x:P-1,y:0},{x:I-1,y:k},{width:1,height:R}),dr.copy(b.data,_,{x:0,y:0},{x:I+P,y:k},{width:1,height:R})}this.image=_,this.iconPositions=s,this.patternPositions=o}addImages(e,r,s){for(const o in e){const u=e[o],p={x:0,y:0,w:u.data.width+2*Gi,h:u.data.height+2*Gi};s.push(p),r[o]=new Ac(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(o)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[o,u]=e.tl;s.update(r.data,void 0,{x:o,y:u})}}var Yn;De("ImagePosition",Ac),De("ImageAtlas",Xh),c.ai=void 0,(Yn=c.ai||(c.ai={}))[Yn.none=0]="none",Yn[Yn.horizontal=1]="horizontal",Yn[Yn.vertical=2]="vertical",Yn[Yn.horizontalOnly=3]="horizontalOnly";const vo=-17;class bo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new bo;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new bo;return r.imageName=e,r}}class fa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new fa;for(let o=0;o<e.sections.length;o++){const u=e.sections[o];u.image?s.addImageSection(u):s.addTextSection(u,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const o=e.charCodeAt(s+1)||null,u=e.charCodeAt(s-1)||null;r+=o&&al(o)&&!xo[e[s+1]]||u&&al(u)&&!xo[e[s-1]]||!xo[e[s]]?e[s]:xo[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&El[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&El[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new fa;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(bo.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let o=0;o<e.text.length;++o)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void bi("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(bo.forImage(r)),this.sectionIndex.push(this.sections.length-1)):bi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Il(i,e,r,s,o,u,p,f,_,x,b,T,I,k,P,R){const j=fa.fromFeature(i,o);let q;T===c.ai.vertical&&j.verticalizePunctuation();const{processBidirectionalText:te,processStyledBidirectionalText:X}=qi;if(te&&j.sections.length===1){q=[];const me=te(j.toString(),kc(j,x,u,e,s,k,P));for(const ze of me){const Fe=new fa;Fe.text=ze,Fe.sections=j.sections;for(let ke=0;ke<ze.length;ke++)Fe.sectionIndex.push(0);q.push(Fe)}}else if(X){q=[];const me=X(j.text,j.sectionIndex,kc(j,x,u,e,s,k,P));for(const ze of me){const Fe=new fa;Fe.text=ze[0],Fe.sectionIndex=ze[1],Fe.sections=j.sections,q.push(Fe)}}else q=function(me,ze){const Fe=[],ke=me.text;let Me=0;for(const Se of ze)Fe.push(me.substring(Me,Se)),Me=Se;return Me<ke.length&&Fe.push(me.substring(Me,ke.length)),Fe}(j,kc(j,x,u,e,s,k,P));const re=[],se={positionedLines:re,text:j.toString(),top:b[1],bottom:b[1],left:b[0],right:b[0],writingMode:T,iconsInText:!1,verticalizable:!1};return function(me,ze,Fe,ke,Me,Se,Le,Ce,be,Ue,Ne,tt){let Dt=0,Rt=vo,ri=0,or=0;const Ri=Ce==="right"?1:Ce==="left"?0:.5;let Qt=0;for(const ni of Me){ni.trim();const si=ni.getMaxScale(),Ci=(si-1)*ii,Oi={positionedGlyphs:[],lineOffset:0};me.positionedLines[Qt]=Oi;const Ii=Oi.positionedGlyphs;let Hi=0;if(!ni.length()){Rt+=Se,++Qt;continue}for(let ai=0;ai<ni.length();ai++){const ot=ni.getSection(ai),Ei=ni.getSectionIndex(ai),vi=ni.getCharCode(ai);let oi=0,Ir=null,Nr=null,Vr=null,En=ii;const Er=!(be===c.ai.horizontal||!Ne&&!Ga(vi)||Ne&&(El[vi]||(fi=vi,Pe.Arabic(fi)||Pe["Arabic Supplement"](fi)||Pe["Arabic Extended-A"](fi)||Pe["Arabic Presentation Forms-A"](fi)||Pe["Arabic Presentation Forms-B"](fi))));if(ot.imageName){const fr=ke[ot.imageName];if(!fr)continue;Vr=ot.imageName,me.iconsInText=me.iconsInText||!0,Nr=fr.paddedRect;const Xi=fr.displaySize;ot.scale=ot.scale*ii/tt,Ir={width:Xi[0],height:Xi[1],left:Gi,top:-Hh,advance:Er?Xi[1]:Xi[0]},oi=Ci+(ii-Xi[1]*ot.scale),En=Ir.advance;const Mn=Er?Xi[0]*ot.scale-ii*si:Xi[1]*ot.scale-ii*si;Mn>0&&Mn>Hi&&(Hi=Mn)}else{const fr=Fe[ot.fontStack],Xi=fr&&fr[vi];if(Xi&&Xi.rect)Nr=Xi.rect,Ir=Xi.metrics;else{const Mn=ze[ot.fontStack],Io=Mn&&Mn[vi];if(!Io)continue;Ir=Io.metrics}oi=(si-ot.scale)*ii}Er?(me.verticalizable=!0,Ii.push({glyph:vi,imageName:Vr,x:Dt,y:Rt+oi,vertical:Er,scale:ot.scale,fontStack:ot.fontStack,sectionIndex:Ei,metrics:Ir,rect:Nr}),Dt+=En*ot.scale+Ue):(Ii.push({glyph:vi,imageName:Vr,x:Dt,y:Rt+oi,vertical:Er,scale:ot.scale,fontStack:ot.fontStack,sectionIndex:Ei,metrics:Ir,rect:Nr}),Dt+=Ir.advance*ot.scale+Ue)}Ii.length!==0&&(ri=Math.max(Dt-Ue,ri),Lp(Ii,0,Ii.length-1,Ri,Hi)),Dt=0;const Wi=Se*si+Hi;Oi.lineOffset=Math.max(Hi,Ci),Rt+=Wi,or=Math.max(Wi,or),++Qt}var fi;const xi=Rt-vo,{horizontalAlign:Bi,verticalAlign:Fi}=Pc(Le);(function(ni,si,Ci,Oi,Ii,Hi,Wi,ai,ot){const Ei=(si-Ci)*Ii;let vi=0;vi=Hi!==Wi?-ai*Oi-vo:(-Oi*ot+.5)*Wi;for(const oi of ni)for(const Ir of oi.positionedGlyphs)Ir.x+=Ei,Ir.y+=vi})(me.positionedLines,Ri,Bi,Fi,ri,or,Se,xi,Me.length),me.top+=-Fi*xi,me.bottom=me.top+xi,me.left+=-Bi*ri,me.right=me.left+ri}(se,e,r,s,q,p,f,_,T,x,I,R),!function(me){for(const ze of me)if(ze.positionedGlyphs.length!==0)return!1;return!0}(re)&&se}const El={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kh(i,e,r,s,o,u){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*ii/u+o:0}{const p=r[e.fontStack],f=p&&p[i];return f?f.metrics.advance*e.scale+o:0}}function Yh(i,e,r,s){const o=Math.pow(i-e,2);return s?i<e?o/2:2*o:o+Math.abs(r)*r}function Dp(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Jh(i,e,r,s,o,u){let p=null,f=Yh(e,r,o,u);for(const _ of s){const x=Yh(e-_.x,r,o,u)+_.badness;x<=f&&(p=_,f=x)}return{index:i,x:e,priorBreak:p,badness:f}}function Qh(i){return i?Qh(i.priorBreak).concat(i.index):[]}function kc(i,e,r,s,o,u,p){if(u!=="point")return[];if(!i)return[];const f=[],_=function(I,k,P,R,j,q){let te=0;for(let X=0;X<I.length();X++){const re=I.getSection(X);te+=Kh(I.getCharCode(X),re,R,j,k,q)}return te/Math.max(1,Math.ceil(te/P))}(i,e,r,s,o,p),x=i.text.indexOf("​")>=0;let b=0;for(let I=0;I<i.length();I++){const k=i.getSection(I),P=i.getCharCode(I);if(El[P]||(b+=Kh(P,k,s,o,e,p)),I<i.length()-1){const R=!((T=P)<11904||!(Pe["Bopomofo Extended"](T)||Pe.Bopomofo(T)||Pe["CJK Compatibility Forms"](T)||Pe["CJK Compatibility Ideographs"](T)||Pe["CJK Compatibility"](T)||Pe["CJK Radicals Supplement"](T)||Pe["CJK Strokes"](T)||Pe["CJK Symbols and Punctuation"](T)||Pe["CJK Unified Ideographs Extension A"](T)||Pe["CJK Unified Ideographs"](T)||Pe["Enclosed CJK Letters and Months"](T)||Pe["Halfwidth and Fullwidth Forms"](T)||Pe.Hiragana(T)||Pe["Ideographic Description Characters"](T)||Pe["Kangxi Radicals"](T)||Pe["Katakana Phonetic Extensions"](T)||Pe.Katakana(T)||Pe["Vertical Forms"](T)||Pe["Yi Radicals"](T)||Pe["Yi Syllables"](T)));(zp[P]||R||k.imageName)&&f.push(Jh(I+1,b,_,f,Dp(P,i.getCharCode(I+1),R&&x),!1))}}var T;return Qh(Jh(i.length(),b,_,f,0,!0))}function Pc(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Lp(i,e,r,s,o){if(!s&&!o)return;const u=i[r],p=(i[r].x+u.metrics.advance*u.scale)*s;for(let f=e;f<=r;f++)i[f].x-=p,i[f].y+=o}function Rp(i,e,r){const{horizontalAlign:s,verticalAlign:o}=Pc(r),u=e[0]-i.displaySize[0]*s,p=e[1]-i.displaySize[1]*o;return{image:i,top:p,bottom:p+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function eu(i,e,r,s,o,u){const p=i.image;let f;if(p.content){const j=p.content,q=p.pixelRatio||1;f=[j[0]/q,j[1]/q,p.displaySize[0]-j[2]/q,p.displaySize[1]-j[3]/q]}const _=e.left*u,x=e.right*u;let b,T,I,k;r==="width"||r==="both"?(k=o[0]+_-s[3],T=o[0]+x+s[1]):(k=o[0]+(_+x-p.displaySize[0])/2,T=k+p.displaySize[0]);const P=e.top*u,R=e.bottom*u;return r==="height"||r==="both"?(b=o[1]+P-s[0],I=o[1]+R+s[2]):(b=o[1]+(P+R-p.displaySize[1])/2,I=b+p.displaySize[1]),{image:p,top:b,right:T,bottom:I,left:k,collisionPadding:f}}const wo=255,sn=128,Jn=wo*sn;function tu(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Pt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:o}=r;let u=0;for(;u<s.length&&s[u]<=i;)u++;u=Math.max(0,u-1);let p=u;for(;p<s.length&&s[p]<i+1;)p++;p=Math.min(s.length-1,p);const f=s[u],_=s[p];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:_,interpolationType:o}:{kind:"camera",minZoom:f,maxZoom:_,minSize:r.evaluate(new Pt(f)),maxSize:r.evaluate(new Pt(_)),interpolationType:o}}}function zc(i,e,r){let s="never";const o=i.get(e);return o?s=o:i.get(r)&&(s="always"),s}const Bp=Kn.VectorTileFeature.types,Fp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ml(i,e,r,s,o,u,p,f,_,x,b,T,I){const k=f?Math.min(Jn,Math.round(f[0])):0,P=f?Math.min(Jn,Math.round(f[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*o),u,p,(k<<1)+(_?1:0),P,16*x,16*b,256*T,256*I)}function Dc(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Op(i){for(const e of i.sections)if(sc(e.text))return!0;return!1}class Lc{constructor(e){this.layoutVertexArray=new rt,this.indexArray=new di,this.programConfigurations=e,this.segments=new zt,this.dynamicLayoutVertexArray=new Qe,this.opacityVertexArray=new at,this.hasVisibleVertices=!1,this.placedSymbolArray=new J}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,o){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,gp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Fp,!0),this.opacityVertexBuffer.itemSize=1),(s||o)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}De("SymbolBuffers",Lc);class Rc{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new zt,this.collisionVertexArray=new Mt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,_p.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}De("CollisionBuffers",Rc);class ma{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=dc([]),this.placementViewportMatrix=dc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tu(this.zoom,r["text-size"]),this.iconSizeData=tu(this.zoom,r["icon-size"]);const s=this.layers[0].layout,o=s.get("symbol-sort-key"),u=s.get("symbol-z-order");this.canOverlap=zc(s,"text-overlap","text-allow-overlap")!=="never"||zc(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&!o.isConstant(),this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(p=>c.ai[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new Lc(new Or(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Lc(new Or(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Q,this.lineVertexArray=new oe,this.symbolInstances=new U,this.textAnchorOffsets=new fe}calculateGlyphDependencies(e,r,s,o,u){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,(s||o)&&u){const f=xo[e.charAt(p)];f&&(r[f.charCodeAt(0)]=!0)}}populate(e,r,s){const o=this.layers[0],u=o.layout,p=u.get("text-font"),f=u.get("text-field"),_=u.get("icon-image"),x=(f.value.kind!=="constant"||f.value.value instanceof gi&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),b=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,T=u.get("symbol-sort-key");if(this.features=[],!x&&!b)return;const I=r.iconDependencies,k=r.glyphDependencies,P=r.availableImages,R=new Pt(this.zoom);for(const{feature:j,id:q,index:te,sourceLayerIndex:X}of e){const re=o._featureFilter.needGeometry,se=Ts(j,re);if(!o._featureFilter.filter(R,se,s))continue;let me,ze;if(re||(se.geometry=Ss(j)),x){const ke=o.getValueAndResolveTokens("text-field",se,s,P),Me=gi.factory(ke);Op(Me)&&(this.hasRTLText=!0),(!this.hasRTLText||Ja()==="unavailable"||this.hasRTLText&&qi.isParsed())&&(me=xp(Me,o,se))}if(b){const ke=o.getValueAndResolveTokens("icon-image",se,s,P);ze=ke instanceof ui?ke:ui.fromString(ke)}if(!me&&!ze)continue;const Fe=this.sortFeaturesByKey?T.evaluate(se,{},s):void 0;if(this.features.push({id:q,text:me,icon:ze,index:te,sourceLayerIndex:X,geometry:se.geometry,properties:j.properties,type:Bp[j.type],sortKey:Fe}),ze&&(I[ze.name]=!0),me){const ke=p.evaluate(se,{},s).join(","),Me=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ai.vertical)>=0;for(const Se of me.sections)if(Se.image)I[Se.image.name]=!0;else{const Le=qa(me.toString()),Ce=Se.fontStack||ke,be=k[Ce]=k[Ce]||{};this.calculateGlyphDependencies(Se.text,be,Me,this.allowVerticalPlacement,Le)}}}u.get("symbol-placement")==="line"&&(this.features=function(j){const q={},te={},X=[];let re=0;function se(ke){X.push(j[ke]),re++}function me(ke,Me,Se){const Le=te[ke];return delete te[ke],te[Me]=Le,X[Le].geometry[0].pop(),X[Le].geometry[0]=X[Le].geometry[0].concat(Se[0]),Le}function ze(ke,Me,Se){const Le=q[Me];return delete q[Me],q[ke]=Le,X[Le].geometry[0].shift(),X[Le].geometry[0]=Se[0].concat(X[Le].geometry[0]),Le}function Fe(ke,Me,Se){const Le=Se?Me[0][Me[0].length-1]:Me[0][0];return`${ke}:${Le.x}:${Le.y}`}for(let ke=0;ke<j.length;ke++){const Me=j[ke],Se=Me.geometry,Le=Me.text?Me.text.toString():null;if(!Le){se(ke);continue}const Ce=Fe(Le,Se),be=Fe(Le,Se,!0);if(Ce in te&&be in q&&te[Ce]!==q[be]){const Ue=ze(Ce,be,Se),Ne=me(Ce,be,X[Ue].geometry);delete q[Ce],delete te[be],te[Fe(Le,X[Ne].geometry,!0)]=Ne,X[Ue].geometry=null}else Ce in te?me(Ce,be,Se):be in q?ze(Ce,be,Se):(se(ke),q[Ce]=re-1,te[be]=re-1)}return X.filter(ke=>ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((j,q)=>j.sortKey-q.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let o=e.dist(r[e.segment+1]),u=e.dist(r[e.segment]);const p={};for(let f=e.segment+1;f<r.length;f++)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:o},f<r.length-1&&(o+=r[f+1].dist(r[f]));for(let f=e.segment||0;f>=0;f--)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:u},f>0&&(u+=r[f-1].dist(r[f]));for(let f=0;f<r.length;f++){const _=p[f];this.lineVertexArray.emplaceBack(_.x,_.y,_.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,o,u,p,f,_,x,b,T,I){const k=e.indexArray,P=e.layoutVertexArray,R=e.segments.prepareSegment(4*r.length,P,k,this.canOverlap?p.sortKey:void 0),j=this.glyphOffsetArray.length,q=R.vertexLength,te=this.allowVerticalPlacement&&f===c.ai.vertical?Math.PI/2:0,X=p.text&&p.text.sections;for(let re=0;re<r.length;re++){const{tl:se,tr:me,bl:ze,br:Fe,tex:ke,pixelOffsetTL:Me,pixelOffsetBR:Se,minFontScaleX:Le,minFontScaleY:Ce,glyphOffset:be,isSDF:Ue,sectionIndex:Ne}=r[re],tt=R.vertexLength,Dt=be[1];Ml(P,_.x,_.y,se.x,Dt+se.y,ke.x,ke.y,s,Ue,Me.x,Me.y,Le,Ce),Ml(P,_.x,_.y,me.x,Dt+me.y,ke.x+ke.w,ke.y,s,Ue,Se.x,Me.y,Le,Ce),Ml(P,_.x,_.y,ze.x,Dt+ze.y,ke.x,ke.y+ke.h,s,Ue,Me.x,Se.y,Le,Ce),Ml(P,_.x,_.y,Fe.x,Dt+Fe.y,ke.x+ke.w,ke.y+ke.h,s,Ue,Se.x,Se.y,Le,Ce),Dc(e.dynamicLayoutVertexArray,_,te),k.emplaceBack(tt,tt+1,tt+2),k.emplaceBack(tt+1,tt+2,tt+3),R.vertexLength+=4,R.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(be[0]),re!==r.length-1&&Ne===r[re+1].sectionIndex||e.programConfigurations.populatePaintArrays(P.length,p,p.index,{},I,X&&X[Ne])}e.placedSymbolArray.emplaceBack(_.x,_.y,j,this.glyphOffsetArray.length-j,q,x,b,_.segment,s?s[0]:0,s?s[1]:0,o[0],o[1],f,0,!1,0,T)}_addCollisionDebugVertex(e,r,s,o,u,p){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,o,u,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,r,s,o,u,p,f){const _=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),x=_.vertexLength,b=u.layoutVertexArray,T=u.collisionVertexArray,I=f.anchorX,k=f.anchorY;this._addCollisionDebugVertex(b,T,p,I,k,new Ae(e,r)),this._addCollisionDebugVertex(b,T,p,I,k,new Ae(s,r)),this._addCollisionDebugVertex(b,T,p,I,k,new Ae(s,o)),this._addCollisionDebugVertex(b,T,p,I,k,new Ae(e,o)),_.vertexLength+=4;const P=u.indexArray;P.emplaceBack(x,x+1),P.emplaceBack(x+1,x+2),P.emplaceBack(x+2,x+3),P.emplaceBack(x+3,x),_.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,o){for(let u=e;u<r;u++){const p=this.collisionBoxArray.get(u);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,o?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rc(Zt,Nh.members,ei),this.iconCollisionBox=new Rc(Zt,Nh.members,ei);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,o,u,p,f,_,x){const b={};for(let T=r;T<s;T++){const I=e.get(T);b.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},b.textFeatureIndex=I.featureIndex;break}for(let T=o;T<u;T++){const I=e.get(T);b.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},b.verticalTextFeatureIndex=I.featureIndex;break}for(let T=p;T<f;T++){const I=e.get(T);b.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},b.iconFeatureIndex=I.featureIndex;break}for(let T=_;T<x;T++){const I=e.get(T);b.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},b.verticalIconFeatureIndex=I.featureIndex;break}return b}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),o=s.vertexStartIndex+4*s.numGlyphs;for(let u=s.vertexStartIndex;u<o;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),o=[],u=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const _=this.symbolInstances.get(f);o.push(0|Math.round(r*_.anchorX+s*_.anchorY)),u.push(_.featureIndex)}return p.sort((f,_)=>o[f]-o[_]||u[_]-u[f]),p}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((o,u,p)=>{o>=0&&p.indexOf(o)===u&&this.addIndicesForPlacedSymbol(this.text,o)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let iu,ru;De("SymbolBucket",ma,{omit:["layers","collisionBoxArray","features","compareText"]}),ma.MAX_GLYPHS=65535,ma.addDynamicAttributes=Dc;var Bc={get paint(){return ru=ru||new Wt({"icon-opacity":new Ze(he.paint_symbol["icon-opacity"]),"icon-color":new Ze(he.paint_symbol["icon-color"]),"icon-halo-color":new Ze(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ze(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ze(he.paint_symbol["icon-halo-blur"]),"icon-translate":new je(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new je(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ze(he.paint_symbol["text-opacity"]),"text-color":new Ze(he.paint_symbol["text-color"],{runtimeType:wi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ze(he.paint_symbol["text-halo-color"]),"text-halo-width":new Ze(he.paint_symbol["text-halo-width"]),"text-halo-blur":new Ze(he.paint_symbol["text-halo-blur"]),"text-translate":new je(he.paint_symbol["text-translate"]),"text-translate-anchor":new je(he.paint_symbol["text-translate-anchor"])})},get layout(){return iu=iu||new Wt({"symbol-placement":new je(he.layout_symbol["symbol-placement"]),"symbol-spacing":new je(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new je(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ze(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new je(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new je(he.layout_symbol["icon-allow-overlap"]),"icon-overlap":new je(he.layout_symbol["icon-overlap"]),"icon-ignore-placement":new je(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new je(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new je(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ze(he.layout_symbol["icon-size"]),"icon-text-fit":new je(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new je(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ze(he.layout_symbol["icon-image"]),"icon-rotate":new Ze(he.layout_symbol["icon-rotate"]),"icon-padding":new Ze(he.layout_symbol["icon-padding"]),"icon-keep-upright":new je(he.layout_symbol["icon-keep-upright"]),"icon-offset":new Ze(he.layout_symbol["icon-offset"]),"icon-anchor":new Ze(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new je(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new je(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new je(he.layout_symbol["text-rotation-alignment"]),"text-field":new Ze(he.layout_symbol["text-field"]),"text-font":new Ze(he.layout_symbol["text-font"]),"text-size":new Ze(he.layout_symbol["text-size"]),"text-max-width":new Ze(he.layout_symbol["text-max-width"]),"text-line-height":new je(he.layout_symbol["text-line-height"]),"text-letter-spacing":new Ze(he.layout_symbol["text-letter-spacing"]),"text-justify":new Ze(he.layout_symbol["text-justify"]),"text-radial-offset":new Ze(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new je(he.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ze(he.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ze(he.layout_symbol["text-anchor"]),"text-max-angle":new je(he.layout_symbol["text-max-angle"]),"text-writing-mode":new je(he.layout_symbol["text-writing-mode"]),"text-rotate":new Ze(he.layout_symbol["text-rotate"]),"text-padding":new je(he.layout_symbol["text-padding"]),"text-keep-upright":new je(he.layout_symbol["text-keep-upright"]),"text-transform":new Ze(he.layout_symbol["text-transform"]),"text-offset":new Ze(he.layout_symbol["text-offset"]),"text-allow-overlap":new je(he.layout_symbol["text-allow-overlap"]),"text-overlap":new je(he.layout_symbol["text-overlap"]),"text-ignore-placement":new je(he.layout_symbol["text-ignore-placement"]),"text-optional":new je(he.layout_symbol["text-optional"])})}};class nu{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Pr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}De("FormatSectionOverride",nu,{omit:["defaultValue"]});class Al extends sr{constructor(e){super(e,Bc)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const o=[];for(const u of s)o.indexOf(u)<0&&o.push(u);this.layout._values["text-writing-mode"]=o}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,o){const u=this.layout.get(e).evaluate(r,{},s,o),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Xs(p.value)||!u?u:function(f,_){return _.replace(/{([^{}]+)}/g,(x,b)=>f&&b in f?String(f[b]):"")}(r.properties,u)}createBucket(e){return new ma(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Bc.paint.overridableProperties){if(!Al.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new nu(r),o=new Oa(s,r.property.specification);let u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Na("source",o):new Ys("composite",o,r.value.zoomStops),this.paint._values[e]=new Si(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Al.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),o=Bc.paint.properties[r];let u=!1;const p=f=>{for(const _ of f)if(o.overrides&&o.overrides.hasOverride(_))return void(u=!0)};if(s.value.kind==="constant"&&s.value.value instanceof gi)p(s.value.value.sections);else if(s.value.kind==="source"){const f=x=>{u||(x instanceof fn&&Ft(x.value)===O?p(x.value.sections):x instanceof Ws?p(x.sections):x.eachChild(f))},_=s.value;_._styleExpression&&f(_._styleExpression.expression)}return u}}let su;var Np={get paint(){return su=su||new Wt({"background-color":new je(he.paint_background["background-color"]),"background-pattern":new eo(he.paint_background["background-pattern"]),"background-opacity":new je(he.paint_background["background-opacity"])})}};class Vp extends sr{constructor(e){super(e,Np)}}let au;var jp={get paint(){return au=au||new Wt({"raster-opacity":new je(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new je(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new je(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new je(he.paint_raster["raster-brightness-max"]),"raster-saturation":new je(he.paint_raster["raster-saturation"]),"raster-contrast":new je(he.paint_raster["raster-contrast"]),"raster-resampling":new je(he.paint_raster["raster-resampling"]),"raster-fade-duration":new je(he.paint_raster["raster-fade-duration"])})}};class $p extends sr{constructor(e){super(e,jp)}}class Up extends sr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class qp{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Fc=63710088e-1;class Qn{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qn(cr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,o=e.lat*r,u=Math.sin(s)*Math.sin(o)+Math.cos(s)*Math.cos(o)*Math.cos((e.lng-this.lng)*r);return Fc*Math.acos(Math.min(u,1))}static convert(e){if(e instanceof Qn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Qn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Qn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ou=2*Math.PI*Fc;function lu(i){return ou*Math.cos(i*Math.PI/180)}function cu(i){return(180+i)/360}function hu(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function uu(i,e){return i/lu(e)}function du(i){return 360*i-180}function Oc(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class kl{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Qn.convert(e);return new kl(cu(s.lng),hu(s.lat),uu(r,s.lat))}toLngLat(){return new Qn(du(this.x),Oc(this.y))}toAltitude(){return this.z*lu(Oc(this.y))}meterInMercatorCoordinateUnits(){return 1/ou*(e=Oc(this.y),1/Math.cos(e*Math.PI/180));var e}}function pu(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Nc{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=So(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const o=(p=this.y,f=this.z,_=pu(256*(u=this.x),256*(p=Math.pow(2,f)-p-1),f),x=pu(256*(u+1),256*(p+1),f),_[0]+","+_[1]+","+x[0]+","+x[1]);var u,p,f,_,x;const b=function(T,I,k){let P,R="";for(let j=T;j>0;j--)P=1<<j-1,R+=(I&P?1:0)+(k&P?2:0);return R}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,b).replace(/{bbox-epsg-3857}/g,o)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new Ae((e.x*r-this.x)*Jt,(e.y*r-this.y)*Jt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class fu{constructor(e,r){this.wrap=e,this.canonical=r,this.key=So(e,r.z,r.z,r.x,r.y)}}class pr{constructor(e,r,s,o,u){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Nc(s,+o,+u),this.key=So(r,e,s,o,u)}clone(){return new pr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new pr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new pr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?So(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):So(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new pr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,o=2*this.canonical.y;return[new pr(r,this.wrap,r,s,o),new pr(r,this.wrap,r,s+1,o),new pr(r,this.wrap,r,s,o+1),new pr(r,this.wrap,r,s+1,o+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new pr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new pr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new fu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new kl(e.x-this.wrap,e.y))}}function So(i,e,r,s,o){(i*=2)<0&&(i=-1*i-1);const u=1<<r;return(u*u*i+u*o+s).toString(36)+r.toString(36)+e.toString(36)}De("CanonicalTileID",Nc),De("OverscaledTileID",pr,{omit:["posMatrix"]});class mu{constructor(e,r,s,o=1,u=1,p=1,f=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void bi(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const _=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=o,this.greenFactor=u,this.blueFactor=p,this.baseShift=f;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let x=0;x<_;x++)for(let b=0;b<_;b++){const T=this.get(x,b);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(e,r){const s=new Uint8Array(this.data.buffer),o=4*this._idx(e,r);return this.unpack(s[o],s[o+1],s[o+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,s){return e*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new dr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let o=r*this.dim,u=r*this.dim+this.dim,p=s*this.dim,f=s*this.dim+this.dim;switch(r){case-1:o=u-1;break;case 1:u=o+1}switch(s){case-1:p=f-1;break;case 1:f=p+1}const _=-r*this.dim,x=-s*this.dim;for(let b=p;b<f;b++)for(let T=o;T<u;T++)this.data[this._idx(T,b)]=e.data[this._idx(T+_,b+x)]}}De("DEMData",mu);class gu{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class _u{constructor(e,r,s,o,u){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=o,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class yu{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Zn(Jt,16,0),this.grid3D=new Zn(Jt,16,0),this.featureIndexArray=new _e,this.promoteId=r}insert(e,r,s,o,u,p){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,o,u);const _=p?this.grid3D:this.grid;for(let x=0;x<r.length;x++){const b=r[x],T=[1/0,1/0,-1/0,-1/0];for(let I=0;I<b.length;I++){const k=b[I];T[0]=Math.min(T[0],k.x),T[1]=Math.min(T[1],k.y),T[2]=Math.max(T[2],k.x),T[3]=Math.max(T[3],k.y)}T[0]<Jt&&T[1]<Jt&&T[2]>=0&&T[3]>=0&&_.insert(f,T[0],T[1],T[2],T[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Kn.VectorTile(new Ec(this.rawTileData)).layers,this.sourceLayerCoder=new gu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,o){this.loadVTLayers();const u=e.params||{},p=Jt/e.tileSize/e.scale,f=ja(u.filter),_=e.queryGeometry,x=e.queryPadding*p,b=vu(_),T=this.grid.query(b.minX-x,b.minY-x,b.maxX+x,b.maxY+x),I=vu(e.cameraQueryGeometry),k=this.grid3D.query(I.minX-x,I.minY-x,I.maxX+x,I.maxY+x,(j,q,te,X)=>function(re,se,me,ze,Fe){for(const Me of re)if(se<=Me.x&&me<=Me.y&&ze>=Me.x&&Fe>=Me.y)return!0;const ke=[new Ae(se,me),new Ae(se,Fe),new Ae(ze,Fe),new Ae(ze,me)];if(re.length>2){for(const Me of ke)if(la(re,Me))return!0}for(let Me=0;Me<re.length-1;Me++)if(wd(re[Me],re[Me+1],ke))return!0;return!1}(e.cameraQueryGeometry,j-x,q-x,te+x,X+x));for(const j of k)T.push(j);T.sort(Zp);const P={};let R;for(let j=0;j<T.length;j++){const q=T[j];if(q===R)continue;R=q;const te=this.featureIndexArray.get(q);let X=null;this.loadMatchingFeature(P,te.bucketIndex,te.sourceLayerIndex,te.featureIndex,f,u.layers,u.availableImages,r,s,o,(re,se,me)=>(X||(X=Ss(re)),se.queryIntersectsFeature(_,re,me,X,this.z,e.transform,p,e.pixelPosMatrix)))}return P}loadMatchingFeature(e,r,s,o,u,p,f,_,x,b,T){const I=this.bucketLayerIDs[r];if(p&&!function(j,q){for(let te=0;te<j.length;te++)if(q.indexOf(j[te])>=0)return!0;return!1}(p,I))return;const k=this.sourceLayerCoder.decode(s),P=this.vtLayers[k].feature(o);if(u.needGeometry){const j=Ts(P,!0);if(!u.filter(new Pt(this.tileID.overscaledZ),j,this.tileID.canonical))return}else if(!u.filter(new Pt(this.tileID.overscaledZ),P))return;const R=this.getId(P,k);for(let j=0;j<I.length;j++){const q=I[j];if(p&&p.indexOf(q)<0)continue;const te=_[q];if(!te)continue;let X={};R&&b&&(X=b.getState(te.sourceLayer||"_geojsonTileLayer",R));const re=ci({},x[q]);re.paint=xu(re.paint,te.paint,P,X,f),re.layout=xu(re.layout,te.layout,P,X,f);const se=!T||T(P,te,X);if(!se)continue;const me=new _u(P,this.z,this.x,this.y,R);me.layer=re;let ze=e[q];ze===void 0&&(ze=e[q]=[]),ze.push({featureIndex:o,feature:me,intersectionZ:se})}}lookupSymbolFeatures(e,r,s,o,u,p,f,_){const x={};this.loadVTLayers();const b=ja(u);for(const T of e)this.loadMatchingFeature(x,s,o,T,b,p,f,_,r);return x}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function xu(i,e,r,s,o){return Bt(i,(u,p)=>{const f=e instanceof aa?e.get(p):null;return f&&f.evaluate?f.evaluate(r,s,o):f})}function vu(i){let e=1/0,r=1/0,s=-1/0,o=-1/0;for(const u of i)e=Math.min(e,u.x),r=Math.min(r,u.y),s=Math.max(s,u.x),o=Math.max(o,u.y);return{minX:e,minY:r,maxX:s,maxY:o}}function Zp(i,e){return e-i}function bu(i,e,r,s,o){const u=[];for(let p=0;p<i.length;p++){const f=i[p];let _;for(let x=0;x<f.length-1;x++){let b=f[x],T=f[x+1];b.x<e&&T.x<e||(b.x<e?b=new Ae(e,b.y+(e-b.x)/(T.x-b.x)*(T.y-b.y))._round():T.x<e&&(T=new Ae(e,b.y+(e-b.x)/(T.x-b.x)*(T.y-b.y))._round()),b.y<r&&T.y<r||(b.y<r?b=new Ae(b.x+(r-b.y)/(T.y-b.y)*(T.x-b.x),r)._round():T.y<r&&(T=new Ae(b.x+(r-b.y)/(T.y-b.y)*(T.x-b.x),r)._round()),b.x>=s&&T.x>=s||(b.x>=s?b=new Ae(s,b.y+(s-b.x)/(T.x-b.x)*(T.y-b.y))._round():T.x>=s&&(T=new Ae(s,b.y+(s-b.x)/(T.x-b.x)*(T.y-b.y))._round()),b.y>=o&&T.y>=o||(b.y>=o?b=new Ae(b.x+(o-b.y)/(T.y-b.y)*(T.x-b.x),o)._round():T.y>=o&&(T=new Ae(b.x+(o-b.y)/(T.y-b.y)*(T.x-b.x),o)._round()),_&&b.equals(_[_.length-1])||(_=[b],u.push(_)),_.push(T)))))}}return u}De("FeatureIndex",yu,{omit:["rawTileData","sourceLayerCoder"]});class es extends Ae{constructor(e,r,s,o){super(e,r),this.angle=s,o!==void 0&&(this.segment=o)}clone(){return new es(this.x,this.y,this.angle,this.segment)}}function wu(i,e,r,s,o){if(e.segment===void 0||r===0)return!0;let u=e,p=e.segment+1,f=0;for(;f>-r/2;){if(p--,p<0)return!1;f-=i[p].dist(u),u=i[p]}f+=i[p].dist(i[p+1]),p++;const _=[];let x=0;for(;f<r/2;){const b=i[p],T=i[p+1];if(!T)return!1;let I=i[p-1].angleTo(b)-b.angleTo(T);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),_.push({distance:f,angleDelta:I}),x+=I;f-_[0].distance>s;)x-=_.shift().angleDelta;if(x>o)return!1;p++,f+=b.dist(T)}return!0}function Su(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Tu(i,e,r){return i?.6*e*r:0}function Cu(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Gp(i,e,r,s,o,u){const p=Tu(r,o,u),f=Cu(r,s)*u;let _=0;const x=Su(i)/2;for(let b=0;b<i.length-1;b++){const T=i[b],I=i[b+1],k=T.dist(I);if(_+k>x){const P=(x-_)/k,R=ji.number(T.x,I.x,P),j=ji.number(T.y,I.y,P),q=new es(R,j,I.angleTo(T),b);return q._round(),!p||wu(i,q,f,p,e)?q:void 0}_+=k}}function Hp(i,e,r,s,o,u,p,f,_){const x=Tu(s,u,p),b=Cu(s,o),T=b*p,I=i[0].x===0||i[0].x===_||i[0].y===0||i[0].y===_;return e-T<e/4&&(e=T+e/4),Iu(i,I?e/2*f%e:(b/2+2*u)*p*f%e,e,x,r,T,I,!1,_)}function Iu(i,e,r,s,o,u,p,f,_){const x=u/2,b=Su(i);let T=0,I=e-r,k=[];for(let P=0;P<i.length-1;P++){const R=i[P],j=i[P+1],q=R.dist(j),te=j.angleTo(R);for(;I+r<T+q;){I+=r;const X=(I-T)/q,re=ji.number(R.x,j.x,X),se=ji.number(R.y,j.y,X);if(re>=0&&re<_&&se>=0&&se<_&&I-x>=0&&I+x<=b){const me=new es(re,se,te,P);me._round(),s&&!wu(i,me,u,s,o)||k.push(me)}}T+=q}return f||k.length||p||(k=Iu(i,T/2,r,s,o,u,p,!0,_)),k}De("Anchor",es);const ga=Gi;function Eu(i,e,r,s){const o=[],u=i.image,p=u.pixelRatio,f=u.paddedRect.w-2*ga,_=u.paddedRect.h-2*ga,x=i.right-i.left,b=i.bottom-i.top,T=u.stretchX||[[0,f]],I=u.stretchY||[[0,_]],k=(Se,Le)=>Se+Le[1]-Le[0],P=T.reduce(k,0),R=I.reduce(k,0),j=f-P,q=_-R;let te=0,X=P,re=0,se=R,me=0,ze=j,Fe=0,ke=q;if(u.content&&s){const Se=u.content;te=Pl(T,0,Se[0]),re=Pl(I,0,Se[1]),X=Pl(T,Se[0],Se[2]),se=Pl(I,Se[1],Se[3]),me=Se[0]-te,Fe=Se[1]-re,ze=Se[2]-Se[0]-X,ke=Se[3]-Se[1]-se}const Me=(Se,Le,Ce,be)=>{const Ue=zl(Se.stretch-te,X,x,i.left),Ne=Dl(Se.fixed-me,ze,Se.stretch,P),tt=zl(Le.stretch-re,se,b,i.top),Dt=Dl(Le.fixed-Fe,ke,Le.stretch,R),Rt=zl(Ce.stretch-te,X,x,i.left),ri=Dl(Ce.fixed-me,ze,Ce.stretch,P),or=zl(be.stretch-re,se,b,i.top),Ri=Dl(be.fixed-Fe,ke,be.stretch,R),Qt=new Ae(Ue,tt),fi=new Ae(Rt,tt),xi=new Ae(Rt,or),Bi=new Ae(Ue,or),Fi=new Ae(Ne/p,Dt/p),ni=new Ae(ri/p,Ri/p),si=e*Math.PI/180;if(si){const Ii=Math.sin(si),Hi=Math.cos(si),Wi=[Hi,-Ii,Ii,Hi];Qt._matMult(Wi),fi._matMult(Wi),Bi._matMult(Wi),xi._matMult(Wi)}const Ci=Se.stretch+Se.fixed,Oi=Le.stretch+Le.fixed;return{tl:Qt,tr:fi,bl:Bi,br:xi,tex:{x:u.paddedRect.x+ga+Ci,y:u.paddedRect.y+ga+Oi,w:Ce.stretch+Ce.fixed-Ci,h:be.stretch+be.fixed-Oi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fi,pixelOffsetBR:ni,minFontScaleX:ze/p/x,minFontScaleY:ke/p/b,isSDF:r}};if(s&&(u.stretchX||u.stretchY)){const Se=Mu(T,j,P),Le=Mu(I,q,R);for(let Ce=0;Ce<Se.length-1;Ce++){const be=Se[Ce],Ue=Se[Ce+1];for(let Ne=0;Ne<Le.length-1;Ne++)o.push(Me(be,Le[Ne],Ue,Le[Ne+1]))}}else o.push(Me({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:_+1}));return o}function Pl(i,e,r){let s=0;for(const o of i)s+=Math.max(e,Math.min(r,o[1]))-Math.max(e,Math.min(r,o[0]));return s}function Mu(i,e,r){const s=[{fixed:-ga,stretch:0}];for(const[o,u]of i){const p=s[s.length-1];s.push({fixed:o-p.stretch,stretch:p.stretch}),s.push({fixed:o-p.stretch,stretch:p.stretch+(u-o)})}return s.push({fixed:e+ga,stretch:r}),s}function zl(i,e,r,s){return i/e*r+s}function Dl(i,e,r,s){return i-e*r/s}class Ll{constructor(e,r,s,o,u,p,f,_,x,b){if(this.boxStartIndex=e.length,x){let T=p.top,I=p.bottom;const k=p.collisionPadding;k&&(T-=k[1],I+=k[3]);let P=I-T;P>0&&(P=Math.max(10,P),this.circleDiameter=P)}else{let T=p.top*f-_[0],I=p.bottom*f+_[2],k=p.left*f-_[3],P=p.right*f+_[1];const R=p.collisionPadding;if(R&&(k-=R[0]*f,T-=R[1]*f,P+=R[2]*f,I+=R[3]*f),b){const j=new Ae(k,T),q=new Ae(P,T),te=new Ae(k,I),X=new Ae(P,I),re=b*Math.PI/180;j._rotate(re),q._rotate(re),te._rotate(re),X._rotate(re),k=Math.min(j.x,q.x,te.x,X.x),P=Math.max(j.x,q.x,te.x,X.x),T=Math.min(j.y,q.y,te.y,X.y),I=Math.max(j.y,q.y,te.y,X.y)}e.emplaceBack(r.x,r.y,k,T,P,I,s,o,u)}this.boxEndIndex=e.length}}class Wp{constructor(e=[],r=Xp){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,o=r[e];for(;e>0;){const u=e-1>>1,p=r[u];if(s(o,p)>=0)break;r[e]=p,e=u}r[e]=o}_down(e){const{data:r,compare:s}=this,o=this.length>>1,u=r[e];for(;e<o;){let p=1+(e<<1),f=r[p];const _=p+1;if(_<this.length&&s(r[_],f)<0&&(p=_,f=r[_]),s(f,u)>=0)break;r[e]=f,e=p}r[e]=u}}function Xp(i,e){return i<e?-1:i>e?1:0}function Kp(i,e=1,r=!1){let s=1/0,o=1/0,u=-1/0,p=-1/0;const f=i[0];for(let k=0;k<f.length;k++){const P=f[k];(!k||P.x<s)&&(s=P.x),(!k||P.y<o)&&(o=P.y),(!k||P.x>u)&&(u=P.x),(!k||P.y>p)&&(p=P.y)}const _=Math.min(u-s,p-o);let x=_/2;const b=new Wp([],Yp);if(_===0)return new Ae(s,o);for(let k=s;k<u;k+=_)for(let P=o;P<p;P+=_)b.push(new _a(k+x,P+x,x,i));let T=function(k){let P=0,R=0,j=0;const q=k[0];for(let te=0,X=q.length,re=X-1;te<X;re=te++){const se=q[te],me=q[re],ze=se.x*me.y-me.x*se.y;R+=(se.x+me.x)*ze,j+=(se.y+me.y)*ze,P+=3*ze}return new _a(R/P,j/P,0,k)}(i),I=b.length;for(;b.length;){const k=b.pop();(k.d>T.d||!T.d)&&(T=k,r&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,I)),k.max-T.d<=e||(x=k.h/2,b.push(new _a(k.p.x-x,k.p.y-x,x,i)),b.push(new _a(k.p.x+x,k.p.y-x,x,i)),b.push(new _a(k.p.x-x,k.p.y+x,x,i)),b.push(new _a(k.p.x+x,k.p.y+x,x,i)),I+=4)}return r&&(console.log(`num probes: ${I}`),console.log(`best distance: ${T.d}`)),T.p}function Yp(i,e){return e.max-i.max}function _a(i,e,r,s){this.p=new Ae(i,e),this.h=r,this.d=function(o,u){let p=!1,f=1/0;for(let _=0;_<u.length;_++){const x=u[_];for(let b=0,T=x.length,I=T-1;b<T;I=b++){const k=x[b],P=x[I];k.y>o.y!=P.y>o.y&&o.x<(P.x-k.x)*(o.y-k.y)/(P.y-k.y)+k.x&&(p=!p),f=Math.min(f,hh(o,k,P))}}return(p?1:-1)*Math.sqrt(f)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var yi;c.aq=void 0,(yi=c.aq||(c.aq={}))[yi.center=1]="center",yi[yi.left=2]="left",yi[yi.right=3]="right",yi[yi.top=4]="top",yi[yi.bottom=5]="bottom",yi[yi["top-left"]=6]="top-left",yi[yi["top-right"]=7]="top-right",yi[yi["bottom-left"]=8]="bottom-left",yi[yi["bottom-right"]=9]="bottom-right";const ts=7,Vc=Number.POSITIVE_INFINITY;function Au(i,e){return e[1]!==Vc?function(r,s,o){let u=0,p=0;switch(s=Math.abs(s),o=Math.abs(o),r){case"top-right":case"top-left":case"top":p=o-ts;break;case"bottom-right":case"bottom-left":case"bottom":p=-o+ts}switch(r){case"top-right":case"bottom-right":case"right":u=-s;break;case"top-left":case"bottom-left":case"left":u=s}return[u,p]}(i,e[0],e[1]):function(r,s){let o=0,u=0;s<0&&(s=0);const p=s/Math.SQRT2;switch(r){case"top-right":case"top-left":u=p-ts;break;case"bottom-right":case"bottom-left":u=-p+ts;break;case"bottom":u=-s+ts;break;case"top":u=s-ts}switch(r){case"top-right":case"bottom-right":o=-p;break;case"top-left":case"bottom-left":o=p;break;case"left":o=s;break;case"right":o=-s}return[o,u]}(i,e[0])}function ku(i,e,r){var s;const o=i.layout,u=(s=o.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},r);if(u){const f=u.values,_=[];for(let x=0;x<f.length;x+=2){const b=_[x]=f[x],T=f[x+1].map(I=>I*ii);b.startsWith("top")?T[1]-=ts:b.startsWith("bottom")&&(T[1]+=ts),_[x+1]=T}return new tr(_)}const p=o.get("text-variable-anchor");if(p){let f;f=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[o.get("text-radial-offset").evaluate(e,{},r)*ii,Vc]:o.get("text-offset").evaluate(e,{},r).map(x=>x*ii);const _=[];for(const x of p)_.push(x,Au(x,f));return new tr(_)}return null}function jc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jp(i,e,r,s,o,u,p,f,_,x,b){let T=u.textMaxSize.evaluate(e,{});T===void 0&&(T=p);const I=i.layers[0].layout,k=I.get("icon-offset").evaluate(e,{},b),P=zu(r.horizontal),R=p/24,j=i.tilePixelRatio*R,q=i.tilePixelRatio*T/24,te=i.tilePixelRatio*f,X=i.tilePixelRatio*I.get("symbol-spacing"),re=I.get("text-padding")*i.tilePixelRatio,se=function(be,Ue,Ne,tt=1){const Dt=be.get("icon-padding").evaluate(Ue,{},Ne),Rt=Dt&&Dt.values;return[Rt[0]*tt,Rt[1]*tt,Rt[2]*tt,Rt[3]*tt]}(I,e,b,i.tilePixelRatio),me=I.get("text-max-angle")/180*Math.PI,ze=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point",Fe=I.get("icon-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",ke=I.get("symbol-placement"),Me=X/2,Se=I.get("icon-text-fit");let Le;s&&Se!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Le=eu(s,r.vertical,Se,I.get("icon-text-fit-padding"),k,R)),P&&(s=eu(s,P,Se,I.get("icon-text-fit-padding"),k,R)));const Ce=(be,Ue)=>{Ue.x<0||Ue.x>=Jt||Ue.y<0||Ue.y>=Jt||function(Ne,tt,Dt,Rt,ri,or,Ri,Qt,fi,xi,Bi,Fi,ni,si,Ci,Oi,Ii,Hi,Wi,ai,ot,Ei,vi,oi,Ir){const Nr=Ne.addToLineVertexArray(tt,Dt);let Vr,En,Er,fr,Xi=0,Mn=0,Io=0,Bu=0,Xc=-1,Kc=-1;const An={};let Fu=Sn("");if(Ne.allowVerticalPlacement&&Rt.vertical){const Mi=Qt.layout.get("text-rotate").evaluate(ot,{},oi)+90;Er=new Ll(fi,tt,xi,Bi,Fi,Rt.vertical,ni,si,Ci,Mi),Ri&&(fr=new Ll(fi,tt,xi,Bi,Fi,Ri,Ii,Hi,Ci,Mi))}if(ri){const Mi=Qt.layout.get("icon-rotate").evaluate(ot,{}),mr=Qt.layout.get("icon-text-fit")!=="none",Is=Eu(ri,Mi,vi,mr),$r=Ri?Eu(Ri,Mi,vi,mr):void 0;En=new Ll(fi,tt,xi,Bi,Fi,ri,Ii,Hi,!1,Mi),Xi=4*Is.length;const Es=Ne.iconSizeData;let an=null;Es.kind==="source"?(an=[sn*Qt.layout.get("icon-size").evaluate(ot,{})],an[0]>Jn&&bi(`${Ne.layerIds[0]}: Value for "icon-size" is >= ${wo}. Reduce your "icon-size".`)):Es.kind==="composite"&&(an=[sn*Ei.compositeIconSizes[0].evaluate(ot,{},oi),sn*Ei.compositeIconSizes[1].evaluate(ot,{},oi)],(an[0]>Jn||an[1]>Jn)&&bi(`${Ne.layerIds[0]}: Value for "icon-size" is >= ${wo}. Reduce your "icon-size".`)),Ne.addSymbols(Ne.icon,Is,an,ai,Wi,ot,c.ai.none,tt,Nr.lineStartIndex,Nr.lineLength,-1,oi),Xc=Ne.icon.placedSymbolArray.length-1,$r&&(Mn=4*$r.length,Ne.addSymbols(Ne.icon,$r,an,ai,Wi,ot,c.ai.vertical,tt,Nr.lineStartIndex,Nr.lineLength,-1,oi),Kc=Ne.icon.placedSymbolArray.length-1)}const Ou=Object.keys(Rt.horizontal);for(const Mi of Ou){const mr=Rt.horizontal[Mi];if(!Vr){Fu=Sn(mr.text);const $r=Qt.layout.get("text-rotate").evaluate(ot,{},oi);Vr=new Ll(fi,tt,xi,Bi,Fi,mr,ni,si,Ci,$r)}const Is=mr.positionedLines.length===1;if(Io+=Pu(Ne,tt,mr,or,Qt,Ci,ot,Oi,Nr,Rt.vertical?c.ai.horizontal:c.ai.horizontalOnly,Is?Ou:[Mi],An,Xc,Ei,oi),Is)break}Rt.vertical&&(Bu+=Pu(Ne,tt,Rt.vertical,or,Qt,Ci,ot,Oi,Nr,c.ai.vertical,["vertical"],An,Kc,Ei,oi));const tf=Vr?Vr.boxStartIndex:Ne.collisionBoxArray.length,rf=Vr?Vr.boxEndIndex:Ne.collisionBoxArray.length,nf=Er?Er.boxStartIndex:Ne.collisionBoxArray.length,sf=Er?Er.boxEndIndex:Ne.collisionBoxArray.length,af=En?En.boxStartIndex:Ne.collisionBoxArray.length,of=En?En.boxEndIndex:Ne.collisionBoxArray.length,lf=fr?fr.boxStartIndex:Ne.collisionBoxArray.length,cf=fr?fr.boxEndIndex:Ne.collisionBoxArray.length;let jr=-1;const Bl=(Mi,mr)=>Mi&&Mi.circleDiameter?Math.max(Mi.circleDiameter,mr):mr;jr=Bl(Vr,jr),jr=Bl(Er,jr),jr=Bl(En,jr),jr=Bl(fr,jr);const Nu=jr>-1?1:0;Nu&&(jr*=Ir/ii),Ne.glyphOffsetArray.length>=ma.MAX_GLYPHS&&bi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ot.sortKey!==void 0&&Ne.addToSortKeyRanges(Ne.symbolInstances.length,ot.sortKey);const hf=ku(Qt,ot,oi),[uf,df]=function(Mi,mr){const Is=Mi.length,$r=mr?.values;if($r?.length>0)for(let Es=0;Es<$r.length;Es+=2){const an=$r[Es+1];Mi.emplaceBack(c.aq[$r[Es]],an[0],an[1])}return[Is,Mi.length]}(Ne.textAnchorOffsets,hf);Ne.symbolInstances.emplaceBack(tt.x,tt.y,An.right>=0?An.right:-1,An.center>=0?An.center:-1,An.left>=0?An.left:-1,An.vertical||-1,Xc,Kc,Fu,tf,rf,nf,sf,af,of,lf,cf,xi,Io,Bu,Xi,Mn,Nu,0,ni,jr,uf,df)}(i,Ue,be,r,s,o,Le,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,j,[re,re,re,re],ze,_,te,se,Fe,k,e,u,x,b,p)};if(ke==="line")for(const be of bu(e.geometry,0,0,Jt,Jt)){const Ue=Hp(be,X,me,r.vertical||P,s,24,q,i.overscaling,Jt);for(const Ne of Ue)P&&Qp(i,P.text,Me,Ne)||Ce(be,Ne)}else if(ke==="line-center"){for(const be of e.geometry)if(be.length>1){const Ue=Gp(be,me,r.vertical||P,s,24,q);Ue&&Ce(be,Ue)}}else if(e.type==="Polygon")for(const be of xc(e.geometry,0)){const Ue=Kp(be,16);Ce(be[0],new es(Ue.x,Ue.y,0))}else if(e.type==="LineString")for(const be of e.geometry)Ce(be,new es(be[0].x,be[0].y,0));else if(e.type==="Point")for(const be of e.geometry)for(const Ue of be)Ce([Ue],new es(Ue.x,Ue.y,0))}function Pu(i,e,r,s,o,u,p,f,_,x,b,T,I,k,P){const R=function(te,X,re,se,me,ze,Fe,ke){const Me=se.layout.get("text-rotate").evaluate(ze,{})*Math.PI/180,Se=[];for(const Le of X.positionedLines)for(const Ce of Le.positionedGlyphs){if(!Ce.rect)continue;const be=Ce.rect||{};let Ue=Hh+1,Ne=!0,tt=1,Dt=0;const Rt=(me||ke)&&Ce.vertical,ri=Ce.metrics.advance*Ce.scale/2;if(ke&&X.verticalizable&&(Dt=Le.lineOffset/2-(Ce.imageName?-(ii-Ce.metrics.width*Ce.scale)/2:(Ce.scale-1)*ii)),Ce.imageName){const ai=Fe[Ce.imageName];Ne=ai.sdf,tt=ai.pixelRatio,Ue=Gi/tt}const or=me?[Ce.x+ri,Ce.y]:[0,0];let Ri=me?[0,0]:[Ce.x+ri+re[0],Ce.y+re[1]-Dt],Qt=[0,0];Rt&&(Qt=Ri,Ri=[0,0]);const fi=Ce.metrics.isDoubleResolution?2:1,xi=(Ce.metrics.left-Ue)*Ce.scale-ri+Ri[0],Bi=(-Ce.metrics.top-Ue)*Ce.scale+Ri[1],Fi=xi+be.w/fi*Ce.scale/tt,ni=Bi+be.h/fi*Ce.scale/tt,si=new Ae(xi,Bi),Ci=new Ae(Fi,Bi),Oi=new Ae(xi,ni),Ii=new Ae(Fi,ni);if(Rt){const ai=new Ae(-ri,ri-vo),ot=-Math.PI/2,Ei=ii/2-ri,vi=new Ae(5-vo-Ei,-(Ce.imageName?Ei:0)),oi=new Ae(...Qt);si._rotateAround(ot,ai)._add(vi)._add(oi),Ci._rotateAround(ot,ai)._add(vi)._add(oi),Oi._rotateAround(ot,ai)._add(vi)._add(oi),Ii._rotateAround(ot,ai)._add(vi)._add(oi)}if(Me){const ai=Math.sin(Me),ot=Math.cos(Me),Ei=[ot,-ai,ai,ot];si._matMult(Ei),Ci._matMult(Ei),Oi._matMult(Ei),Ii._matMult(Ei)}const Hi=new Ae(0,0),Wi=new Ae(0,0);Se.push({tl:si,tr:Ci,bl:Oi,br:Ii,tex:be,writingMode:X.writingMode,glyphOffset:or,sectionIndex:Ce.sectionIndex,isSDF:Ne,pixelOffsetTL:Hi,pixelOffsetBR:Wi,minFontScaleX:0,minFontScaleY:0})}return Se}(0,r,f,o,u,p,s,i.allowVerticalPlacement),j=i.textSizeData;let q=null;j.kind==="source"?(q=[sn*o.layout.get("text-size").evaluate(p,{})],q[0]>Jn&&bi(`${i.layerIds[0]}: Value for "text-size" is >= ${wo}. Reduce your "text-size".`)):j.kind==="composite"&&(q=[sn*k.compositeTextSizes[0].evaluate(p,{},P),sn*k.compositeTextSizes[1].evaluate(p,{},P)],(q[0]>Jn||q[1]>Jn)&&bi(`${i.layerIds[0]}: Value for "text-size" is >= ${wo}. Reduce your "text-size".`)),i.addSymbols(i.text,R,q,f,u,p,x,e,_.lineStartIndex,_.lineLength,I,P);for(const te of b)T[te]=i.text.placedSymbolArray.length-1;return 4*R.length}function zu(i){for(const e in i)return i[e];return null}function Qp(i,e,r,s){const o=i.compareText;if(e in o){const u=o[e];for(let p=u.length-1;p>=0;p--)if(s.dist(u[p])<r)return!0}else o[e]=[];return o[e].push(s),!1}const Du=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $c{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const o=s>>4;if(o!==1)throw new Error(`Got v${o} data when expected v1.`);const u=Du[15&s];if(!u)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[f]=new Uint32Array(e,4,1);return new $c(f,p,u,e)}constructor(e,r=64,s=Float64Array,o){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=Du.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,f=e*this.IndexArrayType.BYTES_PER_ELEMENT,_=(8-f%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${s}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+_,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+f+_),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+_,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Uc(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:f}=this,_=[0,u.length-1,0],x=[];for(;_.length;){const b=_.pop()||0,T=_.pop()||0,I=_.pop()||0;if(T-I<=f){for(let j=I;j<=T;j++){const q=p[2*j],te=p[2*j+1];q>=e&&q<=s&&te>=r&&te<=o&&x.push(u[j])}continue}const k=I+T>>1,P=p[2*k],R=p[2*k+1];P>=e&&P<=s&&R>=r&&R<=o&&x.push(u[k]),(b===0?e<=P:r<=R)&&(_.push(I),_.push(k-1),_.push(1-b)),(b===0?s>=P:o>=R)&&(_.push(k+1),_.push(T),_.push(1-b))}return x}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:u,nodeSize:p}=this,f=[0,o.length-1,0],_=[],x=s*s;for(;f.length;){const b=f.pop()||0,T=f.pop()||0,I=f.pop()||0;if(T-I<=p){for(let j=I;j<=T;j++)Ru(u[2*j],u[2*j+1],e,r)<=x&&_.push(o[j]);continue}const k=I+T>>1,P=u[2*k],R=u[2*k+1];Ru(P,R,e,r)<=x&&_.push(o[k]),(b===0?e-s<=P:r-s<=R)&&(f.push(I),f.push(k-1),f.push(1-b)),(b===0?e+s>=P:r+s>=R)&&(f.push(k+1),f.push(T),f.push(1-b))}return _}}function Uc(i,e,r,s,o,u){if(o-s<=r)return;const p=s+o>>1;Lu(i,e,p,s,o,u),Uc(i,e,r,s,p-1,1-u),Uc(i,e,r,p+1,o,1-u)}function Lu(i,e,r,s,o,u){for(;o>s;){if(o-s>600){const x=o-s+1,b=r-s+1,T=Math.log(x),I=.5*Math.exp(2*T/3),k=.5*Math.sqrt(T*I*(x-I)/x)*(b-x/2<0?-1:1);Lu(i,e,r,Math.max(s,Math.floor(r-b*I/x+k)),Math.min(o,Math.floor(r+(x-b)*I/x+k)),u)}const p=e[2*r+u];let f=s,_=o;for(To(i,e,s,r),e[2*o+u]>p&&To(i,e,s,o);f<_;){for(To(i,e,f,_),f++,_--;e[2*f+u]<p;)f++;for(;e[2*_+u]>p;)_--}e[2*s+u]===p?To(i,e,s,_):(_++,To(i,e,_,o)),_<=r&&(s=_+1),r<=_&&(o=_-1)}}function To(i,e,r,s){qc(i,r,s),qc(e,2*r,2*s),qc(e,2*r+1,2*s+1)}function qc(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function Ru(i,e,r,s){const o=i-r,u=e-s;return o*o+u*u}var Zc;c.bh=void 0,(Zc=c.bh||(c.bh={})).create="create",Zc.load="load",Zc.fullLoad="fullLoad";let Rl=null,Co=[];const Gc=1e3/60,Hc="loadTime",Wc="fullLoadTime",ef={mark(i){performance.mark(i)},frame(i){const e=i;Rl!=null&&Co.push(e-Rl),Rl=e},clearMetrics(){Rl=null,Co=[],performance.clearMeasures(Hc),performance.clearMeasures(Wc);for(const i in c.bh)performance.clearMarks(c.bh[i])},getPerformanceMetrics(){performance.measure(Hc,c.bh.create,c.bh.load),performance.measure(Wc,c.bh.create,c.bh.fullLoad);const i=performance.getEntriesByName(Hc)[0].duration,e=performance.getEntriesByName(Wc)[0].duration,r=Co.length,s=1/(Co.reduce((u,p)=>u+p,0)/r/1e3),o=Co.filter(u=>u>Gc).reduce((u,p)=>u+(p-Gc)/Gc,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:o/(r+o)*100,totalFrames:r}}};c.$=function(i,e,r){var s,o,u,p,f,_,x,b,T,I,k,P,R=r[0],j=r[1],q=r[2];return e===i?(i[12]=e[0]*R+e[4]*j+e[8]*q+e[12],i[13]=e[1]*R+e[5]*j+e[9]*q+e[13],i[14]=e[2]*R+e[6]*j+e[10]*q+e[14],i[15]=e[3]*R+e[7]*j+e[11]*q+e[15]):(o=e[1],u=e[2],p=e[3],f=e[4],_=e[5],x=e[6],b=e[7],T=e[8],I=e[9],k=e[10],P=e[11],i[0]=s=e[0],i[1]=o,i[2]=u,i[3]=p,i[4]=f,i[5]=_,i[6]=x,i[7]=b,i[8]=T,i[9]=I,i[10]=k,i[11]=P,i[12]=s*R+f*j+T*q+e[12],i[13]=o*R+_*j+I*q+e[13],i[14]=u*R+x*j+k*q+e[14],i[15]=p*R+b*j+P*q+e[15]),i},c.A=ca,c.B=ji,c.C=class{constructor(i,e,r){this.receive=s=>{const o=s.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];const p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else Yi()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},this.process=()=>{if(!this.taskQueue.length)return;const s=this.taskQueue.shift(),o=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(s,o)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new qp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Yi()?i:window}send(i,e,r,s,o=!1){const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[u]=r);const p=[],f={id:u,type:i,hasCallback:!!r,targetMapId:s,mustQueue:o,sourceMapId:this.mapId,data:tn(e,p)};return this.target.postMessage(f,{transfer:p}),{cancel:()=>{r&&delete this.callbacks[u],this.target.postMessage({id:u,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Gn(e.error)):r(null,Gn(e.data)))}else{let r=!1;const s=[],o=e.hasCallback?(f,_)=>{r=!0,delete this.cancelCallbacks[i];const x={id:i,type:"<response>",sourceMapId:this.mapId,error:f?tn(f):null,data:tn(_,s)};this.target.postMessage(x,{transfer:s})}:f=>{r=!0};let u=null;const p=Gn(e.data);if(this.parent[e.type])u=this.parent[e.type](e.sourceMapId,p,o);else if("getWorkerSource"in this.parent){const f=e.type.split(".");u=this.parent.getWorkerSource(e.sourceMapId,f[0],p.source)[f[1]](p,o)}else o(new Error(`Could not find function ${e.type}`));!r&&u&&u.cancel&&(this.cancelCallbacks[i]=u.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.D=je,c.E=un,c.F=function(i,e){const r={};for(let s=0;s<e.length;s++){const o=e[s];o in i&&(r[o]=i[o])}return r},c.G=cu,c.H=hu,c.I=Ac,c.J=At,c.K=bt,c.L=Qn,c.M=ns,c.N=Jt,c.O=pr,c.P=Ae,c.Q=Vt,c.R=dr,c.S=zt,c.T=hl,c.U=kl,c.V=class extends bn{},c.W=Nc,c.X=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const o=window.document.createElement("source");Ar(i[s])||(r.crossOrigin="Anonymous"),o.src=i[s],r.appendChild(o)}return{cancel:()=>{}}},c.Y=Te,c.Z=function(){var i=new ca(16);return ca!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},c._=xe,c.a=rs,c.a$=class extends A{},c.a0=function(i,e,r){var s=r[0],o=r[1],u=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*o,i[5]=e[5]*o,i[6]=e[6]*o,i[7]=e[7]*o,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},c.a1=fh,c.a2=function(){return ks++},c.a3=N,c.a4=ma,c.a5=function(){qi.isLoading()||qi.isLoaded()||Ja()!=="deferred"||cl()},c.a6=ja,c.a7=Ts,c.a8=Pt,c.a9=_u,c.aA=ys,c.aB=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Qi(i[r],e[i[r].ref]));return i},c.aC=function(i){if(i.type==="custom")return new Up(i);switch(i.type){case"background":return new Vp(i);case"circle":return new Cd(i);case"fill":return new Zd(i);case"fill-extrusion":return new ap(i);case"heatmap":return new Ed(i);case"hillshade":return new Ad(i);case"line":return new fp(i);case"raster":return new $p(i);case"symbol":return new Al(i)}},c.aD=hr,c.aE=function(i,e){if(!i)return[{command:ft.setStyle,args:[e]}];let r=[];try{if(!It(i.version,e.version))return[{command:ft.setStyle,args:[e]}];It(i.center,e.center)||r.push({command:ft.setCenter,args:[e.center]}),It(i.zoom,e.zoom)||r.push({command:ft.setZoom,args:[e.zoom]}),It(i.bearing,e.bearing)||r.push({command:ft.setBearing,args:[e.bearing]}),It(i.pitch,e.pitch)||r.push({command:ft.setPitch,args:[e.pitch]}),It(i.sprite,e.sprite)||r.push({command:ft.setSprite,args:[e.sprite]}),It(i.glyphs,e.glyphs)||r.push({command:ft.setGlyphs,args:[e.glyphs]}),It(i.transition,e.transition)||r.push({command:ft.setTransition,args:[e.transition]}),It(i.light,e.light)||r.push({command:ft.setLight,args:[e.light]});const s={},o=[];(function(p,f,_,x){let b;for(b in f=f||{},p=p||{})Object.prototype.hasOwnProperty.call(p,b)&&(Object.prototype.hasOwnProperty.call(f,b)||Ln(b,_,x));for(b in f)Object.prototype.hasOwnProperty.call(f,b)&&(Object.prototype.hasOwnProperty.call(p,b)?It(p[b],f[b])||(p[b].type==="geojson"&&f[b].type==="geojson"&&zs(p,f,b)?_.push({command:ft.setGeoJSONSourceData,args:[b,f[b].data]}):kr(b,f,_,x)):_r(b,f,_))})(i.sources,e.sources,o,s);const u=[];i.layers&&i.layers.forEach(p=>{s[p.source]?r.push({command:ft.removeLayer,args:[p.id]}):u.push(p)}),r=r.concat(o),function(p,f,_){f=f||[];const x=(p=p||[]).map(Kr),b=f.map(Kr),T=p.reduce(dn,{}),I=f.reduce(dn,{}),k=x.slice(),P=Object.create(null);let R,j,q,te,X,re,se;for(R=0,j=0;R<x.length;R++)q=x[R],Object.prototype.hasOwnProperty.call(I,q)?j++:(_.push({command:ft.removeLayer,args:[q]}),k.splice(k.indexOf(q,j),1));for(R=0,j=0;R<b.length;R++)q=b[b.length-1-R],k[k.length-1-R]!==q&&(Object.prototype.hasOwnProperty.call(T,q)?(_.push({command:ft.removeLayer,args:[q]}),k.splice(k.lastIndexOf(q,k.length-j),1)):j++,re=k[k.length-R],_.push({command:ft.addLayer,args:[I[q],re]}),k.splice(k.length-R,0,q),P[q]=!0);for(R=0;R<b.length;R++)if(q=b[R],te=T[q],X=I[q],!P[q]&&!It(te,X))if(It(te.source,X.source)&&It(te["source-layer"],X["source-layer"])&&It(te.type,X.type)){for(se in Rn(te.layout,X.layout,_,q,null,ft.setLayoutProperty),Rn(te.paint,X.paint,_,q,null,ft.setPaintProperty),It(te.filter,X.filter)||_.push({command:ft.setFilter,args:[q,X.filter]}),It(te.minzoom,X.minzoom)&&It(te.maxzoom,X.maxzoom)||_.push({command:ft.setLayerZoomRange,args:[q,X.minzoom,X.maxzoom]}),te)Object.prototype.hasOwnProperty.call(te,se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&(se.indexOf("paint.")===0?Rn(te[se],X[se],_,q,se.slice(6),ft.setPaintProperty):It(te[se],X[se])||_.push({command:ft.setLayerProperty,args:[q,se,X[se]]}));for(se in X)Object.prototype.hasOwnProperty.call(X,se)&&!Object.prototype.hasOwnProperty.call(te,se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&(se.indexOf("paint.")===0?Rn(te[se],X[se],_,q,se.slice(6),ft.setPaintProperty):It(te[se],X[se])||_.push({command:ft.setLayerProperty,args:[q,se,X[se]]}))}else _.push({command:ft.removeLayer,args:[q]}),re=k[k.lastIndexOf(q)+1],_.push({command:ft.addLayer,args:[X,re]})}(u,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:ft.setStyle,args:[e]}]}return r},c.aF=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},c.aG=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],r[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(!i(e[s],r[s]))return!1;return!0}return e===r},c.aH=Bt,c.aI=kn,c.aJ=xs,c.aK=function(i){return i({pluginStatus:zi,pluginURL:rn}),xs.on("pluginStateChange",i),i},c.aL=class extends Tn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},c.aM=oa,c.aN=class extends Tn{constructor(i,e){super(i,e),this.current=oc}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},c.aO=fl,c.aP=class extends Tn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},c.aQ=class extends Tn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},c.aR=ml,c.aS=function(i,e,r,s,o,u,p){var f=1/(e-r),_=1/(s-o),x=1/(u-p);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+r)*f,i[13]=(o+s)*_,i[14]=(p+u)*x,i[15]=1,i},c.aT=wt,c.aU=Td,c.aV=class extends a{},c.aW=yp,c.aX=class extends d{},c.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},c.aZ=xh,c.a_=we,c.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,o,u)=>{const p=o||u;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},c.ab=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},c.ac=function(i){if(ln==null){const e=i.navigator?i.navigator.userAgent:null;ln=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ln},c.ad=li,c.ae=function(i,e,r){var s=Math.sin(r),o=Math.cos(r),u=e[0],p=e[1],f=e[2],_=e[3],x=e[4],b=e[5],T=e[6],I=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*o+x*s,i[1]=p*o+b*s,i[2]=f*o+T*s,i[3]=_*o+I*s,i[4]=x*o-u*s,i[5]=b*o-p*s,i[6]=T*o-f*s,i[7]=I*o-_*s,i},c.af=function(i){var e=new ca(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},c.ag=xl,c.ah=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:o,minZoom:u,maxZoom:p}=i,f=o?li($i.interpolationFactor(o,e,u,p),0,1):0;i.kind==="camera"?s=ji.number(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:s}},c.aj=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:o}){return i.kind==="source"?s/sn:i.kind==="composite"?ji.number(s/sn,o/sn,r):e},c.ak=Dc,c.al=function(i,e,r,s){const o=e.y-i.y,u=e.x-i.x,p=s.y-r.y,f=s.x-r.x,_=p*u-f*o;if(_===0)return null;const x=(f*(i.y-r.y)-p*(i.x-r.x))/_;return new Ae(i.x+x*u,i.y+x*o)},c.am=bu,c.an=lh,c.ao=dc,c.ap=ii,c.ar=zc,c.as=function(i,e){var r=e[0],s=e[1],o=e[2],u=e[3],p=e[4],f=e[5],_=e[6],x=e[7],b=e[8],T=e[9],I=e[10],k=e[11],P=e[12],R=e[13],j=e[14],q=e[15],te=r*f-s*p,X=r*_-o*p,re=r*x-u*p,se=s*_-o*f,me=s*x-u*f,ze=o*x-u*_,Fe=b*R-T*P,ke=b*j-I*P,Me=b*q-k*P,Se=T*j-I*R,Le=T*q-k*R,Ce=I*q-k*j,be=te*Ce-X*Le+re*Se+se*Me-me*ke+ze*Fe;return be?(i[0]=(f*Ce-_*Le+x*Se)*(be=1/be),i[1]=(o*Le-s*Ce-u*Se)*be,i[2]=(R*ze-j*me+q*se)*be,i[3]=(I*me-T*ze-k*se)*be,i[4]=(_*Me-p*Ce-x*ke)*be,i[5]=(r*Ce-o*Me+u*ke)*be,i[6]=(j*re-P*ze-q*X)*be,i[7]=(b*ze-I*re+k*X)*be,i[8]=(p*Le-f*Me+x*Fe)*be,i[9]=(s*Me-r*Le-u*Fe)*be,i[10]=(P*me-R*re+q*te)*be,i[11]=(T*re-b*me-k*te)*be,i[12]=(f*ke-p*Se-_*Fe)*be,i[13]=(r*Se-s*ke+o*Fe)*be,i[14]=(R*X-P*se-j*te)*be,i[15]=(b*se-T*X+I*te)*be,i):null},c.at=jc,c.au=Pc,c.av=$c,c.aw=function(){const i={},e=he.$version;for(const r in he.$root){const s=he.$root[r];if(s.required){let o=null;o=r==="version"?e:s.type==="array"?[]:{},o!=null&&(i[r]=o)}}return i},c.ax=ft,c.ay=sl,c.az=ur,c.b=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(s=>{e(null,s)}).catch(s=>{e(new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},c.b0=di,c.b1=function(i,e){var r=i[0],s=i[1],o=i[2],u=i[3],p=i[4],f=i[5],_=i[6],x=i[7],b=i[8],T=i[9],I=i[10],k=i[11],P=i[12],R=i[13],j=i[14],q=i[15],te=e[0],X=e[1],re=e[2],se=e[3],me=e[4],ze=e[5],Fe=e[6],ke=e[7],Me=e[8],Se=e[9],Le=e[10],Ce=e[11],be=e[12],Ue=e[13],Ne=e[14],tt=e[15];return Math.abs(r-te)<=Li*Math.max(1,Math.abs(r),Math.abs(te))&&Math.abs(s-X)<=Li*Math.max(1,Math.abs(s),Math.abs(X))&&Math.abs(o-re)<=Li*Math.max(1,Math.abs(o),Math.abs(re))&&Math.abs(u-se)<=Li*Math.max(1,Math.abs(u),Math.abs(se))&&Math.abs(p-me)<=Li*Math.max(1,Math.abs(p),Math.abs(me))&&Math.abs(f-ze)<=Li*Math.max(1,Math.abs(f),Math.abs(ze))&&Math.abs(_-Fe)<=Li*Math.max(1,Math.abs(_),Math.abs(Fe))&&Math.abs(x-ke)<=Li*Math.max(1,Math.abs(x),Math.abs(ke))&&Math.abs(b-Me)<=Li*Math.max(1,Math.abs(b),Math.abs(Me))&&Math.abs(T-Se)<=Li*Math.max(1,Math.abs(T),Math.abs(Se))&&Math.abs(I-Le)<=Li*Math.max(1,Math.abs(I),Math.abs(Le))&&Math.abs(k-Ce)<=Li*Math.max(1,Math.abs(k),Math.abs(Ce))&&Math.abs(P-be)<=Li*Math.max(1,Math.abs(P),Math.abs(be))&&Math.abs(R-Ue)<=Li*Math.max(1,Math.abs(R),Math.abs(Ue))&&Math.abs(j-Ne)<=Li*Math.max(1,Math.abs(j),Math.abs(Ne))&&Math.abs(q-tt)<=Li*Math.max(1,Math.abs(q),Math.abs(tt))},c.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},c.b3=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},c.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},c.b5=cr,c.b6=fu,c.b7=uu,c.b8=function(i,e,r,s,o){var u,p=1/Math.tan(e/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,o!=null&&o!==1/0?(i[10]=(o+s)*(u=1/(s-o)),i[14]=2*o*s*u):(i[10]=-1,i[14]=-2*s),i},c.b9=function(i,e,r){var s=Math.sin(r),o=Math.cos(r),u=e[4],p=e[5],f=e[6],_=e[7],x=e[8],b=e[9],T=e[10],I=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*o+x*s,i[5]=p*o+b*s,i[6]=f*o+T*s,i[7]=_*o+I*s,i[8]=x*o-u*s,i[9]=b*o-p*s,i[10]=T*o-f*s,i[11]=I*o-_*s,i},c.bA=Ve,c.bB=Vh,c.bC=Ks,c.bD=qi,c.ba=nt,c.bb=ut,c.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},c.bd=class extends ws{},c.be=Fc,c.bf=du,c.bg=ef,c.bi=Gr,c.bj=function(i,e,r=!1){if(zi===Ha||zi===Wa||zi===Xa)throw new Error("setRTLTextPlugin cannot be called multiple times.");rn=Pn.resolveURL(i),zi=Ha,Ka=e,Ya(),r||cl()},c.bk=Ja,c.bl=function(i,e){const r={};for(let o=0;o<i.length;o++){const u=e&&e[i[o].id]||ea(i[o]);e&&(e[i[o].id]=u);let p=r[u];p||(p=r[u]=[]),p.push(i[o])}const s=[];for(const o in r)s.push(r[o]);return s},c.bm=De,c.bn=gu,c.bo=yu,c.bp=Xh,c.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Jt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,s=e._unevaluatedLayout._values,o={layoutIconSize:s["icon-size"].possiblyEvaluate(new Pt(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Pt(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Pt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:x,maxZoom:b}=i.bucket.textSizeData;o.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Pt(x),i.canonical),s["text-size"].possiblyEvaluate(new Pt(b),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:x,maxZoom:b}=i.bucket.iconSizeData;o.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Pt(x),i.canonical),s["icon-size"].possiblyEvaluate(new Pt(b),i.canonical)]}const u=r.get("text-line-height")*ii,p=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",f=r.get("text-keep-upright"),_=r.get("text-size");for(const x of i.bucket.features){const b=r.get("text-font").evaluate(x,{},i.canonical).join(","),T=_.evaluate(x,{},i.canonical),I=o.layoutTextSize.evaluate(x,{},i.canonical),k=o.layoutIconSize.evaluate(x,{},i.canonical),P={horizontal:{},vertical:void 0},R=x.text;let j,q=[0,0];if(R){const re=R.toString(),se=r.get("text-letter-spacing").evaluate(x,{},i.canonical)*ii,me=Za(re)?se:0,ze=r.get("text-anchor").evaluate(x,{},i.canonical),Fe=ku(e,x,i.canonical);if(!Fe){const Ce=r.get("text-radial-offset").evaluate(x,{},i.canonical);q=Ce?Au(ze,[Ce*ii,Vc]):r.get("text-offset").evaluate(x,{},i.canonical).map(be=>be*ii)}let ke=p?"center":r.get("text-justify").evaluate(x,{},i.canonical);const Me=r.get("symbol-placement"),Se=Me==="point"?r.get("text-max-width").evaluate(x,{},i.canonical)*ii:0,Le=()=>{i.bucket.allowVerticalPlacement&&qa(re)&&(P.vertical=Il(R,i.glyphMap,i.glyphPositions,i.imagePositions,b,Se,u,ze,"left",me,q,c.ai.vertical,!0,Me,I,T))};if(!p&&Fe){const Ce=new Set;if(ke==="auto")for(let Ue=0;Ue<Fe.values.length;Ue+=2)Ce.add(jc(Fe.values[Ue]));else Ce.add(ke);let be=!1;for(const Ue of Ce)if(!P.horizontal[Ue])if(be)P.horizontal[Ue]=P.horizontal[0];else{const Ne=Il(R,i.glyphMap,i.glyphPositions,i.imagePositions,b,Se,u,"center",Ue,me,q,c.ai.horizontal,!1,Me,I,T);Ne&&(P.horizontal[Ue]=Ne,be=Ne.positionedLines.length===1)}Le()}else{ke==="auto"&&(ke=jc(ze));const Ce=Il(R,i.glyphMap,i.glyphPositions,i.imagePositions,b,Se,u,ze,ke,me,q,c.ai.horizontal,!1,Me,I,T);Ce&&(P.horizontal[ke]=Ce),Le(),qa(re)&&p&&f&&(P.vertical=Il(R,i.glyphMap,i.glyphPositions,i.imagePositions,b,Se,u,ze,ke,me,q,c.ai.vertical,!1,Me,I,T))}}let te=!1;if(x.icon&&x.icon.name){const re=i.imageMap[x.icon.name];re&&(j=Rp(i.imagePositions[x.icon.name],r.get("icon-offset").evaluate(x,{},i.canonical),r.get("icon-anchor").evaluate(x,{},i.canonical)),te=!!re.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=te:i.bucket.sdfIcons!==te&&bi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(re.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const X=zu(P.horizontal)||P.vertical;i.bucket.iconsInText=!!X&&X.iconsInText,(X||j)&&Jp(i.bucket,x,P,j,i.imageMap,o,I,k,q,te,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},c.br=Cc,c.bs=wc,c.bt=Tc,c.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},c.bv=Ec,c.bw=Kn,c.bx=function(i,e,r,s,o){return xe(this,void 0,void 0,function*(){if(bt())try{return yield ns(i,e,r,s,o)}catch{}return function(u,p,f,_,x){const b=u.width,T=u.height;gr&&kt||(gr=new OffscreenCanvas(b,T),kt=gr.getContext("2d",{willReadFrequently:!0})),gr.width=b,gr.height=T,kt.drawImage(u,0,0,b,T);const I=kt.getImageData(p,f,_,x);return kt.clearRect(0,0,b,T),I.data}(i,e,r,s,o)})},c.by=mu,c.bz=H,c.c=zn,c.d=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Ps})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(s):Ps},c.e=ci,c.f=function(i,e){return Hr(ci(i,{type:"json"}),e)},c.g=Ji,c.h=Pn,c.i=Yi,c.j=Xr,c.k=Wr,c.l=as,c.m=Hr,c.n=function(i){return new Ec(i).readFields(Ap,[])},c.o=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const o=new Array(i.length);let u=null;i.forEach((p,f)=>{e(p,(_,x)=>{_&&(u=_),o[f]=x,--s==0&&r(u,o)})})},c.p=Wh,c.q=uo,c.r=Wt,c.s=Ar,c.t=rc,c.u=Pe,c.v=he,c.w=bi,c.x=ra,c.y=Br,c.z=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}}}),ae(["./shared"],function(c){class xe{constructor(C){this.keyCache={},C&&this.replace(C)}replace(C){this._layerConfigs={},this._layers={},this.update(C,[])}update(C,E){for(const V of C){this._layerConfigs[V.id]=V;const $=this._layers[V.id]=c.aC(V);$._featureFilter=c.a6($.filter),this.keyCache[V.id]&&delete this.keyCache[V.id]}for(const V of E)delete this.keyCache[V],delete this._layerConfigs[V],delete this._layers[V];this.familiesBySource={};const D=c.bl(Object.values(this._layerConfigs),this.keyCache);for(const V of D){const $=V.map(pe=>this._layers[pe.id]),ie=$[0];if(ie.visibility==="none")continue;const K=ie.source||"";let Z=this.familiesBySource[K];Z||(Z=this.familiesBySource[K]={});const ee=ie.sourceLayer||"_geojsonTileLayer";let ue=Z[ee];ue||(ue=Z[ee]=[]),ue.push($)}}}class H{constructor(C){const E={},D=[];for(const K in C){const Z=C[K],ee=E[K]={};for(const ue in Z){const pe=Z[+ue];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;const ge={x:0,y:0,w:pe.bitmap.width+2,h:pe.bitmap.height+2};D.push(ge),ee[ue]={rect:ge,metrics:pe.metrics}}}const{w:V,h:$}=c.p(D),ie=new c.q({width:V||1,height:$||1});for(const K in C){const Z=C[K];for(const ee in Z){const ue=Z[+ee];if(!ue||ue.bitmap.width===0||ue.bitmap.height===0)continue;const pe=E[K][ee].rect;c.q.copy(ue.bitmap,ie,{x:0,y:0},{x:pe.x+1,y:pe.y+1},ue.bitmap)}}this.image=ie,this.positions=E}}c.bm("GlyphAtlas",H);class Ve{constructor(C){this.tileID=new c.O(C.tileID.overscaledZ,C.tileID.wrap,C.tileID.canonical.z,C.tileID.canonical.x,C.tileID.canonical.y),this.uid=C.uid,this.zoom=C.zoom,this.pixelRatio=C.pixelRatio,this.tileSize=C.tileSize,this.source=C.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=C.showCollisionBoxes,this.collectResourceTiming=!!C.collectResourceTiming,this.returnDependencies=!!C.returnDependencies,this.promoteId=C.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(C,E,D,V,$){this.status="parsing",this.data=C,this.collisionBoxArray=new c.a3;const ie=new c.bn(Object.keys(C.layers).sort()),K=new c.bo(this.tileID,this.promoteId);K.bucketLayerIDs=[];const Z={},ee={featureIndex:K,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:D},ue=E.familiesBySource[this.source];for(const pt in ue){const dt=C.layers[pt];if(!dt)continue;dt.version===1&&c.w(`Vector tile source "${this.source}" layer "${pt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const mi=ie.encode(pt),Et=[];for(let Yt=0;Yt<dt.length;Yt++){const hi=dt.feature(Yt),er=K.getId(hi,pt);Et.push({feature:hi,id:er,index:Yt,sourceLayerIndex:mi})}for(const Yt of ue[pt]){const hi=Yt[0];hi.source!==this.source&&c.w(`layer.source = ${hi.source} does not equal this.source = ${this.source}`),hi.minzoom&&this.zoom<Math.floor(hi.minzoom)||hi.maxzoom&&this.zoom>=hi.maxzoom||hi.visibility!=="none"&&(He(Yt,this.zoom,D),(Z[hi.id]=hi.createBucket({index:K.bucketLayerIDs.length,layers:Yt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mi,sourceID:this.source})).populate(Et,ee,this.tileID.canonical),K.bucketLayerIDs.push(Yt.map(er=>er.id)))}}let pe,ge,$e,We;const Re=c.aH(ee.glyphDependencies,pt=>Object.keys(pt).map(Number));this.inFlightDependencies.forEach(pt=>pt?.cancel()),this.inFlightDependencies=[];const qe=++this.dependencySentinel;Object.keys(Re).length?this.inFlightDependencies.push(V.send("getGlyphs",{uid:this.uid,stacks:Re,source:this.source,tileID:this.tileID,type:"glyphs"},(pt,dt)=>{qe===this.dependencySentinel&&(pe||(pe=pt,ge=dt,Tt.call(this)))})):ge={};const Ye=Object.keys(ee.iconDependencies);Ye.length?this.inFlightDependencies.push(V.send("getImages",{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"},(pt,dt)=>{qe===this.dependencySentinel&&(pe||(pe=pt,$e=dt,Tt.call(this)))})):$e={};const vt=Object.keys(ee.patternDependencies);function Tt(){if(pe)return $(pe);if(ge&&$e&&We){const pt=new H(ge),dt=new c.bp($e,We);for(const mi in Z){const Et=Z[mi];Et instanceof c.a4?(He(Et.layers,this.zoom,D),c.bq({bucket:Et,glyphMap:ge,glyphPositions:pt.positions,imageMap:$e,imagePositions:dt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Et.hasPattern&&(Et instanceof c.br||Et instanceof c.bs||Et instanceof c.bt)&&(He(Et.layers,this.zoom,D),Et.addFeatures(ee,this.tileID.canonical,dt.patternPositions))}this.status="done",$(null,{buckets:Object.values(Z).filter(mi=>!mi.isEmpty()),featureIndex:K,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pt.image,imageAtlas:dt,glyphMap:this.returnDependencies?ge:null,iconMap:this.returnDependencies?$e:null,glyphPositions:this.returnDependencies?pt.positions:null})}}vt.length?this.inFlightDependencies.push(V.send("getImages",{icons:vt,source:this.source,tileID:this.tileID,type:"patterns"},(pt,dt)=>{qe===this.dependencySentinel&&(pe||(pe=pt,We=dt,Tt.call(this)))})):We={},Tt.call(this)}}function He(O,C,E){const D=new c.a8(C);for(const V of O)V.recalculate(D,E)}function Ae(O,C){const E=c.l(O.request,(D,V,$,ie)=>{if(D)C(D);else if(V)try{const K=new c.bw.VectorTile(new c.bv(V));C(null,{vectorTile:K,rawData:V,cacheControl:$,expires:ie})}catch(K){const Z=new Uint8Array(V);let ee=`Unable to parse the tile at ${O.request.url}, `;ee+=Z[0]===31&&Z[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${K.messge}`,C(new Error(ee))}});return()=>{E.cancel(),C()}}class Xe{constructor(C,E,D,V){this.actor=C,this.layerIndex=E,this.availableImages=D,this.loadVectorData=V||Ae,this.fetching={},this.loading={},this.loaded={}}loadTile(C,E){const D=C.uid;this.loading||(this.loading={});const V=!!(C&&C.request&&C.request.collectResourceTiming)&&new c.bu(C.request),$=this.loading[D]=new Ve(C);$.abort=this.loadVectorData(C,(ie,K)=>{if(delete this.loading[D],ie||!K)return $.status="done",this.loaded[D]=$,E(ie);const Z=K.rawData,ee={};K.expires&&(ee.expires=K.expires),K.cacheControl&&(ee.cacheControl=K.cacheControl);const ue={};if(V){const pe=V.finish();pe&&(ue.resourceTiming=JSON.parse(JSON.stringify(pe)))}$.vectorTile=K.vectorTile,$.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,(pe,ge)=>{if(delete this.fetching[D],pe||!ge)return E(pe);E(null,c.e({rawTileData:Z.slice(0)},ge,ee,ue))}),this.loaded=this.loaded||{},this.loaded[D]=$,this.fetching[D]={rawTileData:Z,cacheControl:ee,resourceTiming:ue}})}reloadTile(C,E){const D=this.loaded,V=C.uid;if(D&&D[V]){const $=D[V];$.showCollisionBoxes=C.showCollisionBoxes,$.status==="parsing"?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,(ie,K)=>{if(ie||!K)return E(ie,K);let Z;if(this.fetching[V]){const{rawTileData:ee,cacheControl:ue,resourceTiming:pe}=this.fetching[V];delete this.fetching[V],Z=c.e({rawTileData:ee.slice(0)},K,ue,pe)}else Z=K;E(null,Z)}):$.status==="done"&&($.vectorTile?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,E):E())}}abortTile(C,E){const D=this.loading,V=C.uid;D&&D[V]&&D[V].abort&&(D[V].abort(),delete D[V]),E()}removeTile(C,E){const D=this.loaded,V=C.uid;D&&D[V]&&delete D[V],E()}}class it{constructor(){this.loaded={}}loadTile(C,E){return c._(this,void 0,void 0,function*(){const{uid:D,encoding:V,rawImageData:$,redFactor:ie,greenFactor:K,blueFactor:Z,baseShift:ee}=C,ue=$.width+2,pe=$.height+2,ge=c.a($)?new c.R({width:ue,height:pe},yield c.bx($,-1,-1,ue,pe)):$,$e=new c.by(D,ge,V,ie,K,Z,ee);this.loaded=this.loaded||{},this.loaded[D]=$e,E(null,$e)})}removeTile(C){const E=this.loaded,D=C.uid;E&&E[D]&&delete E[D]}}function yt(O,C){if(O.length!==0){xt(O[0],C);for(var E=1;E<O.length;E++)xt(O[E],!C)}}function xt(O,C){for(var E=0,D=0,V=0,$=O.length,ie=$-1;V<$;ie=V++){var K=(O[V][0]-O[ie][0])*(O[ie][1]+O[V][1]),Z=E+K;D+=Math.abs(E)>=Math.abs(K)?E-Z+K:K-Z+E,E=Z}E+D>=0!=!!C&&O.reverse()}var lt=c.bz(function O(C,E){var D,V=C&&C.type;if(V==="FeatureCollection")for(D=0;D<C.features.length;D++)O(C.features[D],E);else if(V==="GeometryCollection")for(D=0;D<C.geometries.length;D++)O(C.geometries[D],E);else if(V==="Feature")O(C.geometry,E);else if(V==="Polygon")yt(C.coordinates,E);else if(V==="MultiPolygon")for(D=0;D<C.coordinates.length;D++)yt(C.coordinates[D],E);return C});const At=c.bw.VectorTileFeature.prototype.toGeoJSON;var bt={exports:{}},nt=c.bA,ut=c.bw.VectorTileFeature,li=cr;function cr(O,C){this.options=C||{},this.features=O,this.length=O.length}function ci(O,C){this.id=typeof O.id=="number"?O.id:void 0,this.type=O.type,this.rawGeometry=O.type===1?[O.geometry]:O.geometry,this.properties=O.tags,this.extent=C||4096}cr.prototype.feature=function(O){return new ci(this.features[O],this.options.extent)},ci.prototype.loadGeometry=function(){var O=this.rawGeometry;this.geometry=[];for(var C=0;C<O.length;C++){for(var E=O[C],D=[],V=0;V<E.length;V++)D.push(new nt(E[V][0],E[V][1]));this.geometry.push(D)}return this.geometry},ci.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var O=this.geometry,C=1/0,E=-1/0,D=1/0,V=-1/0,$=0;$<O.length;$++)for(var ie=O[$],K=0;K<ie.length;K++){var Z=ie[K];C=Math.min(C,Z.x),E=Math.max(E,Z.x),D=Math.min(D,Z.y),V=Math.max(V,Z.y)}return[C,D,E,V]},ci.prototype.toGeoJSON=ut.prototype.toGeoJSON;var ks=c.bB,Bt=li;function kn(O){var C=new ks;return function(E,D){for(var V in E.layers)D.writeMessage(3,hr,E.layers[V])}(O,C),C.finish()}function hr(O,C){var E;C.writeVarintField(15,O.version||1),C.writeStringField(1,O.name||""),C.writeVarintField(5,O.extent||4096);var D={keys:[],values:[],keycache:{},valuecache:{}};for(E=0;E<O.length;E++)D.feature=O.feature(E),C.writeMessage(2,Zr,D);var V=D.keys;for(E=0;E<V.length;E++)C.writeStringField(3,V[E]);var $=D.values;for(E=0;E<$.length;E++)C.writeMessage(4,ln,$[E])}function Zr(O,C){var E=O.feature;E.id!==void 0&&C.writeVarintField(1,E.id),C.writeMessage(2,bi,O),C.writeVarintField(3,E.type),C.writeMessage(4,Yi,E)}function bi(O,C){var E=O.feature,D=O.keys,V=O.values,$=O.keycache,ie=O.valuecache;for(var K in E.properties){var Z=E.properties[K],ee=$[K];if(Z!==null){ee===void 0&&(D.push(K),$[K]=ee=D.length-1),C.writeVarint(ee);var ue=typeof Z;ue!=="string"&&ue!=="boolean"&&ue!=="number"&&(Z=JSON.stringify(Z));var pe=ue+":"+Z,ge=ie[pe];ge===void 0&&(V.push(Z),ie[pe]=ge=V.length-1),C.writeVarint(ge)}}}function Ni(O,C){return(C<<3)+(7&O)}function Mr(O){return O<<1^O>>31}function Yi(O,C){for(var E=O.loadGeometry(),D=O.type,V=0,$=0,ie=E.length,K=0;K<ie;K++){var Z=E[K],ee=1;D===1&&(ee=Z.length),C.writeVarint(Ni(1,ee));for(var ue=D===3?Z.length-1:Z.length,pe=0;pe<ue;pe++){pe===1&&D!==1&&C.writeVarint(Ni(2,ue-1));var ge=Z[pe].x-V,$e=Z[pe].y-$;C.writeVarint(Mr(ge)),C.writeVarint(Mr($e)),V+=ge,$+=$e}D===3&&C.writeVarint(Ni(7,1))}}function ln(O,C){var E=typeof O;E==="string"?C.writeStringField(1,O):E==="boolean"?C.writeBooleanField(7,O):E==="number"&&(O%1!=0?C.writeDoubleField(3,O):O<0?C.writeSVarintField(6,O):C.writeVarintField(5,O))}bt.exports=kn,bt.exports.fromVectorTileJs=kn,bt.exports.fromGeojsonVt=function(O,C){C=C||{};var E={};for(var D in O)E[D]=new Bt(O[D].features,C),E[D].name=D,E[D].version=C.version,E[D].extent=C.extent;return kn({layers:E})},bt.exports.GeoJSONWrapper=Bt;var rs=c.bz(bt.exports);const Ps={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:O=>O},ns=Math.fround||(gr=new Float32Array(1),O=>(gr[0]=+O,gr[0]));var gr;const kt=3,Ai=5,cn=6;class Pn{constructor(C){this.options=Object.assign(Object.create(Ps),C),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(C){const{log:E,minZoom:D,maxZoom:V}=this.options;E&&console.time("total time");const $=`prepare ${C.length} points`;E&&console.time($),this.points=C;const ie=[];for(let Z=0;Z<C.length;Z++){const ee=C[Z];if(!ee.geometry)continue;const[ue,pe]=ee.geometry.coordinates,ge=ns(ur(ue)),$e=ns(Ji(pe));ie.push(ge,$e,1/0,Z,-1,1),this.options.reduce&&ie.push(0)}let K=this.trees[V+1]=this._createTree(ie);E&&console.timeEnd($);for(let Z=V;Z>=D;Z--){const ee=+Date.now();K=this.trees[Z]=this._createTree(this._cluster(K,Z)),E&&console.log("z%d: %d clusters in %dms",Z,K.numItems,+Date.now()-ee)}return E&&console.timeEnd("total time"),this}getClusters(C,E){let D=((C[0]+180)%360+360)%360-180;const V=Math.max(-90,Math.min(90,C[1]));let $=C[2]===180?180:((C[2]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,C[3]));if(C[2]-C[0]>=360)D=-180,$=180;else if(D>$){const pe=this.getClusters([D,V,180,ie],E),ge=this.getClusters([-180,V,$,ie],E);return pe.concat(ge)}const K=this.trees[this._limitZoom(E)],Z=K.range(ur(D),Ji(ie),ur($),Ji(V)),ee=K.data,ue=[];for(const pe of Z){const ge=this.stride*pe;ue.push(ee[ge+Ai]>1?zn(ee,ge,this.clusterProps):this.points[ee[ge+kt]])}return ue}getChildren(C){const E=this._getOriginId(C),D=this._getOriginZoom(C),V="No cluster with the specified id.",$=this.trees[D];if(!$)throw new Error(V);const ie=$.data;if(E*this.stride>=ie.length)throw new Error(V);const K=this.options.radius/(this.options.extent*Math.pow(2,D-1)),Z=$.within(ie[E*this.stride],ie[E*this.stride+1],K),ee=[];for(const ue of Z){const pe=ue*this.stride;ie[pe+4]===C&&ee.push(ie[pe+Ai]>1?zn(ie,pe,this.clusterProps):this.points[ie[pe+kt]])}if(ee.length===0)throw new Error(V);return ee}getLeaves(C,E,D){const V=[];return this._appendLeaves(V,C,E=E||10,D=D||0,0),V}getTile(C,E,D){const V=this.trees[this._limitZoom(C)],$=Math.pow(2,C),{extent:ie,radius:K}=this.options,Z=K/ie,ee=(D-Z)/$,ue=(D+1+Z)/$,pe={features:[]};return this._addTileFeatures(V.range((E-Z)/$,ee,(E+1+Z)/$,ue),V.data,E,D,$,pe),E===0&&this._addTileFeatures(V.range(1-Z/$,ee,1,ue),V.data,$,D,$,pe),E===$-1&&this._addTileFeatures(V.range(0,ee,Z/$,ue),V.data,-1,D,$,pe),pe.features.length?pe:null}getClusterExpansionZoom(C){let E=this._getOriginZoom(C)-1;for(;E<=this.options.maxZoom;){const D=this.getChildren(C);if(E++,D.length!==1)break;C=D[0].properties.cluster_id}return E}_appendLeaves(C,E,D,V,$){const ie=this.getChildren(E);for(const K of ie){const Z=K.properties;if(Z&&Z.cluster?$+Z.point_count<=V?$+=Z.point_count:$=this._appendLeaves(C,Z.cluster_id,D,V,$):$<V?$++:C.push(K),C.length===D)break}return $}_createTree(C){const E=new c.av(C.length/this.stride|0,this.options.nodeSize,Float32Array);for(let D=0;D<C.length;D+=this.stride)E.add(C[D],C[D+1]);return E.finish(),E.data=C,E}_addTileFeatures(C,E,D,V,$,ie){for(const K of C){const Z=K*this.stride,ee=E[Z+Ai]>1;let ue,pe,ge;if(ee)ue=Gr(E,Z,this.clusterProps),pe=E[Z],ge=E[Z+1];else{const Re=this.points[E[Z+kt]];ue=Re.properties;const[qe,Ye]=Re.geometry.coordinates;pe=ur(qe),ge=Ji(Ye)}const $e={type:1,geometry:[[Math.round(this.options.extent*(pe*$-D)),Math.round(this.options.extent*(ge*$-V))]],tags:ue};let We;We=ee||this.options.generateId?E[Z+kt]:this.points[E[Z+kt]].id,We!==void 0&&($e.id=We),ie.features.push($e)}}_limitZoom(C){return Math.max(this.options.minZoom,Math.min(Math.floor(+C),this.options.maxZoom+1))}_cluster(C,E){const{radius:D,extent:V,reduce:$,minPoints:ie}=this.options,K=D/(V*Math.pow(2,E)),Z=C.data,ee=[],ue=this.stride;for(let pe=0;pe<Z.length;pe+=ue){if(Z[pe+2]<=E)continue;Z[pe+2]=E;const ge=Z[pe],$e=Z[pe+1],We=C.within(Z[pe],Z[pe+1],K),Re=Z[pe+Ai];let qe=Re;for(const Ye of We){const vt=Ye*ue;Z[vt+2]>E&&(qe+=Z[vt+Ai])}if(qe>Re&&qe>=ie){let Ye,vt=ge*Re,Tt=$e*Re,pt=-1;const dt=((pe/ue|0)<<5)+(E+1)+this.points.length;for(const mi of We){const Et=mi*ue;if(Z[Et+2]<=E)continue;Z[Et+2]=E;const Yt=Z[Et+Ai];vt+=Z[Et]*Yt,Tt+=Z[Et+1]*Yt,Z[Et+4]=dt,$&&(Ye||(Ye=this._map(Z,pe,!0),pt=this.clusterProps.length,this.clusterProps.push(Ye)),$(Ye,this._map(Z,Et)))}Z[pe+4]=dt,ee.push(vt/qe,Tt/qe,1/0,dt,-1,qe),$&&ee.push(pt)}else{for(let Ye=0;Ye<ue;Ye++)ee.push(Z[pe+Ye]);if(qe>1)for(const Ye of We){const vt=Ye*ue;if(!(Z[vt+2]<=E)){Z[vt+2]=E;for(let Tt=0;Tt<ue;Tt++)ee.push(Z[vt+Tt])}}}}return ee}_getOriginId(C){return C-this.points.length>>5}_getOriginZoom(C){return(C-this.points.length)%32}_map(C,E,D){if(C[E+Ai]>1){const ie=this.clusterProps[C[E+cn]];return D?Object.assign({},ie):ie}const V=this.points[C[E+kt]].properties,$=this.options.map(V);return D&&$===V?Object.assign({},$):$}}function zn(O,C,E){return{type:"Feature",id:O[C+kt],properties:Gr(O,C,E),geometry:{type:"Point",coordinates:[(D=O[C],360*(D-.5)),ss(O[C+1])]}};var D}function Gr(O,C,E){const D=O[C+Ai],V=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D,$=O[C+cn],ie=$===-1?{}:Object.assign({},E[$]);return Object.assign(ie,{cluster:!0,cluster_id:O[C+kt],point_count:D,point_count_abbreviated:V})}function ur(O){return O/360+.5}function Ji(O){const C=Math.sin(O*Math.PI/180),E=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return E<0?0:E>1?1:E}function ss(O){const C=(180-360*O)*Math.PI/180;return 360*Math.atan(Math.exp(C))/Math.PI-90}function Hr(O,C,E,D){for(var V,$=D,ie=E-C>>1,K=E-C,Z=O[C],ee=O[C+1],ue=O[E],pe=O[E+1],ge=C+3;ge<E;ge+=3){var $e=as(O[ge],O[ge+1],Z,ee,ue,pe);if($e>$)V=ge,$=$e;else if($e===$){var We=Math.abs(ge-ie);We<K&&(V=ge,K=We)}}$>D&&(V-C>3&&Hr(O,C,V,D),O[V+2]=$,E-V>3&&Hr(O,V,E,D))}function as(O,C,E,D,V,$){var ie=V-E,K=$-D;if(ie!==0||K!==0){var Z=((O-E)*ie+(C-D)*K)/(ie*ie+K*K);Z>1?(E=V,D=$):Z>0&&(E+=ie*Z,D+=K*Z)}return(ie=O-E)*ie+(K=C-D)*K}function Ar(O,C,E,D){var V={id:O===void 0?null:O,type:C,geometry:E,tags:D,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($){var ie=$.geometry,K=$.type;if(K==="Point"||K==="MultiPoint"||K==="LineString")Dn($,ie);else if(K==="Polygon"||K==="MultiLineString")for(var Z=0;Z<ie.length;Z++)Dn($,ie[Z]);else if(K==="MultiPolygon")for(Z=0;Z<ie.length;Z++)for(var ee=0;ee<ie[Z].length;ee++)Dn($,ie[Z][ee])}(V),V}function Dn(O,C){for(var E=0;E<C.length;E+=3)O.minX=Math.min(O.minX,C[E]),O.minY=Math.min(O.minY,C[E+1]),O.maxX=Math.max(O.maxX,C[E]),O.maxY=Math.max(O.maxY,C[E+1])}function hn(O,C,E,D){if(C.geometry){var V=C.geometry.coordinates,$=C.geometry.type,ie=Math.pow(E.tolerance/((1<<E.maxZoom)*E.extent),2),K=[],Z=C.id;if(E.promoteId?Z=C.properties[E.promoteId]:E.generateId&&(Z=D||0),$==="Point")Wr(V,K);else if($==="MultiPoint")for(var ee=0;ee<V.length;ee++)Wr(V[ee],K);else if($==="LineString")Xr(V,K,ie,!1);else if($==="MultiLineString"){if(E.lineMetrics){for(ee=0;ee<V.length;ee++)Xr(V[ee],K=[],ie,!1),O.push(Ar(Z,"LineString",K,C.properties));return}un(V,K,ie,!1)}else if($==="Polygon")un(V,K,ie,!0);else{if($!=="MultiPolygon"){if($==="GeometryCollection"){for(ee=0;ee<C.geometry.geometries.length;ee++)hn(O,{id:Z,geometry:C.geometry.geometries[ee],properties:C.properties},E,D);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ee=0;ee<V.length;ee++){var ue=[];un(V[ee],ue,ie,!0),K.push(ue)}}O.push(Ar(Z,$,K,C.properties))}}function Wr(O,C){C.push(he(O[0])),C.push(ki(O[1])),C.push(0)}function Xr(O,C,E,D){for(var V,$,ie=0,K=0;K<O.length;K++){var Z=he(O[K][0]),ee=ki(O[K][1]);C.push(Z),C.push(ee),C.push(0),K>0&&(ie+=D?(V*ee-Z*$)/2:Math.sqrt(Math.pow(Z-V,2)+Math.pow(ee-$,2))),V=Z,$=ee}var ue=C.length-3;C[2]=1,Hr(C,0,ue,E),C[ue+2]=1,C.size=Math.abs(ie),C.start=0,C.end=C.size}function un(O,C,E,D){for(var V=0;V<O.length;V++){var $=[];Xr(O[V],$,E,D),C.push($)}}function he(O){return O/360+.5}function ki(O){var C=Math.sin(O*Math.PI/180),E=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return E<0?0:E>1?1:E}function Qi(O,C,E,D,V,$,ie,K){if(D/=C,$>=(E/=C)&&ie<D)return O;if(ie<E||$>=D)return null;for(var Z=[],ee=0;ee<O.length;ee++){var ue=O[ee],pe=ue.geometry,ge=ue.type,$e=V===0?ue.minX:ue.minY,We=V===0?ue.maxX:ue.maxY;if($e>=E&&We<D)Z.push(ue);else if(!(We<E||$e>=D)){var Re=[];if(ge==="Point"||ge==="MultiPoint")It(pe,Re,E,D,V);else if(ge==="LineString")ft(pe,Re,E,D,V,!1,K.lineMetrics);else if(ge==="MultiLineString")Ln(pe,Re,E,D,V,!1);else if(ge==="Polygon")Ln(pe,Re,E,D,V,!0);else if(ge==="MultiPolygon")for(var qe=0;qe<pe.length;qe++){var Ye=[];Ln(pe[qe],Ye,E,D,V,!0),Ye.length&&Re.push(Ye)}if(Re.length){if(K.lineMetrics&&ge==="LineString"){for(qe=0;qe<Re.length;qe++)Z.push(Ar(ue.id,ge,Re[qe],ue.tags));continue}ge!=="LineString"&&ge!=="MultiLineString"||(Re.length===1?(ge="LineString",Re=Re[0]):ge="MultiLineString"),ge!=="Point"&&ge!=="MultiPoint"||(ge=Re.length===3?"Point":"MultiPoint"),Z.push(Ar(ue.id,ge,Re,ue.tags))}}}return Z.length?Z:null}function It(O,C,E,D,V){for(var $=0;$<O.length;$+=3){var ie=O[$+V];ie>=E&&ie<=D&&(C.push(O[$]),C.push(O[$+1]),C.push(O[$+2]))}}function ft(O,C,E,D,V,$,ie){for(var K,Z,ee=_r(O),ue=V===0?zs:Rn,pe=O.start,ge=0;ge<O.length-3;ge+=3){var $e=O[ge],We=O[ge+1],Re=O[ge+2],qe=O[ge+3],Ye=O[ge+4],vt=V===0?$e:We,Tt=V===0?qe:Ye,pt=!1;ie&&(K=Math.sqrt(Math.pow($e-qe,2)+Math.pow(We-Ye,2))),vt<E?Tt>E&&(Z=ue(ee,$e,We,qe,Ye,E),ie&&(ee.start=pe+K*Z)):vt>D?Tt<D&&(Z=ue(ee,$e,We,qe,Ye,D),ie&&(ee.start=pe+K*Z)):kr(ee,$e,We,Re),Tt<E&&vt>=E&&(Z=ue(ee,$e,We,qe,Ye,E),pt=!0),Tt>D&&vt<=D&&(Z=ue(ee,$e,We,qe,Ye,D),pt=!0),!$&&pt&&(ie&&(ee.end=pe+K*Z),C.push(ee),ee=_r(O)),ie&&(pe+=K)}var dt=O.length-3;$e=O[dt],We=O[dt+1],Re=O[dt+2],(vt=V===0?$e:We)>=E&&vt<=D&&kr(ee,$e,We,Re),dt=ee.length-3,$&&dt>=3&&(ee[dt]!==ee[0]||ee[dt+1]!==ee[1])&&kr(ee,ee[0],ee[1],ee[2]),ee.length&&C.push(ee)}function _r(O){var C=[];return C.size=O.size,C.start=O.start,C.end=O.end,C}function Ln(O,C,E,D,V,$){for(var ie=0;ie<O.length;ie++)ft(O[ie],C,E,D,V,$,!1)}function kr(O,C,E,D){O.push(C),O.push(E),O.push(D)}function zs(O,C,E,D,V,$){var ie=($-C)/(D-C);return O.push($),O.push(E+(V-E)*ie),O.push(1),ie}function Rn(O,C,E,D,V,$){var ie=($-E)/(V-E);return O.push(C+(D-C)*ie),O.push($),O.push(1),ie}function Kr(O,C){for(var E=[],D=0;D<O.length;D++){var V,$=O[D],ie=$.type;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")V=dn($.geometry,C);else if(ie==="MultiLineString"||ie==="Polygon"){V=[];for(var K=0;K<$.geometry.length;K++)V.push(dn($.geometry[K],C))}else if(ie==="MultiPolygon")for(V=[],K=0;K<$.geometry.length;K++){for(var Z=[],ee=0;ee<$.geometry[K].length;ee++)Z.push(dn($.geometry[K][ee],C));V.push(Z)}E.push(Ar($.id,ie,V,$.tags))}return E}function dn(O,C){var E=[];E.size=O.size,O.start!==void 0&&(E.start=O.start,E.end=O.end);for(var D=0;D<O.length;D+=3)E.push(O[D]+C,O[D+1],O[D+2]);return E}function Te(O,C){if(O.transformed)return O;var E,D,V,$=1<<O.z,ie=O.x,K=O.y;for(E=0;E<O.features.length;E++){var Z=O.features[E],ee=Z.geometry,ue=Z.type;if(Z.geometry=[],ue===1)for(D=0;D<ee.length;D+=2)Z.geometry.push(yr(ee[D],ee[D+1],C,$,ie,K));else for(D=0;D<ee.length;D++){var pe=[];for(V=0;V<ee[D].length;V+=2)pe.push(yr(ee[D][V],ee[D][V+1],C,$,ie,K));Z.geometry.push(pe)}}return O.transformed=!0,O}function yr(O,C,E,D,V,$){return[Math.round(E*(O*D-V)),Math.round(E*(C*D-$))]}function jt(O,C,E,D,V){for(var $=C===V.maxZoom?0:V.tolerance/((1<<C)*V.extent),ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:E,y:D,z:C,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},K=0;K<O.length;K++){ie.numFeatures++,pn(ie,O[K],$,V);var Z=O[K].minX,ee=O[K].minY,ue=O[K].maxX,pe=O[K].maxY;Z<ie.minX&&(ie.minX=Z),ee<ie.minY&&(ie.minY=ee),ue>ie.maxX&&(ie.maxX=ue),pe>ie.maxY&&(ie.maxY=pe)}return ie}function pn(O,C,E,D){var V=C.geometry,$=C.type,ie=[];if($==="Point"||$==="MultiPoint")for(var K=0;K<V.length;K+=3)ie.push(V[K]),ie.push(V[K+1]),O.numPoints++,O.numSimplified++;else if($==="LineString")Pr(ie,V,O,E,!1,!1);else if($==="MultiLineString"||$==="Polygon")for(K=0;K<V.length;K++)Pr(ie,V[K],O,E,$==="Polygon",K===0);else if($==="MultiPolygon")for(var Z=0;Z<V.length;Z++){var ee=V[Z];for(K=0;K<ee.length;K++)Pr(ie,ee[K],O,E,!0,K===0)}if(ie.length){var ue=C.tags||null;if($==="LineString"&&D.lineMetrics){for(var pe in ue={},C.tags)ue[pe]=C.tags[pe];ue.mapbox_clip_start=V.start/V.size,ue.mapbox_clip_end=V.end/V.size}var ge={geometry:ie,type:$==="Polygon"||$==="MultiPolygon"?3:$==="LineString"||$==="MultiLineString"?2:1,tags:ue};C.id!==null&&(ge.id=C.id),O.features.push(ge)}}function Pr(O,C,E,D,V,$){var ie=D*D;if(D>0&&C.size<(V?ie:D))E.numPoints+=C.length/3;else{for(var K=[],Z=0;Z<C.length;Z+=3)(D===0||C[Z+2]>ie)&&(E.numSimplified++,K.push(C[Z]),K.push(C[Z+1])),E.numPoints++;V&&function(ee,ue){for(var pe=0,ge=0,$e=ee.length,We=$e-2;ge<$e;We=ge,ge+=2)pe+=(ee[ge]-ee[We])*(ee[ge+1]+ee[We+1]);if(pe>0===ue)for(ge=0,$e=ee.length;ge<$e/2;ge+=2){var Re=ee[ge],qe=ee[ge+1];ee[ge]=ee[$e-2-ge],ee[ge+1]=ee[$e-1-ge],ee[$e-2-ge]=Re,ee[$e-1-ge]=qe}}(K,$),O.push(K)}}function Ie(O,C){var E=(C=this.options=function(V,$){for(var ie in $)V[ie]=$[ie];return V}(Object.create(this.options),C)).debug;if(E&&console.time("preprocess data"),C.maxZoom<0||C.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(C.promoteId&&C.generateId)throw new Error("promoteId and generateId cannot be used together.");var D=function(V,$){var ie=[];if(V.type==="FeatureCollection")for(var K=0;K<V.features.length;K++)hn(ie,V.features[K],$,K);else hn(ie,V.type==="Feature"?V:{geometry:V},$);return ie}(O,C);this.tiles={},this.tileCoords=[],E&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",C.indexMaxZoom,C.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),D=function(V,$){var ie=$.buffer/$.extent,K=V,Z=Qi(V,1,-1-ie,ie,0,-1,2,$),ee=Qi(V,1,1-ie,2+ie,0,-1,2,$);return(Z||ee)&&(K=Qi(V,1,-ie,1+ie,0,-1,2,$)||[],Z&&(K=Kr(Z,1).concat(K)),ee&&(K=K.concat(Kr(ee,-1)))),K}(D,C),D.length&&this.splitTile(D,0,0,0),E&&(D.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function et(O,C,E){return 32*((1<<O)*E+C)+O}function Ke(O,C){return C?O.properties[C]:O.id}function wi(O,C){if(O==null)return!0;if(O.type==="Feature")return Ke(O,C)!=null;if(O.type==="FeatureCollection"){const E=new Set;for(const D of O.features){const V=Ke(D,C);if(V==null||E.has(V))return!1;E.add(V)}return!0}return!1}function xr(O,C){const E=new Map;if(O!=null)if(O.type==="Feature")E.set(Ke(O,C),O);else for(const D of O.features)E.set(Ke(D,C),D);return E}Ie.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ie.prototype.splitTile=function(O,C,E,D,V,$,ie){for(var K=[O,C,E,D],Z=this.options,ee=Z.debug;K.length;){D=K.pop(),E=K.pop(),C=K.pop(),O=K.pop();var ue=1<<C,pe=et(C,E,D),ge=this.tiles[pe];if(!ge&&(ee>1&&console.time("creation"),ge=this.tiles[pe]=jt(O,C,E,D,Z),this.tileCoords.push({z:C,x:E,y:D}),ee)){ee>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",C,E,D,ge.numFeatures,ge.numPoints,ge.numSimplified),console.timeEnd("creation"));var $e="z"+C;this.stats[$e]=(this.stats[$e]||0)+1,this.total++}if(ge.source=O,V){if(C===Z.maxZoom||C===V)continue;var We=1<<V-C;if(E!==Math.floor($/We)||D!==Math.floor(ie/We))continue}else if(C===Z.indexMaxZoom||ge.numPoints<=Z.indexMaxPoints)continue;if(ge.source=null,O.length!==0){ee>1&&console.time("clipping");var Re,qe,Ye,vt,Tt,pt,dt=.5*Z.buffer/Z.extent,mi=.5-dt,Et=.5+dt,Yt=1+dt;Re=qe=Ye=vt=null,Tt=Qi(O,ue,E-dt,E+Et,0,ge.minX,ge.maxX,Z),pt=Qi(O,ue,E+mi,E+Yt,0,ge.minX,ge.maxX,Z),O=null,Tt&&(Re=Qi(Tt,ue,D-dt,D+Et,1,ge.minY,ge.maxY,Z),qe=Qi(Tt,ue,D+mi,D+Yt,1,ge.minY,ge.maxY,Z),Tt=null),pt&&(Ye=Qi(pt,ue,D-dt,D+Et,1,ge.minY,ge.maxY,Z),vt=Qi(pt,ue,D+mi,D+Yt,1,ge.minY,ge.maxY,Z),pt=null),ee>1&&console.timeEnd("clipping"),K.push(Re||[],C+1,2*E,2*D),K.push(qe||[],C+1,2*E,2*D+1),K.push(Ye||[],C+1,2*E+1,2*D),K.push(vt||[],C+1,2*E+1,2*D+1)}}},Ie.prototype.getTile=function(O,C,E){var D=this.options,V=D.extent,$=D.debug;if(O<0||O>24)return null;var ie=1<<O,K=et(O,C=(C%ie+ie)%ie,E);if(this.tiles[K])return Te(this.tiles[K],V);$>1&&console.log("drilling down to z%d-%d-%d",O,C,E);for(var Z,ee=O,ue=C,pe=E;!Z&&ee>0;)ee--,ue=Math.floor(ue/2),pe=Math.floor(pe/2),Z=this.tiles[et(ee,ue,pe)];return Z&&Z.source?($>1&&console.log("found parent tile z%d-%d-%d",ee,ue,pe),$>1&&console.time("drilling down"),this.splitTile(Z.source,ee,ue,pe,O,C,E),$>1&&console.timeEnd("drilling down"),this.tiles[K]?Te(this.tiles[K],V):null):null};class Je extends Xe{constructor(C,E,D,V){super(C,E,D),this._dataUpdateable=new Map,this.loadGeoJSON=($,ie)=>{const{promoteId:K}=$;if($.request)return c.f($.request,(Z,ee,ue,pe)=>{this._dataUpdateable=wi(ee,K)?xr(ee,K):void 0,ie(Z,ee,ue,pe)});if(typeof $.data=="string")try{const Z=JSON.parse($.data);this._dataUpdateable=wi(Z,K)?xr(Z,K):void 0,ie(null,Z)}catch{ie(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}else $.dataDiff?this._dataUpdateable?(function(Z,ee,ue){var pe,ge,$e,We;if(ee.removeAll&&Z.clear(),ee.remove)for(const Re of ee.remove)Z.delete(Re);if(ee.add)for(const Re of ee.add){const qe=Ke(Re,ue);qe!=null&&Z.set(qe,Re)}if(ee.update)for(const Re of ee.update){let qe=Z.get(Re.id);if(qe==null)continue;const Ye=!Re.removeAllProperties&&(((pe=Re.removeProperties)===null||pe===void 0?void 0:pe.length)>0||((ge=Re.addOrUpdateProperties)===null||ge===void 0?void 0:ge.length)>0);if((Re.newGeometry||Re.removeAllProperties||Ye)&&(qe=Object.assign({},qe),Z.set(Re.id,qe),Ye&&(qe.properties=Object.assign({},qe.properties))),Re.newGeometry&&(qe.geometry=Re.newGeometry),Re.removeAllProperties)qe.properties={};else if((($e=Re.removeProperties)===null||$e===void 0?void 0:$e.length)>0)for(const vt of Re.removeProperties)Object.prototype.hasOwnProperty.call(qe.properties,vt)&&delete qe.properties[vt];if(((We=Re.addOrUpdateProperties)===null||We===void 0?void 0:We.length)>0)for(const{key:vt,value:Tt}of Re.addOrUpdateProperties)qe.properties[vt]=Tt}}(this._dataUpdateable,$.dataDiff,K),ie(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ie(new Error(`Cannot update existing geojson data in ${$.source}`)):ie(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,V&&(this.loadGeoJSON=V)}loadGeoJSONTile(C,E){const D=C.tileID.canonical;if(!this._geoJSONIndex)return E(null,null);const V=this._geoJSONIndex.getTile(D.z,D.x,D.y);if(!V)return E(null,null);const $=new class{constructor(K){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.N,this.length=K.length,this._features=K}feature(K){return new class{constructor(Z){this._feature=Z,this.extent=c.N,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(this._feature.type===1){const Z=[];for(const ee of this._feature.geometry)Z.push([new c.P(ee[0],ee[1])]);return Z}{const Z=[];for(const ee of this._feature.geometry){const ue=[];for(const pe of ee)ue.push(new c.P(pe[0],pe[1]));Z.push(ue)}return Z}}toGeoJSON(Z,ee,ue){return At.call(this,Z,ee,ue)}}(this._features[K])}}(V.features);let ie=rs($);ie.byteOffset===0&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),E(null,{vectorTile:$,rawData:ie.buffer})}loadData(C,E){var D;(D=this._pendingRequest)===null||D===void 0||D.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const V=!!(C&&C.request&&C.request.collectResourceTiming)&&new c.bu(C.request);this._pendingCallback=E,this._pendingRequest=this.loadGeoJSON(C,($,ie)=>{if(delete this._pendingCallback,delete this._pendingRequest,$||!ie)return E($);if(typeof ie!="object")return E(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`));{lt(ie,!0);try{if(C.filter){const Z=c.bC(C.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Z.result==="error")throw new Error(Z.value.map(ue=>`${ue.key}: ${ue.message}`).join(", "));ie={type:"FeatureCollection",features:ie.features.filter(ue=>Z.value.evaluate({zoom:0},ue))}}this._geoJSONIndex=C.cluster?new Pn(function({superclusterOptions:Z,clusterProperties:ee}){if(!ee||!Z)return Z;const ue={},pe={},ge={accumulated:null,zoom:0},$e={properties:null},We=Object.keys(ee);for(const Re of We){const[qe,Ye]=ee[Re],vt=c.bC(Ye),Tt=c.bC(typeof qe=="string"?[qe,["accumulated"],["get",Re]]:qe);ue[Re]=vt.value,pe[Re]=Tt.value}return Z.map=Re=>{$e.properties=Re;const qe={};for(const Ye of We)qe[Ye]=ue[Ye].evaluate(ge,$e);return qe},Z.reduce=(Re,qe)=>{$e.properties=qe;for(const Ye of We)ge.accumulated=Re[Ye],Re[Ye]=pe[Ye].evaluate(ge,$e)},Z}(C)).load(ie.features):function(Z,ee){return new Ie(Z,ee)}(ie,C.geojsonVtOptions)}catch(Z){return E(Z)}this.loaded={};const K={};if(V){const Z=V.finish();Z&&(K.resourceTiming={},K.resourceTiming[C.source]=JSON.parse(JSON.stringify(Z)))}E(null,K)}})}reloadTile(C,E){const D=this.loaded;return D&&D[C.uid]?super.reloadTile(C,E):this.loadTile(C,E)}removeSource(C,E){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),E()}getClusterExpansionZoom(C,E){try{E(null,this._geoJSONIndex.getClusterExpansionZoom(C.clusterId))}catch(D){E(D)}}getClusterChildren(C,E){try{E(null,this._geoJSONIndex.getChildren(C.clusterId))}catch(D){E(D)}}getClusterLeaves(C,E){try{E(null,this._geoJSONIndex.getLeaves(C.clusterId,C.limit,C.offset))}catch(D){E(D)}}}class zr{constructor(C){this.self=C,this.actor=new c.C(C,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Xe,geojson:Je},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(E,D)=>{if(this.workerSourceTypes[E])throw new Error(`Worker source with name "${E}" already registered.`);this.workerSourceTypes[E]=D},this.self.registerRTLTextPlugin=E=>{if(c.bD.isParsed())throw new Error("RTL text plugin already registered.");c.bD.applyArabicShaping=E.applyArabicShaping,c.bD.processBidirectionalText=E.processBidirectionalText,c.bD.processStyledBidirectionalText=E.processStyledBidirectionalText}}setReferrer(C,E){this.referrer=E}setImages(C,E,D){this.availableImages[C]=E;for(const V in this.workerSources[C]){const $=this.workerSources[C][V];for(const ie in $)$[ie].availableImages=E}D()}setLayers(C,E,D){this.getLayerIndex(C).replace(E),D()}updateLayers(C,E,D){this.getLayerIndex(C).update(E.layers,E.removedIds),D()}loadTile(C,E,D){this.getWorkerSource(C,E.type,E.source).loadTile(E,D)}loadDEMTile(C,E,D){this.getDEMWorkerSource(C,E.source).loadTile(E,D)}reloadTile(C,E,D){this.getWorkerSource(C,E.type,E.source).reloadTile(E,D)}abortTile(C,E,D){this.getWorkerSource(C,E.type,E.source).abortTile(E,D)}removeTile(C,E,D){this.getWorkerSource(C,E.type,E.source).removeTile(E,D)}removeDEMTile(C,E){this.getDEMWorkerSource(C,E.source).removeTile(E)}removeSource(C,E,D){if(!this.workerSources[C]||!this.workerSources[C][E.type]||!this.workerSources[C][E.type][E.source])return;const V=this.workerSources[C][E.type][E.source];delete this.workerSources[C][E.type][E.source],V.removeSource!==void 0?V.removeSource(E,D):D()}loadWorkerSource(C,E,D){try{this.self.importScripts(E.url),D()}catch(V){D(V.toString())}}syncRTLPluginState(C,E,D){try{c.bD.setState(E);const V=c.bD.getPluginURL();if(c.bD.isLoaded()&&!c.bD.isParsed()&&V!=null){this.self.importScripts(V);const $=c.bD.isParsed();D($?void 0:new Error(`RTL Text Plugin failed to import scripts from ${V}`),$)}}catch(V){D(V.toString())}}getAvailableImages(C){let E=this.availableImages[C];return E||(E=[]),E}getLayerIndex(C){let E=this.layerIndexes[C];return E||(E=this.layerIndexes[C]=new xe),E}getWorkerSource(C,E,D){return this.workerSources[C]||(this.workerSources[C]={}),this.workerSources[C][E]||(this.workerSources[C][E]={}),this.workerSources[C][E][D]||(this.workerSources[C][E][D]=new this.workerSourceTypes[E]({send:(V,$,ie)=>{this.actor.send(V,$,ie,C)}},this.getLayerIndex(C),this.getAvailableImages(C))),this.workerSources[C][E][D]}getDEMWorkerSource(C,E){return this.demWorkerSources[C]||(this.demWorkerSources[C]={}),this.demWorkerSources[C][E]||(this.demWorkerSources[C][E]=new it),this.demWorkerSources[C][E]}}return c.i()&&(self.worker=new zr(self)),zr}),ae(["./shared"],function(c){var xe="3.6.2";class H{static testProp(t){if(!H.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in H.docStyle)return t[n];return t[0]}static create(t,n,a){const l=window.document.createElement(t);return n!==void 0&&(l.className=n),a&&a.appendChild(l),l}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){H.docStyle&&H.selectProp&&(H.userSelect=H.docStyle[H.selectProp],H.docStyle[H.selectProp]="none")}static enableDrag(){H.docStyle&&H.selectProp&&(H.docStyle[H.selectProp]=H.userSelect)}static setTransform(t,n){t.style[H.transformProp]=n}static addEventListener(t,n,a,l={}){t.addEventListener(n,a,"passive"in l?l:l.capture)}static removeEventListener(t,n,a,l={}){t.removeEventListener(n,a,"passive"in l?l:l.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",H.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",H.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",H.suppressClickInternal,!0)},0)}static mousePos(t,n){const a=t.getBoundingClientRect();return new c.P(n.clientX-a.left-t.clientLeft,n.clientY-a.top-t.clientTop)}static touchPos(t,n){const a=t.getBoundingClientRect(),l=[];for(let d=0;d<n.length;d++)l.push(new c.P(n[d].clientX-a.left-t.clientLeft,n[d].clientY-a.top-t.clientTop));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}H.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,H.selectProp=H.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),H.transformProp=H.testProp(["transform","WebkitTransform"]);const Ve={supported:!1,testSupport:function(h){!Xe&&Ae&&(it?yt(h):He=h)}};let He,Ae,Xe=!1,it=!1;function yt(h){const t=h.createTexture();h.bindTexture(h.TEXTURE_2D,t);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Ae),h.isContextLost())return;Ve.supported=!0}catch{}h.deleteTexture(t),Xe=!0}var xt,lt;typeof document<"u"&&(Ae=document.createElement("img"),Ae.onload=function(){He&&yt(He),He=null,it=!0},Ae.onerror=function(){Xe=!0,He=null},Ae.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(h){let t,n,a,l;h.resetRequestQueue=()=>{t=[],n=0,a=0,l={}},h.addThrottleControl=v=>{const w=a++;return l[w]=v,w},h.removeThrottleControl=v=>{delete l[v],g()},h.getImage=(v,w,S=!0)=>{Ve.supported&&(v.headers||(v.headers={}),v.headers.accept="image/webp,*/*");const A={requestParameters:v,supportImageRefresh:S,callback:w,cancelled:!1,completed:!1,cancel:()=>{A.completed||A.cancelled||(A.cancelled=!0,A.innerRequest&&(A.innerRequest.cancel(),n--),g())}};return t.push(A),g(),A};const d=v=>{const{requestParameters:w,supportImageRefresh:S,callback:A}=v;return c.e(w,{type:"image"}),(S!==!1||c.i()||c.g(w.url)||w.headers&&!Object.keys(w.headers).reduce((F,B)=>F&&B==="accept",!0)?c.m:y)(w,(F,B,N,L)=>{m(v,A,F,B,N,L)})},m=(v,w,S,A,F,B)=>{S?w(S):A instanceof HTMLImageElement||c.a(A)?w(null,A):A&&((N,L)=>{typeof createImageBitmap=="function"?c.b(N,L):c.d(N,L)})(A,(N,L)=>{N!=null?w(N):L!=null&&w(null,L,{cacheControl:F,expires:B})}),v.cancelled||(v.completed=!0,n--,g())},g=()=>{const v=(()=>{const w=Object.keys(l);let S=!1;if(w.length>0){for(const A of w)if(S=l[A](),S)break}return S})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let w=n;w<v&&t.length>0;w++){const S=t.shift();if(S.cancelled){w--;continue}const A=d(S);n++,S.innerRequest=A}},y=(v,w)=>{const S=new Image,A=v.url;let F=!1;const B=v.credentials;return B&&B==="include"?S.crossOrigin="use-credentials":(B&&B==="same-origin"||!c.s(A))&&(S.crossOrigin="anonymous"),S.fetchPriority="high",S.onload=()=>{w(null,S),S.onerror=S.onload=null},S.onerror=()=>{F||w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),S.onerror=S.onload=null},S.src=A,{cancel:()=>{F=!0,S.src=""}}}}(xt||(xt={})),xt.resetRequestQueue(),function(h){h.Glyphs="Glyphs",h.Image="Image",h.Source="Source",h.SpriteImage="SpriteImage",h.SpriteJSON="SpriteJSON",h.Style="Style",h.Tile="Tile",h.Unknown="Unknown"}(lt||(lt={}));class At{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,a){const l=function(d){const m=d.match(bt);if(!m)throw new Error(`Unable to parse URL "${d}"`);return{protocol:m[1],authority:m[2],path:m[3]||"/",params:m[4]?m[4].split("&"):[]}}(t);return l.path+=`${n}${a}`,function(d){const m=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${m}`}(l)}setTransformRequest(t){this._transformRequestFn=t}}const bt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function nt(h){var t=new c.A(3);return t[0]=h[0],t[1]=h[1],t[2]=h[2],t}var ut,li=function(h,t,n){return h[0]=t[0]-n[0],h[1]=t[1]-n[1],h[2]=t[2]-n[2],h};ut=new c.A(3),c.A!=Float32Array&&(ut[0]=0,ut[1]=0,ut[2]=0);var cr=function(h){var t=h[0],n=h[1];return t*t+n*n};function ci(h){const t=[];if(typeof h=="string")t.push({id:"default",url:h});else if(h&&h.length>0){const n=[];for(const{id:a,url:l}of h){const d=`${a}${l}`;n.indexOf(d)===-1&&(n.push(d),t.push({id:a,url:l}))}}return t}function ks(h,t,n,a,l){if(a)return void h(a);if(l!==Object.values(t).length||l!==Object.values(n).length)return;const d={};for(const m in t){d[m]={};const g=c.h.getImageCanvasContext(n[m]),y=t[m];for(const v in y){const{width:w,height:S,x:A,y:F,sdf:B,pixelRatio:N,stretchX:L,stretchY:J,content:ne}=y[v];d[m][v]={data:null,pixelRatio:N,sdf:B,stretchX:L,stretchY:J,content:ne,spriteData:{width:w,height:S,x:A,y:F,context:g}}}}h(null,d)}(function(){var h=new c.A(2);c.A!=Float32Array&&(h[0]=0,h[1]=0)})();class Bt{constructor(t,n,a,l){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(n,l)}update(t,n,a){const{width:l,height:d}=t,m=!(this.size&&this.size[0]===l&&this.size[1]===d||a),{context:g}=this,{gl:y}=g;if(this.useMipmap=!!(n&&n.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),m)this.size=[l,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||c.a(t)?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,t):y.texImage2D(y.TEXTURE_2D,0,this.format,l,d,0,this.format,y.UNSIGNED_BYTE,t.data);else{const{x:v,y:w}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||c.a(t)?y.texSubImage2D(y.TEXTURE_2D,0,v,w,y.RGBA,y.UNSIGNED_BYTE,t):y.texSubImage2D(y.TEXTURE_2D,0,v,w,l,d,y.RGBA,y.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)}bind(t,n,a){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||t),this.filter=t),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function kn(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class hr extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:a}of this.requestors)this._notify(n,a);this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let a=!0;const l=n.data||n.spriteData;return this._validateStretch(n.stretchX,l&&l.width)||(this.fire(new c.j(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,l&&l.height)||(this.fire(new c.j(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new c.j(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,n){if(!t)return!0;let a=0;for(const l of t){if(l[0]<a||l[1]<l[0]||n<l[1])return!1;a=l[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const a=n.spriteData,l=a&&a.width||n.data.width,d=a&&a.height||n.data.height;return!(t[0]<0||l<t[0]||t[1]<0||d<t[1]||t[2]<0||l<t[2]||t[3]<0||d<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,a=!0){const l=this.getImage(t);if(a&&(l.data.width!==n.data.width||l.data.height!==n.data.height))throw new Error(`size mismatch between old image (${l.data.width}x${l.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=l.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let a=!0;if(!this.isLoaded())for(const l of t)this.images[l]||(a=!1);this.isLoaded()||a?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const a={};for(const l of t){let d=this.getImage(l);d||(this.fire(new c.k("styleimagemissing",{id:l})),d=this.getImage(l)),d?a[l]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:c.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,a)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],a=this.getImage(t);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new c.I(l,a);this.patterns[t]={bin:l,position:d}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Bt(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const d in this.patterns)t.push(this.patterns[d].bin);const{w:n,h:a}=c.p(t),l=this.atlasImage;l.resize({width:n||1,height:a||1});for(const d in this.patterns){const{bin:m}=this.patterns[d],g=m.x+1,y=m.y+1,v=this.getImage(d).data,w=v.width,S=v.height;c.R.copy(v,l,{x:0,y:0},{x:g,y},{width:w,height:S}),c.R.copy(v,l,{x:0,y:S-1},{x:g,y:y-1},{width:w,height:1}),c.R.copy(v,l,{x:0,y:0},{x:g,y:y+S},{width:w,height:1}),c.R.copy(v,l,{x:w-1,y:0},{x:g-1,y},{width:1,height:S}),c.R.copy(v,l,{x:0,y:0},{x:g+w,y},{width:1,height:S})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||c.w(`Image with ID: "${n}" was not found`),kn(a)&&this.updateImage(n,a)}}}const Zr=1e20;function bi(h,t,n,a,l,d,m,g,y){for(let v=t;v<t+a;v++)Ni(h,n*d+v,d,l,m,g,y);for(let v=n;v<n+l;v++)Ni(h,v*d+t,1,a,m,g,y)}function Ni(h,t,n,a,l,d,m){d[0]=0,m[0]=-Zr,m[1]=Zr,l[0]=h[t];for(let g=1,y=0,v=0;g<a;g++){l[g]=h[t+g*n];const w=g*g;do{const S=d[y];v=(l[g]-l[S]+w-S*S)/(g-S)/2}while(v<=m[y]&&--y>-1);y++,d[y]=g,m[y]=v,m[y+1]=Zr}for(let g=0,y=0;g<a;g++){for(;m[y+1]<g;)y++;const v=d[y],w=g-v;h[t+g*n]=l[v]+w*w}}class Mr{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const a=[];for(const l in t)for(const d of t[l])a.push({stack:l,id:d});c.o(a,({stack:l,id:d},m)=>{let g=this.entries[l];g||(g=this.entries[l]={glyphs:{},requests:{},ranges:{}});let y=g.glyphs[d];if(y!==void 0)return void m(null,{stack:l,id:d,glyph:y});if(y=this._tinySDF(g,l,d),y)return g.glyphs[d]=y,void m(null,{stack:l,id:d,glyph:y});const v=Math.floor(d/256);if(256*v>65535)return void m(new Error("glyphs > 65535 not supported"));if(g.ranges[v])return void m(null,{stack:l,id:d,glyph:y});if(!this.url)return void m(new Error("glyphsUrl is not set"));let w=g.requests[v];w||(w=g.requests[v]=[],Mr.loadGlyphRange(l,v,this.url,this.requestManager,(S,A)=>{if(A){for(const F in A)this._doesCharSupportLocalGlyph(+F)||(g.glyphs[+F]=A[+F]);g.ranges[v]=!0}for(const F of w)F(S,A);delete g.requests[v]})),w.push((S,A)=>{S?m(S):A&&m(null,{stack:l,id:d,glyph:A[d]||null})})},(l,d)=>{if(l)n(l);else if(d){const m={};for(const{stack:g,id:y,glyph:v}of d)(m[g]||(m[g]={}))[y]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics};n(null,m)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(c.u["CJK Unified Ideographs"](t)||c.u["Hangul Syllables"](t)||c.u.Hiragana(t)||c.u.Katakana(t))}_tinySDF(t,n,a){const l=this.localIdeographFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let d=t.tinySDF;if(!d){let g="400";/bold/i.test(n)?g="900":/medium/i.test(n)?g="500":/light/i.test(n)&&(g="200"),d=t.tinySDF=new Mr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:g})}const m=d.draw(String.fromCharCode(a));return{id:a,bitmap:new c.q({width:m.width||60,height:m.height||60},m.data),metrics:{width:m.glyphWidth/2||24,height:m.glyphHeight/2||24,left:m.glyphLeft/2+.5||0,top:m.glyphTop/2-27.5||-8,advance:m.glyphAdvance/2||24,isDoubleResolution:!0}}}}Mr.loadGlyphRange=function(h,t,n,a,l){const d=256*t,m=d+255,g=a.transformRequest(n.replace("{fontstack}",h).replace("{range}",`${d}-${m}`),lt.Glyphs);c.l(g,(y,v)=>{if(y)l(y);else if(v){const w={};for(const S of c.n(v))w[S.id]=S;l(null,w)}})},Mr.TinySDF=class{constructor({fontSize:h=24,buffer:t=3,radius:n=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=n;const g=this.size=h+4*t,y=this._createCanvas(g),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${m} ${d} ${h}px ${l}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(h){const t=document.createElement("canvas");return t.width=t.height=h,t}draw(h){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(h),m=Math.ceil(n),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),y=Math.min(this.size-this.buffer,m+Math.ceil(a)),v=g+2*this.buffer,w=y+2*this.buffer,S=Math.max(v*w,0),A=new Uint8ClampedArray(S),F={data:A,width:v,height:w,glyphWidth:g,glyphHeight:y,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(g===0||y===0)return F;const{ctx:B,buffer:N,gridInner:L,gridOuter:J}=this;B.clearRect(N,N,g,y),B.fillText(h,N,N+m);const ne=B.getImageData(N,N,g,y);J.fill(Zr,0,S),L.fill(0,0,S);for(let U=0;U<y;U++)for(let Q=0;Q<g;Q++){const oe=ne.data[4*(U*g+Q)+3]/255;if(oe===0)continue;const le=(U+N)*v+Q+N;if(oe===1)J[le]=0,L[le]=Zr;else{const fe=.5-oe;J[le]=fe>0?fe*fe:0,L[le]=fe<0?fe*fe:0}}bi(J,0,0,v,w,v,this.f,this.v,this.z),bi(L,N,N,g,y,v,this.f,this.v,this.z);for(let U=0;U<S;U++){const Q=Math.sqrt(J[U])-Math.sqrt(L[U]);A[U]=Math.round(255-255*(Q/this.radius+this.cutoff))}return F}};class Yi{constructor(){this.specification=c.v.light.position}possiblyEvaluate(t,n){return c.z(t.expression.evaluate(n))}interpolate(t,n,a){return{x:c.B.number(t.x,n.x,a),y:c.B.number(t.y,n.y,a),z:c.B.number(t.z,n.z,a)}}}let ln;class rs extends c.E{constructor(t){super(),ln=ln||new c.r({anchor:new c.D(c.v.light.anchor),position:new Yi,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(ln),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(c.t,t,n))for(const a in t){const l=t[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,a){return(!a||a.validate!==!1)&&c.x(this,t.call(c.y,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}}class Ps{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const a=t.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,n)),this.dashEntry[a]}getDashRanges(t,n,a){const l=[];let d=t.length%2==1?-t[t.length-1]*a:0,m=t[0]*a,g=!0;l.push({left:d,right:m,isDash:g,zeroLength:t[0]===0});let y=t[0];for(let v=1;v<t.length;v++){g=!g;const w=t[v];d=y*a,y+=w,m=y*a,l.push({left:d,right:m,isDash:g,zeroLength:w===0})}return l}addRoundDash(t,n,a){const l=n/2;for(let d=-a;d<=a;d++){const m=this.width*(this.nextRow+a+d);let g=0,y=t[g];for(let v=0;v<this.width;v++){v/y.right>1&&(y=t[++g]);const w=Math.abs(v-y.left),S=Math.abs(v-y.right),A=Math.min(w,S);let F;const B=d/a*(l+1);if(y.isDash){const N=l-Math.abs(B);F=Math.sqrt(A*A+N*N)}else F=l-Math.sqrt(A*A+B*B);this.data[m+v]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(t){for(let g=t.length-1;g>=0;--g){const y=t[g],v=t[g+1];y.zeroLength?t.splice(g,1):v&&v.isDash===y.isDash&&(v.left=y.left,t.splice(g,1))}const n=t[0],a=t[t.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let d=0,m=t[d];for(let g=0;g<this.width;g++){g/m.right>1&&(m=t[++d]);const y=Math.abs(g-m.left),v=Math.abs(g-m.right),w=Math.min(y,v);this.data[l+g]=Math.max(0,Math.min(255,(m.isDash?w:-w)+128))}}addDash(t,n){const a=n?7:0,l=2*a+1;if(this.nextRow+l>this.height)return c.w("LineAtlas out of space"),null;let d=0;for(let g=0;g<t.length;g++)d+=t[g];if(d!==0){const g=this.width/d,y=this.getDashRanges(t,this.width,g);n?this.addRoundDash(y,g,a):this.addRegularDash(y)}const m={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:d};return this.nextRow+=l,this.dirty=!0,m}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class ns{constructor(t,n,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const l=this.workerPool.acquire(a);for(let d=0;d<l.length;d++){const m=new c.C(l[d],n,a);m.name=`Worker ${d}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,a){c.o(this.actors,(l,d)=>{l.send(t,n,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function gr(h,t,n){const a=function(l,d){if(l)return n(l);if(d){const m=c.F(c.e(d,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(m.vectorLayers=d.vector_layers,m.vectorLayerIds=m.vectorLayers.map(g=>g.id)),n(null,m)}};return h.url?c.f(t.transformRequest(h.url,lt.Source),a):c.h.frame(()=>a(null,h))}class kt{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof c.L?new c.L(t.lng,t.lat):c.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof c.L?new c.L(t.lng,t.lat):c.L.convert(t),this}extend(t){const n=this._sw,a=this._ne;let l,d;if(t instanceof c.L)l=t,d=t;else{if(!(t instanceof kt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(kt.convert(t)):this.extend(c.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(c.L.convert(t)):this;if(l=t._sw,d=t._ne,!l||!d)return this}return n||a?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new c.L(l.lng,l.lat),this._ne=new c.L(d.lng,d.lat)),this}getCenter(){return new c.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.L(this.getWest(),this.getNorth())}getSouthEast(){return new c.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:a}=c.L.convert(t);let l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(t){return t instanceof kt?t:t&&new kt(t)}static fromLngLat(t,n=0){const a=360*n/40075017,l=a/Math.cos(Math.PI/180*t.lat);return new kt(new c.L(t.lng-l,t.lat-a),new c.L(t.lng+l,t.lat+a))}}class Ai{constructor(t,n,a){this.bounds=kt.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),a=Math.floor(c.G(this.bounds.getWest())*n),l=Math.floor(c.H(this.bounds.getNorth())*n),d=Math.ceil(c.G(this.bounds.getEast())*n),m=Math.ceil(c.H(this.bounds.getSouth())*n);return t.x>=a&&t.x<d&&t.y>=l&&t.y<m}}class cn extends c.E{constructor(t,n,a,l){if(super(),this.load=()=>{this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=gr(this._options,this.map._requestManager,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),d?this.fire(new c.j(d)):m&&(c.e(this,m),m.bounds&&(this.tileBounds=new Ai(m.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>c.e({},this._options),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.F(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,n){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(a,lt.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function d(m,g){return delete t.request,t.aborted?n(null):m&&m.status!==404?n(m):(g&&g.resourceTiming&&(t.resourceTiming=g.resourceTiming),this.map._refreshExpiredTiles&&g&&t.setExpiryData(g),t.loadVectorData(g,this.map.painter),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",l,d.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",l,d.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Pn extends c.E{constructor(t,n,a,l){super(),this.id=t,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.F(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=gr(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new c.j(t)):n&&(c.e(this,n),n.bounds&&(this.tileBounds=new Ai(n.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return c.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=xt.getImage(this.map._requestManager.transformRequest(a,lt.Tile),(l,d,m)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(l)t.state="errored",n(l);else if(d){this.map._refreshExpiredTiles&&m&&t.setExpiryData(m);const g=this.map.painter.context,y=g.gl;t.texture=this.map.painter.getTileTexture(d.width),t.texture?t.texture.update(d,{useMipmap:!0}):(t.texture=new Bt(g,d,y.RGBA,{useMipmap:!0}),t.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&y.texParameterf(y.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),t.state="loaded",n(null)}},this.map._refreshExpiredTiles)}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}class zn extends Pn{constructor(t,n,a,l){super(t,n,a,l),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t,n){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(a,lt.Tile);function d(m,g){m&&(t.state="errored",n(m)),g&&(t.dem=g,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=xt.getImage(l,(m,g,y)=>c._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(m)t.state="errored",n(m);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(y);const v=c.a(g)&&c.J()?g:yield function(S){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.K()){const A=S.width+2,F=S.height+2;try{return new c.R({width:A,height:F},yield c.M(S,-1,-1,A,F))}catch{}}return c.h.getImageData(S,1)})}(g),w={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",w,d))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const n=t.canonical,a=Math.pow(2,n.z),l=(n.x-1+a)%a,d=n.x===0?t.wrap-1:t.wrap,m=(n.x+1+a)%a,g=n.x+1===a?t.wrap+1:t.wrap,y={};return y[new c.O(t.overscaledZ,d,n.z,l,n.y).key]={backfilled:!1},y[new c.O(t.overscaledZ,g,n.z,m,n.y).key]={backfilled:!1},n.y>0&&(y[new c.O(t.overscaledZ,d,n.z,l,n.y-1).key]={backfilled:!1},y[new c.O(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},y[new c.O(t.overscaledZ,g,n.z,m,n.y-1).key]={backfilled:!1}),n.y+1<a&&(y[new c.O(t.overscaledZ,d,n.z,l,n.y+1).key]={backfilled:!1},y[new c.O(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},y[new c.O(t.overscaledZ,g,n.z,m,n.y+1).key]={backfilled:!1}),y}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Gr extends c.E{constructor(t,n,a,l){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>c.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(l),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=c.N/this.tileSize;this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*d,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*d,extent:c.N,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.N,radius:(n.clusterRadius||50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,a,l){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:a},l),this}_updateWorkerData(t){const n=c.e({},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(c.h.resolveURL(this._data),lt.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(a,l)=>{if(this._pendingLoads--,this._removed||l&&l.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let d=null;if(l&&l.resourceTiming&&l.resourceTiming[this.id]&&(d=l.resourceTiming[this.id].slice(0)),a)return void this.fire(new c.j(a));const m={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&c.e(m,{resourceTiming:d}),this.fire(new c.k("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const a=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(a,l,(d,m)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):d?n(d):(t.loadVectorData(m,this.map.painter,a==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ur=c.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ji extends c.E{constructor(t,n,a,l){super(),this.load=(d,m)=>{this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=xt.getImage(this.map._requestManager.transformRequest(this.url,lt.Image),(g,y)=>{this._request=null,this._loaded=!0,g?this.fire(new c.j(g)):y&&(this.image=y,d&&(this.coordinates=d),m&&m(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,ur.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Bt(d,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));let g=!1;for(const y in this.tiles){const v=this.tiles[y];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,g=!0)}g&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(l),this.options=n}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(c.U.fromLngLat);this.tileID=function(l){let d=1/0,m=1/0,g=-1/0,y=-1/0;for(const A of l)d=Math.min(d,A.x),m=Math.min(m,A.y),g=Math.max(g,A.x),y=Math.max(y,A.y);const v=Math.max(g-d,y-m),w=Math.max(0,Math.floor(-Math.log(v)/Math.LN2)),S=Math.pow(2,w);return new c.W(w,Math.floor((d+g)/2*S),Math.floor((m+y)/2*S))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(l=>this.tileID.getTilePoint(l)._round());return this._boundsArray=new c.V,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,c.N,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,c.N),this._boundsArray.emplaceBack(a[2].x,a[2].y,c.N,c.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}hasTransition(){return!1}}class ss extends Ji{constructor(t,n,a,l){super(t,n,a,l),this.load=()=>{this._loaded=!1;const d=this.options;this.urls=[];for(const m of d.urls)this.urls.push(this.map._requestManager.transformRequest(m,lt.Source).url);c.X(this.urls,(m,g)=>{this._loaded=!0,m?this.fire(new c.j(m)):g&&(this.video=g,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,ur.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new Bt(d,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));let g=!1;for(const y in this.tiles){const v=this.tiles[y];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,g=!0)}g&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=n}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new c.j(new c.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Hr extends Ji{constructor(t,n,a,l){super(t,n,a,l),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const m=this.map.painter.context,g=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,ur.members)),this.boundsSegments||(this.boundsSegments=c.S.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Bt(m,this.canvas,g.RGBA,{premultiply:!0});let y=!1;for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,y=!0)}y&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(m=>typeof m!="number"))||this.fire(new c.j(new c.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.Y(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.j(new c.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const as={},Ar=h=>{switch(h){case"geojson":return Gr;case"image":return Ji;case"raster":return Pn;case"raster-dem":return zn;case"vector":return cn;case"video":return ss;case"canvas":return Hr}return as[h]};function Dn(h,t){const n=c.Z();return c.$(n,n,[1,1,0]),c.a0(n,n,[.5*h.width,.5*h.height,1]),c.a1(n,n,h.calculatePosMatrix(t.toUnwrapped()))}function hn(h,t,n,a,l,d){const m=function(S,A,F){if(S)for(const B of S){const N=A[B];if(N&&N.source===F&&N.type==="fill-extrusion")return!0}else for(const B in A){const N=A[B];if(N.source===F&&N.type==="fill-extrusion")return!0}return!1}(l&&l.layers,t,h.id),g=d.maxPitchScaleFactor(),y=h.tilesIn(a,g,m);y.sort(Wr);const v=[];for(const S of y)v.push({wrappedTileID:S.tileID.wrapped().key,queryResults:S.tile.queryRenderedFeatures(t,n,h._state,S.queryGeometry,S.cameraQueryGeometry,S.scale,l,d,g,Dn(h.transform,S.tileID))});const w=function(S){const A={},F={};for(const B of S){const N=B.queryResults,L=B.wrappedTileID,J=F[L]=F[L]||{};for(const ne in N){const U=N[ne],Q=J[ne]=J[ne]||{},oe=A[ne]=A[ne]||[];for(const le of U)Q[le.featureIndex]||(Q[le.featureIndex]=!0,oe.push(le))}}return A}(v);for(const S in w)w[S].forEach(A=>{const F=A.feature,B=h.getFeatureState(F.layer["source-layer"],F.id);F.source=F.layer.source,F.layer["source-layer"]&&(F.sourceLayer=F.layer["source-layer"]),F.state=B});return w}function Wr(h,t){const n=h.tileID,a=t.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}class Xr{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=c.a2(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(l,d){const m={};if(!d)return m;for(const g of l){const y=g.layerIds.map(v=>d.getLayer(v)).filter(Boolean);if(y.length!==0){g.layers=y,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(v=>y.filter(w=>w.id===v)[0]));for(const v of y)m[v.id]=g}}return m}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const d=this.buckets[l];if(d instanceof c.a4){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const d=this.buckets[l];if(d instanceof c.a4&&d.hasRTLText){this.hasRTLText=!0,c.a5();break}}this.queryPadding=0;for(const l in this.buckets){const d=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(l).queryRadius(d))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new c.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Bt(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Bt(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,a,l,d,m,g,y,v,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:d,scale:m,tileSize:this.tileSize,pixelPosMatrix:w,transform:y,params:g,queryPadding:this.queryPadding*v},t,n,a):{}}querySourceFeatures(t,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),d=n&&n.sourceLayer?n.sourceLayer:"",m=l._geojsonTileLayer||l[d];if(!m)return;const g=c.a6(n&&n.filter),{z:y,x:v,y:w}=this.tileID.canonical,S={z:y,x:v,y:w};for(let A=0;A<m.length;A++){const F=m.feature(A);if(g.needGeometry){const L=c.a7(F,!0);if(!g.filter(new c.a8(this.tileID.overscaledZ),L,this.tileID.canonical))continue}else if(!g.filter(new c.a8(this.tileID.overscaledZ),F))continue;const B=a.getId(F,d),N=new c.a9(F,y,v,w,B);N.tile=S,t.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const a=c.aa(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{const d=this.expirationTime-n;d?this.expirationTime=a+Math.max(d,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const l in this.buckets){if(!n.style.hasLayer(l))continue;const d=this.buckets[l],m=d.layers[0].sourceLayer||"_geojsonTileLayer",g=a[m],y=t[m];if(!g||!y||Object.keys(y).length===0)continue;d.update(y,g,this.imageAtlas&&this.imageAtlas.patternPositions||{});const v=n&&n.style&&n.style.getLayer(l);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=c.h.now()+t}setDependencies(t,n){const a={};for(const l of n)a[l]=!0;this.dependencies[t]=a}hasDependency(t,n){for(const a of t){const l=this.dependencies[a];if(l){for(const d of n)if(l[d])return!0}}return!1}}class un{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,a){const l=t.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const d={value:n,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(t,d)},a)),this.data[l].push(d),this.order.push(l),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const a=t.wrapped().key,l=n===void 0?0:this.data[a].indexOf(n),d=this.data[a][l];return this.data[a].splice(l,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const a in this.data)for(const l of this.data[a])t(l.value)||n.push(l);for(const a of n)this.remove(a.value.tileID,a)}}class he{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,a){const l=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][l]=this.stateChanges[t][l]||{},c.e(this.stateChanges[t][l],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const d in this.state[t])d!==l&&(this.deletedStates[t][d]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][l]===null){this.deletedStates[t][l]={};for(const d in this.state[t][l])a[d]||(this.deletedStates[t][l][d]=null)}else for(const d in a)this.deletedStates[t]&&this.deletedStates[t][l]&&this.deletedStates[t][l][d]===null&&delete this.deletedStates[t][l][d]}removeFeatureState(t,n,a){if(this.deletedStates[t]===null)return;const l=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&n!==void 0)this.deletedStates[t][l]!==null&&(this.deletedStates[t][l]=this.deletedStates[t][l]||{},this.deletedStates[t][l][a]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][l])for(a in this.deletedStates[t][l]={},this.stateChanges[t][l])this.deletedStates[t][l][a]=null;else this.deletedStates[t][l]=null;else this.deletedStates[t]=null}getState(t,n){const a=String(n),l=c.e({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const d=this.deletedStates[t][n];if(d===null)return{};for(const m in d)delete l[m]}return l}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const d={};for(const m in this.stateChanges[l])this.state[l][m]||(this.state[l][m]={}),c.e(this.state[l][m],this.stateChanges[l][m]),d[m]=this.state[l][m];a[l]=d}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const d={};if(this.deletedStates[l]===null)for(const m in this.state[l])d[m]={},this.state[l][m]={};else for(const m in this.deletedStates[l]){if(this.deletedStates[l][m]===null)this.state[l][m]={};else for(const g of Object.keys(this.deletedStates[l][m]))delete this.state[l][m][g];d[m]=this.state[l][m]}a[l]=a[l]||{},c.e(a[l],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in t)t[l].setFeatureState(a,n)}}class ki extends c.E{constructor(t,n,a){super(),this.id=t,this.dispatcher=a,this.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((l,d,m,g)=>{const y=new(Ar(d.type))(l,d,m,g);if(y.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${y.id}`);return y})(t,n,a,this),this._tiles={},this._cache=new un(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new he,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new c.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Qi).map(t=>t.key)}getRenderableIds(t){const n=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&n.push(this._tiles[a]);return t?n.sort((a,l)=>{const d=a.tileID,m=l.tileID,g=new c.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),y=new c.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-m.overscaledZ||y.y-g.y||y.x-g.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Qi).map(a=>a.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=n),this._loadTile(a,this._tileLoaded.bind(this,a,t,n)))}_tileLoaded(t,n,a,l){if(l)return t.state="errored",void(l.status!==404?this._source.fire(new c.j(l,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=c.h.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let l=0;l<n.length;l++){const d=n[l];if(t.neighboringTiles&&t.neighboringTiles[d]){const m=this.getTileByID(d);a(t,m),a(m,t)}}function a(l,d){l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0;let m=d.tileID.canonical.x-l.tileID.canonical.x;const g=d.tileID.canonical.y-l.tileID.canonical.y,y=Math.pow(2,l.tileID.canonical.z),v=d.tileID.key;m===0&&g===0||Math.abs(g)>1||(Math.abs(m)>1&&(Math.abs(m+y)===1?m+=y:Math.abs(m-y)===1&&(m-=y)),d.dem&&l.dem&&(l.dem.backfillBorder(d.dem,m,g),l.neighboringTiles&&l.neighboringTiles[v]&&(l.neighboringTiles[v].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,a,l){for(const d in this._tiles){let m=this._tiles[d];if(l[d]||!m.hasData()||m.tileID.overscaledZ<=n||m.tileID.overscaledZ>a)continue;let g=m.tileID;for(;m&&m.tileID.overscaledZ>n+1;){const v=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[v.key],m&&m.hasData()&&(g=v)}let y=g;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),t[y.key]){l[g.key]=g;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=t.overscaledZ-1;a>=n;a--){const l=t.scaledTo(a),d=this._getLoadedTile(l);if(d)return d}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,l=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(d)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const a={};for(const l in this._tiles){const d=this._tiles[l];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),a[d.tileID.key]=d}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new c.O(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(a=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(w=>this._source.hasTile(w)))):a=[];const l=t.coveringZoomLevel(this._source),d=Math.max(l-ki.maxOverzooming,this._source.minzoom),m=Math.max(l+ki.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const w={};for(const S of a)if(S.canonical.z>this._source.minzoom){const A=S.scaledTo(S.canonical.z-1);w[A.key]=A;const F=S.scaledTo(Math.max(this._source.minzoom,Math.min(S.canonical.z,5)));w[F.key]=F}a=a.concat(Object.values(w))}const g=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,g&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const y=this._updateRetainedTiles(a,l);if(It(this._source.type)){const w={},S={},A=Object.keys(y),F=c.h.now();for(const B of A){const N=y[B],L=this._tiles[B];if(!L||L.fadeEndTime!==0&&L.fadeEndTime<=F)continue;const J=this.findLoadedParent(N,d);J&&(this._addTile(J.tileID),w[J.tileID.key]=J.tileID),S[B]=N}this._retainLoadedChildren(S,l,m,y);for(const B in w)y[B]||(this._coveredTiles[B]=!0,y[B]=w[B]);if(n){const B={},N={};for(const L of a)this._tiles[L.key].hasData()?B[L.key]=L:N[L.key]=L;for(const L in N){const J=N[L].children(this._source.maxzoom);this._tiles[J[0].key]&&this._tiles[J[1].key]&&this._tiles[J[2].key]&&this._tiles[J[3].key]&&(B[J[0].key]=y[J[0].key]=J[0],B[J[1].key]=y[J[1].key]=J[1],B[J[2].key]=y[J[2].key]=J[2],B[J[3].key]=y[J[3].key]=J[3],delete N[L])}for(const L in N){const J=this.findLoadedParent(N[L],this._source.minzoom);if(J){B[J.tileID.key]=y[J.tileID.key]=J.tileID;for(const ne in B)B[ne].isChildOf(J.tileID)&&delete B[ne]}}for(const L in this._tiles)B[L]||(this._coveredTiles[L]=!0)}}for(const w in y)this._tiles[w].clearFadeHold();const v=c.ab(this._tiles,y);for(const w of v){const S=this._tiles[w];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(w)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const a={},l={},d=Math.max(n-ki.maxOverzooming,this._source.minzoom),m=Math.max(n+ki.maxUnderzooming,this._source.minzoom),g={};for(const y of t){const v=this._addTile(y);a[y.key]=y,v.hasData()||n<this._source.maxzoom&&(g[y.key]=y)}this._retainLoadedChildren(g,n,m,a);for(const y of t){let v=this._tiles[y.key];if(v.hasData())continue;if(n+1>this._source.maxzoom){const S=y.children(this._source.maxzoom)[0],A=this.getTile(S);if(A&&A.hasData()){a[S.key]=S;continue}}else{const S=y.children(this._source.maxzoom);if(a[S[0].key]&&a[S[1].key]&&a[S[2].key]&&a[S[3].key])continue}let w=v.wasRequested();for(let S=y.overscaledZ-1;S>=d;--S){const A=y.scaledTo(S);if(l[A.key])break;if(l[A.key]=!0,v=this.getTile(A),!v&&w&&(v=this._addTile(A)),v){const F=v.hasData();if((w||F)&&(a[A.key]=A),w=v.wasRequested(),F)break}}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let a,l=this._tiles[t].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}n.push(l.key);const d=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;l=d}for(const d of n)this._loadedParentTiles[d]=a}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const a=n;return n||(n=new Xr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,a||this._source.fire(new c.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=n.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,a){const l=[],d=this.transform;if(!d)return l;const m=a?d.getCameraQueryGeometry(t):t,g=t.map(B=>d.pointCoordinate(B,this.terrain)),y=m.map(B=>d.pointCoordinate(B,this.terrain)),v=this.getIds();let w=1/0,S=1/0,A=-1/0,F=-1/0;for(const B of y)w=Math.min(w,B.x),S=Math.min(S,B.y),A=Math.max(A,B.x),F=Math.max(F,B.y);for(let B=0;B<v.length;B++){const N=this._tiles[v[B]];if(N.holdingForFade())continue;const L=N.tileID,J=Math.pow(2,d.zoom-N.tileID.overscaledZ),ne=n*N.queryPadding*c.N/N.tileSize/J,U=[L.getTilePoint(new c.U(w,S)),L.getTilePoint(new c.U(A,F))];if(U[0].x-ne<c.N&&U[0].y-ne<c.N&&U[1].x+ne>=0&&U[1].y+ne>=0){const Q=g.map(le=>L.getTilePoint(le)),oe=y.map(le=>L.getTilePoint(le));l.push({tile:N,tileID:L,queryGeometry:Q,cameraQueryGeometry:oe,scale:J})}}return l}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(It(this._source.type)){const t=c.h.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,a){this._state.updateState(t=t||"_geojsonTileLayer",n,a)}removeFeatureState(t,n,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,a)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,a){const l=this._tiles[t];l&&l.setDependencies(n,a)}reloadTilesForDependencies(t,n){for(const a in this._tiles)this._tiles[a].hasDependency(t,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,n))}}function Qi(h,t){const n=Math.abs(2*h.wrap)-+(h.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||a-n||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function It(h){return h==="raster"||h==="image"||h==="video"}ki.maxOverzooming=10,ki.maxUnderzooming=3;const ft="mapboxgl_preloaded_worker_pool";class _r{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<_r.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ft]}numActive(){return Object.keys(this.active).length}}const Ln=Math.floor(c.h.hardwareConcurrency/2);let kr;function zs(){return kr||(kr=new _r),kr}_r.workerCount=c.ac(globalThis)?Math.max(Math.min(Ln,3),1):1;class Rn{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=c.ad(t,0,1);let n=1,a=this._distances[n];const l=t*this.paddedLength+this.padding;for(;a<l&&n<this._distances.length;)a=this._distances[++n];const d=n-1,m=this._distances[d],g=a-m,y=g>0?(l-m)/g:0;return this.points[d].mult(1-y).add(this.points[n].mult(y))}}function Kr(h,t){let n=!0;return h==="always"||h!=="never"&&t!=="never"||(n=!1),n}class dn{constructor(t,n,a){const l=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(n/a);for(let m=0;m<this.xCellCount*this.yCellCount;m++)l.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,a,l,d){this._forEachCell(n,a,l,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(d)}insertCircle(t,n,a,l){this._forEachCell(n-l,a-l,n+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(a),this.circles.push(l)}_insertBoxCell(t,n,a,l,d,m){this.boxCells[d].push(m)}_insertCircleCell(t,n,a,l,d,m){this.circleCells[d].push(m)}_query(t,n,a,l,d,m,g){if(a<0||t>this.width||l<0||n>this.height)return[];const y=[];if(t<=0&&n<=0&&this.width<=a&&this.height<=l){if(d)return[{key:null,x1:t,y1:n,x2:a,y2:l}];for(let v=0;v<this.boxKeys.length;v++)y.push({key:this.boxKeys[v],x1:this.bboxes[4*v],y1:this.bboxes[4*v+1],x2:this.bboxes[4*v+2],y2:this.bboxes[4*v+3]});for(let v=0;v<this.circleKeys.length;v++){const w=this.circles[3*v],S=this.circles[3*v+1],A=this.circles[3*v+2];y.push({key:this.circleKeys[v],x1:w-A,y1:S-A,x2:w+A,y2:S+A})}}else this._forEachCell(t,n,a,l,this._queryCell,y,{hitTest:d,overlapMode:m,seenUids:{box:{},circle:{}}},g);return y}query(t,n,a,l){return this._query(t,n,a,l,!1,null)}hitTest(t,n,a,l,d,m){return this._query(t,n,a,l,!0,d,m).length>0}hitTestCircle(t,n,a,l,d){const m=t-a,g=t+a,y=n-a,v=n+a;if(g<0||m>this.width||v<0||y>this.height)return!1;const w=[];return this._forEachCell(m,y,g,v,this._queryCellCircle,w,{hitTest:!0,overlapMode:l,circle:{x:t,y:n,radius:a},seenUids:{box:{},circle:{}}},d),w.length>0}_queryCell(t,n,a,l,d,m,g,y){const{seenUids:v,hitTest:w,overlapMode:S}=g,A=this.boxCells[d];if(A!==null){const B=this.bboxes;for(const N of A)if(!v.box[N]){v.box[N]=!0;const L=4*N,J=this.boxKeys[N];if(t<=B[L+2]&&n<=B[L+3]&&a>=B[L+0]&&l>=B[L+1]&&(!y||y(J))&&(!w||!Kr(S,J.overlapMode))&&(m.push({key:J,x1:B[L],y1:B[L+1],x2:B[L+2],y2:B[L+3]}),w))return!0}}const F=this.circleCells[d];if(F!==null){const B=this.circles;for(const N of F)if(!v.circle[N]){v.circle[N]=!0;const L=3*N,J=this.circleKeys[N];if(this._circleAndRectCollide(B[L],B[L+1],B[L+2],t,n,a,l)&&(!y||y(J))&&(!w||!Kr(S,J.overlapMode))){const ne=B[L],U=B[L+1],Q=B[L+2];if(m.push({key:J,x1:ne-Q,y1:U-Q,x2:ne+Q,y2:U+Q}),w)return!0}}}return!1}_queryCellCircle(t,n,a,l,d,m,g,y){const{circle:v,seenUids:w,overlapMode:S}=g,A=this.boxCells[d];if(A!==null){const B=this.bboxes;for(const N of A)if(!w.box[N]){w.box[N]=!0;const L=4*N,J=this.boxKeys[N];if(this._circleAndRectCollide(v.x,v.y,v.radius,B[L+0],B[L+1],B[L+2],B[L+3])&&(!y||y(J))&&!Kr(S,J.overlapMode))return m.push(!0),!0}}const F=this.circleCells[d];if(F!==null){const B=this.circles;for(const N of F)if(!w.circle[N]){w.circle[N]=!0;const L=3*N,J=this.circleKeys[N];if(this._circlesCollide(B[L],B[L+1],B[L+2],v.x,v.y,v.radius)&&(!y||y(J))&&!Kr(S,J.overlapMode))return m.push(!0),!0}}}_forEachCell(t,n,a,l,d,m,g,y){const v=this._convertToXCellCoord(t),w=this._convertToYCellCoord(n),S=this._convertToXCellCoord(a),A=this._convertToYCellCoord(l);for(let F=v;F<=S;F++)for(let B=w;B<=A;B++)if(d.call(this,t,n,a,l,this.xCellCount*B+F,m,g,y))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,a,l,d,m){const g=l-t,y=d-n,v=a+m;return v*v>g*g+y*y}_circleAndRectCollide(t,n,a,l,d,m,g){const y=(m-l)/2,v=Math.abs(t-(l+y));if(v>y+a)return!1;const w=(g-d)/2,S=Math.abs(n-(d+w));if(S>w+a)return!1;if(v<=y||S<=w)return!0;const A=v-y,F=S-w;return A*A+F*F<=a*a}}function Te(h,t,n,a,l){const d=c.Z();return t?(c.a0(d,d,[1/l,1/l,1]),n||c.ae(d,d,a.angle)):c.a1(d,a.labelPlaneMatrix,h),d}function yr(h,t,n,a,l){if(t){const d=c.af(h);return c.a0(d,d,[l,l,1]),n||c.ae(d,d,-a.angle),d}return a.glCoordMatrix}function jt(h,t,n){let a;n?(a=[h.x,h.y,n(h.x,h.y),1],c.ag(a,a,t)):(a=[h.x,h.y,0,1],V(a,a,t));const l=a[3];return{point:new c.P(a[0]/l,a[1]/l),signedDistanceFromCamera:l}}function pn(h,t){return .5+h/t*.5}function Pr(h,t){const n=h[0]/h[3],a=h[1]/h[3];return n>=-t[0]&&n<=t[0]&&a>=-t[1]&&a<=t[1]}function Ie(h,t,n,a,l,d,m,g,y,v){const w=a?h.textSizeData:h.iconSizeData,S=c.ah(w,n.transform.zoom),A=[256/n.width*2+1,256/n.height*2+1],F=a?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;F.clear();const B=h.lineVertexArray,N=a?h.text.placedSymbolArray:h.icon.placedSymbolArray,L=n.transform.width/n.transform.height;let J=!1;for(let ne=0;ne<N.length;ne++){const U=N.get(ne);if(U.hidden||U.writingMode===c.ai.vertical&&!J){D(U.numGlyphs,F);continue}let Q;if(J=!1,v?(Q=[U.anchorX,U.anchorY,v(U.anchorX,U.anchorY),1],c.ag(Q,Q,t)):(Q=[U.anchorX,U.anchorY,0,1],V(Q,Q,t)),!Pr(Q,A)){D(U.numGlyphs,F);continue}const oe=pn(n.transform.cameraToCenterDistance,Q[3]),le=c.aj(w,S,U),fe=m?le/oe:le*oe,ve=new c.P(U.anchorX,U.anchorY),_e=jt(ve,l,v).point,we={projections:{},offsets:{}},Be=wi(U,fe,!1,g,t,l,d,h.glyphOffsetArray,B,F,_e,ve,we,L,y,v);J=Be.useVertical,(Be.notEnoughRoom||J||Be.needsFlipping&&wi(U,fe,!0,g,t,l,d,h.glyphOffsetArray,B,F,_e,ve,we,L,y,v).notEnoughRoom)&&D(U.numGlyphs,F)}a?h.text.dynamicLayoutVertexBuffer.updateData(F):h.icon.dynamicLayoutVertexBuffer.updateData(F)}function et(h,t,n,a,l,d,m,g,y,v,w,S,A){const F=g.glyphStartIndex+g.numGlyphs,B=g.lineStartIndex,N=g.lineStartIndex+g.lineLength,L=t.getoffsetX(g.glyphStartIndex),J=t.getoffsetX(F-1),ne=C(h*L,n,a,l,d,m,g.segment,B,N,y,v,w,S,A);if(!ne)return null;const U=C(h*J,n,a,l,d,m,g.segment,B,N,y,v,w,S,A);return U?{first:ne,last:U}:null}function Ke(h,t,n,a){return h===c.ai.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*a?{useVertical:!0}:(h===c.ai.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function wi(h,t,n,a,l,d,m,g,y,v,w,S,A,F,B,N){const L=t/24,J=h.lineOffsetX*L,ne=h.lineOffsetY*L;let U;if(h.numGlyphs>1){const Q=h.glyphStartIndex+h.numGlyphs,oe=h.lineStartIndex,le=h.lineStartIndex+h.lineLength,fe=et(L,g,J,ne,n,w,S,h,y,d,A,B,N);if(!fe)return{notEnoughRoom:!0};const ve=jt(fe.first.point,m,N).point,_e=jt(fe.last.point,m,N).point;if(a&&!n){const we=Ke(h.writingMode,ve,_e,F);if(we)return we}U=[fe.first];for(let we=h.glyphStartIndex+1;we<Q-1;we++)U.push(C(L*g.getoffsetX(we),J,ne,n,w,S,h.segment,oe,le,y,d,A,B,N));U.push(fe.last)}else{if(a&&!n){const oe=jt(S,l,N).point,le=h.lineStartIndex+h.segment+1,fe=new c.P(y.getx(le),y.gety(le)),ve=jt(fe,l,N),_e=ve.signedDistanceFromCamera>0?ve.point:xr(S,fe,oe,1,l,N),we=Ke(h.writingMode,oe,_e,F);if(we)return we}const Q=C(L*g.getoffsetX(h.glyphStartIndex),J,ne,n,w,S,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,y,d,A,B,N);if(!Q)return{notEnoughRoom:!0};U=[Q]}for(const Q of U)c.ak(v,Q.point,Q.angle);return{}}function xr(h,t,n,a,l,d){const m=jt(h.add(h.sub(t)._unit()),l,d).point,g=n.sub(m);return n.add(g._mult(a/g.mag()))}function Je(h,t){const{projectionCache:n,lineVertexArray:a,labelPlaneMatrix:l,tileAnchorPoint:d,distanceFromAnchor:m,getElevation:g,previousVertex:y,direction:v,absOffsetX:w}=t;if(n.projections[h])return n.projections[h];const S=new c.P(a.getx(h),a.gety(h)),A=jt(S,l,g);if(A.signedDistanceFromCamera>0)return n.projections[h]=A.point,A.point;const F=h-v;return xr(m===0?d:new c.P(a.getx(F),a.gety(F)),S,y,w-m+1,l,g)}function zr(h,t,n){return h._unit()._perp()._mult(t*n)}function O(h,t,n,a,l,d,m,g){const{projectionCache:y,direction:v}=g;if(y.offsets[h])return y.offsets[h];const w=n.add(t);if(h+v<a||h+v>=l)return y.offsets[h]=w,w;const S=Je(h+v,g),A=zr(S.sub(n),m,v),F=n.add(A),B=S.add(A);return y.offsets[h]=c.al(d,w,F,B)||w,y.offsets[h]}function C(h,t,n,a,l,d,m,g,y,v,w,S,A,F){const B=a?h-t:h+t;let N=B>0?1:-1,L=0;a&&(N*=-1,L=Math.PI),N<0&&(L+=Math.PI);let J,ne,U=N>0?g+m:g+m+1,Q=l,oe=l,le=0,fe=0;const ve=Math.abs(B),_e=[];let we;for(;le+fe<=ve;){if(U+=N,U<g||U>=y)return null;le+=fe,oe=Q,ne=J;const Ee={projectionCache:S,lineVertexArray:v,labelPlaneMatrix:w,tileAnchorPoint:d,distanceFromAnchor:le,getElevation:F,previousVertex:oe,direction:N,absOffsetX:ve};if(Q=Je(U,Ee),n===0)_e.push(oe),we=Q.sub(oe);else{let Ge;const Oe=Q.sub(oe);Ge=Oe.mag()===0?zr(Je(U+N,Ee).sub(Q),n,N):zr(Oe,n,N),ne||(ne=oe.add(Ge)),J=O(U,Ge,Q,g,y,ne,n,Ee),_e.push(ne),we=J.sub(ne)}fe=we.mag()}const Be=we._mult((ve-le)/fe)._add(ne||oe),st=L+Math.atan2(Q.y-oe.y,Q.x-oe.x);return _e.push(Be),{point:Be,angle:A?st:0,path:_e}}const E=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function D(h,t){for(let n=0;n<h;n++){const a=t.length;t.resize(a+4),t.float32.set(E,3*a)}}function V(h,t,n){const a=t[0],l=t[1];return h[0]=n[0]*a+n[4]*l+n[12],h[1]=n[1]*a+n[5]*l+n[13],h[3]=n[3]*a+n[7]*l+n[15],h}const $=100;class ie{constructor(t,n=new dn(t.width+200,t.height+200,25),a=new dn(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+$,this.screenBottomBoundary=t.height+$,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,a,l,d,m){const g=this.projectAndGetPerspectiveRatio(l,t.anchorPointX,t.anchorPointY,m),y=a*g.perspectiveRatio,v=t.x1*y+g.point.x,w=t.y1*y+g.point.y,S=t.x2*y+g.point.x,A=t.y2*y+g.point.y;return!this.isInsideGrid(v,w,S,A)||n!=="always"&&this.grid.hitTest(v,w,S,A,n,d)||g.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[v,w,S,A],offscreen:this.isOffscreen(v,w,S,A)}}placeCollisionCircles(t,n,a,l,d,m,g,y,v,w,S,A,F,B){const N=[],L=new c.P(n.anchorX,n.anchorY),J=jt(L,m,B),ne=pn(this.transform.cameraToCenterDistance,J.signedDistanceFromCamera),U=(w?d/ne:d*ne)/c.ap,Q=jt(L,g,B).point,oe=et(U,l,n.lineOffsetX*U,n.lineOffsetY*U,!1,Q,L,n,a,g,{projections:{},offsets:{}},!1,B);let le=!1,fe=!1,ve=!0;if(oe){const _e=.5*A*ne+F,we=new c.P(-100,-100),Be=new c.P(this.screenRightBoundary,this.screenBottomBoundary),st=new Rn,Ee=oe.first,Ge=oe.last;let Oe=[];for(let Qe=Ee.path.length-1;Qe>=1;Qe--)Oe.push(Ee.path[Qe]);for(let Qe=1;Qe<Ge.path.length;Qe++)Oe.push(Ge.path[Qe]);const St=2.5*_e;if(y){const Qe=Oe.map(at=>jt(at,y,B));Oe=Qe.some(at=>at.signedDistanceFromCamera<=0)?[]:Qe.map(at=>at.point)}let rt=[];if(Oe.length>0){const Qe=Oe[0].clone(),at=Oe[0].clone();for(let Zt=1;Zt<Oe.length;Zt++)Qe.x=Math.min(Qe.x,Oe[Zt].x),Qe.y=Math.min(Qe.y,Oe[Zt].y),at.x=Math.max(at.x,Oe[Zt].x),at.y=Math.max(at.y,Oe[Zt].y);rt=Qe.x>=we.x&&at.x<=Be.x&&Qe.y>=we.y&&at.y<=Be.y?[Oe]:at.x<we.x||Qe.x>Be.x||at.y<we.y||Qe.y>Be.y?[]:c.am([Oe],we.x,we.y,Be.x,Be.y)}for(const Qe of rt){st.reset(Qe,.25*_e);let at=0;at=st.length<=.5*_e?1:Math.ceil(st.paddedLength/St)+1;for(let Zt=0;Zt<at;Zt++){const Mt=Zt/Math.max(at-1,1),di=st.lerp(Mt),ei=di.x+$,Xt=di.y+$;N.push(ei,Xt,_e,0);const Zi=ei-_e,zt=Xt-_e,br=ei+_e,wr=Xt+_e;if(ve=ve&&this.isOffscreen(Zi,zt,br,wr),fe=fe||this.isInsideGrid(Zi,zt,br,wr),t!=="always"&&this.grid.hitTestCircle(ei,Xt,_e,t,S)&&(le=!0,!v))return{circles:[],offscreen:!1,collisionDetected:le}}}}return{circles:!v&&le||!fe||ne<this.perspectiveRatioCutoff?[]:N,offscreen:ve,collisionDetected:le}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,l=1/0,d=-1/0,m=-1/0;for(const w of t){const S=new c.P(w.x+$,w.y+$);a=Math.min(a,S.x),l=Math.min(l,S.y),d=Math.max(d,S.x),m=Math.max(m,S.y),n.push(S)}const g=this.grid.query(a,l,d,m).concat(this.ignoredGrid.query(a,l,d,m)),y={},v={};for(const w of g){const S=w.key;if(y[S.bucketInstanceId]===void 0&&(y[S.bucketInstanceId]={}),y[S.bucketInstanceId][S.featureIndex])continue;const A=[new c.P(w.x1,w.y1),new c.P(w.x2,w.y1),new c.P(w.x2,w.y2),new c.P(w.x1,w.y2)];c.an(n,A)&&(y[S.bucketInstanceId][S.featureIndex]=!0,v[S.bucketInstanceId]===void 0&&(v[S.bucketInstanceId]=[]),v[S.bucketInstanceId].push(S.featureIndex))}return v}insertCollisionBox(t,n,a,l,d,m){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:d,collisionGroupID:m,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,a,l,d,m){const g=a?this.ignoredGrid:this.grid,y={bucketInstanceId:l,featureIndex:d,collisionGroupID:m,overlapMode:n};for(let v=0;v<t.length;v+=4)g.insertCircle(y,t[v],t[v+1],t[v+2])}projectAndGetPerspectiveRatio(t,n,a,l){let d;return l?(d=[n,a,l(n,a),1],c.ag(d,d,t)):(d=[n,a,0,1],V(d,d,t)),{point:new c.P((d[0]/d[3]+1)/2*this.transform.width+$,(-d[1]/d[3]+1)/2*this.transform.height+$),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}}isOffscreen(t,n,a,l){return a<$||t>=this.screenRightBoundary||l<$||n>this.screenBottomBoundary}isInsideGrid(t,n,a,l){return a>=0&&t<this.gridRightBoundary&&l>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=c.ao([]);return c.$(t,t,[-100,-100,0]),t}}function K(h,t,n){return t*(c.N/(h.tileSize*Math.pow(2,n-h.tileID.overscaledZ)))}class Z{constructor(t,n,a,l){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):l&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class ee{constructor(t,n,a,l,d){this.text=new Z(t?t.text:null,n,a,d),this.icon=new Z(t?t.icon:null,n,l,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ue{constructor(t,n,a){this.text=t,this.icon=n,this.skipFade=a}}class pe{constructor(){this.invProjMatrix=c.Z(),this.viewportMatrix=c.Z(),this.circles=[]}}class ge{constructor(t,n,a,l,d){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=d}}class $e{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[t]}}function We(h,t,n,a,l){const{horizontalAlign:d,verticalAlign:m}=c.au(h);return new c.P(-(d-.5)*t+a[0]*l,-(m-.5)*n+a[1]*l)}function Re(h,t,n,a,l,d){const{x1:m,x2:g,y1:y,y2:v,anchorPointX:w,anchorPointY:S}=h,A=new c.P(t,n);return a&&A._rotate(l?d:-d),{x1:m+A.x,y1:y+A.y,x2:g+A.x,y2:v+A.y,anchorPointX:w,anchorPointY:S}}class qe{constructor(t,n,a,l,d){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new ie(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new $e(l),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,a,l){const d=a.getBucket(n),m=a.latestFeatureIndex;if(!d||!m||n.id!==d.layerIds[0])return;const g=a.collisionBoxArray,y=d.layers[0].layout,v=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),w=a.tileSize/c.N,S=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),A=y.get("text-pitch-alignment")==="map",F=y.get("text-rotation-alignment")==="map",B=K(a,1,this.transform.zoom),N=Te(S,A,F,this.transform,B);let L=null;if(A){const ne=yr(S,A,F,this.transform,B);L=c.a1([],this.transform.labelPlaneMatrix,ne)}this.retainedQueryData[d.bucketInstanceId]=new ge(d.bucketInstanceId,m,d.sourceLayerIndex,d.index,a.tileID);const J={bucket:d,layout:y,posMatrix:S,textLabelPlaneMatrix:N,labelToScreenMatrix:L,scale:v,textPixelRatio:w,holdingForFade:a.holdingForFade(),collisionBoxArray:g,partiallyEvaluatedTextSize:c.ah(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(l)for(const ne of d.sortKeyRanges){const{sortKey:U,symbolInstanceStart:Q,symbolInstanceEnd:oe}=ne;t.push({sortKey:U,symbolInstanceStart:Q,symbolInstanceEnd:oe,parameters:J})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:J})}attemptAnchorPlacement(t,n,a,l,d,m,g,y,v,w,S,A,F,B,N,L){const J=c.aq[t.textAnchor],ne=[t.textOffset0,t.textOffset1],U=We(J,a,l,ne,d),Q=this.collisionIndex.placeCollisionBox(Re(n,U.x,U.y,m,g,this.transform.angle),S,y,v,w.predicate,L);if((!N||this.collisionIndex.placeCollisionBox(Re(N,U.x,U.y,m,g,this.transform.angle),S,y,v,w.predicate,L).box.length!==0)&&Q.box.length>0){let oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[A.crossTileID]&&this.prevPlacement.placements[A.crossTileID]&&this.prevPlacement.placements[A.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[A.crossTileID].anchor),A.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[A.crossTileID]={textOffset:ne,width:a,height:l,anchor:J,textBoxScale:d,prevAnchor:oe},this.markUsedJustification(F,J,A,B),F.allowVerticalPlacement&&(this.markUsedOrientation(F,B,A),this.placedOrientations[A.crossTileID]=B),{shift:U,placedGlyphBoxes:Q}}}placeLayerBucketPart(t,n,a){const{bucket:l,layout:d,posMatrix:m,textLabelPlaneMatrix:g,labelToScreenMatrix:y,textPixelRatio:v,holdingForFade:w,collisionBoxArray:S,partiallyEvaluatedTextSize:A,collisionGroup:F}=t.parameters,B=d.get("text-optional"),N=d.get("icon-optional"),L=c.ar(d,"text-overlap","text-allow-overlap"),J=L==="always",ne=c.ar(d,"icon-overlap","icon-allow-overlap"),U=ne==="always",Q=d.get("text-rotation-alignment")==="map",oe=d.get("text-pitch-alignment")==="map",le=d.get("icon-text-fit")!=="none",fe=d.get("symbol-z-order")==="viewport-y",ve=J&&(U||!l.hasIconData()||N),_e=U&&(J||!l.hasTextData()||B);!l.collisionArrays&&S&&l.deserializeCollisionBoxes(S);const we=this.retainedQueryData[l.bucketInstanceId].tileID,Be=this.terrain?(Ee,Ge)=>this.terrain.getElevation(we,Ee,Ge):null,st=(Ee,Ge)=>{var Oe,St;if(n[Ee.crossTileID])return;if(w)return void(this.placements[Ee.crossTileID]=new ue(!1,!1,!1));let rt=!1,Qe=!1,at=!0,Zt=null,Mt={box:null,offscreen:null},di={box:null,offscreen:null},ei=null,Xt=null,Zi=null,zt=0,br=0,wr=0;Ge.textFeatureIndex?zt=Ge.textFeatureIndex:Ee.useRuntimeCollisionCircles&&(zt=Ee.featureIndex),Ge.verticalTextFeatureIndex&&(br=Ge.verticalTextFeatureIndex);const nn=Ge.textBox;if(nn){const _i=Gt=>{let ti=c.ai.horizontal;if(l.allowVerticalPlacement&&!Gt&&this.prevPlacement){const Di=this.prevPlacement.placedOrientations[Ee.crossTileID];Di&&(this.placedOrientations[Ee.crossTileID]=Di,ti=Di,this.markUsedOrientation(l,ti,Ee))}return ti},pi=(Gt,ti)=>{if(l.allowVerticalPlacement&&Ee.numVerticalGlyphVertices>0&&Ge.verticalTextBox){for(const Di of l.writingModes)if(Di===c.ai.vertical?(Mt=ti(),di=Mt):Mt=Gt(),Mt&&Mt.box&&Mt.box.length)break}else Mt=Gt()},Ti=Ee.textAnchorOffsetStartIndex,Sn=Ee.textAnchorOffsetEndIndex;if(Sn===Ti){const Gt=(ti,Di)=>{const Ht=this.collisionIndex.placeCollisionBox(ti,L,v,m,F.predicate,Be);return Ht&&Ht.box&&Ht.box.length&&(this.markUsedOrientation(l,Di,Ee),this.placedOrientations[Ee.crossTileID]=Di),Ht};pi(()=>Gt(nn,c.ai.horizontal),()=>{const ti=Ge.verticalTextBox;return l.allowVerticalPlacement&&Ee.numVerticalGlyphVertices>0&&ti?Gt(ti,c.ai.vertical):{box:null,offscreen:null}}),_i(Mt&&Mt.box&&Mt.box.length)}else{let Gt=c.aq[(St=(Oe=this.prevPlacement)===null||Oe===void 0?void 0:Oe.variableOffsets[Ee.crossTileID])===null||St===void 0?void 0:St.anchor];const ti=(Ht,Tn,oa)=>{const fl=Ht.x2-Ht.x1,ml=Ht.y2-Ht.y1,oc=Ee.textBoxScale,oo=le&&ne==="never"?Tn:null;let Sr={box:[],offscreen:!1},Cn=L==="never"?1:2,Tr="never";Gt&&Cn++;for(let ar=0;ar<Cn;ar++){for(let Cr=Ti;Cr<Sn;Cr++){const lo=l.textAnchorOffsets.get(Cr);if(Gt&&lo.textAnchor!==Gt)continue;const Or=this.attemptAnchorPlacement(lo,Ht,fl,ml,oc,Q,oe,v,m,F,Tr,Ee,l,oa,oo,Be);if(Or&&(Sr=Or.placedGlyphBoxes,Sr&&Sr.box&&Sr.box.length))return rt=!0,Zt=Or.shift,Sr}Gt?Gt=null:Tr=L}return Sr};pi(()=>ti(nn,Ge.iconBox,c.ai.horizontal),()=>{const Ht=Ge.verticalTextBox;return l.allowVerticalPlacement&&!(Mt&&Mt.box&&Mt.box.length)&&Ee.numVerticalGlyphVertices>0&&Ht?ti(Ht,Ge.verticalIconBox,c.ai.vertical):{box:null,offscreen:null}}),Mt&&(rt=Mt.box,at=Mt.offscreen);const Di=_i(Mt&&Mt.box);if(!rt&&this.prevPlacement){const Ht=this.prevPlacement.variableOffsets[Ee.crossTileID];Ht&&(this.variableOffsets[Ee.crossTileID]=Ht,this.markUsedJustification(l,Ht.anchor,Ee,Di))}}}if(ei=Mt,rt=ei&&ei.box&&ei.box.length>0,at=ei&&ei.offscreen,Ee.useRuntimeCollisionCircles){const _i=l.text.placedSymbolArray.get(Ee.centerJustifiedTextSymbolIndex),pi=c.aj(l.textSizeData,A,_i),Ti=d.get("text-padding");Xt=this.collisionIndex.placeCollisionCircles(L,_i,l.lineVertexArray,l.glyphOffsetArray,pi,m,g,y,a,oe,F.predicate,Ee.collisionCircleDiameter,Ti,Be),Xt.circles.length&&Xt.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),rt=J||Xt.circles.length>0&&!Xt.collisionDetected,at=at&&Xt.offscreen}if(Ge.iconFeatureIndex&&(wr=Ge.iconFeatureIndex),Ge.iconBox){const _i=pi=>{const Ti=le&&Zt?Re(pi,Zt.x,Zt.y,Q,oe,this.transform.angle):pi;return this.collisionIndex.placeCollisionBox(Ti,ne,v,m,F.predicate,Be)};di&&di.box&&di.box.length&&Ge.verticalIconBox?(Zi=_i(Ge.verticalIconBox),Qe=Zi.box.length>0):(Zi=_i(Ge.iconBox),Qe=Zi.box.length>0),at=at&&Zi.offscreen}const wn=B||Ee.numHorizontalGlyphVertices===0&&Ee.numVerticalGlyphVertices===0,Xn=N||Ee.numIconVertices===0;if(wn||Xn?Xn?wn||(Qe=Qe&&rt):rt=Qe&&rt:Qe=rt=Qe&&rt,rt&&ei&&ei.box&&this.collisionIndex.insertCollisionBox(ei.box,L,d.get("text-ignore-placement"),l.bucketInstanceId,di&&di.box&&br?br:zt,F.ID),Qe&&Zi&&this.collisionIndex.insertCollisionBox(Zi.box,ne,d.get("icon-ignore-placement"),l.bucketInstanceId,wr,F.ID),Xt&&(rt&&this.collisionIndex.insertCollisionCircles(Xt.circles,L,d.get("text-ignore-placement"),l.bucketInstanceId,zt,F.ID),a)){const _i=l.bucketInstanceId;let pi=this.collisionCircleArrays[_i];pi===void 0&&(pi=this.collisionCircleArrays[_i]=new pe);for(let Ti=0;Ti<Xt.circles.length;Ti+=4)pi.circles.push(Xt.circles[Ti+0]),pi.circles.push(Xt.circles[Ti+1]),pi.circles.push(Xt.circles[Ti+2]),pi.circles.push(Xt.collisionDetected?1:0)}if(Ee.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(l.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ee.crossTileID]=new ue(rt||ve,Qe||_e,at||l.justReloaded),n[Ee.crossTileID]=!0};if(fe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ee=l.getSortedSymbolIndexes(this.transform.angle);for(let Ge=Ee.length-1;Ge>=0;--Ge){const Oe=Ee[Ge];st(l.symbolInstances.get(Oe),l.collisionArrays[Oe])}}else for(let Ee=t.symbolInstanceStart;Ee<t.symbolInstanceEnd;Ee++)st(l.symbolInstances.get(Ee),l.collisionArrays[Ee]);if(a&&l.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[l.bucketInstanceId];c.as(Ee.invProjMatrix,m),Ee.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}markUsedJustification(t,n,a,l){let d;d=l===c.ai.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.at(n)];const m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const g of m)g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=d>=0&&g!==d?0:a.crossTileID)}markUsedOrientation(t,n,a){const l=n===c.ai.horizontal||n===c.ai.horizontalOnly?n:0,d=n===c.ai.vertical?n:0,m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const g of m)t.text.placedSymbolArray.get(g).placedOrientation=l;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const l=n?n.symbolFadeChange(t):1,d=n?n.opacities:{},m=n?n.variableOffsets:{},g=n?n.placedOrientations:{};for(const y in this.placements){const v=this.placements[y],w=d[y];w?(this.opacities[y]=new ee(w,l,v.text,v.icon),a=a||v.text!==w.text.placed||v.icon!==w.icon.placed):(this.opacities[y]=new ee(null,l,v.text,v.icon,v.skipFade),a=a||v.text||v.icon)}for(const y in d){const v=d[y];if(!this.opacities[y]){const w=new ee(v,l,!1,!1);w.isHidden()||(this.opacities[y]=w,a=a||v.text.placed||v.icon.placed)}}for(const y in m)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=m[y]);for(const y in g)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=g[y]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const a={};for(const l of n){const d=l.getBucket(t);d&&l.latestFeatureIndex&&t.id===d.layerIds[0]&&this.updateBucketOpacities(d,a,l.collisionBoxArray)}}updateBucketOpacities(t,n,a){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const l=t.layers[0],d=l.layout,m=new ee(null,0,!1,!1,!0),g=d.get("text-allow-overlap"),y=d.get("icon-allow-overlap"),v=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),w=d.get("text-rotation-alignment")==="map",S=d.get("text-pitch-alignment")==="map",A=d.get("icon-text-fit")!=="none",F=new ee(null,0,g&&(y||!t.hasIconData()||d.get("icon-optional")),y&&(g||!t.hasTextData()||d.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const B=(N,L,J)=>{for(let ne=0;ne<L/4;ne++)N.opacityVertexArray.emplaceBack(J);N.hasVisibleVertices=N.hasVisibleVertices||J!==er};for(let N=0;N<t.symbolInstances.length;N++){const L=t.symbolInstances.get(N),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:ne,crossTileID:U}=L;let Q=this.opacities[U];n[U]?Q=m:Q||(Q=F,this.opacities[U]=Q),n[U]=!0;const oe=L.numIconVertices>0,le=this.placedOrientations[L.crossTileID],fe=le===c.ai.vertical,ve=le===c.ai.horizontal||le===c.ai.horizontalOnly;if(J>0||ne>0){const _e=hi(Q.text);B(t.text,J,fe?er:_e),B(t.text,ne,ve?er:_e);const we=Q.text.isHidden();[L.rightJustifiedTextSymbolIndex,L.centerJustifiedTextSymbolIndex,L.leftJustifiedTextSymbolIndex].forEach(Ee=>{Ee>=0&&(t.text.placedSymbolArray.get(Ee).hidden=we||fe?1:0)}),L.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(L.verticalPlacedTextSymbolIndex).hidden=we||ve?1:0);const Be=this.variableOffsets[L.crossTileID];Be&&this.markUsedJustification(t,Be.anchor,L,le);const st=this.placedOrientations[L.crossTileID];st&&(this.markUsedJustification(t,"left",L,st),this.markUsedOrientation(t,st,L))}if(oe){const _e=hi(Q.icon),we=!(A&&L.verticalPlacedIconSymbolIndex&&fe);L.placedIconSymbolIndex>=0&&(B(t.icon,L.numIconVertices,we?_e:er),t.icon.placedSymbolArray.get(L.placedIconSymbolIndex).hidden=Q.icon.isHidden()),L.verticalPlacedIconSymbolIndex>=0&&(B(t.icon,L.numVerticalIconVertices,we?er:_e),t.icon.placedSymbolArray.get(L.verticalPlacedIconSymbolIndex).hidden=Q.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const _e=t.collisionArrays[N];if(_e){let we=new c.P(0,0);if(_e.textBox||_e.verticalTextBox){let st=!0;if(v){const Ee=this.variableOffsets[U];Ee?(we=We(Ee.anchor,Ee.width,Ee.height,Ee.textOffset,Ee.textBoxScale),w&&we._rotate(S?this.transform.angle:-this.transform.angle)):st=!1}_e.textBox&&Ye(t.textCollisionBox.collisionVertexArray,Q.text.placed,!st||fe,we.x,we.y),_e.verticalTextBox&&Ye(t.textCollisionBox.collisionVertexArray,Q.text.placed,!st||ve,we.x,we.y)}const Be=!!(!ve&&_e.verticalIconBox);_e.iconBox&&Ye(t.iconCollisionBox.collisionVertexArray,Q.icon.placed,Be,A?we.x:0,A?we.y:0),_e.verticalIconBox&&Ye(t.iconCollisionBox.collisionVertexArray,Q.icon.placed,!Be,A?we.x:0,A?we.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const N=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=N.invProjMatrix,t.placementViewportMatrix=N.viewportMatrix,t.collisionCircleArray=N.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function Ye(h,t,n,a,l){h.emplaceBack(t?1:0,n?1:0,a||0,l||0),h.emplaceBack(t?1:0,n?1:0,a||0,l||0),h.emplaceBack(t?1:0,n?1:0,a||0,l||0),h.emplaceBack(t?1:0,n?1:0,a||0,l||0)}const vt=Math.pow(2,25),Tt=Math.pow(2,24),pt=Math.pow(2,17),dt=Math.pow(2,16),mi=Math.pow(2,9),Et=Math.pow(2,8),Yt=Math.pow(2,1);function hi(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,n=Math.floor(127*h.opacity);return n*vt+t*Tt+n*pt+t*dt+n*mi+t*Et+n*Yt+t}const er=0;class ko{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,a,l,d){const m=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(m,l,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,m.sort((g,y)=>g.sortKey-y.sortKey));this._currentPartIndex<m.length;)if(n.placeLayerBucketPart(m[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,d())return!0;return!1}}class Bn{constructor(t,n,a,l,d,m,g,y){this.placement=new qe(t,n,m,g,y),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,n,a){const l=c.h.now(),d=()=>!this._forceFullPlacement&&c.h.now()-l>2;for(;this._currentPlacementIndex>=0;){const m=n[t[this._currentPlacementIndex]],g=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=g)&&(!m.maxzoom||m.maxzoom>g)){if(this._inProgressLayer||(this._inProgressLayer=new ko(m)),this._inProgressLayer.continuePlacement(a[m.source],this.placement,this._showCollisionBoxes,m,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Fn=512/c.N/2;class ql{constructor(t,n,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};const l=new Map;for(let d=0;d<n.length;d++){const m=n.get(d),g=m.key,y=l.get(g);y?y.push(m):l.set(g,[m])}for(const[d,m]of l){const g={positions:m.map(y=>({x:Math.floor(y.anchorX*Fn),y:Math.floor(y.anchorY*Fn)})),crossTileIDs:m.map(y=>y.crossTileID)};if(g.positions.length>128){const y=new c.av(g.positions.length,16,Uint16Array);for(const{x:v,y:w}of g.positions)y.add(v,w);y.finish(),delete g.positions,g.index=y}this._symbolsByKey[d]=g}}getScaledCoordinates(t,n){const{x:a,y:l,z:d}=this.tileID.canonical,{x:m,y:g,z:y}=n.canonical,v=Fn/Math.pow(2,y-d),w=(g*c.N+t.anchorY)*v,S=l*c.N*Fn;return{x:Math.floor((m*c.N+t.anchorX)*v-a*c.N*Fn),y:Math.floor(w-S)}}findMatches(t,n,a){const l=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let d=0;d<t.length;d++){const m=t.get(d);if(m.crossTileID)continue;const g=this._symbolsByKey[m.key];if(!g)continue;const y=this.getScaledCoordinates(m,n);if(g.index){const v=g.index.range(y.x-l,y.y-l,y.x+l,y.y+l).sort();for(const w of v){const S=g.crossTileIDs[w];if(!a[S]){a[S]=!0,m.crossTileID=S;break}}}else if(g.positions)for(let v=0;v<g.positions.length;v++){const w=g.positions[v],S=g.crossTileIDs[v];if(Math.abs(w.x-y.x)<=l&&Math.abs(w.y-y.y)<=l&&!a[S]){a[S]=!0,m.crossTileID=S;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class wt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class va{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const a in this.indexes){const l=this.indexes[a],d={};for(const m in l){const g=l[m];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),d[g.tileID.key]=g}this.indexes[a]=d}this.lng=t}addBucket(t,n,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let d=0;d<n.symbolInstances.length;d++)n.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const l=this.usedCrossTileIDs[t.overscaledZ];for(const d in this.indexes){const m=this.indexes[d];if(Number(d)>t.overscaledZ)for(const g in m){const y=m[g];y.tileID.isChildOf(t)&&y.findMatches(n.symbolInstances,t,l)}else{const g=m[t.scaledTo(Number(d)).key];g&&g.findMatches(n.symbolInstances,t,l)}}for(let d=0;d<n.symbolInstances.length;d++){const m=n.symbolInstances.get(d);m.crossTileID||(m.crossTileID=a.generate(),l[m.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ql(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const a of n.getCrossTileIDsLists())for(const l of a)delete this.usedCrossTileIDs[t][l]}removeStaleBuckets(t){let n=!1;for(const a in this.indexes){const l=this.indexes[a];for(const d in l)t[l[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[d]),delete l[d],n=!0)}return n}}class Ds{constructor(){this.layerIndexes={},this.crossTileIDs=new wt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,a){let l=this.layerIndexes[t.id];l===void 0&&(l=this.layerIndexes[t.id]=new va);let d=!1;const m={};l.handleWrapJump(a);for(const g of n){const y=g.getBucket(t);y&&t.id===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(g.tileID,y,this.crossTileIDs)&&(d=!0),m[y.bucketInstanceId]=!0)}return l.removeStaleBuckets(m)&&(d=!0),d}pruneUnusedLayers(t){const n={};t.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const gi=(h,t)=>c.x(h,t&&t.filter(n=>n.identifier!=="source.canvas")),Vi=c.F(c.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Zl=c.F(c.ax,["setCenter","setZoom","setBearing","setPitch"]),tr=c.aw();class ui extends c.E{constructor(t,n={}){super(),this.map=t,this.dispatcher=new ns(zs(),this,t._getMapId()),this.imageManager=new hr,this.imageManager.setEventedParent(this),this.glyphManager=new Mr(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Ps(256,512),this.crossTileSymbolIndex=new Ds,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.az());const a=this;this._rtlTextPluginCallback=ui.registerForPluginStateChange(l=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:l.pluginStatus,pluginURL:l.pluginURL},(d,m)=>{if(c.aA(d),m&&m.every(g=>g))for(const g in a.sourceCaches){const y=a.sourceCaches[g].getSource().type;y!=="vector"&&y!=="geojson"||a.sourceCaches[g].reload()}})}),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const d=this.sourceCaches[l.sourceId];if(!d)return;const m=d.getSource();if(m&&m.vectorLayerIds)for(const g in this._layers){const y=this._layers[g];y.source===m.id&&this._validateLayer(y)}})}loadURL(t,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const l=this.map._requestManager.transformRequest(t,lt.Style);this._request=c.f(l,(d,m)=>{this._request=null,d?this.fire(new c.j(d)):m&&this._load(m,n,a)})}loadJSON(t,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),this._request=c.h.frame(()=>{this._request=null,n.validate=n.validate!==!1,this._load(t,n,a)})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(tr,{validate:!1})}_load(t,n,a){var l;const d=n.transformStyle?n.transformStyle(a,t):t;if(!n.validate||!gi(this,c.y(d))){this._loaded=!0,this.stylesheet=d;for(const m in d.sources)this.addSource(m,d.sources[m],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new rs(this.stylesheet.light),this.map.setTerrain((l=this.stylesheet.terrain)!==null&&l!==void 0?l:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const t=c.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const a=c.aC(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(t,n=!1,a=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(l,d,m,g){const y=ci(l),v=y.length,w=m>1?"@2x":"",S={},A={},F={};for(const{id:B,url:N}of y){const L=d.transformRequest(d.normalizeSpriteURL(N,w,".json"),lt.SpriteJSON),J=`${B}_${L.url}`;S[J]=c.f(L,(Q,oe)=>{delete S[J],A[B]=oe,ks(g,A,F,Q,v)});const ne=d.transformRequest(d.normalizeSpriteURL(N,w,".png"),lt.SpriteImage),U=`${B}_${ne.url}`;S[U]=xt.getImage(ne,(Q,oe)=>{delete S[U],F[B]=oe,ks(g,A,F,Q,v)})}return{cancel(){for(const B of Object.values(S))B.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(l,d)=>{if(this._spriteRequest=null,l)this.fire(new c.j(l));else if(d)for(const m in d){this._spritesImagesIds[m]=[];const g=this._spritesImagesIds[m]?this._spritesImagesIds[m].filter(y=>!(y in d)):[];for(const y of g)this.imageManager.removeImage(y),this._changedImages[y]=!0;for(const y in d[m]){const v=m==="default"?y:`${m}:${y}`;this._spritesImagesIds[m].push(v),v in this.imageManager.images?this.imageManager.updateImage(v,d[m][y],!1):this.imageManager.addImage(v,d[m][y]),n&&(this._changedImages[v]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),a&&a(l)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const a=t.sourceLayer;if(!a)return;const l=n.getSource();(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.j(new Error(`Source layer "${a}" does not exist on source "${l.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const a=[];for(const l of t)n[l]&&a.push(n[l]);return a}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const l=this._layers[a];l.type!=="custom"&&(t[a]=l.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const l=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(l.length||d.length)&&this._updateWorkerLayers(l,d);for(const m in this._updatedSources){const g=this._updatedSources[m];if(g==="reload")this._reloadSource(m);else{if(g!=="clear")throw new Error(`Invalid action ${g}`);this._clearSource(m)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const m in this._updatedPaintProps)this._layers[m].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const l in this.sourceCaches){const d=this.sourceCaches[l];a[l]=d.used,d.used=!1}for(const l of this._order){const d=this._layers[l];d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const l in a){const d=this.sourceCaches[l];a[l]!==d.used&&d.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:l}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();const a=this.serialize();if(t=n.transformStyle?n.transformStyle(a,t):t,gi(this,c.y(t)))return!1;(t=c.aD(t)).layers=c.aB(t.layers);const l=c.aE(a,t).filter(m=>!(m.command in Zl));if(l.length===0)return!1;const d=l.filter(m=>!(m.command in Vi));if(d.length>0)throw new Error(`Unimplemented: ${d.map(m=>m.command).join(", ")}.`);for(const m of l)m.command!=="setTransition"&&this[m.command].apply(this,m.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,n){if(this.getImage(t))return this.fire(new c.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.y.source,`sources.${t}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const l=this.sourceCaches[t]=new ki(t,n,this.dispatcher);l.style=this,l.setEventedParent(this,()=>({isSourceLoaded:l.loaded(),source:l.serialize(),sourceId:t})),l.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new c.j(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,a={}){this._checkLoaded();const l=t.id;if(this.getLayer(l))return void this.fire(new c.j(new Error(`Layer "${l}" already exists on this map.`)));let d;if(t.type==="custom"){if(gi(this,c.aF(t)))return;d=c.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(l,t.source),t=c.aD(t),t=c.e(t,{source:l})),this._validate(c.y.layer,`layers.${l}`,t,{arrayIndex:-1},a))return;d=c.aC(t),this._validateLayer(d),d.setEventedParent(this,{layer:{id:l}})}const m=n?this._order.indexOf(n):this._order.length;if(n&&m===-1)this.fire(new c.j(new Error(`Cannot add layer "${l}" before non-existing layer "${n}".`)));else{if(this._order.splice(m,0,l),this._layerOrderChanged=!0,this._layers[l]=d,this._removedLayers[l]&&d.source&&d.type!=="custom"){const g=this._removedLayers[l];delete this._removedLayers[l],g.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const a=this._order.indexOf(t);this._order.splice(a,1);const l=n?this._order.indexOf(n):this._order.length;n&&l===-1?this.fire(new c.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(l,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,a){this._checkLoaded();const l=this.getLayer(t);l?l.minzoom===n&&l.maxzoom===a||(n!=null&&(l.minzoom=n),a!=null&&(l.maxzoom=a),this._updateLayer(l)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,a={}){this._checkLoaded();const l=this.getLayer(t);if(l){if(!c.aG(l.filter,n))return n==null?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(c.y.filter,`layers.${l.id}.filter`,n,null,a)||(l.filter=c.aD(n),this._updateLayer(l)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return c.aD(this.getLayer(t).filter)}setLayoutProperty(t,n,a,l={}){this._checkLoaded();const d=this.getLayer(t);d?c.aG(d.getLayoutProperty(n),a)||(d.setLayoutProperty(n,a,l),this._updateLayer(d)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const a=this.getLayer(t);if(a)return a.getLayoutProperty(n);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,a,l={}){this._checkLoaded();const d=this.getLayer(t);d?c.aG(d.getPaintProperty(n),a)||(d.setPaintProperty(n,a,l)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new c.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const a=t.source,l=t.sourceLayer,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const m=d.getSource().type;m==="geojson"&&l?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):m!=="vector"||l?(t.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(l,t.id,n)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const a=t.source,l=this.sourceCaches[a];if(l===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const d=l.getSource().type,m=d==="vector"?t.sourceLayer:void 0;d!=="vector"||m?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):l.removeFeatureState(m,t.id,n):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,a=t.sourceLayer,l=this.sourceCaches[n];if(l!==void 0)return l.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),l.getFeatureState(a,t.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=c.aH(this.sourceCaches,d=>d.serialize()),n=this._serializeByIds(this._order),a=this.map.getTerrain()||void 0,l=this.stylesheet;return c.aI({version:l.version,name:l.name,metadata:l.metadata,light:l.light,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:t,layers:n,terrain:a},d=>d!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=m=>this._layers[m].type==="fill-extrusion",a={},l=[];for(let m=this._order.length-1;m>=0;m--){const g=this._order[m];if(n(g)){a[g]=m;for(const y of t){const v=y[g];if(v)for(const w of v)l.push(w)}}}l.sort((m,g)=>g.intersectionZ-m.intersectionZ);const d=[];for(let m=this._order.length-1;m>=0;m--){const g=this._order[m];if(n(g))for(let y=l.length-1;y>=0;y--){const v=l[y].feature;if(a[v.layer.id]<m)break;d.push(v),l.pop()}else for(const y of t){const v=y[g];if(v)for(const w of v)d.push(w.feature)}}return d}queryRenderedFeatures(t,n,a){n&&n.filter&&this._validate(c.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);const l={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const g of n.layers){const y=this._layers[g];if(!y)return this.fire(new c.j(new Error(`The layer '${g}' does not exist in the map's style and cannot be queried for features.`))),[];l[y.source]=!0}}const d=[];n.availableImages=this._availableImages;const m=this._serializedAllLayers();for(const g in this.sourceCaches)n.layers&&!l[g]||d.push(hn(this.sourceCaches[g],this._layers,m,t,n,a));return this.placement&&d.push(function(g,y,v,w,S,A,F){const B={},N=A.queryRenderedSymbols(w),L=[];for(const J of Object.keys(N).map(Number))L.push(F[J]);L.sort(Wr);for(const J of L){const ne=J.featureIndex.lookupSymbolFeatures(N[J.bucketInstanceId],y,J.bucketIndex,J.sourceLayerIndex,S.filter,S.layers,S.availableImages,g);for(const U in ne){const Q=B[U]=B[U]||[],oe=ne[U];oe.sort((le,fe)=>{const ve=J.featureSortOrder;if(ve){const _e=ve.indexOf(le.featureIndex);return ve.indexOf(fe.featureIndex)-_e}return fe.featureIndex-le.featureIndex});for(const le of oe)Q.push(le)}}for(const J in B)B[J].forEach(ne=>{const U=ne.feature,Q=v[g[J].source].getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=Q});return B}(this._layers,m,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(t,n){n&&n.filter&&this._validate(c.y.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[t];return a?function(l,d){const m=l.getRenderableIds().map(v=>l.getTileByID(v)),g=[],y={};for(let v=0;v<m.length;v++){const w=m[v],S=w.tileID.canonical.key;y[S]||(y[S]=!0,w.querySourceFeatures(g,d))}return g}(a,n):[]}addSourceType(t,n,a){return Ar(t)?a(new Error(`A source type called "${t}" already exists.`)):(((l,d)=>{as[l]=d})(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const m in t)if(!c.aG(t[m],a[m])){l=!0;break}if(!l)return;const d={now:c.h.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(d)}_validate(t,n,a,l,d={}){return(!d||d.validate!==!1)&&gi(this,t.call(c.y,c.e({key:n,style:this.serialize(),value:a,styleSpec:c.v},l)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,a,l,d=!1){let m=!1,g=!1;const y={};for(const v of this._order){const w=this._layers[v];if(w.type!=="symbol")continue;if(!y[w.source]){const A=this.sourceCaches[w.source];y[w.source]=A.getRenderableIds(!0).map(F=>A.getTileByID(F)).sort((F,B)=>B.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(B.tileID)?-1:1))}const S=this.crossTileSymbolIndex.addLayer(w,y[w.source],t.center.lng);m=m||S}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.h.now(),t.zoom))&&(this.pauseablePlacement=new Bn(t,this.map.terrain,this._order,d,n,a,l,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.h.now()),g=!0),m&&this.pauseablePlacement.placement.setStale()),g||m)for(const v of this._order){const w=this._layers[v];w.type==="symbol"&&this.placement.updateLayerOpacities(w,y[w.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,a){this.imageManager.getImages(n.icons,a),this._updateTilesForChangedImages();const l=this.sourceCaches[n.source];l&&l.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,a){this.glyphManager.getGlyphs(n.stacks,a);const l=this.sourceCaches[n.source];l&&l.setDependencies(n.tileID.key,n.type,[""])}getResource(t,n,a){return c.m(n,a)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(c.y.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,a={},l){this._checkLoaded();const d=[{id:t,url:n}],m=[...ci(this.stylesheet.sprite),...d];this._validate(c.y.sprite,"sprite",m,null,a)||(this.stylesheet.sprite=m,this._loadSprite(d,!0,l))}removeSprite(t){this._checkLoaded();const n=ci(this.stylesheet.sprite);if(n.find(a=>a.id===t)){if(this._spritesImagesIds[t])for(const a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ci(this.stylesheet.sprite)}setSprite(t,n={},a){this._checkLoaded(),t&&this._validate(c.y.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}}ui.registerForPluginStateChange=c.aK;var Ls=c.Q([{name:"a_pos",type:"Int16",components:2}]),On="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ft={prelude:mt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:mt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:mt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:mt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:mt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:mt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:mt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:mt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:mt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:mt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:mt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",On),terrainDepth:mt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",On),terrainCoords:mt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",On)};function mt(h,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),l=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=d?d.concat(l):l,g={};return{fragmentSource:h=h.replace(n,(y,v,w,S,A)=>(g[A]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${A}
varying ${w} ${S} ${A};
#else
uniform ${w} ${S} u_${A};
#endif
`:`
#ifdef HAS_UNIFORM_u_${A}
    ${w} ${S} ${A} = u_${A};
#endif
`)),vertexSource:t=t.replace(n,(y,v,w,S,A)=>{const F=S==="float"?"vec2":"vec4",B=A.match(/color/)?"color":F;return g[A]?v==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
attribute ${w} ${F} a_${A};
varying ${w} ${S} ${A};
#else
uniform ${w} ${S} u_${A};
#endif
`:B==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${w} ${S} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = unpack_mix_${B}(a_${A}, u_${A}_t);
#else
    ${w} ${S} ${A} = u_${A};
#endif
`:v==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
attribute ${w} ${F} a_${A};
#else
uniform ${w} ${S} u_${A};
#endif
`:B==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${w} ${S} ${A} = a_${A};
#else
    ${w} ${S} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${w} ${S} ${A} = unpack_mix_${B}(a_${A}, u_${A}_t);
#else
    ${w} ${S} ${A} = u_${A};
#endif
`}),staticAttributes:a,staticUniforms:m}}class fn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,a,l,d,m,g,y,v){this.context=t;let w=this.boundPaintVertexBuffers.length!==l.length;for(let S=0;!w&&S<l.length;S++)this.boundPaintVertexBuffers[S]!==l[S]&&(w=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||w||this.boundIndexBuffer!==d||this.boundVertexOffset!==m||this.boundDynamicVertexBuffer!==g||this.boundDynamicVertexBuffer2!==y||this.boundDynamicVertexBuffer3!==v?this.freshBind(n,a,l,d,m,g,y,v):(t.bindVertexArray.set(this.vao),g&&g.bind(),d&&d.dynamicDraw&&d.bind(),y&&y.bind(),v&&v.bind())}freshBind(t,n,a,l,d,m,g,y){const v=t.numAttributes,w=this.context,S=w.gl;this.vao&&this.destroy(),this.vao=w.createVertexArray(),w.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=m,this.boundDynamicVertexBuffer2=g,this.boundDynamicVertexBuffer3=y,n.enableAttributes(S,t);for(const A of a)A.enableAttributes(S,t);m&&m.enableAttributes(S,t),g&&g.enableAttributes(S,t),y&&y.enableAttributes(S,t),n.bind(),n.setVertexAttribPointers(S,t,d);for(const A of a)A.bind(),A.setVertexAttribPointers(S,t,d);m&&(m.bind(),m.setVertexAttribPointers(S,t,d)),l&&l.bind(),g&&(g.bind(),g.setVertexAttribPointers(S,t,d)),y&&(y.bind(),y.setVertexAttribPointers(S,t,d)),w.currentNumAttributes=v}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function $t(h){const t=[];for(let n=0;n<h.length;n++){if(h[n]===null)continue;const a=h[n].split(" ");t.push(a.pop())}return t}class Rs{constructor(t,n,a,l,d,m){const g=t.gl;this.program=g.createProgram();const y=$t(n.staticAttributes),v=a?a.getBinderAttributes():[],w=y.concat(v),S=Ft.prelude.staticUniforms?$t(Ft.prelude.staticUniforms):[],A=n.staticUniforms?$t(n.staticUniforms):[],F=a?a.getBinderUniforms():[],B=S.concat(A).concat(F),N=[];for(const le of B)N.indexOf(le)<0&&N.push(le);const L=a?a.defines():[];d&&L.push("#define OVERDRAW_INSPECTOR;"),m&&L.push("#define TERRAIN3D;");const J=L.concat(Ft.prelude.fragmentSource,n.fragmentSource).join(`
`),ne=L.concat(Ft.prelude.vertexSource,n.vertexSource).join(`
`),U=g.createShader(g.FRAGMENT_SHADER);if(g.isContextLost())return void(this.failedToCreate=!0);if(g.shaderSource(U,J),g.compileShader(U),!g.getShaderParameter(U,g.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${g.getShaderInfoLog(U)}`);g.attachShader(this.program,U);const Q=g.createShader(g.VERTEX_SHADER);if(g.isContextLost())return void(this.failedToCreate=!0);if(g.shaderSource(Q,ne),g.compileShader(Q),!g.getShaderParameter(Q,g.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${g.getShaderInfoLog(Q)}`);g.attachShader(this.program,Q),this.attributes={};const oe={};this.numAttributes=w.length;for(let le=0;le<this.numAttributes;le++)w[le]&&(g.bindAttribLocation(this.program,le,w[le]),this.attributes[w[le]]=le);if(g.linkProgram(this.program),!g.getProgramParameter(this.program,g.LINK_STATUS))throw new Error(`Program failed to link: ${g.getProgramInfoLog(this.program)}`);g.deleteShader(Q),g.deleteShader(U);for(let le=0;le<N.length;le++){const fe=N[le];if(fe&&!oe[fe]){const ve=g.getUniformLocation(this.program,fe);ve&&(oe[fe]=ve)}}this.fixedUniforms=l(t,oe),this.terrainUniforms=((le,fe)=>({u_depth:new c.aL(le,fe.u_depth),u_terrain:new c.aL(le,fe.u_terrain),u_terrain_dim:new c.aM(le,fe.u_terrain_dim),u_terrain_matrix:new c.aN(le,fe.u_terrain_matrix),u_terrain_unpack:new c.aO(le,fe.u_terrain_unpack),u_terrain_exaggeration:new c.aM(le,fe.u_terrain_exaggeration)}))(t,oe),this.binderUniforms=a?a.getUniforms(t,oe):[]}draw(t,n,a,l,d,m,g,y,v,w,S,A,F,B,N,L,J,ne){const U=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(l),t.setColorMode(d),t.setCullFace(m),y){t.activeTexture.set(U.TEXTURE2),U.bindTexture(U.TEXTURE_2D,y.depthTexture),t.activeTexture.set(U.TEXTURE3),U.bindTexture(U.TEXTURE_2D,y.texture);for(const oe in this.terrainUniforms)this.terrainUniforms[oe].set(y[oe])}for(const oe in this.fixedUniforms)this.fixedUniforms[oe].set(g[oe]);N&&N.setUniforms(t,this.binderUniforms,F,{zoom:B});let Q=0;switch(n){case U.LINES:Q=2;break;case U.TRIANGLES:Q=3;break;case U.LINE_STRIP:Q=1}for(const oe of A.get()){const le=oe.vaos||(oe.vaos={});(le[v]||(le[v]=new fn)).bind(t,this,w,N?N.getPaintVertexBuffers():[],S,oe.vertexOffset,L,J,ne),U.drawElements(n,oe.primitiveLength*Q,U.UNSIGNED_SHORT,oe.primitiveOffset*Q*2)}}}function ir(h,t,n){const a=1/K(n,1,t.transform.tileZoom),l=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,t.transform.tileZoom)/l,m=d*(n.tileID.canonical.x+n.tileID.wrap*l),g=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[m>>16,g>>16],u_pixel_coord_lower:[65535&m,65535&g]}}const ba=(h,t,n,a)=>{const l=t.style.light,d=l.properties.get("position"),m=[d.x,d.y,d.z],g=function(){var v=new c.A(9);return c.A!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[5]=0,v[6]=0,v[7]=0),v[0]=1,v[4]=1,v[8]=1,v}();l.properties.get("anchor")==="viewport"&&function(v,w){var S=Math.sin(w),A=Math.cos(w);v[0]=A,v[1]=S,v[2]=0,v[3]=-S,v[4]=A,v[5]=0,v[6]=0,v[7]=0,v[8]=1}(g,-t.transform.angle),function(v,w,S){var A=w[0],F=w[1],B=w[2];v[0]=A*S[0]+F*S[3]+B*S[6],v[1]=A*S[1]+F*S[4]+B*S[7],v[2]=A*S[2]+F*S[5]+B*S[8]}(m,m,g);const y=l.properties.get("color");return{u_matrix:h,u_lightpos:m,u_lightintensity:l.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_vertical_gradient:+n,u_opacity:a}},Yr=(h,t,n,a,l,d,m)=>c.e(ba(h,t,n,a),ir(d,t,m),{u_height_factor:-Math.pow(2,l.overscaledZ)/m.tileSize/8}),Po=h=>({u_matrix:h}),wa=(h,t,n,a)=>c.e(Po(h),ir(n,t,a)),Bs=(h,t)=>({u_matrix:h,u_world:t}),Fs=(h,t,n,a,l)=>c.e(wa(h,t,n,a),{u_world:l}),Jr=(h,t,n,a)=>{const l=h.transform;let d,m;if(a.paint.get("circle-pitch-alignment")==="map"){const g=K(n,1,l.zoom);d=!0,m=[g,g]}else d=!1,m=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(t.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:m}},Sa=(h,t,n)=>{const a=K(n,1,t.zoom),l=Math.pow(2,t.zoom-n.tileID.overscaledZ),d=n.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[t.pixelsToGLUnits[0]/(a*l),t.pixelsToGLUnits[1]/(a*l)],u_overscale_factor:d}},os=(h,t,n=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:n}),zo=h=>({u_matrix:h}),Gl=(h,t,n,a)=>({u_matrix:h,u_extrude_scale:K(t,1,n),u_intensity:a});function Ta(h,t){const n=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new c.U(0,a/n).toLngLat().lat,new c.U(0,(a+1)/n).toLngLat().lat]}const Ca=(h,t,n,a)=>{const l=h.transform;return{u_matrix:Os(h,t,n,a),u_ratio:1/K(t,1,l.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},Do=(h,t,n,a,l)=>c.e(Ca(h,t,n,l),{u_image:0,u_image_height:a}),Hl=(h,t,n,a,l)=>{const d=h.transform,m=Ro(t,d);return{u_matrix:Os(h,t,n,l),u_texsize:t.imageAtlasTexture.size,u_ratio:1/K(t,1,d.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[m,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Lo=(h,t,n,a,l,d)=>{const m=h.lineAtlas,g=Ro(t,h.transform),y=n.layout.get("line-cap")==="round",v=m.getDash(a.from,y),w=m.getDash(a.to,y),S=v.width*l.fromScale,A=w.width*l.toScale;return c.e(Ca(h,t,n,d),{u_patternscale_a:[g/S,-v.height/2],u_patternscale_b:[g/A,-w.height/2],u_sdfgamma:m.width/(256*Math.min(S,A)*h.pixelRatio)/2,u_image:0,u_tex_y_a:v.y,u_tex_y_b:w.y,u_mix:l.t})};function Ro(h,t){return 1/K(h,1,t.tileZoom)}function Os(h,t,n,a){return h.translatePosMatrix(a?a.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Bo=(h,t,n,a,l)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(m=l.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(d=l.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:Fo(l.paint.get("raster-hue-rotate"))};var d,m};function Fo(h){h*=Math.PI/180;const t=Math.sin(h),n=Math.cos(h);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Ia=(h,t,n,a,l,d,m,g,y,v)=>{const w=l.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:w.cameraToCenterDistance,u_pitch:w.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:w.width/w.height,u_fade_change:l.options.fadeDuration?l.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:m,u_coord_matrix:g,u_is_text:+y,u_pitch_with_map:+a,u_texsize:v,u_texture:0}},Ea=(h,t,n,a,l,d,m,g,y,v,w)=>{const S=l.transform;return c.e(Ia(h,t,n,a,l,d,m,g,y,v),{u_gamma_scale:a?Math.cos(S._pitch)*S.cameraToCenterDistance:1,u_device_pixel_ratio:l.pixelRatio,u_is_halo:+w})},mn=(h,t,n,a,l,d,m,g,y,v)=>c.e(Ea(h,t,n,a,l,d,m,g,!0,y,!0),{u_texsize_icon:v,u_texture_icon:1}),Ns=(h,t,n)=>({u_matrix:h,u_opacity:t,u_color:n}),rr=(h,t,n,a,l,d)=>c.e(function(m,g,y,v){const w=y.imageManager.getPattern(m.from.toString()),S=y.imageManager.getPattern(m.to.toString()),{width:A,height:F}=y.imageManager.getPixelSize(),B=Math.pow(2,v.tileID.overscaledZ),N=v.tileSize*Math.pow(2,y.transform.tileZoom)/B,L=N*(v.tileID.canonical.x+v.tileID.wrap*B),J=N*v.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:w.tl,u_pattern_br_a:w.br,u_pattern_tl_b:S.tl,u_pattern_br_b:S.br,u_texsize:[A,F],u_mix:g.t,u_pattern_size_a:w.displaySize,u_pattern_size_b:S.displaySize,u_scale_a:g.fromScale,u_scale_b:g.toScale,u_tile_units_to_pixels:1/K(v,1,y.transform.tileZoom),u_pixel_coord_upper:[L>>16,J>>16],u_pixel_coord_lower:[65535&L,65535&J]}}(a,d,n,l),{u_matrix:h,u_opacity:t}),Vs={fillExtrusion:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_lightpos:new c.aP(h,t.u_lightpos),u_lightintensity:new c.aM(h,t.u_lightintensity),u_lightcolor:new c.aP(h,t.u_lightcolor),u_vertical_gradient:new c.aM(h,t.u_vertical_gradient),u_opacity:new c.aM(h,t.u_opacity)}),fillExtrusionPattern:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_lightpos:new c.aP(h,t.u_lightpos),u_lightintensity:new c.aM(h,t.u_lightintensity),u_lightcolor:new c.aP(h,t.u_lightcolor),u_vertical_gradient:new c.aM(h,t.u_vertical_gradient),u_height_factor:new c.aM(h,t.u_height_factor),u_image:new c.aL(h,t.u_image),u_texsize:new c.aQ(h,t.u_texsize),u_pixel_coord_upper:new c.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(h,t.u_pixel_coord_lower),u_scale:new c.aP(h,t.u_scale),u_fade:new c.aM(h,t.u_fade),u_opacity:new c.aM(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_image:new c.aL(h,t.u_image),u_texsize:new c.aQ(h,t.u_texsize),u_pixel_coord_upper:new c.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(h,t.u_pixel_coord_lower),u_scale:new c.aP(h,t.u_scale),u_fade:new c.aM(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_world:new c.aQ(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_world:new c.aQ(h,t.u_world),u_image:new c.aL(h,t.u_image),u_texsize:new c.aQ(h,t.u_texsize),u_pixel_coord_upper:new c.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(h,t.u_pixel_coord_lower),u_scale:new c.aP(h,t.u_scale),u_fade:new c.aM(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new c.aM(h,t.u_camera_to_center_distance),u_scale_with_map:new c.aL(h,t.u_scale_with_map),u_pitch_with_map:new c.aL(h,t.u_pitch_with_map),u_extrude_scale:new c.aQ(h,t.u_extrude_scale),u_device_pixel_ratio:new c.aM(h,t.u_device_pixel_ratio),u_matrix:new c.aN(h,t.u_matrix)}),collisionBox:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_camera_to_center_distance:new c.aM(h,t.u_camera_to_center_distance),u_pixels_to_tile_units:new c.aM(h,t.u_pixels_to_tile_units),u_extrude_scale:new c.aQ(h,t.u_extrude_scale),u_overscale_factor:new c.aM(h,t.u_overscale_factor)}),collisionCircle:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_inv_matrix:new c.aN(h,t.u_inv_matrix),u_camera_to_center_distance:new c.aM(h,t.u_camera_to_center_distance),u_viewport_size:new c.aQ(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new c.aR(h,t.u_color),u_matrix:new c.aN(h,t.u_matrix),u_overlay:new c.aL(h,t.u_overlay),u_overlay_scale:new c.aM(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new c.aM(h,t.u_extrude_scale),u_intensity:new c.aM(h,t.u_intensity),u_matrix:new c.aN(h,t.u_matrix)}),heatmapTexture:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_world:new c.aQ(h,t.u_world),u_image:new c.aL(h,t.u_image),u_color_ramp:new c.aL(h,t.u_color_ramp),u_opacity:new c.aM(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_image:new c.aL(h,t.u_image),u_latrange:new c.aQ(h,t.u_latrange),u_light:new c.aQ(h,t.u_light),u_shadow:new c.aR(h,t.u_shadow),u_highlight:new c.aR(h,t.u_highlight),u_accent:new c.aR(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_image:new c.aL(h,t.u_image),u_dimension:new c.aQ(h,t.u_dimension),u_zoom:new c.aM(h,t.u_zoom),u_unpack:new c.aO(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_ratio:new c.aM(h,t.u_ratio),u_device_pixel_ratio:new c.aM(h,t.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(h,t.u_units_to_pixels)}),lineGradient:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_ratio:new c.aM(h,t.u_ratio),u_device_pixel_ratio:new c.aM(h,t.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(h,t.u_units_to_pixels),u_image:new c.aL(h,t.u_image),u_image_height:new c.aM(h,t.u_image_height)}),linePattern:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_texsize:new c.aQ(h,t.u_texsize),u_ratio:new c.aM(h,t.u_ratio),u_device_pixel_ratio:new c.aM(h,t.u_device_pixel_ratio),u_image:new c.aL(h,t.u_image),u_units_to_pixels:new c.aQ(h,t.u_units_to_pixels),u_scale:new c.aP(h,t.u_scale),u_fade:new c.aM(h,t.u_fade)}),lineSDF:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_ratio:new c.aM(h,t.u_ratio),u_device_pixel_ratio:new c.aM(h,t.u_device_pixel_ratio),u_units_to_pixels:new c.aQ(h,t.u_units_to_pixels),u_patternscale_a:new c.aQ(h,t.u_patternscale_a),u_patternscale_b:new c.aQ(h,t.u_patternscale_b),u_sdfgamma:new c.aM(h,t.u_sdfgamma),u_image:new c.aL(h,t.u_image),u_tex_y_a:new c.aM(h,t.u_tex_y_a),u_tex_y_b:new c.aM(h,t.u_tex_y_b),u_mix:new c.aM(h,t.u_mix)}),raster:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_tl_parent:new c.aQ(h,t.u_tl_parent),u_scale_parent:new c.aM(h,t.u_scale_parent),u_buffer_scale:new c.aM(h,t.u_buffer_scale),u_fade_t:new c.aM(h,t.u_fade_t),u_opacity:new c.aM(h,t.u_opacity),u_image0:new c.aL(h,t.u_image0),u_image1:new c.aL(h,t.u_image1),u_brightness_low:new c.aM(h,t.u_brightness_low),u_brightness_high:new c.aM(h,t.u_brightness_high),u_saturation_factor:new c.aM(h,t.u_saturation_factor),u_contrast_factor:new c.aM(h,t.u_contrast_factor),u_spin_weights:new c.aP(h,t.u_spin_weights)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new c.aL(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(h,t.u_is_size_feature_constant),u_size_t:new c.aM(h,t.u_size_t),u_size:new c.aM(h,t.u_size),u_camera_to_center_distance:new c.aM(h,t.u_camera_to_center_distance),u_pitch:new c.aM(h,t.u_pitch),u_rotate_symbol:new c.aL(h,t.u_rotate_symbol),u_aspect_ratio:new c.aM(h,t.u_aspect_ratio),u_fade_change:new c.aM(h,t.u_fade_change),u_matrix:new c.aN(h,t.u_matrix),u_label_plane_matrix:new c.aN(h,t.u_label_plane_matrix),u_coord_matrix:new c.aN(h,t.u_coord_matrix),u_is_text:new c.aL(h,t.u_is_text),u_pitch_with_map:new c.aL(h,t.u_pitch_with_map),u_texsize:new c.aQ(h,t.u_texsize),u_texture:new c.aL(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new c.aL(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(h,t.u_is_size_feature_constant),u_size_t:new c.aM(h,t.u_size_t),u_size:new c.aM(h,t.u_size),u_camera_to_center_distance:new c.aM(h,t.u_camera_to_center_distance),u_pitch:new c.aM(h,t.u_pitch),u_rotate_symbol:new c.aL(h,t.u_rotate_symbol),u_aspect_ratio:new c.aM(h,t.u_aspect_ratio),u_fade_change:new c.aM(h,t.u_fade_change),u_matrix:new c.aN(h,t.u_matrix),u_label_plane_matrix:new c.aN(h,t.u_label_plane_matrix),u_coord_matrix:new c.aN(h,t.u_coord_matrix),u_is_text:new c.aL(h,t.u_is_text),u_pitch_with_map:new c.aL(h,t.u_pitch_with_map),u_texsize:new c.aQ(h,t.u_texsize),u_texture:new c.aL(h,t.u_texture),u_gamma_scale:new c.aM(h,t.u_gamma_scale),u_device_pixel_ratio:new c.aM(h,t.u_device_pixel_ratio),u_is_halo:new c.aL(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new c.aL(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aL(h,t.u_is_size_feature_constant),u_size_t:new c.aM(h,t.u_size_t),u_size:new c.aM(h,t.u_size),u_camera_to_center_distance:new c.aM(h,t.u_camera_to_center_distance),u_pitch:new c.aM(h,t.u_pitch),u_rotate_symbol:new c.aL(h,t.u_rotate_symbol),u_aspect_ratio:new c.aM(h,t.u_aspect_ratio),u_fade_change:new c.aM(h,t.u_fade_change),u_matrix:new c.aN(h,t.u_matrix),u_label_plane_matrix:new c.aN(h,t.u_label_plane_matrix),u_coord_matrix:new c.aN(h,t.u_coord_matrix),u_is_text:new c.aL(h,t.u_is_text),u_pitch_with_map:new c.aL(h,t.u_pitch_with_map),u_texsize:new c.aQ(h,t.u_texsize),u_texsize_icon:new c.aQ(h,t.u_texsize_icon),u_texture:new c.aL(h,t.u_texture),u_texture_icon:new c.aL(h,t.u_texture_icon),u_gamma_scale:new c.aM(h,t.u_gamma_scale),u_device_pixel_ratio:new c.aM(h,t.u_device_pixel_ratio),u_is_halo:new c.aL(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_opacity:new c.aM(h,t.u_opacity),u_color:new c.aR(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_opacity:new c.aM(h,t.u_opacity),u_image:new c.aL(h,t.u_image),u_pattern_tl_a:new c.aQ(h,t.u_pattern_tl_a),u_pattern_br_a:new c.aQ(h,t.u_pattern_br_a),u_pattern_tl_b:new c.aQ(h,t.u_pattern_tl_b),u_pattern_br_b:new c.aQ(h,t.u_pattern_br_b),u_texsize:new c.aQ(h,t.u_texsize),u_mix:new c.aM(h,t.u_mix),u_pattern_size_a:new c.aQ(h,t.u_pattern_size_a),u_pattern_size_b:new c.aQ(h,t.u_pattern_size_b),u_scale_a:new c.aM(h,t.u_scale_a),u_scale_b:new c.aM(h,t.u_scale_b),u_pixel_coord_upper:new c.aQ(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.aQ(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aM(h,t.u_tile_units_to_pixels)}),terrain:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_texture:new c.aL(h,t.u_texture),u_ele_delta:new c.aM(h,t.u_ele_delta)}),terrainDepth:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_ele_delta:new c.aM(h,t.u_ele_delta)}),terrainCoords:(h,t)=>({u_matrix:new c.aN(h,t.u_matrix),u_texture:new c.aL(h,t.u_texture),u_terrain_coords_id:new c.aM(h,t.u_terrain_coords_id),u_ele_delta:new c.aM(h,t.u_ele_delta)})};class js{constructor(t,n,a){this.context=t;const l=t.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ls={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $s{constructor(t,n,a,l){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=l,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];l!==void 0&&t.enableVertexAttribArray(l)}}setVertexAttribPointers(t,n,a){for(let l=0;l<this.attributes.length;l++){const d=this.attributes[l],m=n.attributes[d.name];m!==void 0&&t.vertexAttribPointer(m,d.components,t[ls[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Nn=new WeakMap;function Qr(h){var t;if(Nn.has(h))return Nn.get(h);{const n=(t=h.getParameter(h.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Nn.set(h,n),n}}class ct{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Us extends ct{getDefault(){return c.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ji extends ct{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class $i extends ct{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ma extends ct{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class qs extends ct{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Zs extends ct{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Aa extends ct{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ka extends ct{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Gs extends ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Pa extends ct{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class za extends ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Hs extends ct{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Oo extends ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class No extends ct{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vn extends ct{getDefault(){return c.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wl extends ct{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Xl extends ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Kl extends ct{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Yl extends ct{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Jl extends ct{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ql extends ct{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Da extends ct{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ws extends ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class La extends ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ra extends ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class jn extends ct{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Vo extends ct{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class jo extends ct{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const a=this.gl;Qr(a)?a.bindVertexArray(t):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ba extends ct{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class gn extends ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class $o extends ct{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class en extends ct{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class $n extends en{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Uo extends en{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Fa extends en{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class gt{constructor(t,n,a,l,d){this.context=t,this.width=n,this.height=a;const m=t.gl,g=this.framebuffer=m.createFramebuffer();if(this.colorAttachment=new $n(t,g),l)this.depthAttachment=d?new Fa(t,g):new Uo(t,g);else if(d)throw new Error("Stencil cannot be setted without depth");if(m.checkFramebufferStatus(m.FRAMEBUFFER)!==m.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class Ot{constructor(t,n,a){this.blendFunction=t,this.blendColor=n,this.mask=a}}Ot.Replace=[1,0],Ot.disabled=new Ot(Ot.Replace,c.aT.transparent,[!1,!1,!1,!1]),Ot.unblended=new Ot(Ot.Replace,c.aT.transparent,[!0,!0,!0,!0]),Ot.alphaBlended=new Ot([1,771],c.aT.transparent,[!0,!0,!0,!0]);class ec{constructor(t){var n,a;if(this.gl=t,this.clearColor=new Us(this),this.clearDepth=new ji(this),this.clearStencil=new $i(this),this.colorMask=new Ma(this),this.depthMask=new qs(this),this.stencilMask=new Zs(this),this.stencilFunc=new Aa(this),this.stencilOp=new ka(this),this.stencilTest=new Gs(this),this.depthRange=new Pa(this),this.depthTest=new za(this),this.depthFunc=new Hs(this),this.blend=new Oo(this),this.blendFunc=new No(this),this.blendColor=new Vn(this),this.blendEquation=new Wl(this),this.cullFace=new Xl(this),this.cullFaceSide=new Kl(this),this.frontFace=new Yl(this),this.program=new Jl(this),this.activeTexture=new Ql(this),this.viewport=new Da(this),this.bindFramebuffer=new Ws(this),this.bindRenderbuffer=new La(this),this.bindTexture=new Ra(this),this.bindVertexBuffer=new jn(this),this.bindElementBuffer=new Vo(this),this.bindVertexArray=new jo(this),this.pixelStoreUnpack=new Ba(this),this.pixelStoreUnpackPremultiplyAlpha=new gn(this),this.pixelStoreUnpackFlipY=new $o(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Qr(t)){this.HALF_FLOAT=t.HALF_FLOAT;const l=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:l?.RGBA16F_EXT,this.RGB16F=(a=t.RGB16F)!==null&&a!==void 0?a:l?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const l=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=l?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new js(this,t,n)}createVertexBuffer(t,n,a){return new $s(this,t,n,a)}createRenderbuffer(t,n,a){const l=this.gl,d=l.createRenderbuffer();return this.bindRenderbuffer.set(d),l.renderbufferStorage(l.RENDERBUFFER,t,n,a),this.bindRenderbuffer.set(null),d}createFramebuffer(t,n,a,l){return new gt(this,t,n,a,l)}clear({color:t,depth:n,stencil:a}){const l=this.gl;let d=0;t&&(d|=l.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(d|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(d|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),l.clear(d)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){c.aG(t.blendFunction,Ot.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Qr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return Qr(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class ht{constructor(t,n,a){this.func=t,this.mask=n,this.range=a}}ht.ReadOnly=!1,ht.ReadWrite=!0,ht.disabled=new ht(519,ht.ReadOnly,[0,1]);const _n=7680;class Nt{constructor(t,n,a,l,d,m){this.test=t,this.ref=n,this.mask=a,this.fail=l,this.depthFail=d,this.pass=m}}Nt.disabled=new Nt({func:519,mask:0},0,0,_n,_n,_n);class Lt{constructor(t,n,a){this.enable=t,this.mode=n,this.frontFace=a}}let cs;function qo(h,t,n,a,l,d,m){const g=h.context,y=g.gl,v=h.useProgram("collisionBox"),w=[];let S=0,A=0;for(let U=0;U<a.length;U++){const Q=a[U],oe=t.getTile(Q),le=oe.getBucket(n);if(!le)continue;let fe=Q.posMatrix;l[0]===0&&l[1]===0||(fe=h.translatePosMatrix(Q.posMatrix,oe,l,d));const ve=m?le.textCollisionBox:le.iconCollisionBox,_e=le.collisionCircleArray;if(_e.length>0){const we=c.Z(),Be=fe;c.aU(we,le.placementInvProjMatrix,h.transform.glCoordMatrix),c.aU(we,we,le.placementViewportMatrix),w.push({circleArray:_e,circleOffset:A,transform:Be,invTransform:we,coord:Q}),S+=_e.length/4,A=S}ve&&v.draw(g,y.LINES,ht.disabled,Nt.disabled,h.colorModeForRenderPass(),Lt.disabled,Sa(fe,h.transform,oe),h.style.map.terrain&&h.style.map.terrain.getTerrainData(Q),n.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,null,h.transform.zoom,null,null,ve.collisionVertexBuffer)}if(!m||!w.length)return;const F=h.useProgram("collisionCircle"),B=new c.aV;B.resize(4*S),B._trim();let N=0;for(const U of w)for(let Q=0;Q<U.circleArray.length/4;Q++){const oe=4*Q,le=U.circleArray[oe+0],fe=U.circleArray[oe+1],ve=U.circleArray[oe+2],_e=U.circleArray[oe+3];B.emplace(N++,le,fe,ve,_e,0),B.emplace(N++,le,fe,ve,_e,1),B.emplace(N++,le,fe,ve,_e,2),B.emplace(N++,le,fe,ve,_e,3)}(!cs||cs.length<2*S)&&(cs=function(U){const Q=2*U,oe=new c.aX;oe.resize(Q),oe._trim();for(let le=0;le<Q;le++){const fe=6*le;oe.uint16[fe+0]=4*le+0,oe.uint16[fe+1]=4*le+1,oe.uint16[fe+2]=4*le+2,oe.uint16[fe+3]=4*le+2,oe.uint16[fe+4]=4*le+3,oe.uint16[fe+5]=4*le+0}return oe}(S));const L=g.createIndexBuffer(cs,!0),J=g.createVertexBuffer(B,c.aW.members,!0);for(const U of w){const Q={u_matrix:U.transform,u_inv_matrix:U.invTransform,u_camera_to_center_distance:(ne=h.transform).cameraToCenterDistance,u_viewport_size:[ne.width,ne.height]};F.draw(g,y.TRIANGLES,ht.disabled,Nt.disabled,h.colorModeForRenderPass(),Lt.disabled,Q,h.style.map.terrain&&h.style.map.terrain.getTerrainData(U.coord),n.id,J,L,c.S.simpleSegment(0,2*U.circleOffset,U.circleArray.length,U.circleArray.length/2),null,h.transform.zoom,null,null,null)}var ne;J.destroy(),L.destroy()}Lt.disabled=new Lt(!1,1029,2305),Lt.backCCW=new Lt(!0,1029,2305);const Oa=c.ao(new Float32Array(16));function Xs(h,t,n,a,l,d){const{horizontalAlign:m,verticalAlign:g}=c.au(h);return new c.P((-(m-.5)*t/l+a[0])*d,(-(g-.5)*n/l+a[1])*d)}function Ks(h,t,n,a,l,d,m,g,y,v,w){const S=h.text.placedSymbolArray,A=h.text.dynamicLayoutVertexArray,F=h.icon.dynamicLayoutVertexArray,B={};A.clear();for(let N=0;N<S.length;N++){const L=S.get(N),J=L.hidden||!L.crossTileID||h.allowVerticalPlacement&&!L.placedOrientation?null:a[L.crossTileID];if(J){const ne=new c.P(L.anchorX,L.anchorY),U=jt(ne,n?m:d,w),Q=pn(l.cameraToCenterDistance,U.signedDistanceFromCamera);let oe=c.aj(h.textSizeData,y,L)*Q/c.ap;n&&(oe*=h.tilePixelRatio/g);const{width:le,height:fe,anchor:ve,textOffset:_e,textBoxScale:we}=J,Be=Xs(ve,le,fe,_e,we,oe),st=n?jt(ne.add(Be),d,w).point:U.point.add(t?Be.rotate(-l.angle):Be),Ee=h.allowVerticalPlacement&&L.placedOrientation===c.ai.vertical?Math.PI/2:0;for(let Ge=0;Ge<L.numGlyphs;Ge++)c.ak(A,st,Ee);v&&L.associatedIconIndex>=0&&(B[L.associatedIconIndex]={shiftedAnchor:st,angle:Ee})}else D(L.numGlyphs,A)}if(v){F.clear();const N=h.icon.placedSymbolArray;for(let L=0;L<N.length;L++){const J=N.get(L);if(J.hidden)D(J.numGlyphs,F);else{const ne=B[L];if(ne)for(let U=0;U<J.numGlyphs;U++)c.ak(F,ne.shiftedAnchor,ne.angle);else D(J.numGlyphs,F)}}h.icon.dynamicLayoutVertexBuffer.updateData(F)}h.text.dynamicLayoutVertexBuffer.updateData(A)}function Na(h,t,n){return n.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ys(h,t,n,a,l,d,m,g,y,v,w,S){const A=h.context,F=A.gl,B=h.transform,N=g==="map",L=y==="map",J=g!=="viewport"&&n.layout.get("symbol-placement")!=="point",ne=N&&!L&&!J,U=!n.layout.get("symbol-sort-key").isConstant();let Q=!1;const oe=h.depthModeForSublayer(0,ht.ReadOnly),le=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),fe=[];for(const ve of a){const _e=t.getTile(ve),we=_e.getBucket(n);if(!we)continue;const Be=l?we.text:we.icon;if(!Be||!Be.segments.get().length||!Be.hasVisibleVertices)continue;const st=Be.programConfigurations.get(n.id),Ee=l||we.sdfIcons,Ge=l?we.textSizeData:we.iconSizeData,Oe=L||B.pitch!==0,St=h.useProgram(Na(Ee,l,we),st),rt=c.ah(Ge,B.zoom),Qe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ve);let at,Zt,Mt,di,ei=[0,0],Xt=null;if(l)Zt=_e.glyphAtlasTexture,Mt=F.LINEAR,at=_e.glyphAtlasTexture.size,we.iconsInText&&(ei=_e.imageAtlasTexture.size,Xt=_e.imageAtlasTexture,di=Oe||h.options.rotating||h.options.zooming||Ge.kind==="composite"||Ge.kind==="camera"?F.LINEAR:F.NEAREST);else{const Gt=n.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear;Zt=_e.imageAtlasTexture,Mt=Ee||h.options.rotating||h.options.zooming||Gt||Oe?F.LINEAR:F.NEAREST,at=_e.imageAtlasTexture.size}const Zi=K(_e,1,h.transform.zoom),zt=Te(ve.posMatrix,L,N,h.transform,Zi),br=yr(ve.posMatrix,L,N,h.transform,Zi),wr=le&&we.hasTextData(),nn=n.layout.get("icon-text-fit")!=="none"&&wr&&we.hasIconData();if(J){const Gt=h.style.map.terrain?(Di,Ht)=>h.style.map.terrain.getElevation(ve,Di,Ht):null,ti=n.layout.get("text-rotation-alignment")==="map";Ie(we,ve.posMatrix,h,l,zt,br,L,v,ti,Gt)}const wn=h.translatePosMatrix(ve.posMatrix,_e,d,m),Xn=J||l&&le||nn?Oa:zt,_i=h.translatePosMatrix(br,_e,d,m,!0),pi=Ee&&n.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ti;Ti=Ee?we.iconsInText?mn(Ge.kind,rt,ne,L,h,wn,Xn,_i,at,ei):Ea(Ge.kind,rt,ne,L,h,wn,Xn,_i,l,at,!0):Ia(Ge.kind,rt,ne,L,h,wn,Xn,_i,l,at);const Sn={program:St,buffers:Be,uniformValues:Ti,atlasTexture:Zt,atlasTextureIcon:Xt,atlasInterpolation:Mt,atlasInterpolationIcon:di,isSDF:Ee,hasHalo:pi};if(U&&we.canOverlap){Q=!0;const Gt=Be.segments.get();for(const ti of Gt)fe.push({segments:new c.S([ti]),sortKey:ti.sortKey,state:Sn,terrainData:Qe})}else fe.push({segments:Be.segments,sortKey:0,state:Sn,terrainData:Qe})}Q&&fe.sort((ve,_e)=>ve.sortKey-_e.sortKey);for(const ve of fe){const _e=ve.state;if(A.activeTexture.set(F.TEXTURE0),_e.atlasTexture.bind(_e.atlasInterpolation,F.CLAMP_TO_EDGE),_e.atlasTextureIcon&&(A.activeTexture.set(F.TEXTURE1),_e.atlasTextureIcon&&_e.atlasTextureIcon.bind(_e.atlasInterpolationIcon,F.CLAMP_TO_EDGE)),_e.isSDF){const we=_e.uniformValues;_e.hasHalo&&(we.u_is_halo=1,Va(_e.buffers,ve.segments,n,h,_e.program,oe,w,S,we,ve.terrainData)),we.u_is_halo=0}Va(_e.buffers,ve.segments,n,h,_e.program,oe,w,S,_e.uniformValues,ve.terrainData)}}function Va(h,t,n,a,l,d,m,g,y,v){const w=a.context;l.draw(w,w.gl.TRIANGLES,d,m,g,Lt.disabled,y,v,n.id,h.layoutVertexBuffer,h.indexBuffer,t,n.paint,a.transform.zoom,h.programConfigurations.get(n.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function hs(h,t,n,a,l){if(!n||!a||!a.imageAtlas)return;const d=a.imageAtlas.patternPositions;let m=d[n.to.toString()],g=d[n.from.toString()];if(!m&&g&&(m=g),!g&&m&&(g=m),!m||!g){const y=l.getPaintProperty(t);m=d[y],g=d[y]}m&&g&&h.setConstantPatternPositions(m,g)}function us(h,t,n,a,l,d,m){const g=h.context.gl,y="fill-pattern",v=n.paint.get(y),w=v&&v.constantOr(1),S=n.getCrossfadeParameters();let A,F,B,N,L;m?(F=w&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",A=g.LINES):(F=w?"fillPattern":"fill",A=g.TRIANGLES);const J=v.constantOr(null);for(const ne of a){const U=t.getTile(ne);if(w&&!U.patternsLoaded())continue;const Q=U.getBucket(n);if(!Q)continue;const oe=Q.programConfigurations.get(n.id),le=h.useProgram(F,oe),fe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ne);w&&(h.context.activeTexture.set(g.TEXTURE0),U.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),oe.updatePaintBuffers(S)),hs(oe,y,J,U,n);const ve=fe?ne:null,_e=h.translatePosMatrix(ve?ve.posMatrix:ne.posMatrix,U,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(m){N=Q.indexBuffer2,L=Q.segments2;const we=[g.drawingBufferWidth,g.drawingBufferHeight];B=F==="fillOutlinePattern"&&w?Fs(_e,h,S,U,we):Bs(_e,we)}else N=Q.indexBuffer,L=Q.segments,B=w?wa(_e,h,S,U):Po(_e);le.draw(h.context,A,l,h.stencilModeForClipping(ne),d,Lt.disabled,B,fe,n.id,Q.layoutVertexBuffer,N,L,n.paint,h.transform.zoom,oe)}}function ds(h,t,n,a,l,d,m){const g=h.context,y=g.gl,v="fill-extrusion-pattern",w=n.paint.get(v),S=w.constantOr(1),A=n.getCrossfadeParameters(),F=n.paint.get("fill-extrusion-opacity"),B=w.constantOr(null);for(const N of a){const L=t.getTile(N),J=L.getBucket(n);if(!J)continue;const ne=h.style.map.terrain&&h.style.map.terrain.getTerrainData(N),U=J.programConfigurations.get(n.id),Q=h.useProgram(S?"fillExtrusionPattern":"fillExtrusion",U);S&&(h.context.activeTexture.set(y.TEXTURE0),L.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),U.updatePaintBuffers(A)),hs(U,v,B,L,n);const oe=h.translatePosMatrix(N.posMatrix,L,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),le=n.paint.get("fill-extrusion-vertical-gradient"),fe=S?Yr(oe,h,le,F,N,A,L):ba(oe,h,le,F);Q.draw(g,g.gl.TRIANGLES,l,d,m,Lt.backCCW,fe,ne,n.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,n.paint,h.transform.zoom,U,h.style.map.terrain&&J.centroidVertexBuffer)}}function tc(h,t,n,a,l,d,m){const g=h.context,y=g.gl,v=n.fbo;if(!v)return;const w=h.useProgram("hillshade"),S=h.style.map.terrain&&h.style.map.terrain.getTerrainData(t);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,v.colorAttachment.get()),w.draw(g,y.TRIANGLES,l,d,m,Lt.disabled,((A,F,B,N)=>{const L=B.paint.get("hillshade-shadow-color"),J=B.paint.get("hillshade-highlight-color"),ne=B.paint.get("hillshade-accent-color");let U=B.paint.get("hillshade-illumination-direction")*(Math.PI/180);B.paint.get("hillshade-illumination-anchor")==="viewport"&&(U-=A.transform.angle);const Q=!A.options.moving;return{u_matrix:N?N.posMatrix:A.transform.calculatePosMatrix(F.tileID.toUnwrapped(),Q),u_image:0,u_latrange:Ta(0,F.tileID),u_light:[B.paint.get("hillshade-exaggeration"),U],u_shadow:L,u_highlight:J,u_accent:ne}})(h,n,a,S?t:null),S,a.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function ja(h,t,n,a,l,d){const m=h.context,g=m.gl,y=t.dem;if(y&&y.data){const v=y.dim,w=y.stride,S=y.getPixels();if(m.activeTexture.set(g.TEXTURE1),m.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(w),t.demTexture){const F=t.demTexture;F.update(S,{premultiply:!1}),F.bind(g.NEAREST,g.CLAMP_TO_EDGE)}else t.demTexture=new Bt(m,S,g.RGBA,{premultiply:!1}),t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);m.activeTexture.set(g.TEXTURE0);let A=t.fbo;if(!A){const F=new Bt(m,{width:v,height:v,data:null},g.RGBA);F.bind(g.LINEAR,g.CLAMP_TO_EDGE),A=t.fbo=m.createFramebuffer(v,v,!0,!1),A.colorAttachment.set(F.texture)}m.bindFramebuffer.set(A.framebuffer),m.viewport.set([0,0,v,v]),h.useProgram("hillshadePrepare").draw(m,g.TRIANGLES,a,l,d,Lt.disabled,((F,B)=>{const N=B.stride,L=c.Z();return c.aS(L,0,c.N,-c.N,0,0,1),c.$(L,L,[0,-c.N,0]),{u_matrix:L,u_image:1,u_dimension:[N,N],u_zoom:F.overscaledZ,u_unpack:B.getUnpackVector()}})(t.tileID,y),null,n.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function ic(h,t,n,a,l,d){const m=a.paint.get("raster-fade-duration");if(!d&&m>0){const g=c.h.now(),y=(g-h.timeAdded)/m,v=t?(g-t.timeAdded)/m:-1,w=n.getSource(),S=l.coveringZoomLevel({tileSize:w.tileSize,roundZoom:w.roundZoom}),A=!t||Math.abs(t.tileID.overscaledZ-S)>Math.abs(h.tileID.overscaledZ-S),F=A&&h.refreshedUponExpiration?1:c.ad(A?y:1-v,0,1);return h.refreshedUponExpiration&&y>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}const Zo=new c.aT(1,0,0,1),Js=new c.aT(0,1,0,1),$a=new c.aT(0,0,1,1),Go=new c.aT(1,0,1,1),Ho=new c.aT(0,1,1,1);function ps(h,t,n,a){ea(h,0,t+n/2,h.transform.width,n,a)}function Qs(h,t,n,a){ea(h,t-n/2,0,n,h.transform.height,a)}function ea(h,t,n,a,l,d){const m=h.context,g=m.gl;g.enable(g.SCISSOR_TEST),g.scissor(t*h.pixelRatio,n*h.pixelRatio,a*h.pixelRatio,l*h.pixelRatio),m.clear({color:d}),g.disable(g.SCISSOR_TEST)}function Wo(h,t,n){const a=h.context,l=a.gl,d=n.posMatrix,m=h.useProgram("debug"),g=ht.disabled,y=Nt.disabled,v=h.colorModeForRenderPass(),w="$debug",S=h.style.map.terrain&&h.style.map.terrain.getTerrainData(n);a.activeTexture.set(l.TEXTURE0);const A=t.getTileByID(n.key).latestRawTileData,F=Math.floor((A&&A.byteLength||0)/1024),B=t.getTile(n).tileSize,N=512/Math.min(B,512)*(n.overscaledZ/h.transform.zoom)*.5;let L=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(L+=` => ${n.overscaledZ}`),function(J,ne){J.initDebugOverlayCanvas();const U=J.debugOverlayCanvas,Q=J.context.gl,oe=J.debugOverlayCanvas.getContext("2d");oe.clearRect(0,0,U.width,U.height),oe.shadowColor="white",oe.shadowBlur=2,oe.lineWidth=1.5,oe.strokeStyle="white",oe.textBaseline="top",oe.font="bold 36px Open Sans, sans-serif",oe.fillText(ne,5,5),oe.strokeText(ne,5,5),J.debugOverlayTexture.update(U),J.debugOverlayTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}(h,`${L} ${F}kB`),m.draw(a,l.TRIANGLES,g,y,Ot.alphaBlended,Lt.disabled,os(d,c.aT.transparent,N),null,w,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),m.draw(a,l.LINE_STRIP,g,y,v,Lt.disabled,os(d,c.aT.red),S,w,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function Ut(h,t,n){const a=h.context,l=a.gl,d=h.colorModeForRenderPass(),m=new ht(l.LEQUAL,ht.ReadWrite,h.depthRangeFor3D),g=h.useProgram("terrain"),y=t.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,h.width,h.height]);for(const v of n){const w=h.renderToTexture.getTexture(v),S=t.getTerrainData(v.tileID);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,w.texture);const A={u_matrix:h.transform.calculatePosMatrix(v.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(h.transform.zoom)};g.draw(a,l.TRIANGLES,m,Nt.disabled,d,Lt.backCCW,A,S,"terrain",y.vertexBuffer,y.indexBuffer,y.segments)}}class yn{constructor(t,n){this.context=new ec(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.Z(),renderTime:0},this.setup(),this.numSublayers=ki.maxUnderzooming+ki.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ds}resize(t,n,a){if(this.width=Math.floor(t*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style._order)this.style._layers[l].resize()}setup(){const t=this.context,n=new c.a_;n.emplaceBack(0,0),n.emplaceBack(c.N,0),n.emplaceBack(0,c.N),n.emplaceBack(c.N,c.N),this.tileExtentBuffer=t.createVertexBuffer(n,Ls.members),this.tileExtentSegments=c.S.simpleSegment(0,0,4,2);const a=new c.a_;a.emplaceBack(0,0),a.emplaceBack(c.N,0),a.emplaceBack(0,c.N),a.emplaceBack(c.N,c.N),this.debugBuffer=t.createVertexBuffer(a,Ls.members),this.debugSegments=c.S.simpleSegment(0,0,4,5);const l=new c.V;l.emplaceBack(0,0,0,0),l.emplaceBack(c.N,0,c.N,0),l.emplaceBack(0,c.N,0,c.N),l.emplaceBack(c.N,c.N,c.N,c.N),this.rasterBoundsBuffer=t.createVertexBuffer(l,ur.members),this.rasterBoundsSegments=c.S.simpleSegment(0,0,4,2);const d=new c.a_;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,Ls.members),this.viewportSegments=c.S.simpleSegment(0,0,4,2);const m=new c.a$;m.emplaceBack(0),m.emplaceBack(1),m.emplaceBack(3),m.emplaceBack(2),m.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(m);const g=new c.b0;g.emplaceBack(0,1,2),g.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(g);const y=this.context.gl;this.stencilClearMode=new Nt({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.Z();c.aS(a,0,this.width,this.height,0,0,1),c.a0(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,ht.disabled,this.stencilClearMode,Ot.disabled,Lt.disabled,zo(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const a=this.context,l=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(Ot.disabled),a.setDepthMode(ht.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const m of n){const g=this._tileClippingMaskIDs[m.key]=this.nextStencilID++,y=this.style.map.terrain&&this.style.map.terrain.getTerrainData(m);d.draw(a,l.TRIANGLES,ht.disabled,new Nt({func:l.ALWAYS,mask:0},g,255,l.KEEP,l.KEEP,l.REPLACE),Ot.disabled,Lt.disabled,zo(m.posMatrix),y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Nt({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Nt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,a=t.sort((m,g)=>g.overscaledZ-m.overscaledZ),l=a[a.length-1].overscaledZ,d=a[0].overscaledZ-l+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const m={};for(let g=0;g<d;g++)m[g+l]=new Nt({func:n.GEQUAL,mask:255},g+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=d,[m,a]}return[{[l]:Nt.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ot([t.CONSTANT_COLOR,t.ONE],new c.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ot.unblended:Ot.alphaBlended}depthModeForSublayer(t,n,a){if(!this.opaquePassEnabledForLayer())return ht.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ht(a||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(c.h.now()),this.imageManager.beginFrame();const a=this.style._order,l=this.style.sourceCaches,d={},m={},g={};for(const y in l){const v=l[y];v.used&&v.prepare(this.context),d[y]=v.getVisibleCoordinates(),m[y]=d[y].slice().reverse(),g[y]=v.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let y=0;y<a.length;y++)if(this.style._layers[a[y]].is3D()){this.opaquePassCutoff=y;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!c.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||y.length)&&(c.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,w){const S=v.context,A=S.gl,F=Ot.unblended,B=new ht(A.LEQUAL,ht.ReadWrite,[0,1]),N=w.getTerrainMesh(),L=w.sourceCache.getRenderableTiles(),J=v.useProgram("terrainDepth");S.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),S.clear({color:c.aT.transparent,depth:1});for(const ne of L){const U=w.getTerrainData(ne.tileID),Q={u_matrix:v.transform.calculatePosMatrix(ne.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(v.transform.zoom)};J.draw(S,A.TRIANGLES,B,Nt.disabled,F,Lt.backCCW,Q,U,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,w){const S=v.context,A=S.gl,F=Ot.unblended,B=new ht(A.LEQUAL,ht.ReadWrite,[0,1]),N=w.getTerrainMesh(),L=w.getCoordsTexture(),J=w.sourceCache.getRenderableTiles(),ne=v.useProgram("terrainCoords");S.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),S.clear({color:c.aT.transparent,depth:1}),w.coordsIndex=[];for(const U of J){const Q=w.getTerrainData(U.tileID);S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,L.texture);const oe={u_matrix:v.transform.calculatePosMatrix(U.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(v.transform.zoom)};ne.draw(S,A.TRIANGLES,B,Nt.disabled,F,Lt.backCCW,oe,Q,"terrain",N.vertexBuffer,N.indexBuffer,N.segments),w.coordsIndex.push(U.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const y of a){const v=this.style._layers[y];if(!v.hasOffscreenPass()||v.isHidden(this.transform.zoom))continue;const w=m[v.source];(v.type==="custom"||w.length)&&this.renderLayer(this,l[v.source],v,w)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.aT.black:c.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const y=this.style._layers[a[this.currentLayer]],v=l[y.source],w=d[y.source];this._renderTileClippingMasks(y,w),this.renderLayer(this,v,y,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const y=this.style._layers[a[this.currentLayer]],v=l[y.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(y))continue;const w=(y.type==="symbol"?g:m)[y.source];this._renderTileClippingMasks(y,d[y.source]),this.renderLayer(this,v,y,w)}if(this.options.showTileBoundaries){const y=function(v,w){let S=null;const A=Object.values(v._layers).flatMap(L=>L.source&&!L.isHidden(w)?[v.sourceCaches[L.source]]:[]),F=A.filter(L=>L.getSource().type==="vector"),B=A.filter(L=>L.getSource().type!=="vector"),N=L=>{(!S||S.getSource().maxzoom<L.getSource().maxzoom)&&(S=L)};return F.forEach(L=>N(L)),S||B.forEach(L=>N(L)),S}(this.style,this.transform.zoom);y&&function(v,w,S){for(let A=0;A<S.length;A++)Wo(v,w,S[A])}(this,y,y.getVisibleCoordinates())}this.options.showPadding&&function(y){const v=y.transform.padding;ps(y,y.transform.height-(v.top||0),3,Zo),ps(y,v.bottom||0,3,Js),Qs(y,v.left||0,3,$a),Qs(y,y.transform.width-(v.right||0),3,Go);const w=y.transform.centerPoint;(function(S,A,F,B){ea(S,A-1,F-10,2,20,B),ea(S,A-10,F-1,20,2,B)})(y,w.x,y.transform.height-w.y,Ho)}(this),this.context.setDefault()}renderLayer(t,n,a,l){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(l||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(d,m,g,y,v){if(d.renderPass!=="translucent")return;const w=Nt.disabled,S=d.colorModeForRenderPass();(g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(A,F,B,N,L,J,ne){const U=F.transform,Q=L==="map",oe=J==="map";for(const le of A){const fe=N.getTile(le),ve=fe.getBucket(B);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const _e=c.ah(ve.textSizeData,U.zoom),we=K(fe,1,F.transform.zoom),Be=Te(le.posMatrix,oe,Q,F.transform,we),st=B.layout.get("icon-text-fit")!=="none"&&ve.hasIconData();if(_e){const Ee=Math.pow(2,U.zoom-fe.tileID.overscaledZ);Ks(ve,Q,oe,ne,U,Be,le.posMatrix,Ee,_e,st,F.style.map.terrain?(Ge,Oe)=>F.style.map.terrain.getElevation(le,Ge,Oe):null)}}}(y,d,g,m,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),v),g.paint.get("icon-opacity").constantOr(1)!==0&&Ys(d,m,g,y,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),w,S),g.paint.get("text-opacity").constantOr(1)!==0&&Ys(d,m,g,y,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),w,S),m.map.showCollisionBoxes&&(qo(d,m,g,y,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),qo(d,m,g,y,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))})(t,n,a,l,this.style.placement.variableOffsets);break;case"circle":(function(d,m,g,y){if(d.renderPass!=="translucent")return;const v=g.paint.get("circle-opacity"),w=g.paint.get("circle-stroke-width"),S=g.paint.get("circle-stroke-opacity"),A=!g.layout.get("circle-sort-key").isConstant();if(v.constantOr(1)===0&&(w.constantOr(1)===0||S.constantOr(1)===0))return;const F=d.context,B=F.gl,N=d.depthModeForSublayer(0,ht.ReadOnly),L=Nt.disabled,J=d.colorModeForRenderPass(),ne=[];for(let U=0;U<y.length;U++){const Q=y[U],oe=m.getTile(Q),le=oe.getBucket(g);if(!le)continue;const fe=le.programConfigurations.get(g.id),ve=d.useProgram("circle",fe),_e=le.layoutVertexBuffer,we=le.indexBuffer,Be=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Q),st={programConfiguration:fe,program:ve,layoutVertexBuffer:_e,indexBuffer:we,uniformValues:Jr(d,Q,oe,g),terrainData:Be};if(A){const Ee=le.segments.get();for(const Ge of Ee)ne.push({segments:new c.S([Ge]),sortKey:Ge.sortKey,state:st})}else ne.push({segments:le.segments,sortKey:0,state:st})}A&&ne.sort((U,Q)=>U.sortKey-Q.sortKey);for(const U of ne){const{programConfiguration:Q,program:oe,layoutVertexBuffer:le,indexBuffer:fe,uniformValues:ve,terrainData:_e}=U.state;oe.draw(F,B.TRIANGLES,N,L,J,Lt.disabled,ve,_e,g.id,le,fe,U.segments,g.paint,d.transform.zoom,Q)}})(t,n,a,l);break;case"heatmap":(function(d,m,g,y){if(g.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const v=d.context,w=v.gl,S=Nt.disabled,A=new Ot([w.ONE,w.ONE],c.aT.transparent,[!0,!0,!0,!0]);(function(F,B,N){const L=F.gl;F.activeTexture.set(L.TEXTURE1),F.viewport.set([0,0,B.width/4,B.height/4]);let J=N.heatmapFbo;if(J)L.bindTexture(L.TEXTURE_2D,J.colorAttachment.get()),F.bindFramebuffer.set(J.framebuffer);else{const ne=L.createTexture();L.bindTexture(L.TEXTURE_2D,ne),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.LINEAR),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.LINEAR),J=N.heatmapFbo=F.createFramebuffer(B.width/4,B.height/4,!1,!1),function(U,Q,oe,le){var fe,ve;const _e=U.gl,we=(fe=U.HALF_FLOAT)!==null&&fe!==void 0?fe:_e.UNSIGNED_BYTE,Be=(ve=U.RGBA16F)!==null&&ve!==void 0?ve:_e.RGBA;_e.texImage2D(_e.TEXTURE_2D,0,Be,Q.width/4,Q.height/4,0,_e.RGBA,we,null),le.colorAttachment.set(oe)}(F,B,ne,J)}})(v,d,g),v.clear({color:c.aT.transparent});for(let F=0;F<y.length;F++){const B=y[F];if(m.hasRenderableParent(B))continue;const N=m.getTile(B),L=N.getBucket(g);if(!L)continue;const J=L.programConfigurations.get(g.id),ne=d.useProgram("heatmap",J),{zoom:U}=d.transform;ne.draw(v,w.TRIANGLES,ht.disabled,S,A,Lt.disabled,Gl(B.posMatrix,N,U,g.paint.get("heatmap-intensity")),null,g.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,g.paint,d.transform.zoom,J)}v.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(v,w){const S=v.context,A=S.gl,F=w.heatmapFbo;if(!F)return;S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,F.colorAttachment.get()),S.activeTexture.set(A.TEXTURE1);let B=w.colorRampTexture;B||(B=w.colorRampTexture=new Bt(S,w.colorRamp,A.RGBA)),B.bind(A.LINEAR,A.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(S,A.TRIANGLES,ht.disabled,Nt.disabled,v.colorModeForRenderPass(),Lt.disabled,((N,L,J,ne)=>{const U=c.Z();c.aS(U,0,N.width,N.height,0,0,1);const Q=N.context.gl;return{u_matrix:U,u_world:[Q.drawingBufferWidth,Q.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}})(v,w),null,w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(d,g))})(t,n,a,l);break;case"line":(function(d,m,g,y){if(d.renderPass!=="translucent")return;const v=g.paint.get("line-opacity"),w=g.paint.get("line-width");if(v.constantOr(1)===0||w.constantOr(1)===0)return;const S=d.depthModeForSublayer(0,ht.ReadOnly),A=d.colorModeForRenderPass(),F=g.paint.get("line-dasharray"),B=g.paint.get("line-pattern"),N=B.constantOr(1),L=g.paint.get("line-gradient"),J=g.getCrossfadeParameters(),ne=N?"linePattern":F?"lineSDF":L?"lineGradient":"line",U=d.context,Q=U.gl;let oe=!0;for(const le of y){const fe=m.getTile(le);if(N&&!fe.patternsLoaded())continue;const ve=fe.getBucket(g);if(!ve)continue;const _e=ve.programConfigurations.get(g.id),we=d.context.program.get(),Be=d.useProgram(ne,_e),st=oe||Be.program!==we,Ee=d.style.map.terrain&&d.style.map.terrain.getTerrainData(le),Ge=B.constantOr(null);if(Ge&&fe.imageAtlas){const rt=fe.imageAtlas,Qe=rt.patternPositions[Ge.to.toString()],at=rt.patternPositions[Ge.from.toString()];Qe&&at&&_e.setConstantPatternPositions(Qe,at)}const Oe=Ee?le:null,St=N?Hl(d,fe,g,J,Oe):F?Lo(d,fe,g,F,J,Oe):L?Do(d,fe,g,ve.lineClipsArray.length,Oe):Ca(d,fe,g,Oe);if(N)U.activeTexture.set(Q.TEXTURE0),fe.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),_e.updatePaintBuffers(J);else if(F&&(st||d.lineAtlas.dirty))U.activeTexture.set(Q.TEXTURE0),d.lineAtlas.bind(U);else if(L){const rt=ve.gradients[g.id];let Qe=rt.texture;if(g.gradientVersion!==rt.version){let at=256;if(g.stepInterpolant){const Zt=m.getSource().maxzoom,Mt=le.canonical.z===Zt?Math.ceil(1<<d.transform.maxZoom-le.canonical.z):1;at=c.ad(c.aY(ve.maxLineLength/c.N*1024*Mt),256,U.maxTextureSize)}rt.gradient=c.aZ({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:at,image:rt.gradient||void 0,clips:ve.lineClipsArray}),rt.texture?rt.texture.update(rt.gradient):rt.texture=new Bt(U,rt.gradient,Q.RGBA),rt.version=g.gradientVersion,Qe=rt.texture}U.activeTexture.set(Q.TEXTURE0),Qe.bind(g.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}Be.draw(U,Q.TRIANGLES,S,d.stencilModeForClipping(le),A,Lt.disabled,St,Ee,g.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,g.paint,d.transform.zoom,_e,ve.layoutVertexBuffer2),oe=!1}})(t,n,a,l);break;case"fill":(function(d,m,g,y){const v=g.paint.get("fill-color"),w=g.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const S=d.colorModeForRenderPass(),A=g.paint.get("fill-pattern"),F=d.opaquePassEnabledForLayer()&&!A.constantOr(1)&&v.constantOr(c.aT.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===F){const B=d.depthModeForSublayer(1,d.renderPass==="opaque"?ht.ReadWrite:ht.ReadOnly);us(d,m,g,y,B,S,!1)}if(d.renderPass==="translucent"&&g.paint.get("fill-antialias")){const B=d.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,ht.ReadOnly);us(d,m,g,y,B,S,!0)}})(t,n,a,l);break;case"fill-extrusion":(function(d,m,g,y){const v=g.paint.get("fill-extrusion-opacity");if(v!==0&&d.renderPass==="translucent"){const w=new ht(d.context.gl.LEQUAL,ht.ReadWrite,d.depthRangeFor3D);if(v!==1||g.paint.get("fill-extrusion-pattern").constantOr(1))ds(d,m,g,y,w,Nt.disabled,Ot.disabled),ds(d,m,g,y,w,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const S=d.colorModeForRenderPass();ds(d,m,g,y,w,Nt.disabled,S)}}})(t,n,a,l);break;case"hillshade":(function(d,m,g,y){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const v=d.context,w=d.depthModeForSublayer(0,ht.ReadOnly),S=d.colorModeForRenderPass(),[A,F]=d.renderPass==="translucent"?d.stencilConfigForOverlap(y):[{},y];for(const B of F){const N=m.getTile(B);N.needsHillshadePrepare!==void 0&&N.needsHillshadePrepare&&d.renderPass==="offscreen"?ja(d,N,g,w,Nt.disabled,S):d.renderPass==="translucent"&&tc(d,B,N,g,w,A[B.overscaledZ],S)}v.viewport.set([0,0,d.width,d.height])})(t,n,a,l);break;case"raster":(function(d,m,g,y){if(d.renderPass!=="translucent"||g.paint.get("raster-opacity")===0||!y.length)return;const v=d.context,w=v.gl,S=m.getSource(),A=d.useProgram("raster"),F=d.colorModeForRenderPass(),[B,N]=S instanceof Ji?[{},y]:d.stencilConfigForOverlap(y),L=N[N.length-1].overscaledZ,J=!d.options.moving;for(const ne of N){const U=d.depthModeForSublayer(ne.overscaledZ-L,g.paint.get("raster-opacity")===1?ht.ReadWrite:ht.ReadOnly,w.LESS),Q=m.getTile(ne);Q.registerFadeDuration(g.paint.get("raster-fade-duration"));const oe=m.findLoadedParent(ne,0),le=ic(Q,oe,m,g,d.transform,d.style.map.terrain);let fe,ve;const _e=g.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;v.activeTexture.set(w.TEXTURE0),Q.texture.bind(_e,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),v.activeTexture.set(w.TEXTURE1),oe?(oe.texture.bind(_e,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),fe=Math.pow(2,oe.tileID.overscaledZ-Q.tileID.overscaledZ),ve=[Q.tileID.canonical.x*fe%1,Q.tileID.canonical.y*fe%1]):Q.texture.bind(_e,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);const we=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ne),Be=we?ne:null,st=Be?Be.posMatrix:d.transform.calculatePosMatrix(ne.toUnwrapped(),J),Ee=Bo(st,ve||[0,0],fe||1,le,g);S instanceof Ji?A.draw(v,w.TRIANGLES,U,Nt.disabled,F,Lt.disabled,Ee,we,g.id,S.boundsBuffer,d.quadTriangleIndexBuffer,S.boundsSegments):A.draw(v,w.TRIANGLES,U,B[ne.overscaledZ],F,Lt.disabled,Ee,we,g.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(t,n,a,l);break;case"background":(function(d,m,g,y){const v=g.paint.get("background-color"),w=g.paint.get("background-opacity");if(w===0)return;const S=d.context,A=S.gl,F=d.transform,B=F.tileSize,N=g.paint.get("background-pattern");if(d.isPatternMissing(N))return;const L=!N&&v.a===1&&w===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==L)return;const J=Nt.disabled,ne=d.depthModeForSublayer(0,L==="opaque"?ht.ReadWrite:ht.ReadOnly),U=d.colorModeForRenderPass(),Q=d.useProgram(N?"backgroundPattern":"background"),oe=y||F.coveringTiles({tileSize:B,terrain:d.style.map.terrain});N&&(S.activeTexture.set(A.TEXTURE0),d.imageManager.bind(d.context));const le=g.getCrossfadeParameters();for(const fe of oe){const ve=y?fe.posMatrix:d.transform.calculatePosMatrix(fe.toUnwrapped()),_e=N?rr(ve,w,d,N,{tileID:fe,tileSize:B},le):Ns(ve,w,v),we=d.style.map.terrain&&d.style.map.terrain.getTerrainData(fe);Q.draw(S,A.TRIANGLES,ne,J,U,Lt.disabled,_e,we,g.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(t,0,a,l);break;case"custom":(function(d,m,g){const y=d.context,v=g.implementation;if(d.renderPass==="offscreen"){const w=v.prerender;w&&(d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),w.call(v,y.gl,d.transform.customLayerMatrix()),y.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),y.setStencilMode(Nt.disabled);const w=v.renderingMode==="3d"?new ht(d.context.gl.LEQUAL,ht.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,ht.ReadOnly);y.setDepthMode(w),v.render(y.gl,d.transform.customLayerMatrix()),y.setDirty(),d.setBaseState(),y.bindFramebuffer.set(null)}})(t,0,a)}}translatePosMatrix(t,n,a,l,d){if(!a[0]&&!a[1])return t;const m=d?l==="map"?this.transform.angle:0:l==="viewport"?-this.transform.angle:0;if(m){const v=Math.sin(m),w=Math.cos(m);a=[a[0]*w-a[1]*v,a[0]*v+a[1]*w]}const g=[d?a[0]:K(n,a[0],this.transform.zoom),d?a[1]:K(n,a[1],this.transform.zoom),0],y=new Float32Array(16);return c.$(y,t,g),y}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!n||!a}useProgram(t,n){this.cache=this.cache||{};const a=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new Rs(this.context,Ft[t],n,Vs[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Bt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class Pi{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,a){const l=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{const y=1/(g=c.ag([],g,t))[3]/n*l;return c.b3(g,g,[y,y,1/g[3],y])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{const y=function(A,F){var B=F[0],N=F[1],L=F[2],J=B*B+N*N+L*L;return J>0&&(J=1/Math.sqrt(J)),A[0]=F[0]*J,A[1]=F[1]*J,A[2]=F[2]*J,A}([],function(A,F,B){var N=F[0],L=F[1],J=F[2],ne=B[0],U=B[1],Q=B[2];return A[0]=L*Q-J*U,A[1]=J*ne-N*Q,A[2]=N*U-L*ne,A}([],li([],d[g[0]],d[g[1]]),li([],d[g[2]],d[g[1]]))),v=-((w=y)[0]*(S=d[g[1]])[0]+w[1]*S[1]+w[2]*S[2]);var w,S;return y.concat(v)});return new Pi(d,m)}}class Un{constructor(t,n){this.min=t,this.max=n,this.center=function(a,l,d){return a[0]=.5*l[0],a[1]=.5*l[1],a[2]=.5*l[2],a}([],function(a,l,d){return a[0]=l[0]+d[0],a[1]=l[1]+d[1],a[2]=l[2]+d[2],a}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],a=nt(this.min),l=nt(this.max);for(let d=0;d<n.length;d++)a[d]=n[d]?this.min[d]:this.center[d],l[d]=n[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new Un(a,l)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let l=0;l<t.planes.length;l++){const d=t.planes[l];let m=0;for(let g=0;g<n.length;g++)c.b4(d,n[g])>=0&&m++;if(m===0)return 0;m!==n.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let d=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let g=0;g<t.points.length;g++){const y=t.points[g][l]-this.min[l];d=Math.min(d,y),m=Math.max(m,y)}if(m<0||d>this.max[l]-this.min[l])return 0}return 1}}class fs{constructor(t=0,n=0,a=0,l=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=a,this.right=l}interpolate(t,n,a){return n.top!=null&&t.top!=null&&(this.top=c.B.number(t.top,n.top,a)),n.bottom!=null&&t.bottom!=null&&(this.bottom=c.B.number(t.bottom,n.bottom,a)),n.left!=null&&t.left!=null&&(this.left=c.B.number(t.left,n.left,a)),n.right!=null&&t.right!=null&&(this.right=c.B.number(t.right,n.right,a)),this}getCenter(t,n){const a=c.ad((this.left+t-this.right)/2,0,t),l=c.ad((this.top+n-this.bottom)/2,0,n);return new c.P(a,l)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ta{constructor(t,n,a,l,d){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=d===void 0||!!d,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=l??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new ta(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-c.b5(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new c.A(4);return c.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,l,d){var m=l[0],g=l[1],y=l[2],v=l[3],w=Math.sin(d),S=Math.cos(d);a[0]=m*S+y*w,a[1]=g*S+v*w,a[2]=m*-w+y*S,a[3]=g*-w+v*S}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=c.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,a){this._unmodified=!1,this._edgeInsets.interpolate(t,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new c.b6(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new c.P(0,0)),l=this.pointCoordinate(new c.P(this.width,0)),d=this.pointCoordinate(new c.P(this.width,this.height)),m=this.pointCoordinate(new c.P(0,this.height)),g=Math.floor(Math.min(a.x,l.x,d.x,m.x)),y=Math.floor(Math.max(a.x,l.x,d.x,m.x)),v=1;for(let w=g-v;w<=y+v;w++)w!==0&&n.push(new c.b6(w,t))}return n}coveringTiles(t){var n,a;let l=this.coveringZoomLevel(t);const d=l;if(t.minzoom!==void 0&&l<t.minzoom)return[];t.maxzoom!==void 0&&l>t.maxzoom&&(l=t.maxzoom);const m=this.pointCoordinate(this.getCameraPoint()),g=c.U.fromLngLat(this.center),y=Math.pow(2,l),v=[y*m.x,y*m.y,0],w=[y*g.x,y*g.y,0],S=Pi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l);let A=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(A=l);const F=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,B=U=>({aabb:new Un([U*y,0,0],[(U+1)*y,y,0]),zoom:0,x:0,y:0,wrap:U,fullyVisible:!1}),N=[],L=[],J=l,ne=t.reparseOverscaled?d:l;if(this._renderWorldCopies)for(let U=1;U<=3;U++)N.push(B(-U)),N.push(B(U));for(N.push(B(0));N.length>0;){const U=N.pop(),Q=U.x,oe=U.y;let le=U.fullyVisible;if(!le){const Be=U.aabb.intersects(S);if(Be===0)continue;le=Be===2}const fe=t.terrain?v:w,ve=U.aabb.distanceX(fe),_e=U.aabb.distanceY(fe),we=Math.max(Math.abs(ve),Math.abs(_e));if(U.zoom===J||we>F+(1<<J-U.zoom)-2&&U.zoom>=A){const Be=J-U.zoom,st=v[0]-.5-(Q<<Be),Ee=v[1]-.5-(oe<<Be);L.push({tileID:new c.O(U.zoom===J?ne:U.zoom,U.wrap,U.zoom,Q,oe),distanceSq:cr([w[0]-.5-Q,w[1]-.5-oe]),tileDistanceToCamera:Math.sqrt(st*st+Ee*Ee)})}else for(let Be=0;Be<4;Be++){const st=(Q<<1)+Be%2,Ee=(oe<<1)+(Be>>1),Ge=U.zoom+1;let Oe=U.aabb.quadrant(Be);if(t.terrain){const St=new c.O(Ge,U.wrap,Ge,st,Ee),rt=t.terrain.getMinMaxElevation(St),Qe=(n=rt.minElevation)!==null&&n!==void 0?n:this.elevation,at=(a=rt.maxElevation)!==null&&a!==void 0?a:this.elevation;Oe=new Un([Oe.min[0],Oe.min[1],Qe],[Oe.max[0],Oe.max[1],at])}N.push({aabb:Oe,zoom:Ge,x:st,y:Ee,wrap:U.wrap,fullyVisible:le})}}return L.sort((U,Q)=>U.distanceSq-Q.distanceSq).map(U=>U.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=c.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new c.P(c.G(t.lng)*this.worldSize,c.H(n)*this.worldSize)}unproject(t){return new c.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),a=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-a))return;const l=this.getCameraPosition(),d=c.U.fromLngLat(l.lngLat,l.altitude),m=c.U.fromLngLat(n,a),g=d.x-m.x,y=d.y-m.y,v=d.z-m.z,w=Math.sqrt(g*g+y*y+v*v),S=this.scaleZoom(this.cameraToCenterDistance/w/this.tileSize);this._elevation=a,this._center=n,this.zoom=S}setLocationAtPoint(t,n){const a=this.pointCoordinate(n),l=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(t),m=new c.U(d.x-(a.x-l.x),d.y-(a.y-l.y));this.center=this.coordinateLocation(m),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return c.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const A=n.pointCoordinate(t);if(A!=null)return A}const a=[t.x,t.y,0,1],l=[t.x,t.y,1,1];c.ag(a,a,this.pixelMatrixInverse),c.ag(l,l,this.pixelMatrixInverse);const d=a[3],m=l[3],g=a[1]/d,y=l[1]/m,v=a[2]/d,w=l[2]/m,S=v===w?0:(0-v)/(w-v);return new c.U(c.B.number(a[0]/d,l[0]/m,S)/this.worldSize,c.B.number(g,y,S)/this.worldSize)}coordinatePoint(t,n=0,a=this.pixelMatrix){const l=[t.x*this.worldSize,t.y*this.worldSize,n,1];return c.ag(l,l,a),new c.P(l[0]/l[3],l[1]/l[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new kt().extend(this.pointLocation(new c.P(0,t))).extend(this.pointLocation(new c.P(this.width,t))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new kt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const a=t.key,l=n?this._alignedPosMatrixCache:this._posMatrixCache;if(l[a])return l[a];const d=t.canonical,m=this.worldSize/this.zoomScale(d.z),g=d.x+Math.pow(2,d.z)*t.wrap,y=c.ao(new Float64Array(16));return c.$(y,y,[g*m,d.y*m,0]),c.a0(y,y,[m/c.N,m/c.N,1]),c.a1(y,n?this.alignedProjMatrix:this.projMatrix,y),l[a]=new Float32Array(y),l[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,a,l,d=-90,m=90,g=-180,y=180;const v=this.size,w=this._unmodified;if(this.latRange){const F=this.latRange;d=c.H(F[1])*this.worldSize,m=c.H(F[0])*this.worldSize,t=m-d<v.y?v.y/(m-d):0}if(this.lngRange){const F=this.lngRange;g=c.b5(c.G(F[0])*this.worldSize,0,this.worldSize),y=c.b5(c.G(F[1])*this.worldSize,0,this.worldSize),y<g&&(y+=this.worldSize),n=y-g<v.x?v.x/(y-g):0}const S=this.point,A=Math.max(n||0,t||0);if(A)return this.center=this.unproject(new c.P(n?(y+g)/2:S.x,t?(m+d)/2:S.y)),this.zoom+=this.scaleZoom(A),this._unmodified=w,void(this._constraining=!1);if(this.latRange){const F=S.y,B=v.y/2;F-B<d&&(l=d+B),F+B>m&&(l=m-B)}if(this.lngRange){const F=(g+y)/2,B=c.b5(S.x,F-this.worldSize/2,F+this.worldSize/2),N=v.x/2;B-N<g&&(a=g+N),B+N>y&&(a=y-N)}a===void 0&&l===void 0||(this.center=this.unproject(new c.P(a!==void 0?a:S.x,l!==void 0?l:S.y)).wrap()),this._unmodified=w,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b7(1,this.center.lat)*this.worldSize;let l=c.ao(new Float64Array(16));c.a0(l,l,[this.width/2,-this.height/2,1]),c.$(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=c.ao(new Float64Array(16)),c.a0(l,l,[1,-1,1]),c.$(l,l,[-1,-1,0]),c.a0(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),m=Math.min(this.elevation,this._minEleveationForCurrentTile),g=d-m*this._pixelPerMeter/Math.cos(this._pitch),y=m<0?g:d,v=Math.PI/2+this._pitch,w=this._fov*(.5+t.y/this.height),S=Math.sin(w)*y/Math.sin(c.ad(Math.PI-v-w,.01,Math.PI-.01)),A=this.getHorizon(),F=2*Math.atan(A/this.cameraToCenterDistance)*(.5+t.y/(2*A)),B=Math.sin(F)*y/Math.sin(c.ad(Math.PI-v-F,.01,Math.PI-.01)),N=Math.min(S,B),L=1.01*(Math.cos(Math.PI/2-this._pitch)*N+y),J=this.height/50;l=new Float64Array(16),c.b8(l,this._fov,this.width/this.height,J,L),l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,c.a0(l,l,[1,-1,1]),c.$(l,l,[0,0,-this.cameraToCenterDistance]),c.b9(l,l,this._pitch),c.ae(l,l,this.angle),c.$(l,l,[-n,-a,0]),this.mercatorMatrix=c.a0([],l,[this.worldSize,this.worldSize,this.worldSize]),c.a0(l,l,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.a1(new Float64Array(16),this.labelPlaneMatrix,l),c.$(l,l,[0,0,-this.elevation]),this.projMatrix=l,this.invProjMatrix=c.as([],l),this.pixelMatrix3D=c.a1(new Float64Array(16),this.labelPlaneMatrix,l);const ne=this.width%2/2,U=this.height%2/2,Q=Math.cos(this.angle),oe=Math.sin(this.angle),le=n-Math.round(n)+Q*ne+oe*U,fe=a-Math.round(a)+Q*U+oe*ne,ve=new Float64Array(l);if(c.$(ve,ve,[le>.5?le-1:le,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=ve,l=c.as(new Float64Array(16),this.pixelMatrix),!l)throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new c.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return c.ag(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let a=n.x,l=n.y,d=n.x,m=n.y;for(const g of t)a=Math.min(a,g.x),l=Math.min(l,g.y),d=Math.max(d,g.x),m=Math.max(m,g.y);return[new c.P(a,l),new c.P(d,l),new c.P(d,m),new c.P(a,m),new c.P(a,l)]}}}function xn(h,t){let n,a=!1,l=null,d=null;const m=()=>{l=null,a&&(h.apply(d,n),l=setTimeout(m,t),a=!1)};return(...g)=>(a=!0,d=this,n=g,l||m(),l)}class ms{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(a=l)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=xn(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,l),m=Math.round(n.lng*d)/d,g=Math.round(n.lat*d)/d,y=this._map.getBearing(),v=this._map.getPitch();let w="";if(w+=t?`/${m}/${g}/${a}`:`${a}/${g}/${m}`,(y||v)&&(w+="/"+Math.round(10*y)/10),v&&(w+=`/${Math.round(v)}`),this._hashName){const S=this._hashName;let A=!1;const F=window.location.hash.slice(1).split("&").map(B=>{const N=B.split("=")[0];return N===S?(A=!0,`${N}=${w}`):B}).filter(B=>B);return A||F.push(`${S}=${w}`),`#${F.join("&")}`}return`#${w}`}}const qn={linearity:.3,easing:c.ba(0,0,.3,1)},Xo=c.e({deceleration:2500,maxSpeed:1400},qn),Ko=c.e({deceleration:20,maxSpeed:1400},qn),Yo=c.e({deceleration:1e3,maxSpeed:360},qn),Jo=c.e({deceleration:1e3,maxSpeed:90},qn);class Qo{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=c.h.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)n.zoom+=d.zoomDelta||0,n.bearing+=d.bearingDelta||0,n.pitch+=d.pitchDelta||0,d.panDelta&&n.pan._add(d.panDelta),d.around&&(n.around=d.around),d.pinchAround&&(n.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(n.pan.mag()){const d=gs(n.pan.mag(),a,c.e({},Xo,t||{}));l.offset=n.pan.mult(d.amount/n.pan.mag()),l.center=this._map.transform.center,vr(l,d)}if(n.zoom){const d=gs(n.zoom,a,Ko);l.zoom=this._map.transform.zoom+d.amount,vr(l,d)}if(n.bearing){const d=gs(n.bearing,a,Yo);l.bearing=this._map.transform.bearing+c.ad(d.amount,-179,179),vr(l,d)}if(n.pitch){const d=gs(n.pitch,a,Jo);l.pitch=this._map.transform.pitch+d.amount,vr(l,d)}if(l.zoom||l.bearing){const d=n.pinchAround===void 0?n.around:n.pinchAround;l.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),c.e(l,{noMoveStart:!0})}}function vr(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function gs(h,t,n){const{maxSpeed:a,linearity:l,deceleration:d}=n,m=c.ad(h*l/(t/1e3),-a,a),g=Math.abs(m)/(d*l);return{easing:n.easing,duration:1e3*g,amount:m*(g/2)}}class Ui extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a,l={}){const d=H.mousePos(n.getCanvasContainer(),a),m=n.unproject(d);super(t,c.e({point:d,lngLat:m,originalEvent:a},l)),this._defaultPrevented=!1,this.target=n}}class _s extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){const l=t==="touchend"?a.changedTouches:a.touches,d=H.touchPos(n.getCanvasContainer(),l),m=d.map(y=>n.unproject(y)),g=d.reduce((y,v,w,S)=>y.add(v.div(S.length)),new c.P(0,0));super(t,{points:d,point:g,lngLats:m,lngLat:n.unproject(g),originalEvent:a}),this._defaultPrevented=!1}}class el extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class tl{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new el(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Ui(t.type,this._map,t))}mouseup(t){this._map.fire(new Ui(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Ui(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ui(t.type,this._map,t))}mouseover(t){this._map.fire(new Ui(t.type,this._map,t))}mouseout(t){this._map.fire(new Ui(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _s(t.type,this._map,t))}touchmove(t){this._map.fire(new _s(t.type,this._map,t))}touchend(t){this._map.fire(new _s(t.type,this._map,t))}touchcancel(t){this._map.fire(new _s(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class il{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ui(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ui("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ui(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(c.P.convert(t),this._map.terrain)}}class rl{constructor(t,n){this._map=t,this._tr=new Dr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(H.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const l=this._startPos;this._lastPos=a,this._box||(this._box=H.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(l.x,a.x),m=Math.max(l.x,a.x),g=Math.min(l.y,a.y),y=Math.max(l.y,a.y);H.setTransform(this._box,`translate(${d}px,${g}px)`),this._box.style.width=m-d+"px",this._box.style.height=y-g+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const a=this._startPos,l=n;if(this.reset(),H.suppressClick(),a.x!==l.x||a.y!==l.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:t})),{cameraAnimation:d=>d.fitScreenCoordinates(a,l,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(H.remove(this._box),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new c.k(t,{originalEvent:n}))}}function nr(h,t){if(h.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${t.length}`);const n={};for(let a=0;a<h.length;a++)n[h[a].identifier]=t[a];return n}class Lr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const d=new c.P(0,0);for(const m of l)d._add(m);return d.div(l.length)}(n),this.touches=nr(a,n)))}touchmove(t,n,a){if(this.aborted||!this.centroid)return;const l=nr(a,n);for(const d in this.touches){const m=l[d];(!m||m.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(t,n,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class ia{constructor(t){this.singleTap=new Lr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,a){this.singleTap.touchstart(t,n,a)}touchmove(t,n,a){this.singleTap.touchmove(t,n,a)}touchend(t,n,a){const l=this.singleTap.touchend(t,n,a);if(l){const d=t.timeStamp-this.lastTime<500,m=!this.lastTap||this.lastTap.dist(l)<30;if(d&&m||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class Rr{constructor(t){this._tr=new Dr(t),this._zoomIn=new ia({numTouches:1,numTaps:2}),this._zoomOut=new ia({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,a){this._zoomIn.touchstart(t,n,a),this._zoomOut.touchstart(t,n,a)}touchmove(t,n,a){this._zoomIn.touchmove(t,n,a),this._zoomOut.touchmove(t,n,a)}touchend(t,n,a){const l=this._zoomIn.touchend(t,n,a),d=this._zoomOut.touchend(t,n,a),m=this._tr;return l?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:m.zoom+1,around:m.unproject(l)},{originalEvent:t})}):d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:m.zoom-1,around:m.unproject(d)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Br{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const l=n.length?n[0]:n;return!this._moved&&l.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=l,this._move(a,l))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&H.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const rc={0:1,2:2};class Ua{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=H.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,a){const l=rc[a];return n.buttons===void 0||(n.buttons&l)!==l}(t,this._eventButton)}isValidEndEvent(t){return H.mouseButton(t)===this._eventButton}}class nl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ra=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=function(t){t.preventDefault()}},Zn=({enable:h,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const a=new Ua({checkCorrectEvent:l=>H.mouseButton(l)===0&&l.ctrlKey||H.mouseButton(l)===2});return new Br({clickTolerance:t,move:(l,d)=>({bearingDelta:(d.x-l.x)*n}),moveStateManager:a,enable:h,assignEvents:ra})},Fr=({enable:h,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new Ua({checkCorrectEvent:l=>H.mouseButton(l)===0&&l.ctrlKey||H.mouseButton(l)===2});return new Br({clickTolerance:t,move:(l,d)=>({pitchDelta:(d.y-l.y)*n}),moveStateManager:a,enable:h,assignEvents:ra})};class De{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,a){return this._calculateTransform(t,n,a)}touchmove(t,n,a){if(this._map._cooperativeGestures&&(this._minTouches===2&&a.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,a.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(a.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,a)}touchend(t,n,a){this._calculateTransform(t,n,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,a){a.length>0&&(this._active=!0);const l=nr(a,n),d=new c.P(0,0),m=new c.P(0,0);let g=0;for(const v in l){const w=l[v],S=this._touches[v];S&&(d._add(w),m._add(w.sub(S)),g++,l[v]=w)}if(this._touches=l,g<this._minTouches||!m.mag())return;const y=m.div(g);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(g),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class na{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,a){if(!this._firstTwoTouches)return;t.preventDefault();const[l,d]=this._firstTwoTouches,m=tn(a,n,l),g=tn(a,n,d);if(!m||!g)return;const y=this._aroundCenter?null:m.add(g).div(2);return this._move([m,g],y,t)}touchend(t,n,a){if(!this._firstTwoTouches)return;const[l,d]=this._firstTwoTouches,m=tn(a,n,l),g=tn(a,n,d);m&&g||(this._active&&H.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function tn(h,t,n){for(let a=0;a<h.length;a++)if(h[a].identifier===n)return t[a]}function Gn(h,t){return Math.log(h/t)/Math.LN2}class sl extends na{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Gn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gn(this._distance,a),pinchAround:n}}}function Pe(h,t){return 180*h.angleWith(t)/Math.PI}class qa extends na{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const a=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pe(this._vector,a),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,a=Pe(t,this._startVector);return Math.abs(a)<n}}function Za(h){return Math.abs(h.y)>Math.abs(h.x)}class nc extends na{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,a){super.touchstart(t,n,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,Za(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,a){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const l=t[0].sub(this._lastPoints[0]),d=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(l,d,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(l.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,a){if(this._valid!==void 0)return this._valid;const l=t.mag()>=2,d=n.mag()>=2;if(!l&&!d)return;if(!l||!d)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const m=t.y>0==n.y>0;return Za(t)&&Za(n)&&m}}const Ga={panStep:100,bearingStep:15,pitchStep:10};class al{constructor(t){this._tr=new Dr(t);const n=Ga;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,a=0,l=0,d=0,m=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),d=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),d=1);break;case 38:t.shiftKey?l=1:(t.preventDefault(),m=-1);break;case 40:t.shiftKey?l=-1:(t.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:g=>{const y=this._tr;g.easeTo({duration:300,easeId:"keyboardHandler",easing:ol,zoom:n?Math.round(y.zoom)+n*(t.shiftKey?2:1):y.zoom,bearing:y.bearing+a*this._bearingStep,pitch:y.pitch+l*this._pitchStep,offset:[-d*this._panStep,-m*this._panStep],center:y.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ol(h){return h*(2-h)}const ll=4.000244140625;class sc{constructor(t,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=t,this._tr=new Dr(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=c.h.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%ll==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(l*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=H.mousePos(this._el,t),a=this._tr;this._around=c.L.convert(this._aroundCenter?a.center:a.unproject(n)),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const g=this._type==="wheel"&&Math.abs(this._delta)>ll?this._wheelZoomRate:this._defaultZoomRate;let y=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&y!==0&&(y=1/y);const v=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(v*y))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,l=this._easing;let d,m=!1;if(this._type==="wheel"&&a&&l){const g=Math.min((c.h.now()-this._lastWheelEventTime)/200,1),y=l(g);d=c.B.number(a,n,y),g<1?this._frameId||(this._frameId=!0):m=!0}else d=n,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!m,zoomDelta:d-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=c.bb;if(this._prevEase){const a=this._prevEase,l=(c.h.now()-a.start)/a.duration,d=a.easing(l+.01)-a.easing(l),m=.27/Math.sqrt(d*d+1e-4)*.01,g=Math.sqrt(.0729-m*m);n=c.ba(m,g,.25,1)}return this._prevEase={start:c.h.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ha{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wa{constructor(t){this._tr=new Dr(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xa{constructor(){this._tap=new ia({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,a){if(!this._swipePoint)if(this._tapTime){const l=n[0],d=t.timeStamp-this._tapTime<500,m=this._tapPoint.dist(l)<30;d&&m?a.length>0&&(this._swipePoint=l,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(t,n,a)}touchmove(t,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=n[0],d=l.y-this._swipePoint.y;return this._swipePoint=l,t.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(t,n,a)}touchend(t,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const l=this._tap.touchend(t,n,a);l&&(this._tapTime=t.timeStamp,this._tapPoint=l)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ka{constructor(t,n,a){this._el=t,this._mousePan=n,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zi{constructor(t,n,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rn{constructor(t,n,a,l){this._el=t,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ys=h=>h.zoom||h.drag||h.pitch||h.rotate;class Ya extends c.k{}function xs(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Ja{constructor(t,n){this.handleWindowEvent=l=>{this.handleEvent(l,`${l.type}Window`)},this.handleEvent=(l,d)=>{if(l.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const m=l.type==="renderFrame"?void 0:l,g={needsRenderFrame:!1},y={},v={},w=l.touches,S=w?this._getMapTouches(w):void 0,A=S?H.touchPos(this._el,S):H.mousePos(this._el,l);for(const{handlerName:N,handler:L,allowed:J}of this._handlers){if(!L.isEnabled())continue;let ne;this._blockedByActive(v,J,N)?L.reset():L[d||l.type]&&(ne=L[d||l.type](l,A,S),this.mergeHandlerResult(g,y,ne,N,m),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||L.isActive())&&(v[N]=L)}const F={};for(const N in this._previousActiveHandlers)v[N]||(F[N]=m);this._previousActiveHandlers=v,(Object.keys(F).length||xs(g))&&(this._changes.push([g,y,F]),this._triggerRenderFrame()),(Object.keys(v).length||xs(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=g;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qo(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[l,d,m]of this._listeners)H.addEventListener(l,d,l===document?this.handleWindowEvent:this.handleEvent,m)}destroy(){for(const[t,n,a]of this._listeners)H.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new tl(n,t));const l=n.boxZoom=new rl(n,t);this._add("boxZoom",l),t.interactive&&t.boxZoom&&l.enable();const d=new Rr(n),m=new Wa(n);n.doubleClickZoom=new Ha(m,d),this._add("tapZoom",d),this._add("clickZoom",m),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const g=new Xa;this._add("tapDragZoom",g);const y=n.touchPitch=new nc(n);this._add("touchPitch",y),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const v=Zn(t),w=Fr(t);n.dragRotate=new zi(t,v,w),this._add("mouseRotate",v,["mousePitch"]),this._add("mousePitch",w,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const S=(({enable:J,clickTolerance:ne})=>{const U=new Ua({checkCorrectEvent:Q=>H.mouseButton(Q)===0&&!Q.ctrlKey});return new Br({clickTolerance:ne,move:(Q,oe)=>({around:oe,panDelta:oe.sub(Q)}),activateOnStart:!0,moveStateManager:U,enable:J,assignEvents:ra})})(t),A=new De(t,n);n.dragPan=new Ka(a,S,A),this._add("mousePan",S),this._add("touchPan",A,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const F=new qa,B=new sl;n.touchZoomRotate=new rn(a,B,F,g),this._add("touchRotate",F,["touchPan","touchZoom"]),this._add("touchZoom",B,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const N=n.scrollZoom=new sc(n,()=>this._triggerRenderFrame());this._add("scrollZoom",N,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const L=n.keyboard=new al(n);this._add("keyboard",L),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new il(n))}_add(t,n,a){this._handlers.push({handlerName:t,handler:n,allowed:a}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ys(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,a){for(const l in t)if(l!==a&&(!n||n.indexOf(l)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const a of t)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(t,n,a,l,d){if(!a)return;c.e(t,a);const m={handlerName:l,originalEvent:a.originalEvent||d};a.zoomDelta!==void 0&&(n.zoom=m),a.panDelta!==void 0&&(n.drag=m),a.pitchDelta!==void 0&&(n.pitch=m),a.bearingDelta!==void 0&&(n.rotate=m)}_applyChanges(){const t={},n={},a={};for(const[l,d,m]of this._changes)l.panDelta&&(t.panDelta=(t.panDelta||new c.P(0,0))._add(l.panDelta)),l.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+l.pitchDelta),l.around!==void 0&&(t.around=l.around),l.pinchAround!==void 0&&(t.pinchAround=l.pinchAround),l.noInertia&&(t.noInertia=l.noInertia),c.e(n,d),c.e(a,m);this._updateMapTransform(t,n,a),this._changes=[]}_updateMapTransform(t,n,a){const l=this._map,d=l._getTransformForUpdate(),m=l.terrain;if(!(xs(t)||m&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:g,zoomDelta:y,bearingDelta:v,pitchDelta:w,around:S,pinchAround:A}=t;A!==void 0&&(S=A),l._stop(!0),S=S||l.transform.centerPoint;const F=d.pointLocation(g?S.sub(g):S);v&&(d.bearing+=v),w&&(d.pitch+=w),y&&(d.zoom+=y),m?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(g)):d.setLocationAtPoint(F,S):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(F,S),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,d.recalculateZoom(l.terrain)})):d.setLocationAtPoint(F,S),l._applyUpdatedTransform(d),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,a,!0)}_fireEvents(t,n,a){const l=ys(this._eventsInProgress),d=ys(t),m={};for(const w in t){const{originalEvent:S}=t[w];this._eventsInProgress[w]||(m[`${w}start`]=S),this._eventsInProgress[w]=t[w]}!l&&d&&this._fireEvent("movestart",d.originalEvent);for(const w in m)this._fireEvent(w,m[w]);d&&this._fireEvent("move",d.originalEvent);for(const w in t){const{originalEvent:S}=t[w];this._fireEvent(w,S)}const g={};let y;for(const w in this._eventsInProgress){const{handlerName:S,originalEvent:A}=this._eventsInProgress[w];this._handlersById[S].isActive()||(delete this._eventsInProgress[w],y=n[S]||A,g[`${w}end`]=y)}for(const w in g)this._fireEvent(w,g[w]);const v=ys(this._eventsInProgress);if(a&&(l||d)&&!v){this._updatingCamera=!0;const w=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),S=A=>A!==0&&-this._bearingSnap<A&&A<this._bearingSnap;!w||!w.essential&&c.h.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:y})),S(this._map.getBearing())&&this._map.resetNorth()):(S(w.bearing||this._map.getBearing())&&(w.bearing=0),w.freezeElevation=!0,this._map.easeTo(w,{originalEvent:y})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new c.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Ya("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class cl extends c.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const a=Math.min((c.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,a){return t=c.P.convert(t).mult(-1),this.panTo(this.transform.center,c.e({offset:t},n),a)}panTo(t,n,a){return this.easeTo(c.e({center:t},n),a)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,a){return this.easeTo(c.e({zoom:t},n),a)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,a){return this.easeTo(c.e({bearing:t},n),a)}resetNorth(t,n){return this.rotateTo(0,c.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=kt.convert(t);const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,n)}_cameraForBoxAndBearing(t,n,a,l){const d={top:0,bottom:0,right:0,left:0};if(typeof(l=c.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const oe=l.padding;l.padding={top:oe,bottom:oe,right:oe,left:oe}}l.padding=c.e(d,l.padding);const m=this.transform,g=m.padding,y=m.project(c.L.convert(t)),v=m.project(c.L.convert(n)),w=y.rotate(-a*Math.PI/180),S=v.rotate(-a*Math.PI/180),A=new c.P(Math.max(w.x,S.x),Math.max(w.y,S.y)),F=new c.P(Math.min(w.x,S.x),Math.min(w.y,S.y)),B=A.sub(F),N=(m.width-(g.left+g.right+l.padding.left+l.padding.right))/B.x,L=(m.height-(g.top+g.bottom+l.padding.top+l.padding.bottom))/B.y;if(L<0||N<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const J=Math.min(m.scaleZoom(m.scale*Math.min(N,L)),l.maxZoom),ne=c.P.convert(l.offset),U=new c.P((l.padding.left-l.padding.right)/2,(l.padding.top-l.padding.bottom)/2).rotate(a*Math.PI/180),Q=ne.add(U).mult(m.scale/m.zoomScale(J));return{center:m.unproject(y.add(v).div(2).sub(Q)),zoom:J,bearing:a}}fitBounds(t,n,a){return this._fitInternal(this.cameraForBounds(t,n),n,a)}fitScreenCoordinates(t,n,a,l,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(t)),this.transform.pointLocation(c.P.convert(n)),a,l),l,d)}_fitInternal(t,n,a){return t?(delete(n=c.e(t,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(t,n){this.stop();const a=this._getTransformForUpdate();let l=!1,d=!1,m=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(l=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=c.L.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(d=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(m=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this._applyUpdatedTransform(a),this.fire(new c.k("movestart",n)).fire(new c.k("move",n)),l&&this.fire(new c.k("zoomstart",n)).fire(new c.k("zoom",n)).fire(new c.k("zoomend",n)),d&&this.fire(new c.k("rotatestart",n)).fire(new c.k("rotate",n)).fire(new c.k("rotateend",n)),m&&this.fire(new c.k("pitchstart",n)).fire(new c.k("pitch",n)).fire(new c.k("pitchend",n)),this.fire(new c.k("moveend",n))}calculateCameraOptionsFromTo(t,n,a,l=0){const d=c.U.fromLngLat(t,n),m=c.U.fromLngLat(a,l),g=m.x-d.x,y=m.y-d.y,v=m.z-d.z,w=Math.hypot(g,y,v);if(w===0)throw new Error("Can't calculate camera options with same From and To");const S=Math.hypot(g,y),A=this.transform.scaleZoom(this.transform.cameraToCenterDistance/w/this.transform.tileSize),F=180*Math.atan2(g,-y)/Math.PI;let B=180*Math.acos(S/w)/Math.PI;return B=v<0?90-B:90+B,{center:m.toLngLat(),zoom:A,pitch:B,bearing:F}}easeTo(t,n){this._stop(!1,t.easeId),((t=c.e({offset:[0,0],duration:500,easing:c.bb},t)).animate===!1||!t.essential&&c.h.prefersReducedMotion)&&(t.duration=0);const a=this._getTransformForUpdate(),l=this.getZoom(),d=this.getBearing(),m=this.getPitch(),g=this.getPadding(),y="zoom"in t?+t.zoom:l,v="bearing"in t?this._normalizeBearing(t.bearing,d):d,w="pitch"in t?+t.pitch:m,S="padding"in t?t.padding:a.padding,A=c.P.convert(t.offset);let F=a.centerPoint.add(A);const B=a.pointLocation(F),N=c.L.convert(t.center||B);this._normalizeCenter(N);const L=a.project(B),J=a.project(N).sub(L),ne=a.zoomScale(y-l);let U,Q;t.around&&(U=c.L.convert(t.around),Q=a.locationPoint(U));const oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||y!==l,this._rotating=this._rotating||d!==v,this._pitching=this._pitching||w!==m,this._padding=!a.isPaddingEqual(S),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,oe),this.terrain&&this._prepareElevation(N),this._ease(le=>{if(this._zooming&&(a.zoom=c.B.number(l,y,le)),this._rotating&&(a.bearing=c.B.number(d,v,le)),this._pitching&&(a.pitch=c.B.number(m,w,le)),this._padding&&(a.interpolatePadding(g,S,le),F=a.centerPoint.add(A)),this.terrain&&!t.freezeElevation&&this._updateElevation(le),U)a.setLocationAtPoint(U,Q);else{const fe=a.zoomScale(a.zoom-l),ve=y>l?Math.min(2,ne):Math.max(.5,ne),_e=Math.pow(ve,1-le),we=a.unproject(L.add(J.mult(le*_e)).mult(fe));a.setLocationAtPoint(a.renderWorldCopies?we.wrap():we,F)}this._applyUpdatedTransform(a),this._fireMoveEvents(n)},le=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,le)},t),this}_prepareEase(t,n,a={}){this._moving=!0,n||a.moving||this.fire(new c.k("movestart",t)),this._zooming&&!a.zooming&&this.fire(new c.k("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new c.k("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new c.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(n-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=c.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:a,zoom:l,pitch:d,bearing:m,elevation:g}=this.transformCameraUpdate(n);a&&(n.center=a),l!==void 0&&(n.zoom=l),d!==void 0&&(n.pitch=d),m!==void 0&&(n.bearing=m),g!==void 0&&(n.elevation=g),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new c.k("move",t)),this._zooming&&this.fire(new c.k("zoom",t)),this._rotating&&this.fire(new c.k("rotate",t)),this._pitching&&this.fire(new c.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,l=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new c.k("zoomend",t)),l&&this.fire(new c.k("rotateend",t)),d&&this.fire(new c.k("pitchend",t)),this.fire(new c.k("moveend",t))}flyTo(t,n){if(!t.essential&&c.h.prefersReducedMotion){const Oe=c.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Oe,n)}this.stop(),t=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.bb},t);const a=this._getTransformForUpdate(),l=this.getZoom(),d=this.getBearing(),m=this.getPitch(),g=this.getPadding(),y="zoom"in t?c.ad(+t.zoom,a.minZoom,a.maxZoom):l,v="bearing"in t?this._normalizeBearing(t.bearing,d):d,w="pitch"in t?+t.pitch:m,S="padding"in t?t.padding:a.padding,A=a.zoomScale(y-l),F=c.P.convert(t.offset);let B=a.centerPoint.add(F);const N=a.pointLocation(B),L=c.L.convert(t.center||N);this._normalizeCenter(L);const J=a.project(N),ne=a.project(L).sub(J);let U=t.curve;const Q=Math.max(a.width,a.height),oe=Q/A,le=ne.mag();if("minZoom"in t){const Oe=c.ad(Math.min(t.minZoom,l,y),a.minZoom,a.maxZoom),St=Q/a.zoomScale(Oe-l);U=Math.sqrt(St/le*2)}const fe=U*U;function ve(Oe){const St=(oe*oe-Q*Q+(Oe?-1:1)*fe*fe*le*le)/(2*(Oe?oe:Q)*fe*le);return Math.log(Math.sqrt(St*St+1)-St)}function _e(Oe){return(Math.exp(Oe)-Math.exp(-Oe))/2}function we(Oe){return(Math.exp(Oe)+Math.exp(-Oe))/2}const Be=ve(!1);let st=function(Oe){return we(Be)/we(Be+U*Oe)},Ee=function(Oe){return Q*((we(Be)*(_e(St=Be+U*Oe)/we(St))-_e(Be))/fe)/le;var St},Ge=(ve(!0)-Be)/U;if(Math.abs(le)<1e-6||!isFinite(Ge)){if(Math.abs(Q-oe)<1e-6)return this.easeTo(t,n);const Oe=oe<Q?-1:1;Ge=Math.abs(Math.log(oe/Q))/U,Ee=function(){return 0},st=function(St){return Math.exp(Oe*U*St)}}return t.duration="duration"in t?+t.duration:1e3*Ge/("screenSpeed"in t?+t.screenSpeed/U:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==v,this._pitching=w!==m,this._padding=!a.isPaddingEqual(S),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(L),this._ease(Oe=>{const St=Oe*Ge,rt=1/st(St);a.zoom=Oe===1?y:l+a.scaleZoom(rt),this._rotating&&(a.bearing=c.B.number(d,v,Oe)),this._pitching&&(a.pitch=c.B.number(m,w,Oe)),this._padding&&(a.interpolatePadding(g,S,Oe),B=a.centerPoint.add(F)),this.terrain&&!t.freezeElevation&&this._updateElevation(Oe);const Qe=Oe===1?L:a.unproject(J.add(ne.mult(Ee(St))).mult(rt));a.setLocationAtPoint(a.renderWorldCopies?Qe.wrap():Qe,B),this._applyUpdatedTransform(a),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,n)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,n,a){a.animate===!1||a.duration===0?(t(1),n()):(this._easeStart=c.h.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=c.b5(t,-180,180);const a=Math.abs(t-n);return Math.abs(t-360-n)<a&&(t-=360),Math.abs(t+360-n)<a&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const a=t.lng-n.center.lng;t.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(c.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class qi{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=H.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=H.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){H.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const a=this._map._getUIString(`AttributionControl.${n}`);t.title=a,t.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(l=>typeof l!="string"?"":l)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const n=this._map.style.sourceCaches;for(const l in n){const d=n[l];if(d.used||d.usedForTerrain){const m=d.getSource();m.attribution&&t.indexOf(m.attribution)<0&&t.push(m.attribution)}}t=t.filter(l=>String(l).trim()),t.sort((l,d)=>l.length-d.length),t=t.filter((l,d)=>{for(let m=d+1;m<t.length;m++)if(t[m].indexOf(l)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Pt{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=H.create("div","maplibregl-ctrl");const n=H.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){H.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class sa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const l of a)if(l.id===t)return void(l.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Qa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var hl=c.Q([{name:"a_pos3d",type:"Int16",components:3}]);class ul extends c.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const a={};for(const l of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[l.key]=!0,this._renderableTilesKeys.push(l.key),this._tiles[l.key]||(l.posMatrix=new Float64Array(16),c.aS(l.posMatrix,0,c.N,0,c.N,0,1),this._tiles[l.key]=new Xr(l,this.tileSize));for(const l in this._tiles)a[l]||delete this._tiles[l]}freeRtt(t){for(const n in this._tiles){const a=this._tiles[n];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const a of this._renderableTilesKeys){const l=this._tiles[a].tileID;if(l.canonical.equals(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16),c.aS(d.posMatrix,0,c.N,0,c.N,0,1),n[a]=d}else if(l.canonical.isChildOf(t.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const m=l.canonical.z-t.canonical.z,g=l.canonical.x-(l.canonical.x>>m<<m),y=l.canonical.y-(l.canonical.y>>m<<m),v=c.N>>m;c.aS(d.posMatrix,0,v,0,v,0,1),c.$(d.posMatrix,d.posMatrix,[-g*v,-y*v,0]),n[a]=d}else if(t.canonical.isChildOf(l.canonical)){const d=t.clone();d.posMatrix=new Float64Array(16);const m=t.canonical.z-l.canonical.z,g=t.canonical.x-(t.canonical.x>>m<<m),y=t.canonical.y-(t.canonical.y>>m<<m),v=c.N>>m;c.aS(d.posMatrix,0,c.N,0,c.N,0,1),c.$(d.posMatrix,d.posMatrix,[g*v,y*v,0]),c.a0(d.posMatrix,d.posMatrix,[1/2**m,1/2**m,0]),n[a]=d}}return n}getSourceTile(t,n){const a=this.sourceCache._source;let l=t.overscaledZ-this.deltaZoom;if(l>a.maxzoom&&(l=a.maxzoom),l<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(l).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!d||!d.dem)&&n)for(;l>=a.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(t.scaledTo(l--).key);return d}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class dl{constructor(t,n,a){this.painter=t,this.sourceCache=new ul(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,a,l=c.N){var d;if(!(n>=0&&n<l&&a>=0&&a<l))return 0;const m=this.getTerrainData(t),g=(d=m.tile)===null||d===void 0?void 0:d.dem;if(!g)return 0;const y=function(B,N,L){var J=N[0],ne=N[1];return B[0]=L[0]*J+L[4]*ne+L[12],B[1]=L[1]*J+L[5]*ne+L[13],B}([],[n/l*c.N,a/l*c.N],m.u_terrain_matrix),v=[y[0]*g.dim,y[1]*g.dim],w=Math.floor(v[0]),S=Math.floor(v[1]),A=v[0]-w,F=v[1]-S;return g.get(w,S)*(1-A)*(1-F)+g.get(w+1,S)*A*(1-F)+g.get(w,S+1)*(1-A)*F+g.get(w+1,S+1)*A*F}getElevationForLngLatZoom(t,n){const{tileID:a,mercatorX:l,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(a,l%c.N,d%c.N,c.N)}getElevation(t,n,a,l=c.N){return this.getDEMElevation(t,n,a,l)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const l=this.painter.context,d=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Bt(l,d,l.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Bt(l,new c.R({width:1,height:1}),l.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ao([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const l=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Bt(l,n.dem.getPixels(),l.gl.RGBA,{premultiply:!1}),n.demTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const l=this.sourceCache.sourceCache._source.maxzoom;let d=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=l?d=t.canonical.z-l:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const m=t.canonical.x-(t.canonical.x>>d<<d),g=t.canonical.y-(t.canonical.y>>d<<d),y=c.bc(new Float64Array(16),[1/(c.N<<d),1/(c.N<<d),0]);c.$(y,y,[m*c.N,g*c.N,0]),this._demMatrixCache[t.key]={matrix:y,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,a=n.width/devicePixelRatio,l=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===l||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Bt(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Bt(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,l,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,l))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,m=0;d<this._coordsTextureSize;d++)for(let g=0;g<this._coordsTextureSize;g++,m+=4)n[m+0]=255&g,n[m+1]=255&d,n[m+2]=g>>8<<4|d>>8,n[m+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),l=new Bt(t,a,t.gl.RGBA,{premultiply:!1});return l.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=l,l}pointCoordinate(t){const n=new Uint8Array(4),a=this.painter.context,l=a.gl;a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),l.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const d=n[0]+(n[2]>>4<<8),m=n[1]+((15&n[2])<<8),g=this.coordsIndex[255-n[3]],y=g&&this.sourceCache.getTileByID(g);if(!y)return null;const v=this._coordsTextureSize,w=(1<<y.tileID.canonical.z)*v;return new c.U(this._allowMercatorOverflow(t,(y.tileID.canonical.x*v+d)/w),(y.tileID.canonical.y*v+m)/w,this.getElevation(y.tileID,d,m,v))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new c.bd,a=new c.b0,l=this.meshSize,d=c.N/l,m=l*l;for(let S=0;S<=l;S++)for(let A=0;A<=l;A++)n.emplaceBack(A*d,S*d,0);for(let S=0;S<m;S+=l+1)for(let A=0;A<l;A++)a.emplaceBack(A+S,l+A+S+1,l+A+S+2),a.emplaceBack(A+S,l+A+S+2,A+S+1);const g=n.length,y=g+2*(l+1);for(const S of[0,1])for(let A=0;A<=l;A++)for(const F of[0,1])n.emplaceBack(A*d,S*c.N,F);for(let S=0;S<2*l;S+=2)a.emplaceBack(y+S,y+S+1,y+S+3),a.emplaceBack(y+S,y+S+3,y+S+2),a.emplaceBack(g+S,g+S+3,g+S+1),a.emplaceBack(g+S,g+S+2,g+S+3);const v=n.length,w=v+2*(l+1);for(const S of[0,1])for(let A=0;A<=l;A++)for(const F of[0,1])n.emplaceBack(S*c.N,A*d,F);for(let S=0;S<2*l;S+=2)a.emplaceBack(v+S,v+S+1,v+S+3),a.emplaceBack(v+S,v+S+3,v+S+2),a.emplaceBack(w+S,w+S+3,w+S+1),a.emplaceBack(w+S,w+S+2,w+S+3);return this._mesh={indexBuffer:t.createIndexBuffer(a),vertexBuffer:t.createVertexBuffer(n,hl.members),segments:c.S.simpleSegment(0,0,n.length,a.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*c.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var a;const{tileID:l}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(a=this.getMinMaxElevation(l).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(t,n){const a=c.U.fromLngLat(t.wrap()),l=(1<<n)*c.N,d=a.x*l,m=a.y*l,g=Math.floor(d/c.N),y=Math.floor(m/c.N);return{tileID:new c.O(n,0,n,g,y),mercatorX:d,mercatorY:m}}_allowMercatorOverflow(t,n){const a=t.x<this.painter.width/2;let l=c.bf(n);const d=this.painter.transform.center.lng;return a&&Math.sign(l)>0&&Math.sign(d)<0||!a&&Math.sign(l)<0&&Math.sign(d)>0?(l=360*Math.sign(d)+l,c.G(l)):n}}class ac{constructor(t,n,a){this._context=t,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Bt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:t,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Si={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class aa{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new ac(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(a=>!t._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in t.sourceCaches){this._coordsDescendingInv[a]={};const l=t.sourceCaches[a].getVisibleCoordinates();for(const d of l){const m=this.terrain.sourceCache.getTerrainCoords(d);for(const g in m)this._coordsDescendingInv[a][g]||(this._coordsDescendingInv[a][g]=[]),this._coordsDescendingInv[a][g].push(m[g])}}this._coordsDescendingInvStr={};for(const a of t._order){const l=t._layers[a],d=l.source;if(Si[l.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const m in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][m]=this._coordsDescendingInv[d][m].map(g=>g.key).sort().join()}}for(const a of this._renderableTiles)for(const l in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[l][a.tileID.key];d&&d!==a.rttCoords[l]&&(a.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,a=this.painter,l=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Si[n]&&(this._prevType&&Si[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!l))return!0;if(Si[this._prevType]||Si[n]&&l){this._prevType=n;const d=this._stacks.length-1,m=this._stacks[d]||[];for(const g of this._renderableTiles){if(this.pool.isFull()&&(Ut(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(g),g.rtt[d]){const v=this.pool.getObjectForId(g.rtt[d].id);if(v.stamp===g.rtt[d].stamp){this.pool.useObject(v);continue}}const y=this.pool.getOrCreateFreeObject();this.pool.useObject(y),this.pool.stampObject(y),g.rtt[d]={id:y.id,stamp:y.stamp},a.context.bindFramebuffer.set(y.fbo.framebuffer),a.context.clear({color:c.aT.transparent,stencil:0}),a.currentStencilSource=void 0;for(let v=0;v<m.length;v++){const w=a.style._layers[m[v]],S=w.source?this._coordsDescendingInv[w.source][g.tileID.key]:[g.tileID];a.context.viewport.set([0,0,y.fbo.width,y.fbo.height]),a._renderTileClippingMasks(w,S),a.renderLayer(a,a.style.sourceCaches[w.source],w,S),w.source&&(g.rttCoords[w.source]=this._coordsDescendingInvStr[w.source][g.tileID.key])}}return Ut(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Si[n]}return!1}}const je=xe,Ze={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},vs=h=>{h.touchstart=h.dragStart,h.touchmoveWindow=h.dragMove,h.touchend=h.dragEnd},eo={showCompass:!0,showZoom:!0,visualizePitch:!1};class to{constructor(t,n,a=!1){this.mousedown=m=>{this.startMouse(c.e({},m,{ctrlKey:!0,preventDefault:()=>m.preventDefault()}),H.mousePos(this.element,m)),H.addEventListener(window,"mousemove",this.mousemove),H.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.moveMouse(m,H.mousePos(this.element,m))},this.mouseup=m=>{this.mouseRotate.dragEnd(m),this.mousePitch&&this.mousePitch.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,m.targetTouches)[0],this.startTouch(m,this._startPos),H.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,m.targetTouches)[0],this.moveTouch(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const l=t.dragRotate._mouseRotate.getClickTolerance(),d=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Zn({clickTolerance:l,enable:!0}),this.touchRotate=(({enable:m,clickTolerance:g,bearingDegreesPerPixelMoved:y=.8})=>{const v=new nl;return new Br({clickTolerance:g,move:(w,S)=>({bearingDelta:(S.x-w.x)*y}),moveStateManager:v,enable:m,assignEvents:vs})})({clickTolerance:l,enable:!0}),this.map=t,a&&(this.mousePitch=Fr({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:m,clickTolerance:g,pitchDegreesPerPixelMoved:y=-.5})=>{const v=new nl;return new Br({clickTolerance:g,move:(w,S)=>({pitchDelta:(S.y-w.y)*y}),moveStateManager:v,enable:m,assignEvents:vs})})({clickTolerance:d,enable:!0})),H.addEventListener(n,"mousedown",this.mousedown),H.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),H.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),H.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),H.disableDrag()}moveMouse(t,n){const a=this.map,{bearingDelta:l}=this.mouseRotate.dragMove(t,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(t,n)||{};d&&a.setPitch(a.getPitch()+d)}}moveTouch(t,n){const a=this.map,{bearingDelta:l}=this.touchRotate.dragMove(t,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(t,n)||{};d&&a.setPitch(a.getPitch()+d)}}off(){const t=this.element;H.removeEventListener(t,"mousedown",this.mousedown),H.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend),H.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){H.enableDrag(),H.removeEventListener(window,"mousemove",this.mousemove),H.removeEventListener(window,"mouseup",this.mouseup),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend)}}let Wt;function io(h,t,n){if(h=new c.L(h.lng,h.lat),t){const a=new c.L(h.lng-360,h.lat),l=new c.L(h.lng+360,h.lat),d=n.locationPoint(h).distSqr(t);n.locationPoint(a).distSqr(t)<d?h=a:n.locationPoint(l).distSqr(t)<d&&(h=l)}for(;Math.abs(h.lng-n.center.lng)>180;){const a=n.locationPoint(h);if(a.x>=0&&a.y>=0&&a.x<=n.width&&a.y<=n.height)break;h.lng>n.center.lng?h.lng-=360:h.lng+=360}return h}const sr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pl(h,t,n){const a=h.classList;for(const l in sr)a.remove(`maplibregl-${n}-anchor-${l}`);a.add(`maplibregl-${n}-anchor-${t}`)}class vn extends c.E{constructor(t){if(super(),this._onKeyPress=n=>{const a=n.code,l=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&l!==32&&l!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,l=this._element;this._popup&&(a===l||l.contains(a))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const a=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!a)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=io(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let l="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?l=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),H.setTransform(this._element,`${sr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${l}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const m=this._map.unproject(this._pos),g=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*g?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=c.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div"),this._element.setAttribute("aria-label","Map marker");const n=H.createNS("http://www.w3.org/2000/svg","svg"),a=41,l=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${l}px`),n.setAttributeNS(null,"viewBox",`0 0 ${l} ${a}`);const d=H.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const m=H.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");const g=H.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(3.0, 29.0)"),g.setAttributeNS(null,"fill","#000000");const y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of y){const ne=H.createNS("http://www.w3.org/2000/svg","ellipse");ne.setAttributeNS(null,"opacity","0.04"),ne.setAttributeNS(null,"cx","10.5"),ne.setAttributeNS(null,"cy","5.80029008"),ne.setAttributeNS(null,"rx",J.rx),ne.setAttributeNS(null,"ry",J.ry),g.appendChild(ne)}const v=H.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill",this._color);const w=H.createNS("http://www.w3.org/2000/svg","path");w.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),v.appendChild(w);const S=H.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"opacity","0.25"),S.setAttributeNS(null,"fill","#000000");const A=H.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),S.appendChild(A);const F=H.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");const B=H.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(8.0, 8.0)");const N=H.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#000000"),N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962");const L=H.createNS("http://www.w3.org/2000/svg","circle");L.setAttributeNS(null,"fill","#FFFFFF"),L.setAttributeNS(null,"cx","5.5"),L.setAttributeNS(null,"cy","5.5"),L.setAttributeNS(null,"r","5.4999962"),B.appendChild(N),B.appendChild(L),m.appendChild(g),m.appendChild(v),m.appendChild(S),m.appendChild(F),m.appendChild(B),n.appendChild(m),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",l*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),pl(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),H.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const l=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=c.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const qt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Vt=0,Hn=!1;const bs={maxWidth:100,unit:"metric"};function ws(h,t,n){const a=n&&n.maxWidth||100,l=h._container.clientHeight/2,d=h.unproject([0,l]),m=h.unproject([a,l]),g=d.distanceTo(m);if(n&&n.unit==="imperial"){const y=3.2808*g;y>5280?bn(t,a,y/5280,h._getUIString("ScaleControl.Miles")):bn(t,a,y,h._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?bn(t,a,g/1852,h._getUIString("ScaleControl.NauticalMiles")):g>=1e3?bn(t,a,g/1e3,h._getUIString("ScaleControl.Kilometers")):bn(t,a,g,h._getUIString("ScaleControl.Meters"))}function bn(h,t,n,a){const l=function(d){const m=Math.pow(10,`${Math.floor(d)}`.length-1);let g=d/m;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:g>=1?1:function(y){const v=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*v)/v}(g),m*g}(n);h.style.width=t*(l/n)+"px",h.innerHTML=`${l}&nbsp;${a}`}const ro={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},no=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wn(h){if(h){if(typeof h=="number"){const t=Math.round(Math.abs(h)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,h),"top-left":new c.P(t,t),"top-right":new c.P(-t,t),bottom:new c.P(0,-h),"bottom-left":new c.P(t,-t),"bottom-right":new c.P(-t,-t),left:new c.P(h,0),right:new c.P(-h,0)}}if(h instanceof c.P||Array.isArray(h)){const t=c.P.convert(h);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:c.P.convert(h.center||[0,0]),top:c.P.convert(h.top||[0,0]),"top-left":c.P.convert(h["top-left"]||[0,0]),"top-right":c.P.convert(h["top-right"]||[0,0]),bottom:c.P.convert(h.bottom||[0,0]),"bottom-left":c.P.convert(h["bottom-left"]||[0,0]),"bottom-right":c.P.convert(h["bottom-right"]||[0,0]),left:c.P.convert(h.left||[0,0]),right:c.P.convert(h.right||[0,0])}}return Wn(new c.P(0,0))}const so={extend:(h,...t)=>c.e(h,...t),run(h){h()},logToElement(h,t=!1,n="log"){const a=window.document.getElementById(n);a&&(t&&(a.innerHTML=""),a.innerHTML+=`<br>${h}`)}},ao=xe;class _t{static get version(){return ao}static get workerCount(){return _r.workerCount}static set workerCount(t){_r.workerCount=t}static get maxParallelImageRequests(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){c.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return c.c.WORKER_URL}static set workerUrl(t){c.c.WORKER_URL=t}static addProtocol(t,n){c.c.REGISTERED_PROTOCOLS[t]=n}static removeProtocol(t){delete c.c.REGISTERED_PROTOCOLS[t]}}return _t.Map=class extends cl{constructor(h){if(c.bg.mark(c.bh.create),(h=c.e({},Ze,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ta(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),{bearingSnap:h.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._cooperativeGestures=h.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new sa,this._controls=[],this._mapId=c.a2(),this._locale=c.e({},Qa,h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this.transformCameraUpdate=h.transformCameraUpdate,this._imageQueueHandle=xt.addThrottleControl(()=>this.isMoving()),this._requestManager=new At(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=xn(a=>{this._trackResize&&!this._removed&&this.resize(a)._update()},50);this._resizeObserver=new ResizeObserver(a=>{t?n(a):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ja(this,h),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=h.hash&&new ms(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,c.e({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new qi({customAttribution:h.customAttribution})),h.maplibreLogo&&this.addControl(new Pt,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new c.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new c.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new c.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=h.onAdd(this);this._controls.push(h);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,t,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,t,n,a)}resize(h){var t;const n=this._containerDimensions(),a=n[0],l=n[1],d=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,d),this.painter.resize(a,l,d),this.painter.overLimit()){const g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];const y=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,y),this.painter.resize(a,l,y)}this.transform.resize(a,l),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,l);const m=!this._moving;return m&&(this.stop(),this.fire(new c.k("movestart",h)).fire(new c.k("move",h))),this.fire(new c.k("resize",h)),m&&this.fire(new c.k("moveend",h)),this}_getClampedPixelRatio(h,t){const{0:n,1:a}=this._maxCanvasSize,l=this.getPixelRatio(),d=h*l,m=t*l;return Math.min(d>n?n/d:1,m>a?a/m:1)*l}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(kt.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(h){return this.transform.locationPoint(c.L.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.pointLocation(c.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,t,n){if(h==="mouseenter"||h==="mouseover"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:d=>{const m=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];m.length?a||(a=!0,n.call(this,new Ui(h,this,d.originalEvent,{features:m}))):a=!1},mouseout:()=>{a=!1}}}}if(h==="mouseleave"||h==="mouseout"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:m=>{(this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,n.call(this,new Ui(h,this,m.originalEvent)))},mouseout:m=>{a&&(a=!1,n.call(this,new Ui(h,this,m.originalEvent)))}}}}{const a=l=>{const d=this.getLayer(t)?this.queryRenderedFeatures(l.point,{layers:[t]}):[];d.length&&(l.features=d,n.call(this,l),delete l.features)};return{layer:t,listener:n,delegates:{[h]:a}}}}on(h,t,n){if(n===void 0)return super.on(h,t);const a=this._createDelegatedListener(h,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(a);for(const l in a.delegates)this.on(l,a.delegates[l]);return this}once(h,t,n){if(n===void 0)return super.once(h,t);const a=this._createDelegatedListener(h,t,n);for(const l in a.delegates)this.once(l,a.delegates[l]);return this}off(h,t,n){return n===void 0?super.off(h,t):(this._delegatedListeners&&this._delegatedListeners[h]&&(a=>{const l=this._delegatedListeners[h];for(let d=0;d<l.length;d++){const m=l[d];if(m.layer===t&&m.listener===n){for(const g in m.delegates)this.off(g,m.delegates[g]);return l.splice(d,1),this}}})(),this)}queryRenderedFeatures(h,t){if(!this.style)return[];let n;const a=h instanceof c.P||Array.isArray(h),l=a?h:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:h)||{},l instanceof c.P||typeof l[0]=="number")n=[c.P.convert(l)];else{const d=c.P.convert(l[0]),m=c.P.convert(l[1]);n=[d,new c.P(m.x,d.y),m,new c.P(d.x,m.y),d]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}setStyle(h,t){return(t=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(h,t))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new ui(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,t,n):this.style.loadJSON(h,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ui(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if(typeof h=="string"){const n=this._requestManager.transformRequest(h,lt.Style);c.f(n,(a,l)=>{a?this.fire(new c.j(a)):l&&this._updateDiff(l,t)})}else typeof h=="object"&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h,t)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){const t=this.style&&this.style.sourceCaches[h];if(t!==void 0)return t.loaded();this.fire(new c.j(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){const t=this.style.sourceCaches[h.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===h.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dl(this.painter,t,h),this.painter.renderToTexture=new aa(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==h.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:h})),this}getTerrain(){var h,t;return(t=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const t in h){const n=h[t]._tiles;for(const a in n){const l=n[a];if(l.state!=="loaded"&&l.state!=="errored")return!1}}return!0}addSourceType(h,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,n)}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,n={}){const{pixelRatio:a=1,sdf:l=!1,stretchX:d,stretchY:m,content:g}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||c.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:y,height:v,data:w}=t,S=t;return this.style.addImage(h,{data:new c.R({width:y,height:v},new Uint8Array(w)),pixelRatio:a,stretchX:d,stretchY:m,content:g,sdf:l,version:0,userImage:S}),S.onAdd&&S.onAdd(this,h),this}}{const{width:y,height:v,data:w}=c.h.getImageData(t);this.style.addImage(h,{data:new c.R({width:y,height:v},w),pixelRatio:a,stretchX:d,stretchY:m,content:g,sdf:l,version:0})}}updateImage(h,t){const n=this.style.getImage(h);if(!n)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||c.a(t)?c.h.getImageData(t):t,{width:l,height:d,data:m}=a;if(l===void 0||d===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(l!==n.data.width||d!==n.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const g=!(t instanceof HTMLImageElement||c.a(t));return n.data.replace(m,g),this.style.updateImage(h,n),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){xt.getImage(this._requestManager.transformRequest(h,lt.Image),t)}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,t,n){return this.style.setLayerZoomRange(h,t,n),this._update(!0)}setFilter(h,t,n={}){return this.style.setFilter(h,t,n),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,n,a={}){return this.style.setPaintProperty(h,t,n,a),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,n,a={}){return this.style.setLayoutProperty(h,t,n,a),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setGlyphs(h,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,t,n,a=>{a||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,t,n=>{n||this._update(!0)}),this}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,t=0;return this._container&&(h=this._container.clientWidth||400,t=this._container.clientHeight||300),[h,t]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map");const t=this._canvasContainer=H.create("div","maplibregl-canvas-container",h);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=H.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const l=this._controlContainer=H.create("div","maplibregl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{d[m]=H.create("div",`maplibregl-ctrl-${m} `,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=H.create("div","maplibregl-cooperative-gesture-screen",this._container);let h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){H.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(h,t,n){this._canvas.width=Math.floor(n*h),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const h={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{t={requestedAttributes:h},a&&(t.statusMessage=a.statusMessage,t.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h);if(!n){const a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new yn(n,this.transform),Ve.testSupport(n)}_onCooperativeGesture(h,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const l=this.transform.zoom,d=c.h.now();this.style.zoomHistory.update(l,d);const m=new c.a8(l,{now:d,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),g=m.crossFadingFactor();g===1&&g===this._crossFadingFactor||(n=!0,this._crossFadingFactor=g),this.style.update(m)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bg.mark(c.bh.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,c.bg.mark(c.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),xt.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),H.remove(this._canvasContainer),H.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),c.bg.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=c.h.frame(h=>{c.bg.frame(h),this._frame=null,this._render(h)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return je}getCameraTargetElevation(){return this.transform.elevation}},_t.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),a=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);t.title=a,t.setAttribute("aria-label",a)},this.options=c.e({},eo,h),this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),H.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),H.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=H.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new to(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){H.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,t){const n=H.create("button",h,this._container);return n.type="button",n.addEventListener("click",t),n}},_t.GeolocateControl=class extends c.E{constructor(h){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new c.L(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy,l=this._map.getBearing(),d=c.e({bearing:l},this.options.fitBoundsOptions),m=kt.fromLngLat(n,a);this._map.fitBounds(m,d,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new c.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Hn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=H.create("button","maplibregl-ctrl-geolocate",this._container),H.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new vn({element:this._dotElement}),this._circleElement=H.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")))})}},this.options=c.e({},qt,h)}onAdd(h){return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,n=!1){Wt===void 0||n?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(a=>{Wt=a.state!=="denied",t(Wt)}).catch(()=>{Wt=!!window.navigator.geolocation,t(Wt)}):(Wt=!!window.navigator.geolocation,t(Wt)):t(Wt)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),H.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Vt=0,Hn=!1}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),n=h.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const h=this._map.getBounds(),t=h.getSouthEast(),n=h.getNorthEast(),a=t.distanceTo(n),l=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Vt--,Hn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Vt++,Vt>1?(h={maximumAge:6e5,timeout:0},Hn=!0):(h=this.options.positionOptions,Hn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_t.AttributionControl=qi,_t.LogoControl=Pt,_t.ScaleControl=class{constructor(h){this._onMove=()=>{ws(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ws(this._map,this._container,this.options)},this.options=c.e({},bs,h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){H.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_t.FullscreenControl=class extends c.E{constructor(h={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){H.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const h=this._fullscreenButton=H.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);H.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_t.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=h}onAdd(h){return this._map=h,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=H.create("button","maplibregl-ctrl-terrain",this._container),H.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){H.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_t.Popup=class extends c.E{constructor(h){super(),this.remove=()=>(this._content&&H.remove(this._content),this._container&&(H.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new c.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=H.create("div","maplibregl-popup",this._map.getContainer()),this._tip=H.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const m of this.options.className.split(" "))this._container.classList.add(m);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=io(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let a=this.options.anchor;const l=Wn(this.options.offset);if(!a){const m=this._container.offsetWidth,g=this._container.offsetHeight;let y;y=n.y+l.bottom.y<g?["top"]:n.y>this._map.transform.height-g?["bottom"]:[],n.x<m/2?y.push("left"):n.x>this._map.transform.width-m/2&&y.push("right"),a=y.length===0?"bottom":y.join("-")}const d=n.add(l[a]).round();H.setTransform(this._container,`${sr[a]} translate(${d.x}px,${d.y}px)`),pl(this._container,a,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(ro),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=c.L.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=h;a=n.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){this._container&&this._container.classList.add(h)}removeClassName(h){this._container&&this._container.classList.remove(h)}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}_createCloseButton(){this.options.closeButton&&(this._closeButton=H.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(no);h&&h.focus()}},_t.Marker=vn,_t.Style=ui,_t.LngLat=c.L,_t.LngLatBounds=kt,_t.Point=c.P,_t.MercatorCoordinate=c.U,_t.Evented=c.E,_t.AJAXError=c.bi,_t.config=c.c,_t.CanvasSource=Hr,_t.GeoJSONSource=Gr,_t.ImageSource=Ji,_t.RasterDEMTileSource=zn,_t.RasterTileSource=Pn,_t.VectorTileSource=cn,_t.VideoSource=ss,_t.setRTLTextPlugin=c.bj,_t.getRTLTextPluginStatus=c.bk,_t.prewarm=function(){zs().acquire(ft)},_t.clearPrewarmedResources=function(){const h=kr;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(ft),kr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},so.extend(_t,{isSafari:c.ac,getPerformanceMetrics:c.bg.getPerformanceMetrics}),_t});var ce=Y;return ce})})(gd);var hg=gd.exports;const ug=Lf(hg);function dg(){const[M,z]=ye.useState(!1);return de.jsx("div",{className:M?"fixed top-0 right-0 bottom-0 left-0 z-[9999]":"w-full h-full relative",children:de.jsx(lg,{mapLib:ug,style:{width:"100%",height:" 100%",position:"relative"},mapStyle:"https://api.ekgis.vn/v2/mapstyles/style/osmplus/standard/style.json?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy",children:de.jsx(cg,{id:"raster-tiles",type:"raster",tileSize:256,tiles:["https://api.ekgis.vn/v1/maps/roadmap/{z}/{x}/{y}.png?api_key=wtpM0U1ZmE2s87LEZNSHf63Osc1a2sboaozCQNsy"]})})})}function pg({data:M}){return de.jsxs(ya,{className:"h-[500px]",children:[de.jsx(Ki,{span:8,children:de.jsx(ih,{columns:[{title:"Stt",dataIndex:"stt",key:"stt",render:(z,G,W)=>W+1},...sh],dataSource:md,pagination:!1})}),de.jsx(Ki,{span:16,children:de.jsx(dg,{})})]})}const{Dragger:fg}=$f,mg={name:"file",multiple:!0,action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",onChange(M){const{status:z}=M.file;z!=="uploading"&&console.log(M.file,M.fileList),z==="done"?Vu.success(`${M.file.name} file uploaded successfully.`):z==="error"&&Vu.error(`${M.file.name} file upload failed.`)},onDrop(M){console.log("Dropped files",M.dataTransfer.files)}};function gg(){return de.jsxs(fg,{...mg,children:[de.jsx("p",{className:"ant-upload-drag-icon",children:de.jsx(Sm,{})}),de.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),de.jsx("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload. Strictly prohibited from uploading company data or other banned files."})]})}function _g({form:M,filter:z,setFilter:G}){const[W,Y]=ye.useState([]),[ae,ce]=ye.useState([]),[c,xe]=ye.useState([]),[H,Ve]=ye.useState([]);ye.useState(""),ye.useState(""),ye.useEffect(()=>{M.setFieldsValue(z)},[z]),ye.useEffect(()=>{(async()=>{let Xe=await is.get("/api/method/frappe.desk.search.search_link",{params:{txt:"",doctype:"Customer Group",ignore_user_permissions:0,reference_doctype:"Customer"}}),it=await is.get("/api/method/mbw_dms.api.location.list_province");ce(it.result);let{results:yt}=Xe;Y(yt.map(xt=>({label:xt.value,value:xt.value})))})()},[]);const He=async Xe=>{let it=ae.find(yt=>yt.ten_tinh==Xe)?.ma_tinh;if(it){let yt=await is.get("/api/method/mbw_dms.api.location.list_district",{params:{ma_tinh_thanh:Number.parseInt(it)}});xe(yt.result)}},Ae=async Xe=>{let it=c.find(yt=>yt.ten_huyen==Xe)?.ma_huyen;if(it){let yt=await is.get("/api/method/mbw_dms.api.location.list_ward",{params:{ma_quan_huyen:it}});Ve(yt.result)}};return de.jsxs(eh,{form:M,layout:"vertical",onFinish:G,children:[de.jsx(lr,{label:"Loại khách hàng",name:"customer_type",children:de.jsx(qr,{options:[{label:"Tất cả",value:!1},{label:"Company",value:"Company"},{label:"Individual",value:"Individual"}]})}),de.jsx(lr,{label:"Nhóm khách hàng",name:"customer_group",children:de.jsx(qr,{options:W})}),de.jsx("p",{className:"font-medium text-sm",children:"Địa chỉ"}),de.jsx(lr,{label:"Tỉnh/Thành phố",name:"city",children:de.jsx(qr,{options:ae.map(Xe=>({label:Xe.ten_tinh,value:Xe.ten_tinh})),onChange:He})}),de.jsx(lr,{label:"Quận/huyện",name:"district",children:de.jsx(qr,{options:c.map(Xe=>({label:Xe.ten_huyen,value:Xe.ten_huyen})),disabled:c.length==0,onChange:Ae})}),de.jsx(lr,{label:"Phường/xã",name:"ward",children:de.jsx(qr,{options:H.map(Xe=>({label:Xe.ten_xa,value:Xe.ten_xa})),disabled:H.length==0})})]})}const yg=[...sh,{title:"Loại khách hàng",dataIndex:"customer_id",key:"customer_type"},{title:"Nhóm khách hàng",dataIndex:"customer_name",key:"customer_group"},...fd],Qu=M=>{let z=[];for(let G in M)M[G]&&(z=[...z,{key:[Em[G]],value:M[G],key2:G}]);return z};function xg({selected:M,handleAdd:z,closeModal:G}){const[W]=Rf(),[Y,ae]=ye.useState([]),[ce,c]=ye.useState(md),[xe,H]=ye.useState({}),[Ve,He]=ye.useState(!1),Ae=20,[Xe,it]=ye.useState(1),[yt,xt]=ye.useState(40),lt={selectedRowKeys:Y&&Y.map(ut=>ut.name),onChange:(ut,li)=>{ae(li)}},At=()=>{W.submit(),He(!1)},bt=ut=>{if(ut){let li={...xe};delete li[ut.key2],W.setFieldsValue(li),H(cr=>(delete cr[ut.key2],{...cr}))}else W.resetFields(),H({})};ye.useEffect(()=>{(async()=>{const ut=await is.get("/api/method/mbw_dms.api.router.get_customer",{params:{...xe,page_size:Ae,page_number:Xe}});c(ut?.result?.data),xt(ut.result?.total),console.log("rsCustomer",ut)})()},[xe,Xe]);const nt=()=>{Y.length>0&&z(Y),G()};return ye.useEffect(()=>{ae(M)},[M]),de.jsxs(de.Fragment,{children:[de.jsxs(ya,{className:"justify-between",children:[de.jsxs(Ki,{className:"inline-flex ",children:[de.jsx(lr,{children:de.jsx(jl,{placeholder:"Tìm kiếm khách hàng",prefix:de.jsx(sd,{})})}),de.jsxs("div",{className:"flex justify-center items-center ml-4",children:[de.jsx(Ol,{className:"flex items-center text-nowrap !text-[13px] !leading-[21px] !font-normal  border-r-[0.1px] rounded-r-none h-[36px]",icon:de.jsx(Uf,{style:{fontSize:"20px"}}),onClick:He.bind(null,!0),children:"Filter"}),de.jsx(Ol,{className:"border-l-[0.1px] rounded-l-none h-[36px]",onClick:()=>bt(),children:de.jsx(qf,{style:{fontSize:"20px"}})})]})]}),de.jsxs(Ki,{className:"inline-flex items-center",children:[de.jsxs("span",{className:"mr-4",children:["Đã chọn ",Y.length||0," khách hàng"]}),de.jsx(Ol,{type:"primary",onClick:nt,children:"Thêm"})]})]}),de.jsxs("div",{className:"py-5 px-4",children:[de.jsxs("span",{children:[ce.length," kết quả hiển thị"]}),Qu(xe).length>0&&de.jsxs(ya,{className:"items-center",children:[Qu(xe).map(ut=>de.jsxs(Bf,{closeIcon:de.jsx(id,{}),onClose:()=>{bt(ut)},children:[ut.key,": ",ut.value]})),de.jsx("span",{className:"cursor-pointer",onClick:()=>bt(),children:"Clear all"})]})]}),de.jsx(ih,{rowSelection:{type:"checkbox",...lt},columns:yg,dataSource:ce.map(ut=>({key:ut.name,...ut})),pagination:!1}),de.jsx(ya,{className:"justify-end mt-2",children:de.jsx(Ff,{defaultCurrent:Xe,pageSize:Ae,total:yt,onChange:(ut,li)=>{it(ut)}})}),de.jsx(th,{width:451,title:"Bộ lọc",open:Ve,okText:"Áp dụng",cancelText:"Đặt lại",onCancel:He.bind(null,!1),onOk:At,children:de.jsx(_g,{filter:xe,setFilter:H,form:W})})]})}function vg({listCustomer:M,handleCustomer:z}){const[G,W]=ye.useState("list"),[Y,ae]=ye.useState(!1),[ce,c]=ye.useState(!1),xe=Ve=>{switch(Ve){case"Choose":ae(!1);break;case"Import":c(!1);break;default:ae(!1),c(!1)}},H=Ve=>{switch(Ve){case"Choose":ae(!0);break;case"Import":c(!0);break}};return de.jsxs(de.Fragment,{children:[de.jsxs(ya,{gutter:16,className:"justify-between p-4 pb-5 pt-10 mt-0",children:[de.jsx(Ki,{children:de.jsxs(ya,{gutter:8,children:[de.jsx(Ki,{span:9,className:"text-[#1677ff]",children:de.jsx(lr,{children:de.jsx(qr,{defaultValue:"add",options:Cm,onSelect:H})})}),de.jsx(Ki,{span:7,children:de.jsx(Ol,{className:"w-full flex items-center text-[#1677ff] bg-[#1877f214] h-[36px]",icon:de.jsx(Pm,{}),children:"Tối ưu tuyến"})}),de.jsx(Ki,{span:8,children:de.jsx(lr,{children:de.jsx(jl,{placeholder:"Tìm kiếm khách hàng",prefix:de.jsx(sd,{})})})})]})}),de.jsxs(Ki,{children:[" ",de.jsxs(Jc.Group,{defaultValue:G,onChange:Ve=>W(Ve.target.value),size:"middle",children:[de.jsx(Jc.Button,{value:"list",children:de.jsx(Dm,{size:28})}),de.jsx(Jc.Button,{value:"map",children:de.jsx(zm,{size:28})})]})]})]}),de.jsx("div",{children:G=="list"?de.jsx(Lm,{data:M,handleData:z}):de.jsx(pg,{data:M})}),de.jsx(th,{width:1240,open:Y,onCancel:xe.bind(null,"Choose"),title:de.jsx("strong",{className:"text-xl",children:"Chọn khách hàng"}),footer:!1,children:de.jsx(xg,{selected:M,handleAdd:z,closeModal:ae.bind(null,!1)})}),de.jsx(th,{width:777,open:ce,onCancel:xe.bind(null,"Import"),okText:"Tiếp tục",cancelText:"Hủy",title:de.jsx("strong",{className:"text-xl",children:"Nhập dữ liệu khách hàng"}),children:de.jsx(gg,{})})]})}function bg(){const[M]=eh.useForm(),z=Of(),[G,W]=pd.useNotification(),[Y,ae]=ye.useState([]),ce=(xe,H)=>{G.info({message:`Notification ${xe}`,description:de.jsx("p",{children:H}),placement:xe})},c=ye.useCallback(async xe=>{xe={...xe,customers:Y.map(H=>{let Ve=["customer_id","customer_name","display_address","phone_number","customer","frequency"];for(let He in H)Ve.includes(He)||delete H[He];return H})};try{await is.post("/api/method/mbw_dms.api.router.create_router",xe),ce("topRight","Success"),z("/")}catch(H){ce("topRight","Failure!!!"),console.log("error create",H)}},[Y]);return de.jsxs(de.Fragment,{children:[de.jsx(Nf,{title:"Thêm tuyến",buttons:[{label:"Thêm",action:M.submit,type:"primary"}]}),de.jsx("div",{className:"bg-white rounded-md",children:de.jsx(eh,{layout:"vertical",form:M,onFinish:c,children:de.jsx(Vf,{defaultActiveKey:"1",items:[{label:de.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:de.jsx(km,{})},{label:de.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"2",children:de.jsx(vg,{handleCustomer:ae,listCustomer:Y})}],indicatorSize:xe=>xe-18})})})]})}function Cg(){return de.jsxs(de.Fragment,{children:[de.jsx(jf,{children:de.jsx("title",{children:" RouterControll"})}),de.jsx(bg,{})]})}export{Cg as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/mapbox-gl-FD4ghjK4.js","assets/main-ZqBQIJMP.js","assets/main-kl2YzmiT.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
