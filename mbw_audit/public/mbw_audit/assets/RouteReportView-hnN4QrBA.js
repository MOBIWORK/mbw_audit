import{r as a,s as U,j as e,aJ as T,C as R,g as y,Z as v,S as Q,a3 as B,a4 as V,T as W,a5 as J,u as Y,F as G,H as L,aO as M,aK as D,A as $,d as ee}from"./main-Z-QFHQJy.js";import{I as O}from"./index-gr6DzbMM.js";import{C as Ae,a as te}from"./CloseCircleOutlined-SfQDSGb_.js";const X="data:image/png;base64,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";function ae({form:i,recordData:t,onChangeScoringHuman:p}){const[b,C]=a.useState([]),[S,N]=a.useState([]),[g,x]=a.useState(0),[h,n]=a.useState(0),[r,c]=a.useState(0),[j,f]=a.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]),[o,I]=a.useState(!1),[F,k]=a.useState(!1);a.useEffect(()=>{if(t){i.setFieldsValue({store:t.customer_name,campaign_name:t.campaign_name,employee_code:t.employee_name,quatity:t.quantity_cate,time_report:u(t.images_time),scoring_machine:t.scoring_machine==1?"Đạt":t.scoring_machine==0?"Không đạt":"",scoring_human:t.scoring_human}),c(t.scoring_human);let A=[];t.images!=null&&t.images!=""&&(A=JSON.parse(t.images)),A.length===0&&I(!0);let s=[];t.images_ai!=null&&t.images_ai!=""&&(s=JSON.parse(t.images_ai)),s.length===0&&(k(!0),U.warning("không tải được ảnh AI")),C(A),N(s)}},[t]);const K=A=>{x(A)},q=A=>{n(A)},w=()=>{g>0&&x(g-1)},z=()=>{g<b.length-1&&x(g+1)},E=()=>{h>0&&n(h-1)},l=()=>{h<S.length-1&&n(h+1)},d=A=>{c(A),p(A)},u=A=>{let s=new Date(A),_=s.getDate(),m=s.getMonth()+1,P=s.getFullYear(),Z=s.getHours(),H=s.getMinutes();return`${_.toString().padStart(2,"0")}/${m.toString().padStart(2,"0")}/${P} ${Z.toString().padStart(2,"0")}:${H.toString().padStart(2,"0")}`};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 pt-6 pb-[40px]",children:[e.jsxs(T,{children:[e.jsx(R,{span:8,children:e.jsx(y,{label:"Khách hàng",name:"store",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0})})}),e.jsx(R,{span:8,children:e.jsx(y,{label:"Chiến dịch",name:"campaign_name",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0})})}),e.jsx(R,{span:8,children:e.jsx(y,{label:"Nhân viên thực hiện",name:"employee_code",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0})})})]}),e.jsxs(T,{children:[e.jsx(R,{span:8,children:e.jsx(y,{label:"Thời gian thực hiện",name:"time_report",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0})})}),e.jsx(R,{span:8,children:e.jsx(y,{label:"Điểm trưng bày AI chấm",name:"scoring_machine",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0,style:{color:t&&t.scoring_machine===1?"green":t&&t.scoring_machine===0?"red":"black"}})})}),e.jsx(R,{span:8,children:e.jsx(y,{label:"Giám sát chấm",name:"scoring_human",className:"pt-3",required:!0,children:e.jsx(Q,{className:"w-[200px] h-[36px]",value:r,onChange:A=>d(A),defaultValue:r,children:j.map(A=>e.jsx(Q.Option,{value:A.value,children:A.label},A.value))})})})]}),e.jsxs(T,{children:[e.jsx(R,{span:8,children:e.jsxs(y,{label:"Hình ảnh cửa hàng",className:"pt-3",required:!0,children:[e.jsxs("div",{style:{position:"relative",width:"100%",height:"auto",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(O,{src:b[g],fallback:X,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"cover",alignSelf:"center",borderRadius:"10px"}}),!o&&e.jsx("div",{onClick:w,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",left:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(B,{onClick:w,style:{color:"white"}})}),!o&&e.jsx("div",{onClick:z,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",right:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(V,{onClick:z,style:{color:"white"}})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",gap:"10px",overflowX:"hidden",marginTop:"10px"},children:b.map((A,s)=>e.jsx(O,{src:A,onClick:()=>K(s),style:{width:"80px",height:"80px",objectFit:"cover",cursor:"pointer",borderRadius:"10px"},preview:!1},s))})]})}),e.jsx(R,{span:8,children:e.jsxs(y,{label:"Hình ảnh AI trả về",className:"pt-3",required:!0,children:[e.jsxs("div",{style:{position:"relative",width:"100%",height:"auto",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(O,{src:S[h],fallback:X,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"cover",alignSelf:"center",borderRadius:"10px"}}),!F&&e.jsx("div",{onClick:E,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",left:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(B,{onClick:E,style:{color:"white"}})}),!F&&e.jsx("div",{onClick:l,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",right:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(V,{onClick:l,style:{color:"white"}})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",gap:"10px",overflowX:"hidden",marginTop:"10px"},children:S.map((A,s)=>e.jsx(O,{src:A,onClick:()=>q(s),style:{width:"80px",height:"80px",objectFit:"cover",cursor:"pointer",borderRadius:"10px"},preview:!1},s))})]})}),e.jsx(R,{span:8})]})]})})}function ne(i){const t={},[p,b]=a.useState([]);a.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]),i.recordData?.detail_skus.forEach(n=>{const r=n.category,c=1;t[r]=(t[r]||0)+c});const C=(n,r,c)=>{b(j=>{let f=p.filter(o=>o.report_sku_id==c.name);if(f!=null&&f.length>0){let o=p.findIndex(I=>I.report_sku_id==c.name);p[o].sum_product_human=r}else p.push({report_sku_id:c.name,sum_product_human:r,scoring_human:c.scoring_human});return i.onChangeValReportSKU(p),p})},S=i.recordData?.category_names.map((n,r)=>{const c=Object.keys(n)[0];return{key:r.toString(),stt:(r+1).toString(),categoryName:Object.values(n)[0],number_product:t[c]||0}});a.useState(null);const N=[{title:"STT",dataIndex:"stt"},{title:"Tên sản phẩm",dataIndex:"name_product"},{title:"Số lượng sản phẩm AI đếm",dataIndex:"sum_product"},{title:"Số lượng sản phẩm giám sát đếm",dataIndex:"sum_product_human",render:(n,r,c)=>e.jsx(v,{style:{width:"120px"},defaultValue:n,onChange:j=>{const f=parseInt(j.target.value);isNaN(f)?U.warning("Nhập số lượng"):C(c,f,r)}})},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:n=>e.jsxs(e.Fragment,{children:[n===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(Ae,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),n===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(te,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],g=[{title:"STT",dataIndex:"stt"},{title:"Danh mục sản phẩm",dataIndex:"categoryName"},{title:"Số lượng sản phẩm",dataIndex:"number_product"}],[x,h]=a.useState([]);return a.useEffect(()=>{if(i.recordData){const n=i.recordData.category_names.map((r,c)=>{const j=Object.keys(r)[0];return i.recordData.detail_skus.filter(o=>o.category===j).map((o,I)=>({key:`${c}-${I}`,stt:`${(I+1).toString().padStart(2,"0")}`,name_product:o.product_name,sum_product:o.sum_product.toString(),image:o.images,creation:o.creation,scoring_machine:o.scoring_machine,scoring_human:o.scoring_human,sum_product_human:o.sum_product_human,name:o.name,index_category:c}))});h(n)}},[i.recordData]),e.jsx(e.Fragment,{children:e.jsx(W,{columns:g,expandable:{expandedRowRender:(n,r)=>e.jsx("div",{style:{margin:5},children:e.jsx(J,{columns:N,dataSource:x[r],pagination:!1})}),rowExpandable:n=>x[n.key]&&x[n.key].length>0},dataSource:S})})}function se(){const[i,t]=a.useState(null),[p,b]=a.useState(0),[C,S]=a.useState([]),[N,g]=a.useState(!1),[x,h]=a.useState(!1),[n,r]=a.useState(!1),[c,j]=a.useState(!1),f=Y(),o=l=>{},[I]=G.useForm(),F=l=>{b(l)},k=l=>{S(l)},K=[{key:"1",label:e.jsx("span",{style:{fontWeight:700},children:"Thông tin chung"}),children:e.jsx(ae,{form:I,recordData:i,onChangeScoringHuman:F})},{key:"2",label:e.jsx("span",{style:{fontWeight:700},children:"Sản phẩm"}),children:e.jsx(ne,{recordData:i,onChangeValReportSKU:k})}];a.useEffect(()=>{let l=localStorage.getItem("recordData");if(l){let d=JSON.parse(l);t(d),b(d.scoring_human);let u=[];for(let A=0;A<d.detail_skus.length;A++){let s={report_sku_id:d.detail_skus[A].name,sum_product_human:d.detail_skus[A].sum_product_human,scoring_human:d.detail_skus[A].scoring_human};u.push(s)}S(u)}},[x]),a.useEffect(()=>{let l=JSON.parse(localStorage.getItem("dataReports"));if(l){const d=l.findIndex(u=>u.name===i?.name);d===0?r(!0):d===l.length-1?j(!0):(r(!1),j(!1))}},[i]);const q=async()=>{g(!0);let l={name:i.name,scoring:p,arr_product:C};const u=await $.post("/api/method/mbw_audit.api.api.update_report",l);if(u!=null&&u.message=="ok"&&u.result!=null&&u.result.data=="success"){U.success("Cập nhật thành công"),g(!1);let A=JSON.parse(localStorage.getItem("dataReports")),s=JSON.parse(localStorage.getItem("recordData"));for(let m=0;m<s.detail_skus.length;m++)s.detail_skus[m].sum_product_human=C[m].sum_product_human,s.detail_skus[m].scoring_human=C[m].scoring_human;const _=A.findIndex(m=>m.name===s.name);if(_!==null&&_<A.length-1){const m=A[_+1];localStorage.setItem("recordData",JSON.stringify(m)),h(P=>!P)}else return}else U.error("Cập nhật thất bại"),g(!1)},w=()=>{let l=JSON.parse(localStorage.getItem("dataReports"));const d=l.findIndex(u=>u.name===i.name);if(d>0){const u=l[d-1];localStorage.setItem("recordData",JSON.stringify(u)),h(A=>!A)}},z=()=>i?`${i.customer_name} - ${i.campaign_name}`:"Tiêu đề",E=()=>{f("/reports"),localStorage.removeItem("recordData"),localStorage.removeItem("dataReports")};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:z(),icon:e.jsx("p",{onClick:()=>E(),className:"mr-2 cursor-pointer",children:e.jsx(B,{})}),buttons:[{label:"trước",type:"default",size:"20px",className:"flex items-center mr-2",icon:e.jsx(M,{}),action:w,disabled:n},{label:"Lưu lại và Tiếp",type:"primary",size:"20px",className:"flex items-center",loading:N,action:q,disabled:c}]}),e.jsx("div",{className:"bg-white  rounded-xl",children:e.jsx(G,{layout:"vertical",form:I,children:e.jsx(D,{items:K,defaultActiveKey:["1","2"],onChange:o,className:"custom-collapse"})})})]})}function ce(){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsx("title",{children:"BÁO CÁO"})}),e.jsx(se,{})]})}export{ce as default};
