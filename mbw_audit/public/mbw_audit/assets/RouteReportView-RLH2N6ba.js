import{r as o,j as e,aH as N,C as g,h as S,$ as C,S as O,aL as A,aN as H,T as z,a4 as q,u as P,F as K,H as V,aI as E,A as L,s as T,d as $}from"./main-X-WkoCKM.js";import{I as w,C as J,a as W}from"./CloseCircleOutlined-Z_F-m7Ql.js";function Y({form:l,recordData:t,onChangeScoringHuman:u}){const[x,I]=o.useState([]),[j,v]=o.useState([]),[d,f]=o.useState(0),[n,s]=o.useState(0),[r,y]=o.useState(0),[i,p]=o.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]);o.useEffect(()=>{if(t){l.setFieldsValue({store:t.customer_name,campaign_name:t.campaign_name,employee_code:t.employee_name,quatity:t.quantity_cate,time_report:t.images_time,scoring_machine:t.scoring_machine==1?"Đạt":t.scoring_machine==0?"Không đạt":"",scoring_human:t.scoring_human}),y(t.scoring_human);let a=[];t.images!=null&&t.images!=""&&(a=JSON.parse(t.images));let b=[];t.images_ai!=null&&t.images_ai!=""&&(b=JSON.parse(t.images_ai)),I(a),v(b)}},[t]);const k=a=>{f(a)},c=a=>{s(a)},m=()=>{d>0&&f(d-1)},h=()=>{d<x.length-1&&f(d+1)},_=()=>{n>0&&s(n-1)},R=()=>{n<j.length-1&&s(n+1)},F=a=>{y(a),u(a)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 pt-6 pb-[40px]",children:[e.jsxs(N,{children:[e.jsx(g,{span:8,children:e.jsx(S,{label:"Khách hàng",name:"store",className:"pt-3",required:!0,children:e.jsx(C,{readOnly:!0})})}),e.jsx(g,{span:8,children:e.jsx(S,{label:"Chiến dịch",name:"campaign_name",className:"pt-3",required:!0,children:e.jsx(C,{readOnly:!0})})}),e.jsx(g,{span:8,children:e.jsx(S,{label:"Nhân viên thực hiện",name:"employee_code",className:"pt-3",required:!0,children:e.jsx(C,{readOnly:!0})})})]}),e.jsxs(N,{children:[e.jsx(g,{span:8,children:e.jsx(S,{label:"Thời gian thực hiện",name:"time_report",className:"pt-3",required:!0,children:e.jsx(C,{readOnly:!0})})}),e.jsx(g,{span:8,children:e.jsx(S,{label:"Điểm trưng bày AI chấm",name:"scoring_machine",className:"pt-3",required:!0,children:e.jsx(C,{readOnly:!0,style:{color:t&&t.scoring_machine===1?"green":t&&t.scoring_machine===0?"red":"black"}})})}),e.jsx(g,{span:8,children:e.jsx(S,{label:"Giám sát chấm",name:"scoring_human",className:"pt-3",required:!0,children:e.jsx(O,{className:"w-[200px] h-[36px]",value:r,onChange:a=>F(a),defaultValue:r,children:i.map(a=>e.jsx(O.Option,{value:a.value,children:a.label},a.value))})})})]}),e.jsxs(N,{children:[e.jsx(g,{span:8,children:e.jsxs(S,{label:"Hình ảnh cửa hàng",className:"pt-3",required:!0,children:[e.jsxs("div",{style:{position:"relative",width:"100%",height:"auto",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(w,{src:x[d],style:{maxWidth:"100%",maxHeight:"100%",objectFit:"cover",alignSelf:"center",borderRadius:"10px"}}),e.jsx("div",{onClick:m,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",left:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(A,{onClick:m,style:{color:"white"}})}),e.jsx("div",{onClick:h,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",right:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(H,{onClick:h,style:{color:"white"}})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",gap:"10px",overflowX:"hidden",marginTop:"10px"},children:x.map((a,b)=>e.jsx(w,{src:a,onClick:()=>k(b),style:{width:"80px",height:"80px",objectFit:"cover",cursor:"pointer",borderRadius:"10px"},preview:!1},b))})]})}),e.jsx(g,{span:8,children:e.jsxs(S,{label:"Hình ảnh AI trả về",className:"pt-3",required:!0,children:[e.jsxs("div",{style:{position:"relative",width:"100%",height:"auto",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(w,{src:j[n],style:{maxWidth:"100%",maxHeight:"100%",objectFit:"cover",alignSelf:"center",borderRadius:"10px"}}),e.jsx("div",{onClick:_,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",left:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(A,{onClick:_,style:{color:"white"}})}),e.jsx("div",{onClick:R,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",right:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(H,{onClick:R,style:{color:"white"}})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",gap:"10px",overflowX:"hidden",marginTop:"10px"},children:j.map((a,b)=>e.jsx(w,{src:a,onClick:()=>c(b),style:{width:"80px",height:"80px",objectFit:"cover",cursor:"pointer",borderRadius:"10px"},preview:!1},b))})]})}),e.jsx(g,{span:8})]})]})})}function M(l){const t={},[u,x]=o.useState([]);o.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]),l.recordData?.detail_skus.forEach(n=>{const s=n.category,r=1;t[s]=(t[s]||0)+r});const I=(n,s,r)=>{x(y=>{let i=u.filter(p=>p.report_sku_id==r.name);if(i!=null&&i.length>0){let p=u.findIndex(k=>k.report_sku_id==r.name);u[p].sum_product_human=s}else u.push({report_sku_id:r.name,sum_product_human:s,scoring_human:r.scoring_human});return l.onChangeValReportSKU(u),u})},j=l.recordData?.category_names.map((n,s)=>{const r=Object.keys(n)[0];return{key:s.toString(),stt:(s+1).toString(),categoryName:Object.values(n)[0],number_product:t[r]||0}}),v=[{title:"STT",dataIndex:"stt"},{title:"Tên sản phẩm",dataIndex:"name_product"},{title:"Số lượng sản phẩm AI đếm",dataIndex:"sum_product"},{title:"Số lượng sản phẩm giám sát đếm",dataIndex:"sum_product_human",render:(n,s,r)=>e.jsx(C,{style:{width:"120px"},defaultValue:n,onChange:y=>I(r,parseInt(y.target.value),s)})},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:n=>e.jsxs(e.Fragment,{children:[n===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(J,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),n===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(W,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],d=[{title:"STT",dataIndex:"stt"},{title:"Danh mục sản phẩm",dataIndex:"categoryName"},{title:"Số lượng sản phẩm",dataIndex:"number_product"}],f=l.recordData?.category_names.map((n,s)=>{const r=Object.keys(n)[0];return(l.recordData?.detail_skus.filter(i=>i.category===r)).map((i,p)=>({key:`${s}-${p}`,stt:`${(p+1).toString().padStart(2,"0")}`,name_product:i.product_name,sum_product:i.sum_product.toString(),image:i.images,creation:i.creation,scoring_machine:i.scoring_machine,scoring_human:i.scoring_human,sum_product_human:i.sum_product_human,name:i.name,index_category:s}))});return e.jsx(e.Fragment,{children:e.jsx(z,{columns:d,expandable:{expandedRowRender:(n,s)=>e.jsx("div",{style:{margin:5},children:e.jsx(q,{columns:v,dataSource:f[s],pagination:!1})}),rowExpandable:n=>f[n.key].length>0},dataSource:j})})}function B(){const[l,t]=o.useState(null),[u,x]=o.useState(0),[I,j]=o.useState([]),[v,d]=o.useState(!1),f=P(),n=c=>{},[s]=K.useForm(),r=c=>{x(c)},y=c=>{j(c)},i=[{key:"1",label:e.jsx("span",{style:{fontWeight:700},children:"Thông tin chung"}),children:e.jsx(Y,{form:s,recordData:l,onChangeScoringHuman:r})},{key:"2",label:e.jsx("span",{style:{fontWeight:700},children:"Sản phẩm"}),children:e.jsx(M,{recordData:l,onChangeValReportSKU:y})}];o.useEffect(()=>{let c=localStorage.getItem("recordData");if(console.log(JSON.parse(c)),c){let m=JSON.parse(c);t(m),x(m.scoring_human);let h=[];for(let _=0;_<m.detail_skus.length;_++){let R={report_sku_id:m.detail_skus[_].name,sum_product_human:m.detail_skus[_].sum_product_human,scoring_human:m.detail_skus[_].scoring_human};h.push(R)}j(h)}localStorage.removeItem("recordData")},[]);const p=async()=>{d(!0);let c={name:l.name,scoring:u,arr_product:I};const h=await L.post("/api/method/mbw_audit.api.api.update_report",c);h!=null&&h.message=="ok"&&h.result!=null&&h.result.data=="success"?(T.success("Cập nhật thành công"),d(!1)):(T.error("Cập nhật thất bại"),d(!1))},k=()=>l?`${l.customer_name} - ${l.campaign_name}`:"Tiêu đề";return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:k(),icon:e.jsx("p",{onClick:()=>f("/reports"),className:"mr-2 cursor-pointer",children:e.jsx(A,{})}),buttons:[{label:"Lưu lại",type:"primary",size:"20px",className:"flex items-center",loading:v,action:p}]}),e.jsx("div",{className:"bg-white  rounded-xl",children:e.jsx(K,{layout:"vertical",form:s,children:e.jsx(E,{items:i,defaultActiveKey:["1","2"],onChange:n,className:"custom-collapse"})})})]})}function Q(){return e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsx("title",{children:"BÁO CÁO"})}),e.jsx(B,{})]})}export{Q as default};
