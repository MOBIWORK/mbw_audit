import{r as x,e as J,_ as P,f as I,u as W,A as $,j as t,H as G,S as E,F as Y,T as M,D as Q,d as Z}from"./main-eGw_LrLC.js";import{C as L,a as z}from"./CloseCircleOutlined-x_sNvcdo.js";var ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"};const te=ee;var ne=function(O,m){return x.createElement(J,P({},O,{ref:m,icon:te}))};const le=x.forwardRef(ne);var U={exports:{}};(function(f,O){(function(m,v){v()})(I,function(){function m(n,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}function v(n,l,d){var a=new XMLHttpRequest;a.open("GET",n),a.responseType="blob",a.onload=function(){w(a.response,l,d)},a.onerror=function(){console.error("could not download file")},a.send()}function g(n){var l=new XMLHttpRequest;l.open("HEAD",n,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function _(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(l)}}var c=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof I=="object"&&I.global===I?I:void 0,C=c.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),w=c.saveAs||(typeof window!="object"||window!==c?function(){}:"download"in HTMLAnchorElement.prototype&&!C?function(n,l,d){var a=c.URL||c.webkitURL,o=document.createElement("a");l=l||n.name||"download",o.download=l,o.rel="noopener",typeof n=="string"?(o.href=n,o.origin===location.origin?_(o):g(o.href)?v(n,l,d):_(o,o.target="_blank")):(o.href=a.createObjectURL(n),setTimeout(function(){a.revokeObjectURL(o.href)},4e4),setTimeout(function(){_(o)},0))}:"msSaveOrOpenBlob"in navigator?function(n,l,d){if(l=l||n.name||"download",typeof n!="string")navigator.msSaveOrOpenBlob(m(n,d),l);else if(g(n))v(n,l,d);else{var a=document.createElement("a");a.href=n,a.target="_blank",setTimeout(function(){_(a)})}}:function(n,l,d,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof n=="string")return v(n,l,d);var o=n.type==="application/octet-stream",k=/constructor/i.test(c.HTMLElement)||c.safari,B=/CriOS\/[\d]+/.test(navigator.userAgent);if((B||o&&k||C)&&typeof FileReader<"u"){var A=new FileReader;A.onloadend=function(){var j=A.result;j=B?j:j.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=j:location=j,a=null},A.readAsDataURL(n)}else{var R=c.URL||c.webkitURL,b=R.createObjectURL(n);a?a.location=b:location.href=b,a=null,setTimeout(function(){R.revokeObjectURL(b)},4e4)}});c.saveAs=w.saveAs=w,f.exports=w})})(U);var ae=U.exports;const{RangePicker:ie}=Q;function se(){const[f,O]=x.useState("all"),[m,v]=x.useState([]),[g,_]=x.useState("all"),c=W(),[C,w]=x.useState([]),[n,l]=x.useState([]),[d,a]=x.useState([]),o=e=>{localStorage.setItem("recordData",JSON.stringify(e)),c("/report-view")};x.useEffect(()=>{b(),j(),R()},[]);const k=e=>{console.log(e)},B=[{title:"STT",dataIndex:"stt"},{title:"Khách hàng",dataIndex:"customer_name"},{title:"Tên chiến dịch",dataIndex:"campaign_name"},{title:"Nhân viên thực hiện",dataIndex:"employee_name"},{title:"Số lượng danh mục",dataIndex:"quantity_cate"},{title:"Ảnh gian hàng",dataIndex:"images",render:e=>t.jsx(t.Fragment,{children:t.jsx("a",{onClick:()=>k(e),children:"Xem hình ảnh"})})},{title:"Ảnh gian hàng AI",dataIndex:"images",render:e=>t.jsx(t.Fragment,{children:t.jsx("a",{onClick:()=>k(e),children:"Xem hình ảnh"})})},{title:"Thời gian thực hiện",dataIndex:"images_time"},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:e=>t.jsxs(t.Fragment,{children:[e===1&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(L,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),e===0&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(z,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})},{title:"Điểm trưng bày giám sát chấm",dataIndex:"scoring_human",render:e=>t.jsxs(t.Fragment,{children:[e===1&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(L,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),e===0&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(z,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],A=[{title:"Tên sản phẩm",dataIndex:"product_name"},{title:"Số lượng sản phẩm AI đếm",dataIndex:"sum_product"},{title:"Số lượng sản phẩm giám sát đếm",dataIndex:"sum_product_human"},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:e=>t.jsxs(t.Fragment,{children:[e===1&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(L,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),e===0&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(z,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],R=async()=>{let e="/api/method/mbw_audit.api.api.get_reports_by_filter";if(f!=null&&f!=""&&f!="all"&&(e=`${e}?campaign_code=${f}`),m!=null&&m.length==2){let y=new Date(m[0]).getTime()/1e3,p=new Date(m[1]).getTime()/1e3;e.includes("?")?e=`${e}&start_date=${y}&end_date=${p}`:e=`${e}?start_date=${y}&end_date=${p}`}g!=null&&g!=""&&g!="all"&&(e.includes("?")?e=`${e}&employee_id=${g}`:e=`${e}?employee_id=${g}`);let i=await $.get(e);if(i!=null&&i.message=="ok"&&i.result!=null&&i.result.data!=null){let y=i.result.data.map((p,r)=>{let S=(r+1).toString().padStart(2,"0"),D=JSON.parse(p.categories).length.toString().padStart(2,"0");return{...p,key:p.name,stt:S,quantity_cate:D}});w(y),console.log(y)}else w([])},b=async()=>{try{const i=await $.get("/api/method/mbw_service_v2.api.ess.employee.get_list_employee");i&&i.result&&i.result.data&&l(i.result.data)}catch(e){console.error("Error fetching employee data:",e)}},j=async()=>{const i=await $.get("/api/method/mbw_audit.api.api.get_all_campaigns");i!=null&&i.message=="ok"&&i.result!=null?a(i.result.data):a([])};x.useEffect(()=>{R()},[f,m,g]);const V=()=>{X(C,"Báo cáo chấm điểm trưng bày")},X=async(e,i)=>{const y=require("exceljs"),p=new y.Workbook,r=p.addWorksheet("Sheet1");r.properties.defaultColWidth=20,r.getColumn("A").width=30,r.mergeCells("A2:J2"),r.getCell("A2").value=i,r.getCell("A2").style={font:{bold:!0,name:"Times New Roman",size:12}},r.getCell("A2").alignment={vertical:"middle",horizontal:"center"};let S=r.getRow(4),D=r.getRow(5),h=[{title:"Khách hàng",field:"customer_name"},{title:"Tên chiến dịch",field:"campaign_name"},{title:"Nhân viên thực hiện",field:"employee_name"},{title:"Số lượng danh mục",field:"categories"},{title:"Ảnh gian hàng",field:"images"},{title:"Ảnh gian hàng AI",field:"images_ai"},{title:"Thời gian thực hiện",field:"images_time"},{title:"Điểm trưng bày AI chấm",field:"scoring_machine"},{title:"Điểm trưng bày giám sát chấm",field:"scoring_human"}];for(let s=0;s<h.length;s++){let H=S.getCell(s+1),N=D.getCell(s+1);r.mergeCells(`${H._address}:${N._address}`),S.getCell(s+1).style={font:{bold:!0,name:"Times New Roman",size:12,italic:!0}},S.getCell(s+1).alignment={vertical:"middle",horizontal:"center"},S.getCell(s+1).value=h[s].title}for(let s=0;s<e.length;s++){let N=r.getRow(s+6),F=1;for(let u=0;u<h.length;u++){N.getCell(F).style={font:{name:"Times New Roman",size:12,italic:!0}};let T="";h[u].field=="categories"?e[s][h[u].field]!=null&&e[s][h[u].field]!=""&&(T=JSON.parse(e[s][h[u].field]).length):h[u].field=="scoring_machine"||h[u].field=="scoring_human"?e[s][h[u].field]==0?T="Không đạt":T="Đạt":T=e[s][h[u].field],N.getCell(F).value=T,F+=1}}const q=await p.xlsx.writeBuffer();K(q,"report")},K=(e,i)=>{let y="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",p=".xlsx";const r=new Blob([e],{type:y});ae.saveAs(r,i+"_export_"+new Date().getTime()+p)};return t.jsxs(t.Fragment,{children:[t.jsx(G,{title:"Báo cáo",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:t.jsx(le,{className:"text-xl"}),size:"20px",className:"flex items-center",action:V}]}),t.jsxs("div",{className:"bg-white rounded-xl",children:[t.jsxs("div",{className:"flex p-4",style:{alignItems:"flex-end"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:"15px"},children:[t.jsx("label",{style:{paddingBottom:"5px"},children:"Chiến dịch:"}),t.jsxs(E,{className:"w-[200px] h-[36px]",value:f,onChange:e=>O(e),defaultValue:"all",children:[t.jsx(E.Option,{value:"all",children:"Tất cả"}),d.map(e=>t.jsx(E.Option,{value:e.name,children:e.campaign_name},e.name))]})]}),t.jsx(Y,{className:"w-[250px] border-none mr-4",label:"Thời gian thực hiện",children:t.jsx(ie,{value:m,onChange:e=>v(e)})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx("label",{style:{paddingBottom:"5px"},children:"Nhân viên:"}),t.jsxs(E,{className:"w-[200px] h-[36px]",value:g,onChange:e=>_(e),defaultValue:"all",children:[t.jsx(E.Option,{value:"all",children:"Tất cả"}),n.map(e=>t.jsx(E.Option,{value:e.name,children:e.employee_name},e.name))]})]})]}),t.jsx("div",{children:t.jsx(M,{columns:B,dataSource:C,onRow:(e,i)=>({onClick:()=>o(e)}),rowHoverBg:"#f0f0f0",expandable:{expandedRowRender:(e,i)=>t.jsx("div",{style:{margin:5},children:t.jsx(M,{columns:A,dataSource:e.detail_skus,pagination:!1})})}})})]})]})}function de(){return t.jsxs(t.Fragment,{children:[t.jsx(Z,{children:t.jsx("title",{children:"BÁO CÁO"})}),t.jsx(se,{})]})}export{de as default};
