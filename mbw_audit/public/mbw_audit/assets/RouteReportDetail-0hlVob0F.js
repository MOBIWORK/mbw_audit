import{r as n,A as H,_ as V,u as z,a as v,j as e,H as P,F as w,I as K,S as q,b as y,T as J,D as L,c as M}from"./main-Ii39zDC_.js";import{p as U,u,w as $}from"./path-SBoGkxsR.js";import{C as X,a as G}from"./CloseCircleOutlined-jxqclpYY.js";var Q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"};const W=Q;var Y=function(x,l){return n.createElement(H,V({},x,{ref:l,icon:W}))};const Z=n.forwardRef(Y),{RangePicker:ee}=L,_=[{title:"STT",dataIndex:"stt"},{title:"Khách hàng",dataIndex:"retail_code"},{title:"Tên chiến dịch",dataIndex:"campaign_name"},{title:"Nhân viên thực hiện",dataIndex:"employee_name"},{title:"Số lượng danh mục sản phẩm",dataIndex:"quantity_cate"},{title:"Thời gian thực hiện",dataIndex:"images_time"},{title:"Chấm điểm trưng bày",dataIndex:"scoring_machine",render:i=>e.jsxs(e.Fragment,{children:[i===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(X,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),i===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(G,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],te=U.apiUrl;function ae(){const[i,x]=n.useState(""),[l,D]=n.useState(null),[m,b]=n.useState("all"),[g,S]=n.useState([]),C=z(),[j,E]=n.useState([]),[O,I]=n.useState([]);n.useState([]),n.useState("checkbox");const R=t=>{localStorage.setItem("recordData",JSON.stringify(t)),C("/report-view")};n.useEffect(()=>{N()},[]);const N=async()=>{let t=await T();try{let a=te+".api.get_list_reports";const s=await v.get(a);if(s&&s.message&&s.message.data){let r=s.message.data.map((o,d)=>{let c=(d+1).toString().padStart(2,"0"),p=JSON.parse(o.categories).length.toString().padStart(2,"0");return{...o,key:o.name,stt:c,quantity_cate:p,employee_name:k(t,o.employee_code)}});E(r),S(r)}}catch(a){console.error("Error fetching report data:",a)}},T=async()=>{try{const a=await v.get("/api/method/mbw_service_v2.api.ess.employee.get_list_employee");if(a&&a.result&&a.result.data)return I(a.result.data),a.result.data}catch(t){console.error("Error fetching employee data:",t)}},k=(t,a)=>{const s=t.find(r=>r.name===a);return s?s.employee_name:""};n.useEffect(()=>{const t=j.filter(a=>{const s=a.campaign_name.toLowerCase().includes(i.toLowerCase()),r=l&&l[0]?new Date(l[0]):null,o=l&&l[1]?new Date(l[1]):null,d=r&&o?new Date(a.images_time)>=new Date(r.setHours(0,0,0,0))&&new Date(a.images_time)<=new Date(o.setHours(23,59,59,999)):!0,c=m==="all"||a.employee_code===m;return s&&c&&d});S(t)},[i,l,m,j]);const A=t=>t.map(a=>({...a,scoring_machine:a.scoring_machine===1?"Đạt":"Không đạt"})),B=(t,a,s)=>{const r={font:{bold:!0}},d=A(g).map(h=>t.map(f=>h[f.dataIndex])),c=u.aoa_to_sheet([t.map(h=>h.title),...d]);c["!cols"]=t.map(()=>({width:20})),c["!rows"]=[{hpx:30}],t.forEach((h,f)=>{const F=u.encode_cell({r:0,c:f});c[F].s=r});const p=u.book_new();u.book_append_sheet(p,c,"Sheet1"),$(p,s+".xlsx")};return e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Báo cáo",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(Z,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>B(_,g,"Danh sách báo cáo")}]}),e.jsxs("div",{className:"bg-white rounded-xl",children:[e.jsxs("div",{className:"flex p-4",style:{alignItems:"flex-end"},children:[e.jsx(w,{className:"w-[320px] border-none mr-4 ",children:e.jsx(K,{placeholder:"Tìm kiếm theo chiến dịch",value:i,onChange:t=>x(t.target.value),prefix:e.jsx(q,{})})}),e.jsx(w,{className:"w-[250px] border-none mr-4",label:"Thời gian thực hiện",children:e.jsx(ee,{value:l,onChange:t=>D(t)})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{style:{paddingBottom:"5px"},children:"Nhân viên:"}),e.jsxs(y,{className:"w-[200px] h-[36px]",value:m,onChange:t=>b(t),defaultValue:"all",children:[e.jsx(y.Option,{value:"all",children:"Tất cả"}),O.map(t=>e.jsx(y.Option,{value:t.name,children:t.employee_name},t.name))]})]})]}),e.jsx("div",{children:e.jsx(J,{columns:_,dataSource:g,onRow:(t,a)=>({onClick:()=>R(t)}),rowHoverBg:"#f0f0f0"})})]})]})}function re(){return e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsx("title",{children:"BÁO CÁO"})}),e.jsx(ae,{})]})}export{re as default};
