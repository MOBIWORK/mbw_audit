import{u as de,r as s,A as g,j as e,H as he,Z as M,h as pe,$ as ge,a0 as ue,T as xe,a2 as C,a3 as F,a1 as fe,a5 as X,a6 as H,a7 as Ce,s as o,d as je}from"./main-X-WkoCKM.js";import{a as ye,V as De,D as _e,E as ke,r as Se,u as be,p as Ie}from"./xlsx-cPNcJ-Cd.js";import"./progress-D7WVgCZt.js";const j=Ie.apiUrl;function Oe(){const y=de(),[B,Te]=s.useState("checkbox"),Y=[{title:"Tên chiến dịch",dataIndex:"campaign_name",render:(a,t)=>e.jsx("a",{href:"javascript:;",onClick:()=>I(t),children:t.campaign_name})},{title:"Trạng thái",dataIndex:"campaign_status",render:(a,t)=>e.jsxs(e.Fragment,{children:[t.campaign_status==="Open"&&e.jsxs(X,{color:"green",children:[e.jsx("div",{className:"dot-tag-green"})," Hoạt động"]}),t.campaign_status==="Close"&&e.jsxs(X,{color:"red",children:[e.jsx("div",{className:"dot-tag-red"})," Không hoạt động"]})]})},{title:"Thời gian bắt đầu",dataIndex:"start_date",render:a=>H(a).format("DD/MM/YYYY")},{title:"Thời gian kết thúc",dataIndex:"end_date",render:a=>H(a).format("DD/MM/YYYY")},{title:"Hành động",key:"action",render:(a,t)=>e.jsxs(Ce,{size:"middle",children:[e.jsx("a",{children:e.jsx(ke,{onClick:()=>I(t)})}),e.jsx("a",{children:e.jsx(M,{onClick:()=>q(t)})})]})}],P={onChange:(a,t)=>{S(t),t.length>0?x(!0):x(!1)}},[A,p]=s.useState([]),W={onRemove:()=>{p([])},action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",multiple:!1,beforeUpload:async a=>{try{const t=a.name.toLowerCase();if(t.endsWith(".xls")||t.endsWith(".xlsx")||t.endsWith(".xlsm")||t.endsWith(".xlsb")||t.endsWith(".csv")||t.endsWith(".ods")){let r=[{uid:"-1",name:a.name,status:"done",url:""}];p(r);const n=new FileReader;n.onload=c=>{const se=c.target.result,L=Se(se,{type:"buffer"}),ne=L.SheetNames[0],ie=L.Sheets[ne],i=be.sheet_to_json(ie,{header:1});let v=[];if(i.length>=2)for(let l=1;l<i.length;l++){const E=new Date(1899,11,31),le=(i[l][2]-1)*24*60*60*1e3;let ce=new Date(E.getTime()+le);const re=(i[l][2]-1)*24*60*60*1e3;let oe=new Date(E.getTime()+re),me={campaign_name:i[l][0],campaign_description:i[l][1],campaign_start:(ce.getTime()/1e3).toString(),campaign_end:(oe.getTime()/1e3).toString(),campaign_status:i[l][4]!=""?i[l][4]:"Open",campaign_categories:i[l][5],campaign_employees:i[l][6],campaign_customers:i[l][7]};v.push(me)}R(v)},n.readAsArrayBuffer(a)}else return o.error("Đã xảy ra lỗi, không đúng định dạng file: xls, xlsx, xlsm, xlsb, csv, ods"),!1}catch{o.error("File không chính xác, tải dữ liệu mẫu để tiếp tục")}return!1}},[K,D]=s.useState([]),[d,U]=s.useState(""),[u,_]=s.useState({}),[V,k]=s.useState(!1),[m,S]=s.useState([]),[$,x]=s.useState(!1),[z,b]=s.useState(!1),[G,f]=s.useState(!1),[J,R]=s.useState([]);s.useState([]),s.useEffect(()=>{h()},[]),s.useEffect(()=>{h()},[d]);const h=async()=>{let a='/api/resource/VGM_Campaign?fields=["*"]';d!=null&&d!=""&&(a+=`&filters=[["campaign_name","like","%${d}%"]]`);let t=await g.get(a);if(t&&t.data){let r=t.data.map(n=>({...n,key:n.name}));D(r)}else D([])},Z=a=>{U(a.target.value)},I=a=>{y(`/campaign-edit/${a.name}`)},q=a=>{_(a),k(!0)},Q=async()=>{let a=j+".api.deleteListByDoctype",t=[u.name];for(let c=0;c<m.length;c++)t.push(m[c].name);let r={doctype:"VGM_Campaign",items:JSON.stringify(t)},n=await g.post(a,r);n!=null&&n.message!=null&&n.message.status=="success"?(o.success("Xóa thành công"),h(),_({}),O()):o.error("Xóa thất bại, Chiến dịch đã tồn tại ở báo cáo")},O=()=>{k(!1)},ee=()=>{b(!0)},te=async()=>{let a=j+".api.deleteListByDoctype",t=[];for(let c=0;c<m.length;c++)t.push(m[c].name);let r={doctype:"VGM_Campaign",items:JSON.stringify(t)},n=await g.post(a,r);n!=null&&n.message!=null&&n.message.status=="success"?(o.success("Xóa thành công"),S([]),x(!1),h(),T()):o.error("Xóa thất bại")},T=()=>{b(!1)},ae=()=>{f(!0),p([])},w=async()=>{let a=j+".api.import_campaign",t={listcampaign:JSON.stringify(J)};(await g.post(a,t)).message.status=="success"?(o.success("Thên chiến dịch thành công"),f(!1),h()):o.error("Thêm chiến dịch thất bại")},N=()=>{f(!1),p([])};return e.jsxs(e.Fragment,{children:[e.jsx(he,{title:"Chiến dịch",buttons:[$&&{label:"Xóa",type:"primary",icon:e.jsx(M,{}),size:"20px",className:"flex items-center mr-2",danger:!0,action:ee},{label:"Nhập file",icon:e.jsx(ye,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2",action:ae},{label:"Thêm mới",type:"primary",icon:e.jsx(De,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>y("/campaign-create")}]}),e.jsxs("div",{className:"bg-white rounded-xl pt-4 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsx(pe,{className:"w-[320px] border-none p-4",children:e.jsx(ge,{value:d,onChange:Z,placeholder:"Tìm kiếm chiến dịch",prefix:e.jsx(ue,{})})}),e.jsx("div",{children:e.jsx(xe,{rowSelection:{type:B,...P},columns:Y,dataSource:K})})]}),e.jsxs(C,{title:`Xóa ${u.campaign_name}?`,open:V,onOk:Q,onCancel:O,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",u.campaign_name," ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(C,{title:`Xóa ${m.length} chiến dịch?`,open:z,onOk:te,onCancel:T,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",m.length," chiến dịch ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(C,{title:"Nhập dữ liệu từ tệp excel",open:G,width:777,onOk:w,onCancel:N,footer:[e.jsx(F,{onClick:N,children:"Hủy"},"back"),e.jsx(F,{type:"primary",onClick:w,children:"Lưu lại"},"submit")],children:[e.jsxs("p",{className:"text-[#637381] font-normal text-sm",children:["Chọn file excel có định dạng .xlsx để thực hiện nhập dữ liệu. Tải dữ liệu mẫu ",e.jsx("a",{target:"_blank",href:"/mbw_audit/data_sample/campaign_sample.xlsx",children:"tại đây"})]}),e.jsxs(_e,{...W,fileList:A,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(fe,{})}),e.jsx("p",{className:"ant-upload-text",children:"Kéo, thả hoặc chọn tệp để tải lên"})]})]})]})}function ve(){return e.jsxs(e.Fragment,{children:[e.jsx(je,{children:e.jsx("title",{children:" Campaign"})}),e.jsx(Oe,{})]})}export{ve as default};
