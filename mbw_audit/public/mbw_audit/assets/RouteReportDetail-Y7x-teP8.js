import{r as d,e as ue,_ as ge,f as k,j as e,g as xe,u as fe,A as K,H as ye,S as u,h as ve,T as M,D as _e,d as je}from"./main-X-WkoCKM.js";import{C as B,a as N,I as Y}from"./CloseCircleOutlined-Z_F-m7Ql.js";var we={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"};const Se=we;var Ce=function(A,g){return d.createElement(ue,ge({},A,{ref:g,icon:Se}))};const Ie=d.forwardRef(Ce);var Q={exports:{}};(function(j,A){(function(g,S){S()})(k,function(){function g(l,i){return typeof i>"u"?i={autoBom:!1}:typeof i!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function S(l,i,f){var s=new XMLHttpRequest;s.open("GET",l),s.responseType="blob",s.onload=function(){x(s.response,i,f)},s.onerror=function(){console.error("could not download file")},s.send()}function y(l){var i=new XMLHttpRequest;i.open("HEAD",l,!1);try{i.send()}catch{}return 200<=i.status&&299>=i.status}function C(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(i)}}var m=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof k=="object"&&k.global===k?k:void 0,D=m.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),x=m.saveAs||(typeof window!="object"||window!==m?function(){}:"download"in HTMLAnchorElement.prototype&&!D?function(l,i,f){var s=m.URL||m.webkitURL,p=document.createElement("a");i=i||l.name||"download",p.download=i,p.rel="noopener",typeof l=="string"?(p.href=l,p.origin===location.origin?C(p):y(p.href)?S(l,i,f):C(p,p.target="_blank")):(p.href=s.createObjectURL(l),setTimeout(function(){s.revokeObjectURL(p.href)},4e4),setTimeout(function(){C(p)},0))}:"msSaveOrOpenBlob"in navigator?function(l,i,f){if(i=i||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(g(l,f),i);else if(y(l))S(l,i,f);else{var s=document.createElement("a");s.href=l,s.target="_blank",setTimeout(function(){C(s)})}}:function(l,i,f,s){if(s=s||open("","_blank"),s&&(s.document.title=s.document.body.innerText="downloading..."),typeof l=="string")return S(l,i,f);var p=l.type==="application/octet-stream",L=/constructor/i.test(m.HTMLElement)||m.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||p&&L||D)&&typeof FileReader<"u"){var R=new FileReader;R.onloadend=function(){var I=R.result;I=E?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=I:location=I,s=null},R.readAsDataURL(l)}else{var T=m.URL||m.webkitURL,O=T.createObjectURL(l);s?s.location=O:location.href=O,s=null,setTimeout(function(){T.revokeObjectURL(O)},4e4)}});m.saveAs=x.saveAs=x,j.exports=x})})(Q);var be=Q.exports;const{RangePicker:Ae}=_e;function Ee(){const[j,A]=d.useState("all"),[g,S]=d.useState([]),[y,C]=d.useState("all"),[m,D]=d.useState("all"),[x,l]=d.useState("all");d.useState(!1);const[i,f]=d.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]),[s,p]=d.useState(!1),[L,E]=d.useState([{title:"STT",dataIndex:"stt",fixed:"left",width:100},{title:"Khách hàng",dataIndex:"customer_name",fixed:"left"},{title:"Tên chiến dịch",dataIndex:"campaign_name",fixed:"left"},{title:"Nhân viên thực hiện",dataIndex:"employee_name"},{title:"Số lượng danh mục",dataIndex:"quantity_cate"},{title:"Số lượng sản phẩm AI đếm",children:[]},{title:"Số lượng sản phẩm giám sát đếm",children:[]},{title:"Ảnh gian hàng",dataIndex:"images",render:t=>e.jsx("a",{onClick:a=>{a.stopPropagation(),H(t)},children:"Xem hình ảnh"})},{title:"Ảnh gian hàng AI",dataIndex:"images",render:t=>e.jsx("a",{onClick:a=>{a.stopPropagation(),H(t)},children:"Xem hình ảnh"})},{title:"Thời gian thực hiện",dataIndex:"images_time"},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:t=>e.jsxs(e.Fragment,{children:[t===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(B,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),t===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(N,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})},{title:"Điểm trưng bày giám sát chấm",dataIndex:"scoring_human",render:t=>e.jsxs(e.Fragment,{children:[t===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(B,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),t===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(N,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}]),[R,T]=d.useState([]),{search:O}=xe();new URLSearchParams(O).get("campaign");const Z=fe(),[U,V]=d.useState([]),[ee,te]=d.useState([]),[ae,X]=d.useState([]),J=t=>{localStorage.setItem("recordData",JSON.stringify(t)),Z("/report-view")};d.useEffect(()=>{ie(),se(),q()},[]);const ne=[{title:"STT",dataIndex:"stt",fixed:"left"},{title:"Khách hàng",dataIndex:"customer_name",fixed:"left"},{title:"Tên chiến dịch",dataIndex:"campaign_name",fixed:"left"},{title:"Nhân viên thực hiện",dataIndex:"employee_name"},{title:"Số lượng danh mục",dataIndex:"quantity_cate"},{title:"Ảnh gian hàng",dataIndex:"images",render:t=>e.jsx("a",{onClick:a=>{a.stopPropagation(),H(t)},children:"Xem hình ảnh"})},{title:"Ảnh gian hàng AI",dataIndex:"images",render:t=>e.jsx("a",{onClick:a=>{a.stopPropagation(),H(t)},children:"Xem hình ảnh"})},{title:"Thời gian thực hiện",dataIndex:"images_time"},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:t=>e.jsxs(e.Fragment,{children:[t===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(B,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),t===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(N,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})},{title:"Điểm trưng bày giám sát chấm",dataIndex:"scoring_human",render:t=>e.jsxs(e.Fragment,{children:[t===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(B,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),t===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(N,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],le=[{title:"Tên sản phẩm",dataIndex:"product_name"},{title:"Số lượng sản phẩm AI đếm",dataIndex:"sum_product"},{title:"Số lượng sản phẩm giám sát đếm",dataIndex:"sum_product_human"},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:t=>e.jsxs(e.Fragment,{children:[t===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(B,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),t===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(N,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],q=async()=>{const t=JSON.parse(localStorage.getItem("campaign_dashboard"));t&&(A(t.campaign_code),p(!0),localStorage.removeItem("campaign_dashboard"));let a="/api/method/mbw_audit.api.api.get_reports_by_filter";if(j!=null&&j!=""&&j!="all"&&(a=`${a}?campaign_code=${j}`),g!=null&&g.length==2){let o=new Date(g[0]).getTime()/1e3,r=new Date(g[1]).getTime()/1e3;a.includes("?")?a=`${a}&start_date=${o}&end_date=${r}`:a=`${a}?start_date=${o}&end_date=${r}`}y!=null&&y!=""&&y!="all"&&(a.includes("?")?a=`${a}&employee_id=${y}`:a=`${a}?employee_id=${y}`),m!=null&&m!="all"&&(a.includes("?")?a=`${a}&status_scoring_ai=${m}`:a=`${a}?status_scoring_ai=${m}`,console.log(a)),x!=null&&x!="all"&&(a.includes("?")?a=`${a}&status_scoring_human=${x}`:a=`${a}?status_scoring_human=${x}`);let w=await K.get(a);if(w!=null&&w.message=="ok"&&w.result!=null&&w.result.data!=null){let o=w.result.data.map((r,v)=>{let b=(v+1).toString().padStart(2,"0"),n=JSON.parse(r.categories).length.toString().padStart(2,"0");return{...r,key:r.name,stt:b,quantity_cate:n}});if(!s)V(o);else{let r=!1,v=[],b=[];for(let n=0;n<o.length;n++){for(let h=0;h<o[n].info_products_ai.length;h++){if(!r){let c={title:o[n].info_products_ai[h].product_name,dataIndex:`${o[n].info_products_ai[h].product_name}_ai`,key:`${o[n].info_products_ai[h].product_name}_ai`,width:100},z={title:o[n].info_products_ai[h].product_name,dataIndex:`${o[n].info_products_ai[h].product_name}_human`,key:`${o[n].info_products_ai[h].product_name}_human`,width:100};v.push(c),b.push(z)}o[n][`${o[n].info_products_ai[h].product_name}_ai`]=o[n].info_products_ai[h].sum,o[n][`${o[n].info_products_human[h].product_name}_human`]=o[n].info_products_human[h].sum}v.length>0&&(r=!0)}E(n=>(n[5].children=v,n[6].children=b,n)),T(o)}}else s?(E(o=>(o[5].children=[],o[6].children=[],o)),T([])):V([])},ie=async()=>{try{const a=await K.get("/api/method/mbw_service_v2.api.ess.employee.get_list_employee");a&&a.result&&a.result.data&&te(a.result.data)}catch(t){console.error("Error fetching employee data:",t)}},se=async()=>{const a=await K.get("/api/method/mbw_audit.api.api.get_all_campaigns");a!=null&&a.message=="ok"&&a.result!=null?X(a.result.data):X([])};d.useEffect(()=>{q()},[j,g,y,m,x]);const oe=()=>{re(U,"Báo cáo chấm điểm trưng bày")},re=async(t,a)=>{const w=require("exceljs"),o=new w.Workbook,r=o.addWorksheet("Sheet1");r.properties.defaultColWidth=20,r.getColumn("A").width=30,r.mergeCells("A2:J2"),r.getCell("A2").value=a,r.getCell("A2").style={font:{bold:!0,name:"Times New Roman",size:12}},r.getCell("A2").alignment={vertical:"middle",horizontal:"center"};let v=r.getRow(4),b=r.getRow(5),n=[{title:"Khách hàng",field:"customer_name"},{title:"Tên chiến dịch",field:"campaign_name"},{title:"Nhân viên thực hiện",field:"employee_name"},{title:"Số lượng danh mục",field:"categories"},{title:"Ảnh gian hàng",field:"images"},{title:"Ảnh gian hàng AI",field:"images_ai"},{title:"Thời gian thực hiện",field:"images_time"},{title:"Điểm trưng bày AI chấm",field:"scoring_machine"},{title:"Điểm trưng bày giám sát chấm",field:"scoring_human"}];for(let c=0;c<n.length;c++){let z=v.getCell(c+1),F=b.getCell(c+1);r.mergeCells(`${z._address}:${F._address}`),v.getCell(c+1).style={font:{bold:!0,name:"Times New Roman",size:12,italic:!0}},v.getCell(c+1).alignment={vertical:"middle",horizontal:"center"},v.getCell(c+1).value=n[c].title}for(let c=0;c<t.length;c++){let F=r.getRow(c+6),P=1;for(let _=0;_<n.length;_++){F.getCell(P).style={font:{name:"Times New Roman",size:12,italic:!0}};let $="";n[_].field=="categories"?t[c][n[_].field]!=null&&t[c][n[_].field]!=""&&($=JSON.parse(t[c][n[_].field]).length):n[_].field=="scoring_machine"||n[_].field=="scoring_human"?t[c][n[_].field]==0?$="Không đạt":$="Đạt":$=t[c][n[_].field],F.getCell(P).value=$,P+=1}}const h=await o.xlsx.writeBuffer();ce(h,"report")},ce=(t,a)=>{let w="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",o=".xlsx";const r=new Blob([t],{type:w});be.saveAs(r,a+"_export_"+new Date().getTime()+o)},de=t=>{A(t),t=="all"?p(!1):p(!0)},[me,G]=d.useState([]),[pe,W]=d.useState(!1),he=t=>{W(!1),G([])},H=t=>{const a=JSON.parse(t);G(a),W(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(ye,{title:"Báo cáo",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:e.jsx(Ie,{className:"text-xl"}),size:"20px",className:"flex items-center",action:oe}]}),e.jsxs("div",{className:"bg-white rounded-xl",children:[e.jsxs("div",{className:"flex p-4",style:{alignItems:"flex-end"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:"15px"},children:[e.jsx("label",{style:{paddingBottom:"5px"},children:"Chiến dịch:"}),e.jsxs(u,{className:"w-[150px] h-[36px]",value:j,onChange:t=>de(t),defaultValue:"all",children:[e.jsx(u.Option,{value:"all",children:"Tất cả"}),ae.map(t=>e.jsx(u.Option,{value:t.name,children:t.campaign_name},t.name))]})]}),e.jsx(ve,{className:"w-[250px] border-none mr-4",label:"Thời gian thực hiện",children:e.jsx(Ae,{value:g,onChange:t=>S(t)})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},className:"mr-4",children:[e.jsx("label",{style:{paddingBottom:"5px"},children:"Nhân viên:"}),e.jsxs(u,{className:"w-[150px] h-[36px]",value:y,onChange:t=>C(t),defaultValue:"all",children:[e.jsx(u.Option,{value:"all",children:"Tất cả"}),ee.map(t=>e.jsx(u.Option,{value:t.name,children:t.employee_name},t.name))]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},className:"mr-4",children:[e.jsx("label",{style:{paddingBottom:"5px"},children:"Điểm AI chấm:"}),e.jsxs(u,{className:"w-[150px] h-[36px]",value:m,onChange:t=>D(t),defaultValue:"all",children:[e.jsx(u.Option,{value:"all",children:"Tất cả"}),i.map(t=>e.jsx(u.Option,{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},className:"mr-4",children:[e.jsx("label",{style:{paddingBottom:"5px"},children:"Điểm giám sát chấm:"}),e.jsxs(u,{className:"w-[150px] h-[36px]",value:x,onChange:t=>l(t),defaultValue:"all",children:[e.jsx(u.Option,{value:"all",children:"Tất cả"}),i.map(t=>e.jsx(u.Option,{value:t.value,children:t.label},t.value))]})]})]}),e.jsx("div",{children:s?e.jsx(M,{columns:L,dataSource:R,scroll:{y:540,x:2e3},onRow:(t,a)=>({onClick:()=>J(t)}),rowHoverBg:"#f0f0f0"}):e.jsx(M,{columns:ne,dataSource:U,scroll:{y:540,x:1300},onRow:(t,a)=>({onClick:()=>J(t)}),rowHoverBg:"#f0f0f0",expandable:{expandedRowRender:(t,a)=>e.jsx("div",{style:{margin:5},children:e.jsx(M,{columns:le,dataSource:t.detail_skus,pagination:!1})})}})})]}),e.jsx(Y.PreviewGroup,{preview:{visible:pe,onVisibleChange:he},children:me.map((t,a)=>e.jsx(Y,{style:{display:"none"},width:50,src:t},a))})]})}function $e(){return e.jsxs(e.Fragment,{children:[e.jsx(je,{children:e.jsx("title",{children:"BÁO CÁO"})}),e.jsx(Ee,{})]})}export{$e as default};
