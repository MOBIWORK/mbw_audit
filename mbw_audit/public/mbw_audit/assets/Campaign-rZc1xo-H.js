import{u as pe,r as o,A as b,j as e,H as ge,a1 as W,g as ue,a2 as xe,a3 as fe,T as Ce,M as w,B as Y,a4 as De,a9 as z,aa as G,i as be,s as h,a8 as ye,d as je}from"./main-3-RsTPUa.js";import{a as _e,V as Se,D as ke,E as Ee,r as we,u as Te}from"./xlsx-QIdGVFNO.js";import{e as Ne,F as Oe}from"./FileSaver.min-PyuNu9iF.js";import"./progress-Xjqxpg-C.js";const T=ye.apiUrl;function ve(){const N=pe(),[R,Ie]=o.useState("checkbox"),U=[{title:"Tên chiến dịch",dataIndex:"campaign_name",render:(a,t)=>e.jsx("a",{href:"javascript:;",onClick:()=>H(t),children:t.campaign_name})},{title:"Trạng thái",dataIndex:"campaign_status",render:(a,t)=>e.jsxs(e.Fragment,{children:[t.campaign_status==="Open"&&e.jsxs(z,{color:"green",children:[e.jsx("div",{className:"dot-tag-green"})," Hoạt động"]}),t.campaign_status==="Close"&&e.jsxs(z,{color:"red",children:[e.jsx("div",{className:"dot-tag-red"})," Không hoạt động"]})]})},{title:"Thời gian bắt đầu",dataIndex:"start_date",render:a=>G(a).format("DD/MM/YYYY")},{title:"Thời gian kết thúc",dataIndex:"end_date",render:a=>G(a).format("DD/MM/YYYY")},{title:"Hành động",key:"action",render:(a,t)=>e.jsxs(be,{size:"middle",children:[e.jsx("a",{children:e.jsx(Ee,{onClick:()=>H(t)})}),e.jsx("a",{children:e.jsx(W,{onClick:()=>se(t)})})]})}],K={onChange:(a,t)=>{L(t),t.length>0?_(!0):_(!1)}},[J,f]=o.useState([]),$={onRemove:()=>{f([]),k([])},action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",multiple:!1,beforeUpload:async a=>{try{k([]);const t=a.name.toLowerCase();if(t.endsWith(".xls")||t.endsWith(".xlsx")||t.endsWith(".xlsm")||t.endsWith(".xlsb")||t.endsWith(".csv")||t.endsWith(".ods")){let i=[{uid:"-1",name:a.name,status:"done",url:""}];f(i);const n=new FileReader;n.onload=r=>{const c=r.target.result,x=we(c,{type:"buffer"}),he=x.SheetNames[0],de=x.Sheets[he],s=Te.sheet_to_json(de,{header:1});let A=[];if(s.length>=2)for(let l=1;l<s.length;l++){if(!s[l][0])continue;let g={campaign_name:s[l][0],campaign_description:s[l][1]?s[l][1]:"",campaign_status:s[l][4]!==""&&s[l][4].toLowerCase()==="close"?"Close":"Open",campaign_categories:s[l][5]?s[l][5].replace("“",'"').replace("”",'"'):"",campaign_employees:s[l][6]?s[l][6].replace("“",'"').replace("”",'"'):"",campaign_customers:s[l][7]?s[l][7].replace("“",'"').replace("”",'"'):""};if(typeof s[l][2]=="string"){let m=s[l][2].split("-"),d=new Date(m[2],m[1]-1,m[0]);g.campaign_start=(d.getTime()/1e3).toString()}else{const m=new Date(1899,11,31),d=(s[l][2]-1)*24*60*60*1e3;let E=new Date(m.getTime()+d);g.campaign_start=(E.getTime()/1e3).toString()}if(typeof s[l][3]=="string"){let m=s[l][3].split("-"),d=new Date(m[2],m[1]-1,m[0]);g.campaign_end=(d.getTime()/1e3).toString()}else{const m=new Date(1899,11,31),d=(s[l][3]-1)*24*60*60*1e3;let E=new Date(m.getTime()+d);g.campaign_end=(E.getTime()/1e3).toString()}C.some(m=>m.campaign_name===g.campaign_name)||A.push(g)}k(A)},n.readAsArrayBuffer(a)}else return h.error("Đã xảy ra lỗi, không đúng định dạng file: xls, xlsx, xlsm, xlsb, csv, ods"),!1}catch{h.error("File không chính xác, tải dữ liệu mẫu để tiếp tục")}return!1}},[C,y]=o.useState([]),[q,O]=o.useState([]),[u,Q]=o.useState(""),[j,v]=o.useState({}),[Z,I]=o.useState(!1),[p,L]=o.useState([]),[ee,_]=o.useState(!1),[te,F]=o.useState(!1),[ae,S]=o.useState(!1),[M,k]=o.useState([]);o.useState([]),o.useEffect(()=>{D()},[]),o.useEffect(()=>{if(u!==null&&u!==""){const a=C.filter(t=>t.campaign_name.toLowerCase().includes(u.toLowerCase()));O(a)}else O(C)},[u,C]);const D=async()=>{try{let t=await b.get('/api/resource/VGM_Campaign?fields=["*"]&limit_page_length=500');if(t&&t.data){let i=t.data.map(n=>({...n,key:n.name}));y(i)}else y([])}catch{y([])}},ne=a=>{Q(a.target.value)},H=a=>{N(`/campaign-edit/${a.name}`)},se=a=>{v(a),I(!0)},le=async()=>{let a=T+".api.deleteListByDoctype",t=[j.name];for(let r=0;r<p.length;r++)t.push(p[r].name);let i={doctype:"VGM_Campaign",items:JSON.stringify(t)},n=await b.post(a,i);n!=null&&n.message!=null&&n.message.status=="success"?(h.success("Xóa thành công"),D(),v({}),B()):h.error("Xóa thất bại, Chiến dịch đã tồn tại ở báo cáo")},B=()=>{I(!1)},ie=()=>{F(!0)},ce=async()=>{let a=T+".api.deleteListByDoctype",t=[];for(let r=0;r<p.length;r++)t.push(p[r].name);let i={doctype:"VGM_Campaign",items:JSON.stringify(t)},n=await b.post(a,i);n!=null&&n.message!=null&&n.message.status=="success"?(h.success("Xóa thành công"),L([]),_(!1),D(),X()):h.error("Xóa thất bại")},X=()=>{F(!1)},oe=()=>{S(!0),f([])},P=async()=>{let a=T+".api.import_campaign";if(M.length==0){h.error("Danh sách chiến dịch đã tồn tại hoặc Nhập file không chính xác");return}let t={listcampaign:JSON.stringify(M)};(await b.post(a,t)).message.status=="success"?(h.success("Thêm chiến dịch thành công"),S(!1),D()):h.error("Thêm chiến dịch thất bại")},V=()=>{S(!1),f([])},re=async()=>{const a=new Ne.Workbook,t=a.addWorksheet("Sheet1");t.properties.defaultColWidth=30;let i=[{label:"Campaign Name",cell:"A1",column:"A"},{label:"Campaign Description",cell:"B1",column:"B"},{label:"Start Date",cell:"C1",column:"C"},{label:"End Date",cell:"D1",column:"D"},{label:"Status",cell:"E1",column:"E"},{label:"Categories",cell:"F1",column:"F"},{label:"Employees",cell:"G1",column:"G"},{label:"Customers",cell:"H1",column:"H"}];for(let c=0;c<i.length;c++)t.getCell(i[c].cell).value=i[c].label,t.getCell(i[c].cell).style={font:{bold:!0,name:"Times New Roman",size:13}};let n=[{label:"Tên chiến dịch. VD: Chiến dịch 1",cell:"A2"},{label:"Mô tả chiến dịch",cell:"B2"},{label:"Ngày chiến dịch bắt đầu. VD: 27-02-2024",cell:"C2"},{label:"Ngày chiến dịch kết thúc. VD 29-02-2024",cell:"D2"},{label:"Trạng thái của chiến dịch bao gồm: Close, Open. VD: Close",cell:"E2"},{label:'Danh sách danh mục sản phẩm. VD ["Danh mục 1"]',cell:"F2"},{label:'Danh sách mã nhân viên. VD ["HR-EMP-00014"]',cell:"G2"},{label:'Danh sách mã khách hàng. VD: ["CH-00001"]',cell:"H2"}];for(let c=0;c<n.length;c++)t.getCell(n[c].cell).value=n[c].label,t.getCell(n[c].cell).style={font:{bold:!1,name:"Times New Roman",size:13}};const r=await a.xlsx.writeBuffer();me(r,"sample_campaign",!1)},me=(a,t,i=!0)=>{let n="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",r=".xlsx";const c=new Blob([a],{type:n});let x=t+"_export_"+new Date().getTime()+r;i||(x=t+r),Oe.saveAs(c,x)};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{title:"Chiến dịch",buttons:[ee&&{label:"Xóa",type:"primary",icon:e.jsx(W,{}),size:"20px",className:"flex items-center mr-2",danger:!0,action:ie},{label:"Nhập file",icon:e.jsx(_e,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2",action:oe},{label:"Thêm mới",type:"primary",icon:e.jsx(Se,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>N("/campaign-create")}]}),e.jsxs("div",{className:"bg-white rounded-xl pt-4 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsx(ue,{className:"w-[320px] border-none p-4",children:e.jsx(xe,{value:u,onChange:ne,placeholder:"Tìm kiếm chiến dịch",prefix:e.jsx(fe,{})})}),e.jsx("div",{children:e.jsx(Ce,{rowSelection:{type:R,...K},columns:U,dataSource:q})})]}),e.jsxs(w,{title:`Xóa ${j.campaign_name}?`,open:Z,onOk:le,onCancel:B,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",j.campaign_name," ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(w,{title:`Xóa ${p.length} chiến dịch?`,open:te,onOk:ce,onCancel:X,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",p.length," chiến dịch ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(w,{title:"Nhập dữ liệu từ tệp excel",open:ae,width:777,onOk:P,onCancel:V,footer:[e.jsx(Y,{onClick:V,children:"Hủy"},"back"),e.jsx(Y,{type:"primary",onClick:P,children:"Lưu lại"},"submit")],children:[e.jsxs("p",{className:"text-[#637381] font-normal text-sm",children:["Chọn file excel có định dạng .xlsx để thực hiện nhập dữ liệu. Tải dữ liệu mẫu ",e.jsx("a",{target:"_blank",onClick:re,children:"tại đây"})]}),e.jsxs(ke,{...$,fileList:J,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(De,{})}),e.jsx("p",{className:"ant-upload-text",children:"Kéo, thả hoặc chọn tệp để tải lên"})]})]})]})}function Be(){return e.jsxs(e.Fragment,{children:[e.jsx(je,{children:e.jsx("title",{children:" Campaign"})}),e.jsx(ve,{})]})}export{Be as default};
