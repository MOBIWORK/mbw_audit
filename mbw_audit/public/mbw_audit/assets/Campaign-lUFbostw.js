import{u as ge,r as i,A as u,j as e,H as ue,a1 as Y,g as xe,a2 as fe,a3 as Ce,T as je,M as _,B as P,a4 as ye,aa as A,ab as W,i as _e,s as r,a8 as De,d as Se}from"./main-xoq85Hka.js";import{a as ke,V as be,D as Ie,E as Oe,r as we,u as Le}from"./xlsx-OKrcPSnu.js";import"./progress-odtzz1z8.js";const D=De.apiUrl;function Ne(){const S=ge(),[K,Te]=i.useState("checkbox"),U=[{title:"Tên chiến dịch",dataIndex:"campaign_name",render:(a,t)=>e.jsx("a",{href:"javascript:;",onClick:()=>N(t),children:t.campaign_name})},{title:"Trạng thái",dataIndex:"campaign_status",render:(a,t)=>e.jsxs(e.Fragment,{children:[t.campaign_status==="Open"&&e.jsxs(A,{color:"green",children:[e.jsx("div",{className:"dot-tag-green"})," Hoạt động"]}),t.campaign_status==="Close"&&e.jsxs(A,{color:"red",children:[e.jsx("div",{className:"dot-tag-red"})," Không hoạt động"]})]})},{title:"Thời gian bắt đầu",dataIndex:"start_date",render:a=>W(a).format("DD/MM/YYYY")},{title:"Thời gian kết thúc",dataIndex:"end_date",render:a=>W(a).format("DD/MM/YYYY")},{title:"Hành động",key:"action",render:(a,t)=>e.jsxs(_e,{size:"middle",children:[e.jsx("a",{children:e.jsx(Oe,{onClick:()=>N(t)})}),e.jsx("a",{children:e.jsx(Y,{onClick:()=>te(t)})})]})}],V={onChange:(a,t)=>{O(t),t.length>0?C(!0):C(!1)}},[z,d]=i.useState([]),G={onRemove:()=>{d([]),y([])},action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",multiple:!1,beforeUpload:async a=>{try{y([]);const t=a.name.toLowerCase();if(t.endsWith(".xls")||t.endsWith(".xlsx")||t.endsWith(".xlsm")||t.endsWith(".xlsb")||t.endsWith(".csv")||t.endsWith(".ods")){let o=[{uid:"-1",name:a.name,status:"done",url:""}];d(o);const l=new FileReader;l.onload=c=>{const le=c.target.result,F=we(le,{type:"buffer"}),ce=F.SheetNames[0],re=F.Sheets[ce],s=Le.sheet_to_json(re,{header:1});let X=[];if(s.length>=2)for(let n=1;n<s.length;n++){if(!s[n][0])continue;const B=new Date(1899,11,31),oe=(s[n][2]-1)*24*60*60*1e3;let he=new Date(B.getTime()+oe);const me=(s[n][3]-1)*24*60*60*1e3;let de=new Date(B.getTime()+me),H={campaign_name:s[n][0],campaign_description:s[n][1]?s[n][1]:"",campaign_start:(he.getTime()/1e3).toString(),campaign_end:(de.getTime()/1e3).toString(),campaign_status:s[n][4]!==""&&s[n][4].toLowerCase()==="close"?"Close":"Open",campaign_categories:s[n][5]?s[n][5].replace("“",'"').replace("”",'"'):"",campaign_employees:s[n][6]?s[n][6].replace("“",'"').replace("”",'"'):"",campaign_customers:s[n][7]?s[n][7].replace("“",'"').replace("”",'"'):""};p.some(pe=>pe.campaign_name===H.campaign_name)||X.push(H)}y(X)},l.readAsArrayBuffer(a)}else return r.error("Đã xảy ra lỗi, không đúng định dạng file: xls, xlsx, xlsm, xlsb, csv, ods"),!1}catch{r.error("File không chính xác, tải dữ liệu mẫu để tiếp tục")}return!1}},[p,x]=i.useState([]),[J,k]=i.useState([]),[m,R]=i.useState(""),[f,b]=i.useState({}),[$,I]=i.useState(!1),[h,O]=i.useState([]),[q,C]=i.useState(!1),[Q,w]=i.useState(!1),[Z,j]=i.useState(!1),[L,y]=i.useState([]);i.useState([]),i.useEffect(()=>{g()},[]),i.useEffect(()=>{if(m!==null&&m!==""){const a=p.filter(t=>t.campaign_name.toLowerCase().includes(m.toLowerCase()));k(a)}else k(p)},[m,p]);const g=async()=>{try{let t=await u.get('/api/resource/VGM_Campaign?fields=["*"]&limit_page_length=500');if(t&&t.data){let o=t.data.map(l=>({...l,key:l.name}));x(o)}else x([])}catch{x([])}},ee=a=>{R(a.target.value)},N=a=>{S(`/campaign-edit/${a.name}`)},te=a=>{b(a),I(!0)},ae=async()=>{let a=D+".api.deleteListByDoctype",t=[f.name];for(let c=0;c<h.length;c++)t.push(h[c].name);let o={doctype:"VGM_Campaign",items:JSON.stringify(t)},l=await u.post(a,o);l!=null&&l.message!=null&&l.message.status=="success"?(r.success("Xóa thành công"),g(),b({}),T()):r.error("Xóa thất bại, Chiến dịch đã tồn tại ở báo cáo")},T=()=>{I(!1)},se=()=>{w(!0)},ne=async()=>{let a=D+".api.deleteListByDoctype",t=[];for(let c=0;c<h.length;c++)t.push(h[c].name);let o={doctype:"VGM_Campaign",items:JSON.stringify(t)},l=await u.post(a,o);l!=null&&l.message!=null&&l.message.status=="success"?(r.success("Xóa thành công"),O([]),C(!1),g(),M()):r.error("Xóa thất bại")},M=()=>{w(!1)},ie=()=>{j(!0),d([])},v=async()=>{let a=D+".api.import_campaign";if(L.length==0){r.error("Danh sách chiến dịch đã tồn tại hoặc Nhập file không chính xác");return}let t={listcampaign:JSON.stringify(L)};(await u.post(a,t)).message.status=="success"?(r.success("Thêm chiến dịch thành công"),j(!1),g()):r.error("Thêm chiến dịch thất bại")},E=()=>{j(!1),d([])};return e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:"Chiến dịch",buttons:[q&&{label:"Xóa",type:"primary",icon:e.jsx(Y,{}),size:"20px",className:"flex items-center mr-2",danger:!0,action:se},{label:"Nhập file",icon:e.jsx(ke,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2",action:ie},{label:"Thêm mới",type:"primary",icon:e.jsx(be,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>S("/campaign-create")}]}),e.jsxs("div",{className:"bg-white rounded-xl pt-4 border-[#DFE3E8] border-[0.2px] border-solid",children:[e.jsx(xe,{className:"w-[320px] border-none p-4",children:e.jsx(fe,{value:m,onChange:ee,placeholder:"Tìm kiếm chiến dịch",prefix:e.jsx(Ce,{})})}),e.jsx("div",{children:e.jsx(je,{rowSelection:{type:K,...V},columns:U,dataSource:J})})]}),e.jsxs(_,{title:`Xóa ${f.campaign_name}?`,open:$,onOk:ae,onCancel:T,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",f.campaign_name," ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(_,{title:`Xóa ${h.length} chiến dịch?`,open:Q,onOk:ne,onCancel:M,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",h.length," chiến dịch ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(_,{title:"Nhập dữ liệu từ tệp excel",open:Z,width:777,onOk:v,onCancel:E,footer:[e.jsx(P,{onClick:E,children:"Hủy"},"back"),e.jsx(P,{type:"primary",onClick:v,children:"Lưu lại"},"submit")],children:[e.jsxs("p",{className:"text-[#637381] font-normal text-sm",children:["Chọn file excel có định dạng .xlsx để thực hiện nhập dữ liệu. Tải dữ liệu mẫu ",e.jsx("a",{target:"_blank",href:"/public/data_sample/Mẫu_Nhập_Chiến_Dịch.xlsx",children:"tại đây"})]}),e.jsxs(Ie,{...G,fileList:z,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ye,{})}),e.jsx("p",{className:"ant-upload-text",children:"Kéo, thả hoặc chọn tệp để tải lên"})]})]})]})}function Fe(){return e.jsxs(e.Fragment,{children:[e.jsx(Se,{children:e.jsx("title",{children:" Campaign"})}),e.jsx(Ne,{})]})}export{Fe as default};
