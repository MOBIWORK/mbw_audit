import{r as p,e as de,_ as ce,f as O,j as t,u as me,g as he,A as K,H as pe,S as g,h as ue,T as M,D as ge,d as xe}from"./main-F9UH5SGm.js";import{C as $,a as B}from"./CloseCircleOutlined-hR3nH0DR.js";var fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"};const ye=fe;var ve=function(k,x){return p.createElement(de,ce({},k,{ref:x,icon:ye}))};const _e=p.forwardRef(ve);var G={exports:{}};(function(j,k){(function(x,S){S()})(O,function(){function x(n,a){return typeof a>"u"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}function S(n,a,y){var l=new XMLHttpRequest;l.open("GET",n),l.responseType="blob",l.onload=function(){f(l.response,a,y)},l.onerror=function(){console.error("could not download file")},l.send()}function v(n){var a=new XMLHttpRequest;a.open("HEAD",n,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function C(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(a)}}var m=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof O=="object"&&O.global===O?O:void 0,N=m.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),f=m.saveAs||(typeof window!="object"||window!==m?function(){}:"download"in HTMLAnchorElement.prototype&&!N?function(n,a,y){var l=m.URL||m.webkitURL,h=document.createElement("a");a=a||n.name||"download",h.download=a,h.rel="noopener",typeof n=="string"?(h.href=n,h.origin===location.origin?C(h):v(h.href)?S(n,a,y):C(h,h.target="_blank")):(h.href=l.createObjectURL(n),setTimeout(function(){l.revokeObjectURL(h.href)},4e4),setTimeout(function(){C(h)},0))}:"msSaveOrOpenBlob"in navigator?function(n,a,y){if(a=a||n.name||"download",typeof n!="string")navigator.msSaveOrOpenBlob(x(n,y),a);else if(v(n))S(n,a,y);else{var l=document.createElement("a");l.href=n,l.target="_blank",setTimeout(function(){C(l)})}}:function(n,a,y,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),typeof n=="string")return S(n,a,y);var h=n.type==="application/octet-stream",H=/constructor/i.test(m.HTMLElement)||m.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||h&&H||N)&&typeof FileReader<"u"){var I=new FileReader;I.onloadend=function(){var A=I.result;A=E?A:A.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=A:location=A,l=null},I.readAsDataURL(n)}else{var R=m.URL||m.webkitURL,b=R.createObjectURL(n);l?l.location=b:location.href=b,l=null,setTimeout(function(){R.revokeObjectURL(b)},4e4)}});m.saveAs=f.saveAs=f,j.exports=f})})(G);var je=G.exports;const{RangePicker:we}=ge;function Se(){const[j,k]=p.useState("all"),[x,S]=p.useState([]),[v,C]=p.useState("all"),[m,N]=p.useState("all"),[f,n]=p.useState("all"),[a,y]=p.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]),[l,h]=p.useState(!1),[H,E]=p.useState([{title:"STT",dataIndex:"stt",fixed:"left",width:100},{title:"Khách hàng",dataIndex:"customer_name",fixed:"left"},{title:"Tên chiến dịch",dataIndex:"campaign_name",fixed:"left"},{title:"Nhân viên thực hiện",dataIndex:"employee_name"},{title:"Số lượng danh mục",dataIndex:"quantity_cate"},{title:"Số lượng sản phẩm AI đếm",children:[]},{title:"Số lượng sản phẩm giám sát đếm",children:[]},{title:"Ảnh gian hàng",dataIndex:"images",render:e=>t.jsx(t.Fragment,{children:t.jsx("a",{onClick:()=>D(e),children:"Xem hình ảnh"})})},{title:"Ảnh gian hàng AI",dataIndex:"images",render:e=>t.jsx(t.Fragment,{children:t.jsx("a",{onClick:()=>D(e),children:"Xem hình ảnh"})})},{title:"Thời gian thực hiện",dataIndex:"images_time"},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:e=>t.jsxs(t.Fragment,{children:[e===1&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx($,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),e===0&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(B,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})},{title:"Điểm trưng bày giám sát chấm",dataIndex:"scoring_human",render:e=>t.jsxs(t.Fragment,{children:[e===1&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx($,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),e===0&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(B,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}]),[I,R]=p.useState([]),{search:b}=me(),W=new URLSearchParams(b).get("campaign");console.log(W);const Y=he(),[U,P]=p.useState([]),[Q,Z]=p.useState([]),[ee,X]=p.useState([]),q=e=>{localStorage.setItem("recordData",JSON.stringify(e)),Y("/report-view")};p.useEffect(()=>{ae(),le(),V()},[]);const D=e=>{console.log(e)},te=[{title:"STT",dataIndex:"stt",fixed:"left"},{title:"Khách hàng",dataIndex:"customer_name",fixed:"left"},{title:"Tên chiến dịch",dataIndex:"campaign_name",fixed:"left"},{title:"Nhân viên thực hiện",dataIndex:"employee_name"},{title:"Số lượng danh mục",dataIndex:"quantity_cate"},{title:"Ảnh gian hàng",dataIndex:"images",render:e=>t.jsx(t.Fragment,{children:t.jsx("a",{onClick:()=>D(e),children:"Xem hình ảnh"})})},{title:"Ảnh gian hàng AI",dataIndex:"images",render:e=>t.jsx(t.Fragment,{children:t.jsx("a",{onClick:()=>D(e),children:"Xem hình ảnh"})})},{title:"Thời gian thực hiện",dataIndex:"images_time"},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:e=>t.jsxs(t.Fragment,{children:[e===1&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx($,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),e===0&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(B,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})},{title:"Điểm trưng bày giám sát chấm",dataIndex:"scoring_human",render:e=>t.jsxs(t.Fragment,{children:[e===1&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx($,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),e===0&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(B,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],ne=[{title:"Tên sản phẩm",dataIndex:"product_name"},{title:"Số lượng sản phẩm AI đếm",dataIndex:"sum_product"},{title:"Số lượng sản phẩm giám sát đếm",dataIndex:"sum_product_human"},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:e=>t.jsxs(t.Fragment,{children:[e===1&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx($,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),e===0&&t.jsxs("span",{style:{display:"flex"},children:[t.jsx(B,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",t.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],V=async()=>{let e="/api/method/mbw_audit.api.api.get_reports_by_filter";if(j!=null&&j!=""&&j!="all"&&(e=`${e}?campaign_code=${j}`),x!=null&&x.length==2){let i=new Date(x[0]).getTime()/1e3,u=new Date(x[1]).getTime()/1e3;e.includes("?")?e=`${e}&start_date=${i}&end_date=${u}`:e=`${e}?start_date=${i}&end_date=${u}`}v!=null&&v!=""&&v!="all"&&(e.includes("?")?e=`${e}&employee_id=${v}`:e=`${e}?employee_id=${v}`),m!=null&&m!="all"&&(e.includes("?")?e=`${e}&status_scoring_ai=${m}`:e=`${e}?status_scoring_ai=${m}`,console.log(e)),f!=null&&f!="all"&&(e.includes("?")?e=`${e}&status_scoring_human=${f}`:e=`${e}?status_scoring_human=${f}`);let r=await K.get(e);if(r!=null&&r.message=="ok"&&r.result!=null&&r.result.data!=null){let i=r.result.data.map((u,c)=>{let w=(c+1).toString().padStart(2,"0"),o=JSON.parse(u.categories).length.toString().padStart(2,"0");return{...u,key:u.name,stt:w,quantity_cate:o}});if(!l)P(i);else{let u=!1,c=[],w=[];for(let o=0;o<i.length;o++){for(let s=0;s<i[o].info_products_ai.length;s++){if(!u){let z={title:i[o].info_products_ai[s].product_name,dataIndex:`${i[o].info_products_ai[s].product_name}_ai`,key:`${i[o].info_products_ai[s].product_name}_ai`,width:100},d={title:i[o].info_products_ai[s].product_name,dataIndex:`${i[o].info_products_ai[s].product_name}_human`,key:`${i[o].info_products_ai[s].product_name}_human`,width:100};c.push(z),w.push(d)}i[o][`${i[o].info_products_ai[s].product_name}_ai`]=i[o].info_products_ai[s].sum,i[o][`${i[o].info_products_human[s].product_name}_human`]=i[o].info_products_human[s].sum}c.length>0&&(u=!0)}E(o=>(o[5].children=c,o[6].children=w,o)),R(i)}}else l?(E(i=>(i[5].children=[],i[6].children=[],i)),R([])):P([])},ae=async()=>{try{const r=await K.get("/api/method/mbw_service_v2.api.ess.employee.get_list_employee");r&&r.result&&r.result.data&&Z(r.result.data)}catch(e){console.error("Error fetching employee data:",e)}},le=async()=>{const r=await K.get("/api/method/mbw_audit.api.api.get_all_campaigns");r!=null&&r.message=="ok"&&r.result!=null?X(r.result.data):X([])};p.useEffect(()=>{V()},[j,x,v,m,f]);const ie=()=>{se(U,"Báo cáo chấm điểm trưng bày")},se=async(e,r)=>{const i=require("exceljs"),u=new i.Workbook,c=u.addWorksheet("Sheet1");c.properties.defaultColWidth=20,c.getColumn("A").width=30,c.mergeCells("A2:J2"),c.getCell("A2").value=r,c.getCell("A2").style={font:{bold:!0,name:"Times New Roman",size:12}},c.getCell("A2").alignment={vertical:"middle",horizontal:"center"};let w=c.getRow(4),o=c.getRow(5),s=[{title:"Khách hàng",field:"customer_name"},{title:"Tên chiến dịch",field:"campaign_name"},{title:"Nhân viên thực hiện",field:"employee_name"},{title:"Số lượng danh mục",field:"categories"},{title:"Ảnh gian hàng",field:"images"},{title:"Ảnh gian hàng AI",field:"images_ai"},{title:"Thời gian thực hiện",field:"images_time"},{title:"Điểm trưng bày AI chấm",field:"scoring_machine"},{title:"Điểm trưng bày giám sát chấm",field:"scoring_human"}];for(let d=0;d<s.length;d++){let J=w.getCell(d+1),F=o.getCell(d+1);c.mergeCells(`${J._address}:${F._address}`),w.getCell(d+1).style={font:{bold:!0,name:"Times New Roman",size:12,italic:!0}},w.getCell(d+1).alignment={vertical:"middle",horizontal:"center"},w.getCell(d+1).value=s[d].title}for(let d=0;d<e.length;d++){let F=c.getRow(d+6),L=1;for(let _=0;_<s.length;_++){F.getCell(L).style={font:{name:"Times New Roman",size:12,italic:!0}};let T="";s[_].field=="categories"?e[d][s[_].field]!=null&&e[d][s[_].field]!=""&&(T=JSON.parse(e[d][s[_].field]).length):s[_].field=="scoring_machine"||s[_].field=="scoring_human"?e[d][s[_].field]==0?T="Không đạt":T="Đạt":T=e[d][s[_].field],F.getCell(L).value=T,L+=1}}const z=await u.xlsx.writeBuffer();oe(z,"report")},oe=(e,r)=>{let i="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",u=".xlsx";const c=new Blob([e],{type:i});je.saveAs(c,r+"_export_"+new Date().getTime()+u)},re=e=>{k(e),e=="all"?h(!1):h(!0)};return t.jsxs(t.Fragment,{children:[t.jsx(pe,{title:"Báo cáo",buttons:[{label:"Xuất dữ liệu",type:"primary",icon:t.jsx(_e,{className:"text-xl"}),size:"20px",className:"flex items-center",action:ie}]}),t.jsxs("div",{className:"bg-white rounded-xl",children:[t.jsxs("div",{className:"flex p-4",style:{alignItems:"flex-end"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:"15px"},children:[t.jsx("label",{style:{paddingBottom:"5px"},children:"Chiến dịch:"}),t.jsxs(g,{className:"w-[150px] h-[36px]",value:j,onChange:e=>re(e),defaultValue:"all",children:[t.jsx(g.Option,{value:"all",children:"Tất cả"}),ee.map(e=>t.jsx(g.Option,{value:e.name,children:e.campaign_name},e.name))]})]}),t.jsx(ue,{className:"w-[250px] border-none mr-4",label:"Thời gian thực hiện",children:t.jsx(we,{value:x,onChange:e=>S(e)})}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},className:"mr-4",children:[t.jsx("label",{style:{paddingBottom:"5px"},children:"Nhân viên:"}),t.jsxs(g,{className:"w-[150px] h-[36px]",value:v,onChange:e=>C(e),defaultValue:"all",children:[t.jsx(g.Option,{value:"all",children:"Tất cả"}),Q.map(e=>t.jsx(g.Option,{value:e.name,children:e.employee_name},e.name))]})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},className:"mr-4",children:[t.jsx("label",{style:{paddingBottom:"5px"},children:"Điểm AI chấm:"}),t.jsxs(g,{className:"w-[150px] h-[36px]",value:m,onChange:e=>N(e),defaultValue:"all",children:[t.jsx(g.Option,{value:"all",children:"Tất cả"}),a.map(e=>t.jsx(g.Option,{value:e.value,children:e.label},e.value))]})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column"},className:"mr-4",children:[t.jsx("label",{style:{paddingBottom:"5px"},children:"Điểm giám sát chấm:"}),t.jsxs(g,{className:"w-[150px] h-[36px]",value:f,onChange:e=>n(e),defaultValue:"all",children:[t.jsx(g.Option,{value:"all",children:"Tất cả"}),a.map(e=>t.jsx(g.Option,{value:e.value,children:e.label},e.value))]})]})]}),t.jsx("div",{children:l?t.jsx(M,{columns:H,dataSource:I,scroll:{y:540,x:2e3},onRow:(e,r)=>({onClick:()=>q(e)}),rowHoverBg:"#f0f0f0"}):t.jsx(M,{columns:te,dataSource:U,scroll:{y:540,x:1300},onRow:(e,r)=>({onClick:()=>q(e)}),rowHoverBg:"#f0f0f0",expandable:{expandedRowRender:(e,r)=>t.jsx("div",{style:{margin:5},children:t.jsx(M,{columns:ne,dataSource:e.detail_skus,pagination:!1})})}})})]})]})}function Ie(){return t.jsxs(t.Fragment,{children:[t.jsx(xe,{children:t.jsx("title",{children:"BÁO CÁO"})}),t.jsx(Se,{})]})}export{Ie as default};
