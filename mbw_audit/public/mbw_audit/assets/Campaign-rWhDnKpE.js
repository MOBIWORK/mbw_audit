import{u as me,r as s,a as h,j as e,H as pe,X as E,F as de,I as he,S as ge,T as ue,Z as j,$ as v,Y as xe,a4 as F,a5 as X,a3 as fe,a2 as o,c as Ce}from"./main-Ii39zDC_.js";import{a as je,V as ye,D as De,E as _e}from"./index.esm-rmjFQsI_.js";import{r as Se,u as ke,p as Ie}from"./path-SBoGkxsR.js";const y=Ie.apiUrl;function be(){const D=me(),[H,Oe]=s.useState("checkbox"),Y=[{title:"Tên chiến dịch",dataIndex:"campaign_name",render:t=>e.jsx("a",{children:t})},{title:"Trạng thái",dataIndex:"campaign_status",render:(t,a)=>e.jsxs(e.Fragment,{children:[a.campaign_status==="Open"&&e.jsxs(F,{color:"green",children:[e.jsx("div",{className:"dot-tag-green"})," Hoạt động"]}),a.campaign_status==="Close"&&e.jsxs(F,{color:"red",children:[e.jsx("div",{className:"dot-tag-red"})," Không hoạt động"]})]})},{title:"Thời gian bắt đầu",dataIndex:"start_date",render:t=>X(t).format("DD/MM/YYYY")},{title:"Thời gian kết thúc",dataIndex:"end_date",render:t=>X(t).format("DD/MM/YYYY")},{title:"Hành động",key:"action",render:(t,a)=>e.jsxs(fe,{size:"middle",children:[e.jsx("a",{children:e.jsx(_e,{onClick:()=>q(a)})}),e.jsx("a",{children:e.jsx(E,{onClick:()=>Q(a)})})]})}],B={onChange:(t,a)=>{I(a),a.length>0?x(!0):x(!1)}},[P,g]=s.useState([]),A={action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",multiple:!1,beforeUpload:async t=>{try{let a=[{uid:"-1",name:t.name,status:"done",url:""}];g(a);const c=new FileReader;c.onload=n=>{const r=n.target.result,L=Se(r,{type:"buffer"}),se=L.SheetNames[0],ne=L.Sheets[se],i=ke.sheet_to_json(ne,{header:1});let C=[];if(i.length>=2)for(let l=1;l<i.length;l++){const M=new Date(1899,11,31),ie=(i[l][2]-1)*24*60*60*1e3;let le=new Date(M.getTime()+ie);const ce=(i[l][2]-1)*24*60*60*1e3;let re=new Date(M.getTime()+ce),oe={campaign_name:i[l][0],campaign_description:i[l][1],campaign_start:(le.getTime()/1e3).toString(),campaign_end:(re.getTime()/1e3).toString(),campaign_status:i[l][4]!=""?i[l][4]:"Open",campaign_categories:i[l][5],campaign_employees:i[l][6],campaign_customers:i[l][7]};C.push(oe)}console.log(C),R(C)},c.readAsArrayBuffer(t)}catch{o.error("File không chính xác, tải dữ liệu mẫu để tiếp tục")}return!1}},[K,_]=s.useState([]),[p,U]=s.useState(""),[u,S]=s.useState({}),[V,k]=s.useState(!1),[m,I]=s.useState([]),[$,x]=s.useState(!1),[z,b]=s.useState(!1),[G,f]=s.useState(!1),[J,R]=s.useState([]);s.useState([]),s.useEffect(()=>{d()},[]),s.useEffect(()=>{d()},[p]);const d=async()=>{let t='/api/resource/VGM_Campaign?fields=["*"]';p!=null&&p!=""&&(t+=`&filters=[["campaign_name","like","%${p}%"]]`);let a=await h.get(t);if(a&&a.data){let c=a.data.map(n=>({...n,key:n.name}));_(c)}else _([])},Z=t=>{U(t.target.value)},q=t=>{D(`/campaign-edit/${t.name}`)},Q=t=>{S(t),k(!0)},W=async()=>{let t=y+".api.deleteListByDoctype",a=[u.name];for(let r=0;r<m.length;r++)a.push(m[r].name);let c={doctype:"VGM_Campaign",items:JSON.stringify(a)},n=await h.post(t,c);n!=null&&n.message!=null&&n.message.status=="success"?(o.success("Xóa thành công"),d(),S({}),O()):o.error("Xóa thất bại, Chiến dịch đã tồn tại ở báo cáo")},O=()=>{k(!1)},ee=()=>{b(!0)},te=async()=>{let t=y+".api.deleteListByDoctype",a=[];for(let r=0;r<m.length;r++)a.push(m[r].name);let c={doctype:"VGM_Campaign",items:JSON.stringify(a)},n=await h.post(t,c);n!=null&&n.message!=null&&n.message.status=="success"?(o.success("Xóa thành công"),I([]),x(!1),d(),T()):o.error("Xóa thất bại")},T=()=>{b(!1)},ae=()=>{f(!0),g([])},w=async()=>{let t=y+".api.import_campaign",a={listcampaign:JSON.stringify(J)};(await h.post(t,a)).message.status=="success"?(o.success("Thên chiến dịch thành công"),f(!1),d()):o.error("Thêm chiến dịch thất bại")},N=()=>{f(!1),g([])};return e.jsxs(e.Fragment,{children:[e.jsx(pe,{title:"Chiến dịch",buttons:[$&&{label:"Xóa",type:"primary",icon:e.jsx(E,{}),size:"20px",className:"flex items-center mr-2",danger:!0,action:ee},{label:"Nhập file",icon:e.jsx(je,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2",action:ae},{label:"Thêm mới",type:"primary",icon:e.jsx(ye,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>D("/campaign-create")}]}),e.jsxs("div",{className:"bg-white rounded-xl pt-4",children:[e.jsx(de,{className:"w-[320px] border-none p-4",children:e.jsx(he,{value:p,onChange:Z,placeholder:"Tìm kiếm chiến dịch",prefix:e.jsx(ge,{})})}),e.jsx("div",{children:e.jsx(ue,{rowSelection:{type:H,...B},columns:Y,dataSource:K})})]}),e.jsxs(j,{title:`Xóa ${u.campaign_name}?`,open:V,onOk:W,onCancel:O,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",u.campaign_name," ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(j,{title:`Xóa ${m.length} chiến dịch?`,open:z,onOk:te,onCancel:T,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",m.length," chiến dịch ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(j,{title:"Nhập dữ liệu từ tệp excel",open:G,width:777,onOk:w,onCancel:N,footer:[e.jsx(v,{onClick:N,children:"Hủy"},"back"),e.jsx(v,{type:"primary",onClick:w,children:"Lưu lại"},"submit")],children:[e.jsxs("p",{className:"text-[#637381] font-normal text-sm",children:["Chọn file excel có định dạng .xlsx để thực hiện nhập dữ liệu. Tải dữ liệu mẫu ",e.jsx("a",{target:"_blank",href:"/mbw_audit/data_sample/campaign_sample.xlsx",children:"tại đây"})]}),e.jsxs(De,{...A,fileList:P,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(xe,{})}),e.jsx("p",{className:"ant-upload-text",children:"Kéo, thả hoặc chọn tệp để tải lên"})]})]})]})}function Le(){return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{children:e.jsx("title",{children:" Campaign"})}),e.jsx(be,{})]})}export{Le as default};
