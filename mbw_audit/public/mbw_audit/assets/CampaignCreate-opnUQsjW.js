import{r as n,j as e,R as L,y as F,F as b,z as R,a4 as $,S as J,ah as W,a as D,P as A,G as O,M as P,Y as K,B as V,T as Y,D as B,a1 as Q,W as z,a2 as U,aB as X,a3 as Z,V as H,H as ee}from"./main-pW1tMfgi.js";const te=[{label:"Hoạt động",value:"Open"},{label:"Đóng",value:"Close"}];function se({form:o,onCampaignStatusChange:p}){const[i,c]=n.useState("Open"),y=m=>{c(m),p(m)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 pt-6 pb-[58px]",children:[e.jsxs(L,{children:[e.jsx(F,{span:8,children:e.jsx(b,{label:"Tên chiến dịch",name:"campaign_name",required:!0,children:e.jsx(R,{})})}),e.jsx(F,{span:8,children:e.jsx(b,{label:"Thời gian bắt đầu",name:"campaign_start",required:!0,children:e.jsx($,{showTime:!0})})}),e.jsx(F,{span:8,children:e.jsx(b,{label:"Thời gian kết thúc",name:"campaign_end",required:!0,children:e.jsx($,{showTime:!0})})})]}),e.jsxs(L,{className:"pt-2",children:[e.jsx(F,{span:8,children:e.jsx(b,{label:"Trạng thái",name:"campaign_status",children:e.jsx(J,{defaultValue:"Open",options:te,onChange:y})})}),e.jsx(F,{span:8,children:e.jsx(b,{label:"Mô tả",name:"campaign_description",children:e.jsx(W,{className:"bg-[#F5F7FA]",autoSize:{minRows:3,maxRows:5}})})})]})]})})}function ae({onChangeCategory:o}){const[p,i]=n.useState(!1),[c,y]=n.useState([]),[m,j]=n.useState([]),[h,w]=n.useState(""),[u,C]=n.useState([]);n.useEffect(()=>{d()},[]),n.useEffect(()=>{d()},[h]);const d=async()=>{let l='/api/resource/VGM_Category?fields=["*"]';h!=null&&h!=""&&(l+=`&filters=[["category_name", "like", "%${h}%"]]`);const t=await D.get(l);if(t&&t.data){let s=t.data.map(a=>({...a,key:a.name}));for(let a=0;a<s.length;a++){let x=`/api/resource/VGM_Product?fields=["name","product_code","product_name"]&&filters=[["category","=","${s[a].name}"]]`,M=await D.get(x);if(M!=null&&M.data!=null){s[a].product_num=M.data.length;let q=M.data.map(G=>({...G,key:G.name}));s[a].products=q}else s[a].product_num=0,s[a].products=[]}j(s)}},f=l=>{w(l.target.value)},v={selectedRowKeys:c,onChange:(l,t)=>{y(l)}},N=()=>{let l=[];for(let t=0;t<c.length;t++){let s=m.filter(a=>a.name==c[t]);s!=null&&s.length>0&&(s[0].stt=l.length+1,l.push(s[0]))}C(l),o(l),_()},r=c.length>0,g=()=>{i(!0)},S=()=>{i(!1)},_=()=>{i(!1)},E=l=>{const t=u.filter(s=>s.name!==l.name);C(t),o(t)},T=(l,t)=>{const s=[{title:"Mã sản phẩm",dataIndex:"product_code",key:"product_code"},{title:"Tên sản phẩm",dataIndex:"product_name",key:"product_name"}];return e.jsx(Y,{columns:s,dataSource:l.products,pagination:!1})},k=[{title:"STT",dataIndex:"stt",key:"stt"},{title:"Danh mục sản phẩm",dataIndex:"category_name",key:"category_name"},{title:"Số lượng sản phẩm",dataIndex:"product_num",key:"product_num"},{title:"",key:"",render:l=>e.jsx("a",{children:e.jsx(B,{onClick:()=>E(l)})})}];return e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Sản phẩm"}),e.jsxs("div",{onClick:g,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(A,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn danh mục"})]}),e.jsx("div",{className:"pt-6 ml-4",children:e.jsx(O,{columns:k,expandable:{expandedRowRender:T,defaultExpandedRowKeys:["0"]},dataSource:u})}),e.jsxs(P,{width:990,title:"Chọn danh mục sản phẩm",open:p,onOk:S,onCancel:_,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"w-[320px] border-none pt-4",children:e.jsx(R,{value:h,onChange:f,placeholder:"Tìm kiếm danh mục sản phẩm",prefix:e.jsx(K,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:r?`Đã chọn ${c.length} danh mục`:""}),e.jsx(V,{type:"primary",onClick:N,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(O,{rowSelection:v,columns:[{title:"Danh mục sản phẩm",dataIndex:"category_name",key:"category_name"},{title:"Số lượng sản phẩm",dataIndex:"product_num",key:"product_num"}],dataSource:m})})]})]})}function ne({onChangeCustomer:o}){const[p,i]=n.useState(!1),[c,y]=n.useState([]),[m,j]=n.useState([]),[h,w]=n.useState([]),[u,C]=n.useState([]),[d,f]=n.useState(""),I=[{title:"ID",dataIndex:"customer_code",key:"customer_code",render:t=>e.jsx("a",{children:t})},{title:"Tên khách hàng",key:"customer_name",dataIndex:"customer_name"},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group"},{title:"Địa chỉ",key:"customer_primary_address",dataIndex:"customer_primary_address"},{title:"",key:"action",render:(t,s)=>e.jsx("a",{children:e.jsx(B,{onClick:()=>T(s)})})}];n.useEffect(()=>{v()},[]),n.useEffect(()=>{let t=h;d!=null&&d!=""&&(t=h.filter(s=>s.customer_name.toLowerCase().includes(d.toLowerCase()))),j(t)},[d]);const v=async()=>{let s=await D.get("/api/method/mbw_dms.api.selling.customer.list_customer"),a=[];s!=null&&s.message=="ok"&&(a=s.result.data.map(x=>({...x,key:x.name}))),j(a),w(a)},N=()=>{i(!0)},r=()=>{i(!1)},g=()=>{i(!1)},S=t=>{f(t.target.value)},_=t=>{y(t)},E=()=>{let t=[];for(let s=0;s<c.length;s++){let a=m.filter(x=>x.name==c[s]);a!=null&&a.length>0&&t.push(a[0])}C(t),o(t),g()},T=t=>{const s=u.filter(a=>a.name!==t.name);C(s),o(s)},k={selectedRowKeys:c,onChange:_},l=c.length>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Danh sách khách hàng"}),e.jsxs("div",{onClick:N,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(A,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn khách hàng"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(O,{columns:I,dataSource:u}),";"]}),e.jsxs(P,{width:990,title:"Chọn khách hàng",open:p,onOk:r,onCancel:g,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"w-[320px] border-none pt-4",children:e.jsx(R,{value:d,onChange:S,placeholder:"Tìm kiếm tên khách hàng",prefix:e.jsx(K,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:l?`Đã chọn ${c.length} khách hàng`:""}),e.jsx(V,{type:"primary",onClick:E,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(O,{rowSelection:k,columns:[{title:"ID",dataIndex:"customer_code",key:"customer_code",render:t=>e.jsx("a",{children:t})},{title:"Tên khách hàng",key:"customer_name",dataIndex:"customer_name"},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group"},{title:"Địa chỉ",key:"customer_primary_address",dataIndex:"customer_primary_address"}],dataSource:m})})]})]})})}const le=[{title:"Mã nhân viên",dataIndex:"name",key:"name",render:o=>e.jsx("a",{children:o})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name"},{title:"Email",dataIndex:"email",key:"email"}];function re({onChangeEmployees:o}){const[p,i]=n.useState(!1),[c,y]=n.useState([]),[m,j]=n.useState([]),[h,w]=n.useState([]),[u,C]=n.useState(""),[d,f]=n.useState([]),I=[{title:"Mã nhân viên",dataIndex:"name",key:"name",render:t=>e.jsx("a",{children:t})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name"},{title:"Email",dataIndex:"email",key:"email"},{title:"",key:"",render:t=>e.jsx("a",{children:e.jsx(B,{onClick:()=>T(t)})})}];n.useEffect(()=>{v()},[]),n.useEffect(()=>{let t=h;u!=null&&u!=""&&(t=h.filter(s=>s.employee_name.toLowerCase().includes(u.toLowerCase()))),j(t)},[u]);const v=async()=>{let s=await D.get("/api/method/mbw_service_v2.api.ess.employee.get_list_employee"),a=[];s!=null&&s.result!=null&&s.result.data!=null&&(a=s.result.data.map(x=>({...x,key:x.name}))),j(a),w(a)},N=()=>{i(!0)},r=()=>{i(!1)},g=()=>{i(!1)},S=t=>{y(t)},_=t=>{C(t.target.value)},E=()=>{let t=[];for(let s=0;s<c.length;s++){let a=m.filter(x=>x.name==c[s]);a!=null&&a.length>0&&t.push(a[0])}f(t),o(t),g()},T=t=>{const s=d.filter(a=>a.name!==t.name);f(s),o(s)},k={selectedRowKeys:c,onChange:S},l=c.length>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Danh sách nhân viên"}),e.jsxs("div",{onClick:N,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(A,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn nhân viên"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(O,{columns:I,dataSource:d}),";"]}),e.jsxs(P,{width:990,title:"Chọn nhân viên",open:p,onOk:r,onCancel:g,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"w-[320px] border-none pt-4",children:e.jsx(R,{value:u,onChange:_,placeholder:"Tìm kiếm tên nhân viên",prefix:e.jsx(K,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:l?`Đã chọn ${c.length} nhân viên`:""}),e.jsx(V,{type:"primary",onClick:E,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(O,{rowSelection:k,columns:le,dataSource:m})})]})]})})}function ce(){const o=Q(),[p]=z.useForm(),[i,c]=n.useState("Open"),[y,m]=n.useState([]),[j,h]=n.useState([]),[w,u]=n.useState([]),C=async()=>{let r=p.getFieldsValue(),g=y.map(l=>l.name),S=j.map(l=>l.name),_=w.map(l=>l.name),E="/api/resource/VGM_Campaign",T={campaign_name:r.campaign_name,campaign_description:r.campaign_description,start_date:d(r.campaign_start),end_date:d(r.campaign_end),campaign_status:i,products:JSON.stringify(g),employees:JSON.stringify(S),retails:JSON.stringify(_)},k=await D.post(E,T);k!=null&&k.data!=null?(H.success("Thêm mới thành công"),o("/campaign")):H.error("Thêm mới thất bại")},d=r=>new Date(r).toISOString().slice(0,19).replace("T"," "),f=r=>{c(r)},I=r=>{m(r)},v=r=>{h(r)},N=r=>{u(r)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Thêm mới chiến dịch",icon:e.jsx("p",{onClick:()=>o("/campaign"),className:"mr-2 cursor-pointer",children:e.jsx(X,{})}),buttons:[{label:"Thêm mới",type:"primary",size:"20px",className:"flex items-center",action:C}]}),e.jsx("div",{className:"bg-white pt-4 rounded-xl",children:e.jsx(z,{layout:"vertical",form:p,children:e.jsx(Z,{defaultActiveKey:"1",items:[{label:e.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:e.jsx(se,{form:p,onCampaignStatusChange:f})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Sản phẩm"}),key:"2",children:e.jsx(ae,{onChangeCategory:I})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Nhân viên bán hàng"}),key:"3",children:e.jsx(re,{onChangeEmployees:v})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"4",children:e.jsx(ne,{onChangeCustomer:N})}],indicatorSize:r=>r-18})})})]})}function ie(){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsx("title",{children:" Campaign Create"})}),e.jsx(ce,{})]})}export{ie as default};
