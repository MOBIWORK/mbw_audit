import{r as A,s as v,j as e,aL as J,C as S,g as _,a2 as E,S as Y,a5 as W,a6 as M,T as ee,a7 as te,u as Ae,F as D,H as ne,aQ as ae,aM as se,A as re,d as oe}from"./main-fvdOn_Wi.js";import{I as T}from"./index-Ie74z6jR.js";import{C as ie,a as le}from"./CloseCircleOutlined-sNaDS7A2.js";import{F as ce,P as de}from"./view-pah2j8kp.js";const $="data:image/png;base64,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";function ue({form:n,recordData:t,onChangeScoringHuman:g}){const[R,h]=A.useState([]),[C,k]=A.useState([]),[p,j]=A.useState(0),[x,r]=A.useState(0),[i,c]=A.useState(0),[I,f]=A.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]),[l,N]=A.useState(!1),[w,Q]=A.useState(!1);A.useEffect(()=>{if(t){n.setFieldsValue({store:t.customer_name,campaign_name:t.campaign_name,employee_code:t.employee_name,quatity:t.quantity_cate,time_report:G(t.images_time),scoring_machine:t.scoring_machine==1?"Đạt":t.scoring_machine==0?"Không đạt":"",scoring_human:t.scoring_human}),c(t.scoring_human);let a=[];t.images!=null&&t.images!=""&&(a=JSON.parse(t.images)),a.length===0&&N(!0);let d=[];t.images_ai!=null&&t.images_ai!=""&&(d=JSON.parse(t.images_ai)),d.length===0&&(Q(!0),v.warning("không tải được ảnh AI")),h(a),k(d)}},[t]);const z=a=>{j(a)},V=a=>{r(a)},P=()=>{p>0&&j(p-1)},O=()=>{p<R.length-1&&j(p+1)},U=()=>{x>0&&r(x-1)},K=()=>{x<C.length-1&&r(x+1)},L=a=>{c(a),g(a)},G=a=>{let d=new Date(a),B=d.getDate(),X=d.getMonth()+1,Z=d.getFullYear(),H=d.getHours(),o=d.getMinutes();return`${B.toString().padStart(2,"0")}/${X.toString().padStart(2,"0")}/${Z} ${H.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 pt-6 pb-[40px]",children:[e.jsxs(J,{children:[e.jsx(S,{span:8,children:e.jsx(_,{label:"Khách hàng",name:"store",className:"pt-3",required:!0,children:e.jsx(E,{readOnly:!0})})}),e.jsx(S,{span:8,children:e.jsx(_,{label:"Chiến dịch",name:"campaign_name",className:"pt-3",required:!0,children:e.jsx(E,{readOnly:!0})})}),e.jsx(S,{span:8,children:e.jsx(_,{label:"Nhân viên thực hiện",name:"employee_code",className:"pt-3",required:!0,children:e.jsx(E,{readOnly:!0})})})]}),e.jsxs(J,{children:[e.jsx(S,{span:8,children:e.jsx(_,{label:"Thời gian thực hiện",name:"time_report",className:"pt-3",required:!0,children:e.jsx(E,{readOnly:!0})})}),e.jsx(S,{span:8,children:e.jsx(_,{label:"Điểm trưng bày AI chấm",name:"scoring_machine",className:"pt-3",required:!0,children:e.jsx(E,{readOnly:!0,style:{color:t&&t.scoring_machine===1?"green":t&&t.scoring_machine===0?"red":"black"}})})}),e.jsx(S,{span:8,children:e.jsx(_,{label:"Giám sát chấm",name:"scoring_human",className:"pt-3",required:!0,children:e.jsx(Y,{className:"w-[200px] h-[36px]",value:i,onChange:a=>L(a),defaultValue:i,children:I.map(a=>e.jsx(Y.Option,{value:a.value,children:a.label},a.value))})})})]}),e.jsxs(J,{children:[e.jsx(S,{span:8,children:e.jsxs(_,{label:"Hình ảnh cửa hàng",className:"pt-3",required:!0,children:[e.jsxs("div",{style:{position:"relative",width:"100%",height:"auto",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(T,{src:R[p],fallback:$,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"cover",alignSelf:"center",borderRadius:"10px"}}),!l&&e.jsx("div",{onClick:P,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",left:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(W,{onClick:P,style:{color:"white"}})}),!l&&e.jsx("div",{onClick:O,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",right:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(M,{onClick:O,style:{color:"white"}})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",gap:"10px",overflowX:"hidden",marginTop:"10px"},children:R.map((a,d)=>e.jsx(T,{src:a,onClick:()=>z(d),style:{width:"80px",height:"80px",objectFit:"cover",cursor:"pointer",borderRadius:"10px"},preview:!1},d))})]})}),e.jsx(S,{span:8,children:e.jsxs(_,{label:"Hình ảnh AI trả về",className:"pt-3",required:!0,children:[e.jsxs("div",{style:{position:"relative",width:"100%",height:"auto",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(T,{src:C[x],fallback:$,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"cover",alignSelf:"center",borderRadius:"10px"}}),!w&&e.jsx("div",{onClick:U,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",left:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(W,{onClick:U,style:{color:"white"}})}),!w&&e.jsx("div",{onClick:K,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",right:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(M,{onClick:K,style:{color:"white"}})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",gap:"10px",overflowX:"hidden",marginTop:"10px"},children:C.map((a,d)=>e.jsx(T,{src:a,onClick:()=>V(d),style:{width:"80px",height:"80px",objectFit:"cover",cursor:"pointer",borderRadius:"10px"},preview:!1},d))})]})}),e.jsx(S,{span:8})]})]})})}function me(n){const t={},[g,R]=A.useState([]);A.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]),n.recordData?.detail_skus.forEach(r=>{const i=r.category,c=1;t[i]=(t[i]||0)+c});const h=(r,i,c)=>{R(I=>{let f=g.filter(l=>l.report_sku_id==c.name);if(f!=null&&f.length>0){let l=g.findIndex(N=>N.report_sku_id==c.name);g[l].sum_product_human=i}else g.push({report_sku_id:c.name,sum_product_human:i,scoring_human:c.scoring_human});return n.onChangeValReportSKU(g),g})},C=n.recordData?.category_names.map((r,i)=>{const c=Object.keys(r)[0];return{key:i.toString(),stt:(i+1).toString(),categoryName:Object.values(r)[0],number_product:t[c]||0}});A.useState(null);const k=[{title:"STT",dataIndex:"stt"},{title:"Tên sản phẩm",dataIndex:"name_product"},{title:"Số lượng sản phẩm AI đếm",dataIndex:"sum_product"},{title:"Số lượng sản phẩm giám sát đếm",dataIndex:"sum_product_human",render:(r,i,c)=>e.jsx(E,{style:{width:"120px"},defaultValue:r,onChange:I=>{const f=parseInt(I.target.value);isNaN(f)?(v.warning("Nhập số lượng"),h(c,0,i)):h(c,f,i)}})},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:r=>e.jsxs(e.Fragment,{children:[r===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(ie,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),r===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(le,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],p=[{title:"STT",dataIndex:"stt"},{title:"Danh mục sản phẩm",dataIndex:"categoryName"},{title:"Số lượng sản phẩm",dataIndex:"number_product"}],[j,x]=A.useState([]);return A.useState({}),A.useEffect(()=>{if(n.recordData){const r=n.recordData.category_names.map((i,c)=>{const I=Object.keys(i)[0];return n.recordData.detail_skus.filter(l=>l.category===I).map((l,N)=>({key:`${c}-${N}`,stt:`${(N+1).toString().padStart(2,"0")}`,name_product:l.product_name,sum_product:l.sum_product.toString(),image:l.images,creation:l.creation,scoring_machine:l.scoring_machine,scoring_human:l.scoring_human,sum_product_human:l.sum_product_human,name:l.name,index_category:c}))});x(r)}},[n.recordData]),e.jsx(e.Fragment,{children:e.jsx(ee,{columns:p,expandable:{expandedRowRender:(r,i)=>e.jsx("div",{style:{margin:5},children:e.jsx(te,{columns:k,dataSource:j[i],pagination:!1})}),rowExpandable:r=>j[r.key]&&j[r.key].length>0},dataSource:C})})}function ge(){const[n,t]=A.useState(null),[g,R]=A.useState(0),[h,C]=A.useState([]),[k,p]=A.useState(!1),[j,x]=A.useState(!1),[r,i]=A.useState(!1),[c,I]=A.useState(!1),[f,l]=A.useState(!1),[N,w]=A.useState(""),[Q,z]=A.useState([]),V=Ae(),P=o=>{},[O]=D.useForm(),U=o=>{R(o)},K=o=>{C(o)},L=[{key:"1",label:e.jsx("span",{style:{fontWeight:700},children:"Thông tin chung"}),children:e.jsx(ue,{form:O,recordData:n,onChangeScoringHuman:U})},{key:"2",label:e.jsx("span",{style:{fontWeight:700},children:"Sản phẩm"}),children:e.jsx(me,{recordData:n,onChangeValReportSKU:K})}];A.useEffect(()=>{let o=localStorage.getItem("recordData");if(o){let s=JSON.parse(o);t(s),R(s.scoring_human);let u=[];for(let m=0;m<s.detail_skus.length;m++){let y={report_sku_id:s.detail_skus[m].name,sum_product_human:s.detail_skus[m].sum_product_human,scoring_human:s.detail_skus[m].scoring_human};u.push(y)}C(u)}},[j]),A.useEffect(()=>{let o=JSON.parse(localStorage.getItem("dataReports"));if(o){const s=o.findIndex(u=>u.name===n?.name);s===0?i(!0):s===o.length-1?I(!0):(i(!1),I(!1))}},[n]);const G=async()=>{p(!0);let o={name:n.name,scoring:g,arr_product:h};const u=await re.post("/api/method/mbw_audit.api.api.update_report",o);if(u!=null&&u.message=="ok"&&u.result!=null&&u.result.data=="success"){v.success("Cập nhật thành công"),p(!1);let m=JSON.parse(localStorage.getItem("dataReports")),y=JSON.parse(localStorage.getItem("recordData"));for(let b=0;b<y.detail_skus.length;b++)for(let F=0;F<h.length;F++)y.detail_skus[b].name==h[F].report_sku_id&&(y.detail_skus[b].sum_product_human=h[F].sum_product_human,y.detail_skus[b].scoring_human=h[F].scoring_human);y.scoring_human=g;const q=m.findIndex(b=>b.name===y.name);if(q!==null&&q<m.length-1){const b=m[q+1];localStorage.setItem("recordData",JSON.stringify(b)),x(F=>!F)}else return;m[q]=y,localStorage.setItem("dataReports",JSON.stringify(m))}else v.error("Cập nhật thất bại"),p(!1)},a=()=>{let o=JSON.parse(localStorage.getItem("dataReports"));const s=o.findIndex(u=>u.name===n.name);if(s>0){const u=o[s-1];localStorage.setItem("recordData",JSON.stringify(u)),x(m=>!m)}},d=()=>n?`${n.customer_name} - ${n.campaign_name}`:"Tiêu đề",B=()=>{V("/reports"),localStorage.removeItem("recordData"),localStorage.removeItem("dataReports")},X=()=>{if(console.log(n),n.images!=null&&n.images!=""){let s=JSON.parse(n.images);if(s.length>0)z(s);else{v.warning("Bạn không có ảnh gian hàng sản phẩm để thực hiện gán nhãn");return}}else{v.warning("Bạn không có ảnh gian hàng sản phẩm để thực hiện gán nhãn");return}if(n.categories!=null&&n.categories!=""){let s=JSON.parse(n.categories);if(s.length>0)w(s[0]);else{v.warning("Bạn không có danh mục sản phẩm khi tạo chiến dịch");return}}else{v.warning("Bạn không có danh mục sản phẩm khi tạo chiến dịch");return}l(!0);let o=document.getElementsByClassName("ant-layout-content");o[0].style.padding="0px"},Z=o=>{z([]),w(""),l(!1);let s=document.getElementsByClassName("ant-layout-content");s[0].style.padding="0px 24px 20px"},H=o=>{z([]),w(""),l(!1);let s=document.getElementsByClassName("ant-layout-content");s[0].style.padding="0px 24px 20px"};return e.jsxs(e.Fragment,{children:[f==!1&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{title:d(),icon:e.jsx("p",{onClick:()=>B(),className:"mr-2 cursor-pointer",children:e.jsx(W,{})}),buttons:[{label:"Gán nhãn từ ảnh trưng bày",type:"primary",icon:e.jsx(ce,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2",action:X},{label:"trước",type:"default",size:"20px",className:"flex items-center mr-2",icon:e.jsx(ae,{}),action:a,disabled:r},{label:"Lưu lại và Tiếp",type:"primary",size:"20px",className:"flex items-center",loading:k,action:G,disabled:c}]}),e.jsx("div",{className:"bg-white  rounded-xl",children:e.jsx(D,{layout:"vertical",form:O,children:e.jsx(se,{items:L,defaultActiveKey:["1","2"],onChange:P,className:"custom-collapse"})})})]}),f==!0&&e.jsx(de,{category:N,arrImage:Q,backPageEmit:Z,completeProductLabelling:H})]})}function je(){return e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsx("title",{children:"BÁO CÁO"})}),e.jsx(ge,{})]})}export{je as default};
