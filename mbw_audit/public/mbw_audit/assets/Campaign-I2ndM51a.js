import{u as oe,r as s,A as h,j as e,H as re,X as E,F as me,I as pe,S as de,T as he,Z as x,$ as L,Y as ge,a4 as M,a5 as v,a3 as ue,a2 as m,b as xe}from"./main-Xl67n-75.js";import{a as fe,V as Ce,D as je,E as ye,r as De,u as _e}from"./xlsx-eb9sjPe4.js";import{p as Se}from"./path-AHvYoJqN.js";const f=Se.apiUrl;function ke(){const C=oe(),[F,be]=s.useState("checkbox"),X=[{title:"Tên chiến dịch",dataIndex:"campaign_name",render:t=>e.jsx("a",{children:t})},{title:"Trạng thái",dataIndex:"campaign_status",render:(t,a)=>e.jsxs(e.Fragment,{children:[a.campaign_status==="Open"&&e.jsxs(M,{color:"green",children:[e.jsx("div",{className:"dot-tag-green"})," Hoạt động"]}),a.campaign_status==="Close"&&e.jsxs(M,{color:"red",children:[e.jsx("div",{className:"dot-tag-red"})," Không hoạt động"]})]})},{title:"Thời gian bắt đầu",dataIndex:"start_date",render:t=>v(t).format("DD/MM/YYYY")},{title:"Thời gian kết thúc",dataIndex:"end_date",render:t=>v(t).format("DD/MM/YYYY")},{title:"Hành động",key:"action",render:(t,a)=>e.jsxs(ue,{size:"middle",children:[e.jsx("a",{children:e.jsx(ye,{onClick:()=>R(a)})}),e.jsx("a",{children:e.jsx(E,{onClick:()=>Z(a)})})]})}],H={onChange:(t,a)=>{_(a),a.length>0?u(!0):u(!1)}},Y={action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",multiple:!1,beforeUpload:async t=>{console.log(G);const a=new FileReader;return a.onload=o=>{const n=o.target.result,c=De(n,{type:"buffer"}),te=c.SheetNames[0],ae=c.Sheets[te],i=_e.sheet_to_json(ae,{header:1});let w=[];if(i.length>=2)for(let l=1;l<i.length;l++){const N=new Date(1899,11,31),se=(i[l][2]-1)*24*60*60*1e3;let ne=new Date(N.getTime()+se);const ie=(i[l][2]-1)*24*60*60*1e3;let le=new Date(N.getTime()+ie),ce={campaign_name:i[l][0],campaign_description:i[l][1],campaign_start:(ne.getTime()/1e3).toString(),campaign_end:(le.getTime()/1e3).toString(),campaign_status:i[l][4]!=""?i[l][4]:"Open",campaign_categories:i[l][5],campaign_employees:i[l][6],campaign_customers:i[l][7]};w.push(ce)}z(w)},a.readAsArrayBuffer(t),!1}},[B,j]=s.useState([]),[p,P]=s.useState(""),[g,y]=s.useState({}),[A,D]=s.useState(!1),[r,_]=s.useState([]),[K,u]=s.useState(!1),[U,S]=s.useState(!1),[V,k]=s.useState(!1),[$,z]=s.useState([]),[G,Ie]=s.useState([]);s.useEffect(()=>{d()},[]),s.useEffect(()=>{d()},[p]);const d=async()=>{let t='/api/resource/VGM_Campaign?fields=["*"]';p!=null&&p!=""&&(t+=`&filters=[["campaign_name","like","%${p}%"]]`);let a=await h.get(t);if(a&&a.data){let o=a.data.map(n=>({...n,key:n.name}));j(o)}else j([])},J=t=>{P(t.target.value)},R=t=>{C(`/campaign-edit/${t.name}`)},Z=t=>{y(t),D(!0)},q=async()=>{let t=f+".api.deleteListByDoctype",a=[g.name];for(let c=0;c<r.length;c++)a.push(r[c].name);let o={doctype:"VGM_Campaign",items:JSON.stringify(a)},n=await h.post(t,o);n!=null&&n.message!=null&&n.message.status=="success"?(m.success("Xóa thành công"),d(),y({}),b()):m.error("Xóa thất bại, Chiến dịch đã tồn tại ở báo cáo")},b=()=>{D(!1)},Q=()=>{S(!0)},W=async()=>{let t=f+".api.deleteListByDoctype",a=[];for(let c=0;c<r.length;c++)a.push(r[c].name);let o={doctype:"VGM_Campaign",items:JSON.stringify(a)},n=await h.post(t,o);n!=null&&n.message!=null&&n.message.status=="success"?(m.success("Xóa thành công"),_([]),u(!1),d(),I()):m.error("Xóa thất bại")},I=()=>{S(!1)},ee=()=>{k(!0)},O=async()=>{let t=f+".api.import_campaign",a={listcampaign:JSON.stringify($)};(await h.post(t,a)).status=="success"?(m.success("Thên chiến dịch thành công"),d()):m.success("Thên chiến dịch thất bại")},T=()=>{k(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(re,{title:"Chiến dịch",buttons:[K&&{label:"Xóa",type:"primary",icon:e.jsx(E,{}),size:"20px",className:"flex items-center mr-2",danger:!0,action:Q},{label:"Nhập file",icon:e.jsx(fe,{className:"text-xl"}),size:"20px",className:"flex items-center mr-2",action:ee},{label:"Thêm mới",type:"primary",icon:e.jsx(Ce,{className:"text-xl"}),size:"20px",className:"flex items-center",action:()=>C("/campaign-create")}]}),e.jsxs("div",{className:"bg-white rounded-xl pt-4",children:[e.jsx(me,{className:"w-[320px] border-none p-4",children:e.jsx(pe,{value:p,onChange:J,placeholder:"Tìm kiếm chiến dịch",prefix:e.jsx(de,{})})}),e.jsx("div",{children:e.jsx(he,{rowSelection:{type:F,...H},columns:X,dataSource:B})})]}),e.jsxs(x,{title:`Xóa ${g.campaign_name}?`,open:A,onOk:q,onCancel:b,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",g.campaign_name," ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(x,{title:`Xóa ${r.length} chiến dịch?`,open:U,onOk:W,onCancel:I,okText:"Xác nhận",cancelText:"Hủy",children:[e.jsxs("div",{children:["Bạn có chắc muốn xóa ",r.length," chiến dịch ra khỏi hệ thống không?"]}),e.jsx("div",{children:"Khi thực hiện hành động này, sẽ không thể hoàn tác."})]}),e.jsxs(x,{title:"Nhập dữ liệu từ tệp excel",open:V,width:777,onOk:O,onCancel:T,footer:[e.jsx(L,{onClick:T,children:"Hủy"},"back"),e.jsx(L,{type:"primary",onClick:O,children:"Lưu lại"},"submit")],children:[e.jsxs("p",{className:"text-[#637381] font-normal text-sm",children:["Chọn file excel có định dạng .xlsx để thực hiện nhập dữ liệu. Tải dữ liệu mẫu ",e.jsx("a",{target:"_blank",href:"/mbw_audit/data_sample/campaign_sample.xlsx",children:"tại đây"})]}),e.jsxs(je,{...Y,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ge,{})}),e.jsx("p",{className:"ant-upload-text",children:"Kéo, thả hoặc chọn tệp để tải lên"})]})]})]})}function Ne(){return e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsx("title",{children:" Campaign"})}),e.jsx(ke,{})]})}export{Ne as default};
