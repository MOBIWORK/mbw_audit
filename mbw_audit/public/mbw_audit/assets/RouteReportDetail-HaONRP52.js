import{r as s,u as N,A as u,j as e,H as O,F as g,I as b,S as k,a as p,T as F,D as H,b as A}from"./main-x60GkM-W.js";import{p as B}from"./path-AHvYoJqN.js";import{C as P,a as q}from"./CloseCircleOutlined-EdZis9II.js";const{RangePicker:z}=H,J=[{title:"STT",dataIndex:"stt"},{title:"Khách hàng",dataIndex:"retail_code"},{title:"Tên chiến dịch",dataIndex:"campaign_name"},{title:"Nhân viên thực hiện",dataIndex:"employee_name"},{title:"Số lượng danh mục sản phẩm",dataIndex:"quantity_cate"},{title:"Thời gian thực hiện",dataIndex:"images_time"},{title:"Chấm điểm trưng bày",dataIndex:"scoring_machine",render:o=>e.jsxs(e.Fragment,{children:[o===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(P,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),o===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(q,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],K=B.apiUrl;function L(){const[o,y]=s.useState(""),[l,f]=s.useState(null),[c,j]=s.useState("all"),[S,h]=s.useState([]),v=N(),[x,w]=s.useState([]),[D,_]=s.useState([]);s.useState([]),s.useState("checkbox");const C=t=>{localStorage.setItem("recordData",JSON.stringify(t)),v("/report-view")};s.useEffect(()=>{E()},[]);const E=async()=>{let t=await R();try{let a=K+".api.get_list_reports";const n=await u.get(a);if(n&&n.message&&n.message.data){let r=n.message.data.map((i,d)=>{let m=(d+1).toString().padStart(2,"0"),T=JSON.parse(i.categories).length.toString().padStart(2,"0");return{...i,key:i.name,stt:m,quantity_cate:T,employee_name:I(t,i.employee_code)}});w(r),h(r)}}catch(a){console.error("Error fetching report data:",a)}},R=async()=>{try{const a=await u.get("/api/method/mbw_service_v2.api.ess.employee.get_list_employee");if(a&&a.result&&a.result.data)return _(a.result.data),a.result.data}catch(t){console.error("Error fetching employee data:",t)}},I=(t,a)=>{const n=t.find(r=>r.name===a);return n?n.employee_name:""};return s.useEffect(()=>{const t=x.filter(a=>{const n=a.campaign_name.toLowerCase().includes(o.toLowerCase()),r=l&&l[0]?new Date(l[0]):null,i=l&&l[1]?new Date(l[1]):null,d=r&&i?new Date(a.images_time)>=new Date(r.setHours(0,0,0,0))&&new Date(a.images_time)<=new Date(i.setHours(23,59,59,999)):!0,m=c==="all"||a.employee_code===c;return n&&m&&d});h(t)},[o,l,c,x]),e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Báo cáo"}),e.jsxs("div",{className:"bg-white rounded-xl",children:[e.jsxs("div",{className:"flex p-4",style:{alignItems:"flex-end"},children:[e.jsx(g,{className:"w-[320px] border-none mr-4 ",children:e.jsx(b,{placeholder:"Tìm kiếm theo chiến dịch",value:o,onChange:t=>y(t.target.value),prefix:e.jsx(k,{})})}),e.jsx(g,{className:"w-[250px] border-none mr-4",label:"Thời gian thực hiện",children:e.jsx(z,{value:l,onChange:t=>f(t)})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{style:{paddingBottom:"5px"},children:"Nhân viên:"}),e.jsxs(p,{className:"w-[200px] h-[36px]",value:c,onChange:t=>j(t),defaultValue:"all",children:[e.jsx(p.Option,{value:"all",children:"Tất cả"}),D.map(t=>e.jsx(p.Option,{value:t.name,children:t.employee_name},t.name))]})]})]}),e.jsx("div",{children:e.jsx(F,{columns:J,dataSource:S,onRow:(t,a)=>({onClick:()=>C(t)}),rowHoverBg:"#f0f0f0"})})]})]})}function M(){return e.jsxs(e.Fragment,{children:[e.jsx(A,{children:e.jsx("title",{children:"BÁO CÁO"})}),e.jsx(L,{})]})}export{M as default};
