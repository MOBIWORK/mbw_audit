import{r as n,s as k,j as e,aL as T,C as b,g as N,a2 as v,S as Q,a5 as B,a6 as V,T as W,a7 as J,u as Y,F as G,H as L,aQ as M,aM as D,A as $,d as ee}from"./main-FzWPGk7u.js";import{I as U}from"./index-5MbNB8yw.js";import{C as Ae,a as te}from"./CloseCircleOutlined-_P8mCrVp.js";const X="data:image/png;base64,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";function ae({form:i,recordData:t,onChangeScoringHuman:m}){const[y,h]=n.useState([]),[C,F]=n.useState([]),[g,j]=n.useState(0),[x,s]=n.useState(0),[r,o]=n.useState(0),[f,I]=n.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]),[l,R]=n.useState(!1),[w,K]=n.useState(!1);n.useEffect(()=>{if(t){i.setFieldsValue({store:t.customer_name,campaign_name:t.campaign_name,employee_code:t.employee_name,quatity:t.quantity_cate,time_report:u(t.images_time),scoring_machine:t.scoring_machine==1?"Đạt":t.scoring_machine==0?"Không đạt":"",scoring_human:t.scoring_human}),o(t.scoring_human);let A=[];t.images!=null&&t.images!=""&&(A=JSON.parse(t.images)),A.length===0&&R(!0);let a=[];t.images_ai!=null&&t.images_ai!=""&&(a=JSON.parse(t.images_ai)),a.length===0&&(K(!0),k.warning("không tải được ảnh AI")),h(A),F(a)}},[t]);const q=A=>{j(A)},P=A=>{s(A)},z=()=>{g>0&&j(g-1)},E=()=>{g<y.length-1&&j(g+1)},O=()=>{x>0&&s(x-1)},c=()=>{x<C.length-1&&s(x+1)},d=A=>{o(A),m(A)},u=A=>{let a=new Date(A),_=a.getDate(),p=a.getMonth()+1,S=a.getFullYear(),Z=a.getHours(),H=a.getMinutes();return`${_.toString().padStart(2,"0")}/${p.toString().padStart(2,"0")}/${S} ${Z.toString().padStart(2,"0")}:${H.toString().padStart(2,"0")}`};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 pt-6 pb-[40px]",children:[e.jsxs(T,{children:[e.jsx(b,{span:8,children:e.jsx(N,{label:"Khách hàng",name:"store",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0})})}),e.jsx(b,{span:8,children:e.jsx(N,{label:"Chiến dịch",name:"campaign_name",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0})})}),e.jsx(b,{span:8,children:e.jsx(N,{label:"Nhân viên thực hiện",name:"employee_code",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0})})})]}),e.jsxs(T,{children:[e.jsx(b,{span:8,children:e.jsx(N,{label:"Thời gian thực hiện",name:"time_report",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0})})}),e.jsx(b,{span:8,children:e.jsx(N,{label:"Điểm trưng bày AI chấm",name:"scoring_machine",className:"pt-3",required:!0,children:e.jsx(v,{readOnly:!0,style:{color:t&&t.scoring_machine===1?"green":t&&t.scoring_machine===0?"red":"black"}})})}),e.jsx(b,{span:8,children:e.jsx(N,{label:"Giám sát chấm",name:"scoring_human",className:"pt-3",required:!0,children:e.jsx(Q,{className:"w-[200px] h-[36px]",value:r,onChange:A=>d(A),defaultValue:r,children:f.map(A=>e.jsx(Q.Option,{value:A.value,children:A.label},A.value))})})})]}),e.jsxs(T,{children:[e.jsx(b,{span:8,children:e.jsxs(N,{label:"Hình ảnh cửa hàng",className:"pt-3",required:!0,children:[e.jsxs("div",{style:{position:"relative",width:"100%",height:"auto",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(U,{src:y[g],fallback:X,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"cover",alignSelf:"center",borderRadius:"10px"}}),!l&&e.jsx("div",{onClick:z,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",left:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(B,{onClick:z,style:{color:"white"}})}),!l&&e.jsx("div",{onClick:E,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",right:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(V,{onClick:E,style:{color:"white"}})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",gap:"10px",overflowX:"hidden",marginTop:"10px"},children:y.map((A,a)=>e.jsx(U,{src:A,onClick:()=>q(a),style:{width:"80px",height:"80px",objectFit:"cover",cursor:"pointer",borderRadius:"10px"},preview:!1},a))})]})}),e.jsx(b,{span:8,children:e.jsxs(N,{label:"Hình ảnh AI trả về",className:"pt-3",required:!0,children:[e.jsxs("div",{style:{position:"relative",width:"100%",height:"auto",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(U,{src:C[x],fallback:X,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"cover",alignSelf:"center",borderRadius:"10px"}}),!w&&e.jsx("div",{onClick:O,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",left:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(B,{onClick:O,style:{color:"white"}})}),!w&&e.jsx("div",{onClick:c,style:{height:"50px",width:"35px",display:"flex",justifyContent:"center",borderRadius:"5px",position:"absolute",top:"50%",right:"10px",transform:"translateY(-50%)",cursor:"pointer",fontSize:"24px",zIndex:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:e.jsx(V,{onClick:c,style:{color:"white"}})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-start",gap:"10px",overflowX:"hidden",marginTop:"10px"},children:C.map((A,a)=>e.jsx(U,{src:A,onClick:()=>P(a),style:{width:"80px",height:"80px",objectFit:"cover",cursor:"pointer",borderRadius:"10px"},preview:!1},a))})]})}),e.jsx(b,{span:8})]})]})})}function ne(i){const t={},[m,y]=n.useState([]);n.useState([{label:"Đạt",value:1},{label:"Không đạt",value:0}]),i.recordData?.detail_skus.forEach(s=>{const r=s.category,o=1;t[r]=(t[r]||0)+o});const h=(s,r,o)=>{y(f=>{let I=m.filter(l=>l.report_sku_id==o.name);if(I!=null&&I.length>0){let l=m.findIndex(R=>R.report_sku_id==o.name);m[l].sum_product_human=r}else m.push({report_sku_id:o.name,sum_product_human:r,scoring_human:o.scoring_human});return i.onChangeValReportSKU(m),m})},C=i.recordData?.category_names.map((s,r)=>{const o=Object.keys(s)[0];return{key:r.toString(),stt:(r+1).toString(),categoryName:Object.values(s)[0],number_product:t[o]||0}});n.useState(null);const F=[{title:"STT",dataIndex:"stt"},{title:"Tên sản phẩm",dataIndex:"name_product"},{title:"Số lượng sản phẩm AI đếm",dataIndex:"sum_product"},{title:"Số lượng sản phẩm giám sát đếm",dataIndex:"sum_product_human",render:(s,r,o)=>e.jsx(v,{style:{width:"120px"},defaultValue:s,onChange:f=>{const I=parseInt(f.target.value);isNaN(I)?(k.warning("Nhập số lượng"),h(o,0,r)):h(o,I,r)}})},{title:"Điểm trưng bày AI chấm",dataIndex:"scoring_machine",render:s=>e.jsxs(e.Fragment,{children:[s===1&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(Ae,{style:{fontSize:"17px",color:"green",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"green",verticalAlign:"middle"},children:"Đạt"})]}),s===0&&e.jsxs("span",{style:{display:"flex"},children:[e.jsx(te,{style:{fontSize:"17px",color:"red",paddingRight:"3px"}})," ",e.jsx("span",{style:{color:"red",verticalAlign:"middle"},children:"Không đạt"})]})]})}],g=[{title:"STT",dataIndex:"stt"},{title:"Danh mục sản phẩm",dataIndex:"categoryName"},{title:"Số lượng sản phẩm",dataIndex:"number_product"}],[j,x]=n.useState([]);return n.useState({}),n.useEffect(()=>{if(i.recordData){const s=i.recordData.category_names.map((r,o)=>{const f=Object.keys(r)[0];return i.recordData.detail_skus.filter(l=>l.category===f).map((l,R)=>({key:`${o}-${R}`,stt:`${(R+1).toString().padStart(2,"0")}`,name_product:l.product_name,sum_product:l.sum_product.toString(),image:l.images,creation:l.creation,scoring_machine:l.scoring_machine,scoring_human:l.scoring_human,sum_product_human:l.sum_product_human,name:l.name,index_category:o}))});x(s)}},[i.recordData]),e.jsx(e.Fragment,{children:e.jsx(W,{columns:g,expandable:{expandedRowRender:(s,r)=>e.jsx("div",{style:{margin:5},children:e.jsx(J,{columns:F,dataSource:j[r],pagination:!1})}),rowExpandable:s=>j[s.key]&&j[s.key].length>0},dataSource:C})})}function se(){const[i,t]=n.useState(null),[m,y]=n.useState(0),[h,C]=n.useState([]),[F,g]=n.useState(!1),[j,x]=n.useState(!1),[s,r]=n.useState(!1),[o,f]=n.useState(!1),I=Y(),l=c=>{},[R]=G.useForm(),w=c=>{y(c)},K=c=>{C(c)},q=[{key:"1",label:e.jsx("span",{style:{fontWeight:700},children:"Thông tin chung"}),children:e.jsx(ae,{form:R,recordData:i,onChangeScoringHuman:w})},{key:"2",label:e.jsx("span",{style:{fontWeight:700},children:"Sản phẩm"}),children:e.jsx(ne,{recordData:i,onChangeValReportSKU:K})}];n.useEffect(()=>{let c=localStorage.getItem("recordData");if(c){let d=JSON.parse(c);t(d),y(d.scoring_human);let u=[];for(let A=0;A<d.detail_skus.length;A++){let a={report_sku_id:d.detail_skus[A].name,sum_product_human:d.detail_skus[A].sum_product_human,scoring_human:d.detail_skus[A].scoring_human};u.push(a)}C(u)}},[j]),n.useEffect(()=>{let c=JSON.parse(localStorage.getItem("dataReports"));if(c){const d=c.findIndex(u=>u.name===i?.name);d===0?r(!0):d===c.length-1?f(!0):(r(!1),f(!1))}},[i]);const P=async()=>{g(!0);let c={name:i.name,scoring:m,arr_product:h};const u=await $.post("/api/method/mbw_audit.api.api.update_report",c);if(u!=null&&u.message=="ok"&&u.result!=null&&u.result.data=="success"){k.success("Cập nhật thành công"),g(!1);let A=JSON.parse(localStorage.getItem("dataReports")),a=JSON.parse(localStorage.getItem("recordData"));for(let p=0;p<a.detail_skus.length;p++)for(let S=0;S<h.length;S++)a.detail_skus[p].name==h[S].report_sku_id&&(a.detail_skus[p].sum_product_human=h[S].sum_product_human,a.detail_skus[p].scoring_human=h[S].scoring_human);a.scoring_human=m;const _=A.findIndex(p=>p.name===a.name);if(_!==null&&_<A.length-1){const p=A[_+1];localStorage.setItem("recordData",JSON.stringify(p)),x(S=>!S)}else return;A[_]=a,localStorage.setItem("dataReports",JSON.stringify(A))}else k.error("Cập nhật thất bại"),g(!1)},z=()=>{let c=JSON.parse(localStorage.getItem("dataReports"));const d=c.findIndex(u=>u.name===i.name);if(d>0){const u=c[d-1];localStorage.setItem("recordData",JSON.stringify(u)),x(A=>!A)}},E=()=>i?`${i.customer_name} - ${i.campaign_name}`:"Tiêu đề",O=()=>{I("/reports"),localStorage.removeItem("recordData"),localStorage.removeItem("dataReports")};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:E(),icon:e.jsx("p",{onClick:()=>O(),className:"mr-2 cursor-pointer",children:e.jsx(B,{})}),buttons:[{label:"trước",type:"default",size:"20px",className:"flex items-center mr-2",icon:e.jsx(M,{}),action:z,disabled:s},{label:"Lưu lại và Tiếp",type:"primary",size:"20px",className:"flex items-center",loading:F,action:P,disabled:o}]}),e.jsx("div",{className:"bg-white  rounded-xl",children:e.jsx(G,{layout:"vertical",form:R,children:e.jsx(D,{items:q,defaultActiveKey:["1","2"],onChange:l,className:"custom-collapse"})})})]})}function ce(){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsx("title",{children:"BÁO CÁO"})}),e.jsx(se,{})]})}export{ce as default};
