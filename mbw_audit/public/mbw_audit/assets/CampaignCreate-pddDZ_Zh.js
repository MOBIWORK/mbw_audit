import{r as n,j as e,aF as U,f as V,F as D,I as $,D as ee,b as le,y as ce,a as z,Y as q,T as R,aG as te,Z as W,S as Q,$ as X,a0 as re,X as Y,aH as oe,u as de,a1 as se,H as ie,aI as me,aJ as he,a2 as J,c as ue}from"./main-Ii39zDC_.js";const pe=[{label:"Hoạt động",value:"Open"},{label:"Đóng",value:"Close"}];function xe({form:i,onCampaignStatusChange:S}){const[g,d]=n.useState("Open"),u=y=>{d(y),S(y)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 pt-6 pb-[58px]",children:[e.jsxs(U,{children:[e.jsx(V,{span:8,children:e.jsx(D,{label:"Tên chiến dịch",name:"campaign_name",required:!0,children:e.jsx($,{})})}),e.jsx(V,{span:8,children:e.jsx(D,{label:"Thời gian bắt đầu",name:"campaign_start",required:!0,children:e.jsx(ee,{showTime:!0})})}),e.jsx(V,{span:8,children:e.jsx(D,{label:"Thời gian kết thúc",name:"campaign_end",required:!0,children:e.jsx(ee,{showTime:!0})})})]}),e.jsxs(U,{className:"pt-2",children:[e.jsx(V,{span:8,children:e.jsx(D,{label:"Trạng thái",name:"campaign_status",children:e.jsx(le,{defaultValue:"Open",options:pe,onChange:u})})}),e.jsx(V,{span:8,children:e.jsx(D,{label:"Mô tả",name:"campaign_description",children:e.jsx(ce,{className:"bg-[#F5F7FA]",autoSize:{minRows:3,maxRows:5}})})})]})]})})}function ge({onChangeCategory:i,onChangeCheckExistProduct:S}){const[g,d]=n.useState(!1),[u,y]=n.useState([]),[k,w]=n.useState([]),[C,j]=n.useState(""),[f,p]=n.useState([]),[b,N]=n.useState([]),[F,T]=n.useState(!0);n.useEffect(()=>{O()},[]),n.useEffect(()=>{O()},[C]);const O=async()=>{let a='/api/resource/VGM_Category?fields=["*"]';C!=null&&C!=""&&(a+=`&filters=[["category_name", "like", "%${C}%"]]`);const h=await z.get(a);if(h&&h.data){let o=h.data.map(r=>({...r,key:r.name}));for(let r=0;r<o.length;r++){let I=`/api/resource/VGM_Product?fields=["name","product_code","product_name"]&&filters=[["category","=","${o[r].name}"]]`,K=await z.get(I);if(K!=null&&K.data!=null){o[r].product_num=K.data.length;let ae=K.data.map(Z=>({...Z,key:Z.name}));o[r].products=ae}else o[r].product_num=0,o[r].products=[]}w(o)}},E=a=>{j(a.target.value)},P={selectedRowKeys:u,onChange:(a,h)=>{y(a)}},M=()=>{let a=[],h=[];for(let o=0;o<u.length;o++){let r=k.filter(I=>I.name===u[o]);if(r!=null&&r.length>0){r[0].stt=a.length+1;let I={...r[0]};I.products=I.products.map(K=>({...K,cate_name:I.category_name,product_num:"1"})),h=h.concat(I.products),a.push(I)}}N(h),p(a),i(a),t()},l=u.length>0,_=()=>{d(!0)},m=()=>{d(!1)},t=()=>{d(!1)},s=a=>{const h=f.filter(r=>r.name!==a.name),o=b.filter(r=>r.cate_name!==a.category_name);N(o),p(h),i(h)},c=a=>{T(a.target.checked),S(a.target.checked)},x=(a,h)=>{const o=[{title:"Mã sản phẩm",dataIndex:"product_code",key:"product_code"},{title:"Tên sản phẩm",dataIndex:"product_name",key:"product_name"}];return e.jsx(e.Fragment,{children:e.jsx("div",{style:{margin:5},children:e.jsx(re,{columns:o,dataSource:a.products,pagination:!1})})})},L=[{title:"STT",dataIndex:"stt",key:"stt"},{title:"Danh mục sản phẩm",dataIndex:"category_name",key:"category_name"},{title:"Số lượng sản phẩm",dataIndex:"product_num",key:"product_num"},{title:"",key:"",render:a=>e.jsx("a",{children:e.jsx(Y,{onClick:()=>s(a)})})}],G=[{title:"Mã sản phẩm",dataIndex:"product_code"},{title:"Tên sản phẩm",dataIndex:"product_name"},{title:"Danh mục",dataIndex:"cate_name"},{title:"Số lượng ít nhất",dataIndex:"product_num",render:(a,h,o)=>e.jsx($,{style:{width:"120px"},defaultValue:a,onChange:r=>v(o,parseInt(r.target.value))})}],v=(a,h)=>{const o=[...b];o[a].product_num=h,N(o),i(f)},H=[{key:"1",label:e.jsxs(oe,{checked:F,onChange:c,children:[" ",e.jsx("span",{style:{fontWeight:700,fontSize:"15px"},children:" 1. Thiết lập tiêu chí sản phẩm"})," "]}),children:e.jsx("div",{children:e.jsx(R,{columns:G,dataSource:b})})}],B=[{key:"1",label:e.jsx("span",{style:{fontWeight:700,fontSize:"15px"},children:"  Thiết lập tiêu chí sản phẩm"}),children:e.jsx(te,{items:H,defaultActiveKey:["1","2"],className:"custom-collapse"})}],ne=a=>{};return e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Sản phẩm"}),e.jsxs("div",{onClick:_,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(q,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn danh mục"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(R,{columns:L,expandable:{expandedRowRender:x,defaultExpandedRowKeys:["0"]},dataSource:f}),e.jsx(te,{items:B,defaultActiveKey:["1","2"],onChange:ne,className:"custom-collapse"})]}),e.jsxs(W,{width:990,title:"Chọn danh mục sản phẩm",open:g,onOk:m,onCancel:t,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"w-[320px] border-none pt-4",children:e.jsx($,{value:C,onChange:E,placeholder:"Tìm kiếm danh mục sản phẩm",prefix:e.jsx(Q,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:l?`Đã chọn ${u.length} danh mục`:""}),e.jsx(X,{type:"primary",onClick:M,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(R,{rowSelection:P,columns:[{title:"Danh mục sản phẩm",dataIndex:"category_name",key:"category_name"},{title:"Số lượng sản phẩm",dataIndex:"product_num",key:"product_num"}],dataSource:k})})]})]})}function ye({onChangeCustomer:i}){const[S,g]=n.useState(!1),[d,u]=n.useState([]),[y,k]=n.useState([]),[w,C]=n.useState([]),[j,f]=n.useState([]),[p,b]=n.useState(""),N=[{title:"ID",dataIndex:"customer_code",key:"customer_code",render:t=>e.jsx("a",{children:t})},{title:"Tên khách hàng",key:"customer_name",dataIndex:"customer_name"},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group"},{title:"Địa chỉ",key:"customer_primary_address",dataIndex:"customer_primary_address"},{title:"",key:"action",render:(t,s)=>e.jsx("a",{children:e.jsx(Y,{onClick:()=>l(s)})})}];n.useEffect(()=>{F()},[]),n.useEffect(()=>{let t=w;p!=null&&p!=""&&(t=w.filter(s=>s.customer_name.toLowerCase().includes(p.toLowerCase()))),k(t)},[p]);const F=async()=>{let s=await z.get("/api/method/mbw_dms.api.selling.customer.list_customer"),c=[];s!=null&&s.message=="ok"&&(c=s.result.data.map(x=>({...x,key:x.name}))),k(c),C(c)},T=()=>{g(!0)},O=()=>{g(!1)},E=()=>{g(!1)},A=t=>{b(t.target.value)},P=t=>{u(t)},M=()=>{let t=[];for(let s=0;s<d.length;s++){let c=y.filter(x=>x.name==d[s]);c!=null&&c.length>0&&t.push(c[0])}f(t),i(t),E()},l=t=>{const s=j.filter(c=>c.name!==t.name);f(s),i(s)},_={selectedRowKeys:d,onChange:P},m=d.length>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Danh sách khách hàng"}),e.jsxs("div",{onClick:T,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(q,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn khách hàng"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(R,{columns:N,dataSource:j}),";"]}),e.jsxs(W,{width:990,title:"Chọn khách hàng",open:S,onOk:O,onCancel:E,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"w-[320px] border-none pt-4",children:e.jsx($,{value:p,onChange:A,placeholder:"Tìm kiếm tên khách hàng",prefix:e.jsx(Q,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:m?`Đã chọn ${d.length} khách hàng`:""}),e.jsx(X,{type:"primary",onClick:M,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(R,{rowSelection:_,columns:[{title:"ID",dataIndex:"customer_code",key:"customer_code",render:t=>e.jsx("a",{children:t})},{title:"Tên khách hàng",key:"customer_name",dataIndex:"customer_name"},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group"},{title:"Địa chỉ",key:"customer_primary_address",dataIndex:"customer_primary_address"}],dataSource:y})})]})]})})}const je=[{title:"Mã nhân viên",dataIndex:"name",key:"name",render:i=>e.jsx("a",{children:i})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name"},{title:"Email",dataIndex:"email",key:"email"}];function Se({onChangeEmployees:i}){const[S,g]=n.useState(!1),[d,u]=n.useState([]),[y,k]=n.useState([]),[w,C]=n.useState([]),[j,f]=n.useState(""),[p,b]=n.useState([]),N=[{title:"Mã nhân viên",dataIndex:"name",key:"name",render:t=>e.jsx("a",{children:t})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name"},{title:"Email",dataIndex:"email",key:"email"},{title:"",key:"",render:t=>e.jsx("a",{children:e.jsx(Y,{onClick:()=>l(t)})})}];n.useEffect(()=>{F()},[]),n.useEffect(()=>{let t=w;j!=null&&j!=""&&(t=w.filter(s=>s.employee_name.toLowerCase().includes(j.toLowerCase()))),k(t)},[j]);const F=async()=>{let s=await z.get("/api/method/mbw_service_v2.api.ess.employee.get_list_employee"),c=[];s!=null&&s.result!=null&&s.result.data!=null&&(c=s.result.data.map(x=>({...x,key:x.name}))),k(c),C(c)},T=()=>{g(!0)},O=()=>{g(!1)},E=()=>{g(!1)},A=t=>{u(t)},P=t=>{f(t.target.value)},M=()=>{let t=[];for(let s=0;s<d.length;s++){let c=y.filter(x=>x.name==d[s]);c!=null&&c.length>0&&t.push(c[0])}b(t),i(t),E()},l=t=>{const s=p.filter(c=>c.name!==t.name);b(s),i(s)},_={selectedRowKeys:d,onChange:A},m=d.length>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Danh sách nhân viên"}),e.jsxs("div",{onClick:T,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(q,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn nhân viên"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(R,{columns:N,dataSource:p}),";"]}),e.jsxs(W,{width:990,title:"Chọn nhân viên",open:S,onOk:O,onCancel:E,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"w-[320px] border-none pt-4",children:e.jsx($,{value:j,onChange:P,placeholder:"Tìm kiếm tên nhân viên",prefix:e.jsx(Q,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:m?`Đã chọn ${d.length} nhân viên`:""}),e.jsx(X,{type:"primary",onClick:M,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(R,{rowSelection:_,columns:je,dataSource:y})})]})]})})}function Ce(){const i=de(),[S]=se.useForm(),[g,d]=n.useState("Open"),[u,y]=n.useState([]),[k,w]=n.useState([]),[C,j]=n.useState([]),[f,p]=n.useState({}),[b,N]=n.useState(!0),F=async()=>{try{let l={},_=Object.getOwnPropertyNames(f);if(b){let v={};_.forEach(H=>{let B=f[H];v[H]=B.min_product}),l.min_product=v}let m=S.getFieldsValue(),t=u.map(v=>v.name),s=k.map(v=>v.name),c=C.map(v=>v.name),x="/api/resource/VGM_Campaign",L={campaign_name:m.campaign_name,campaign_description:m.campaign_description,start_date:T(m.campaign_start),end_date:T(m.campaign_end),campaign_status:g,categories:JSON.stringify(t),employees:JSON.stringify(s),retails:JSON.stringify(c),setting_score_audit:l},G=await z.post(x,L);G!=null&&G.data!=null?(J.success("Thêm mới thành công"),i("/campaign")):J.error("Thêm mới thất bại")}catch{J.error("Không thể thêm mới. Vui lòng kiểm tra lại và điền đủ thông tin")}},T=l=>new Date(l).toISOString().slice(0,19).replace("T"," "),O=l=>{d(l)},E=l=>{y(l);let _={};for(let m=0;m<l.length;m++)l[m].products.forEach(t=>{_[t.key]={min_product:parseInt(t.product_num)}});p(_)},A=l=>{w(l)},P=l=>{j(l)},M=l=>{N(l)};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:"Thêm mới chiến dịch",icon:e.jsx("p",{onClick:()=>i("/campaign"),className:"mr-2 cursor-pointer",children:e.jsx(me,{})}),buttons:[{label:"Thêm mới",type:"primary",size:"20px",className:"flex items-center",action:F}]}),e.jsx("div",{className:"bg-white pt-4 rounded-xl",children:e.jsx(se,{layout:"vertical",form:S,children:e.jsx(he,{defaultActiveKey:"1",items:[{label:e.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:e.jsx(xe,{form:S,onCampaignStatusChange:O})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Sản phẩm"}),key:"2",children:e.jsx(ge,{onChangeCategory:E,onChangeCheckExistProduct:M})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Nhân viên bán hàng"}),key:"3",children:e.jsx(Se,{onChangeEmployees:A})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"4",children:e.jsx(ye,{onChangeCustomer:P})}],indicatorSize:l=>l-18})})})]})}function _e(){return e.jsxs(e.Fragment,{children:[e.jsx(ue,{children:e.jsx("title",{children:" Campaign Create"})}),e.jsx(Ce,{})]})}export{_e as default};
