import{r as n,j as e,aF as Z,e as V,F as D,I as $,D as U,a as ne,y as ae,A as G,Y as J,T as R,aG as le,Z as q,S as Q,$ as W,a0 as ce,X,aH as re,u as oe,a1 as ee,H as de,aI as ie,aJ as me,a2 as B,b as he}from"./main-Xl67n-75.js";const ue=[{label:"Hoạt động",value:"Open"},{label:"Đóng",value:"Close"}];function pe({form:i,onCampaignStatusChange:S}){const[g,d]=n.useState("Open"),u=y=>{d(y),S(y)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4 pt-6 pb-[58px]",children:[e.jsxs(Z,{children:[e.jsx(V,{span:8,children:e.jsx(D,{label:"Tên chiến dịch",name:"campaign_name",required:!0,children:e.jsx($,{})})}),e.jsx(V,{span:8,children:e.jsx(D,{label:"Thời gian bắt đầu",name:"campaign_start",required:!0,children:e.jsx(U,{showTime:!0})})}),e.jsx(V,{span:8,children:e.jsx(D,{label:"Thời gian kết thúc",name:"campaign_end",required:!0,children:e.jsx(U,{showTime:!0})})})]}),e.jsxs(Z,{className:"pt-2",children:[e.jsx(V,{span:8,children:e.jsx(D,{label:"Trạng thái",name:"campaign_status",children:e.jsx(ne,{defaultValue:"Open",options:ue,onChange:u})})}),e.jsx(V,{span:8,children:e.jsx(D,{label:"Mô tả",name:"campaign_description",children:e.jsx(ae,{className:"bg-[#F5F7FA]",autoSize:{minRows:3,maxRows:5}})})})]})]})})}function xe({onChangeCategory:i,onChangeCheckExistProduct:S}){const[g,d]=n.useState(!1),[u,y]=n.useState([]),[_,v]=n.useState([]),[C,j]=n.useState(""),[f,p]=n.useState([]),[k,N]=n.useState([]),[F,T]=n.useState(!0);n.useEffect(()=>{O()},[]),n.useEffect(()=>{O()},[C]);const O=async()=>{let a='/api/resource/VGM_Category?fields=["*"]';C!=null&&C!=""&&(a+=`&filters=[["category_name", "like", "%${C}%"]]`);const h=await G.get(a);if(h&&h.data){let o=h.data.map(r=>({...r,key:r.name}));for(let r=0;r<o.length;r++){let I=`/api/resource/VGM_Product?fields=["name","product_code","product_name"]&&filters=[["category","=","${o[r].name}"]]`,K=await G.get(I);if(K!=null&&K.data!=null){o[r].product_num=K.data.length;let se=K.data.map(Y=>({...Y,key:Y.name}));o[r].products=se}else o[r].product_num=0,o[r].products=[]}v(o)}},E=a=>{j(a.target.value)},P={selectedRowKeys:u,onChange:(a,h)=>{y(a)}},M=()=>{let a=[],h=[];for(let o=0;o<u.length;o++){let r=_.filter(I=>I.name===u[o]);if(r!=null&&r.length>0){r[0].stt=a.length+1;let I={...r[0]};I.products=I.products.map(K=>({...K,cate_name:I.category_name,product_num:"1"})),h=h.concat(I.products),a.push(I)}}N(h),p(a),i(a),t()},l=u.length>0,b=()=>{d(!0)},m=()=>{d(!1)},t=()=>{d(!1)},s=a=>{const h=f.filter(r=>r.name!==a.name),o=k.filter(r=>r.cate_name!==a.category_name);N(o),p(h),i(h)},c=a=>{T(a.target.checked),S(a.target.checked)},x=(a,h)=>{const o=[{title:"Mã sản phẩm",dataIndex:"product_code",key:"product_code"},{title:"Tên sản phẩm",dataIndex:"product_name",key:"product_name"}];return e.jsx(e.Fragment,{children:e.jsx("div",{style:{margin:5},children:e.jsx(ce,{columns:o,dataSource:a.products,pagination:!1})})})},z=[{title:"STT",dataIndex:"stt",key:"stt"},{title:"Danh mục sản phẩm",dataIndex:"category_name",key:"category_name"},{title:"Số lượng sản phẩm",dataIndex:"product_num",key:"product_num"},{title:"",key:"",render:a=>e.jsx("a",{children:e.jsx(X,{onClick:()=>s(a)})})}],H=[{title:"Mã sản phẩm",dataIndex:"product_code"},{title:"Tên sản phẩm",dataIndex:"product_name"},{title:"Danh mục",dataIndex:"cate_name"},{title:"Số lượng ít nhất",dataIndex:"product_num",render:(a,h,o)=>e.jsx($,{style:{width:"120px"},defaultValue:a,onChange:r=>w(o,parseInt(r.target.value))})}],w=(a,h)=>{const o=[...k];o[a].product_num=h,N(o),i(f)},L=[{key:"1",label:e.jsxs(re,{checked:F,onChange:c,children:[" ",e.jsx("span",{style:{fontWeight:700,fontSize:"15px"},children:"  Thiết lập tồn tại sản phẩm "})," "]}),children:e.jsx("div",{children:e.jsx(R,{columns:H,dataSource:k})})}],te=a=>{};return e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Sản phẩm"}),e.jsxs("div",{onClick:b,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(J,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn danh mục"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(R,{columns:z,expandable:{expandedRowRender:x,defaultExpandedRowKeys:["0"]},dataSource:f}),e.jsx(le,{items:L,defaultActiveKey:["1","2"],onChange:te,className:"custom-collapse"})]}),e.jsxs(q,{width:990,title:"Chọn danh mục sản phẩm",open:g,onOk:m,onCancel:t,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"w-[320px] border-none pt-4",children:e.jsx($,{value:C,onChange:E,placeholder:"Tìm kiếm danh mục sản phẩm",prefix:e.jsx(Q,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:l?`Đã chọn ${u.length} danh mục`:""}),e.jsx(W,{type:"primary",onClick:M,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(R,{rowSelection:P,columns:[{title:"Danh mục sản phẩm",dataIndex:"category_name",key:"category_name"},{title:"Số lượng sản phẩm",dataIndex:"product_num",key:"product_num"}],dataSource:_})})]})]})}function ge({onChangeCustomer:i}){const[S,g]=n.useState(!1),[d,u]=n.useState([]),[y,_]=n.useState([]),[v,C]=n.useState([]),[j,f]=n.useState([]),[p,k]=n.useState(""),N=[{title:"ID",dataIndex:"customer_code",key:"customer_code",render:t=>e.jsx("a",{children:t})},{title:"Tên khách hàng",key:"customer_name",dataIndex:"customer_name"},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group"},{title:"Địa chỉ",key:"customer_primary_address",dataIndex:"customer_primary_address"},{title:"",key:"action",render:(t,s)=>e.jsx("a",{children:e.jsx(X,{onClick:()=>l(s)})})}];n.useEffect(()=>{F()},[]),n.useEffect(()=>{let t=v;p!=null&&p!=""&&(t=v.filter(s=>s.customer_name.toLowerCase().includes(p.toLowerCase()))),_(t)},[p]);const F=async()=>{let s=await G.get("/api/method/mbw_dms.api.selling.customer.list_customer"),c=[];s!=null&&s.message=="ok"&&(c=s.result.data.map(x=>({...x,key:x.name}))),_(c),C(c)},T=()=>{g(!0)},O=()=>{g(!1)},E=()=>{g(!1)},A=t=>{k(t.target.value)},P=t=>{u(t)},M=()=>{let t=[];for(let s=0;s<d.length;s++){let c=y.filter(x=>x.name==d[s]);c!=null&&c.length>0&&t.push(c[0])}f(t),i(t),E()},l=t=>{const s=j.filter(c=>c.name!==t.name);f(s),i(s)},b={selectedRowKeys:d,onChange:P},m=d.length>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Danh sách khách hàng"}),e.jsxs("div",{onClick:T,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(J,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn khách hàng"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(R,{columns:N,dataSource:j}),";"]}),e.jsxs(q,{width:990,title:"Chọn khách hàng",open:S,onOk:O,onCancel:E,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"w-[320px] border-none pt-4",children:e.jsx($,{value:p,onChange:A,placeholder:"Tìm kiếm tên khách hàng",prefix:e.jsx(Q,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:m?`Đã chọn ${d.length} khách hàng`:""}),e.jsx(W,{type:"primary",onClick:M,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(R,{rowSelection:b,columns:[{title:"ID",dataIndex:"customer_code",key:"customer_code",render:t=>e.jsx("a",{children:t})},{title:"Tên khách hàng",key:"customer_name",dataIndex:"customer_name"},{title:"Nhóm khách hàng",dataIndex:"customer_group",key:"customer_group"},{title:"Địa chỉ",key:"customer_primary_address",dataIndex:"customer_primary_address"}],dataSource:y})})]})]})})}const ye=[{title:"Mã nhân viên",dataIndex:"name",key:"name",render:i=>e.jsx("a",{children:i})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name"},{title:"Email",dataIndex:"email",key:"email"}];function je({onChangeEmployees:i}){const[S,g]=n.useState(!1),[d,u]=n.useState([]),[y,_]=n.useState([]),[v,C]=n.useState([]),[j,f]=n.useState(""),[p,k]=n.useState([]),N=[{title:"Mã nhân viên",dataIndex:"name",key:"name",render:t=>e.jsx("a",{children:t})},{title:"Tên nhân viên",dataIndex:"employee_name",key:"employee_name"},{title:"Email",dataIndex:"email",key:"email"},{title:"",key:"",render:t=>e.jsx("a",{children:e.jsx(X,{onClick:()=>l(t)})})}];n.useEffect(()=>{F()},[]),n.useEffect(()=>{let t=v;j!=null&&j!=""&&(t=v.filter(s=>s.employee_name.toLowerCase().includes(j.toLowerCase()))),_(t)},[j]);const F=async()=>{let s=await G.get("/api/method/mbw_service_v2.api.ess.employee.get_list_employee"),c=[];s!=null&&s.result!=null&&s.result.data!=null&&(c=s.result.data.map(x=>({...x,key:x.name}))),_(c),C(c)},T=()=>{g(!0)},O=()=>{g(!1)},E=()=>{g(!1)},A=t=>{u(t)},P=t=>{f(t.target.value)},M=()=>{let t=[];for(let s=0;s<d.length;s++){let c=y.filter(x=>x.name==d[s]);c!=null&&c.length>0&&t.push(c[0])}k(t),i(t),E()},l=t=>{const s=p.filter(c=>c.name!==t.name);k(s),i(s)},b={selectedRowKeys:d,onChange:A},m=d.length>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"ml-4 font-semibold text-sm text-[#212B36]",children:"Danh sách nhân viên"}),e.jsxs("div",{onClick:T,className:"flex justify-center h-9 cursor-pointer items-center ml-4 border-solid border-[1px] border-indigo-600 rounded-xl w-[160px]",children:[e.jsx("p",{className:"mr-2",children:e.jsx(J,{})}),e.jsx("p",{className:"text-sm font-bold text-[#1877F2]",children:"Chọn nhân viên"})]}),e.jsxs("div",{className:"pt-6 ml-4",children:[e.jsx(R,{columns:N,dataSource:p}),";"]}),e.jsxs(q,{width:990,title:"Chọn nhân viên",open:S,onOk:O,onCancel:E,footer:!1,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"w-[320px] border-none pt-4",children:e.jsx($,{value:j,onChange:P,placeholder:"Tìm kiếm tên nhân viên",prefix:e.jsx(Q,{})})}),e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:8},children:m?`Đã chọn ${d.length} nhân viên`:""}),e.jsx(W,{type:"primary",onClick:M,children:"Thêm"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(R,{rowSelection:b,columns:ye,dataSource:y})})]})]})})}function Se(){const i=oe(),[S]=ee.useForm(),[g,d]=n.useState("Open"),[u,y]=n.useState([]),[_,v]=n.useState([]),[C,j]=n.useState([]),[f,p]=n.useState({}),[k,N]=n.useState(!0),F=async()=>{try{let l={};Object.getOwnPropertyNames(f).forEach(w=>{let L=f[w];k||delete L.min_product,l[w]=L});let m=S.getFieldsValue(),t=u.map(w=>w.name),s=_.map(w=>w.name),c=C.map(w=>w.name),x="/api/resource/VGM_Campaign",z={campaign_name:m.campaign_name,campaign_description:m.campaign_description,start_date:T(m.campaign_start),end_date:T(m.campaign_end),campaign_status:g,categories:JSON.stringify(t),employees:JSON.stringify(s),retails:JSON.stringify(c),setting_score_audit:l},H=await G.post(x,z);H!=null&&H.data!=null?(B.success("Thêm mới thành công"),i("/campaign")):B.error("Thêm mới thất bại")}catch{B.error("Không thể thêm mới. Vui lòng kiểm tra lại và điền đủ thông tin")}},T=l=>new Date(l).toISOString().slice(0,19).replace("T"," "),O=l=>{d(l)},E=l=>{y(l);let b={};for(let m=0;m<l.length;m++)l[m].products.forEach(t=>{b[t.key]={min_product:parseInt(t.product_num)}});p(b)},A=l=>{v(l)},P=l=>{j(l)},M=l=>{N(l)};return e.jsxs(e.Fragment,{children:[e.jsx(de,{title:"Thêm mới chiến dịch",icon:e.jsx("p",{onClick:()=>i("/campaign"),className:"mr-2 cursor-pointer",children:e.jsx(ie,{})}),buttons:[{label:"Thêm mới",type:"primary",size:"20px",className:"flex items-center",action:F}]}),e.jsx("div",{className:"bg-white pt-4 rounded-xl",children:e.jsx(ee,{layout:"vertical",form:S,children:e.jsx(me,{defaultActiveKey:"1",items:[{label:e.jsx("p",{className:"px-4 mb-0",children:" Thông tin chung"}),key:"1",children:e.jsx(pe,{form:S,onCampaignStatusChange:O})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Sản phẩm"}),key:"2",children:e.jsx(xe,{onChangeCategory:E,onChangeCheckExistProduct:M})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Nhân viên bán hàng"}),key:"3",children:e.jsx(je,{onChangeEmployees:A})},{label:e.jsx("p",{className:"px-4 mb-0",children:"Khách hàng"}),key:"4",children:e.jsx(ge,{onChangeCustomer:P})}],indicatorSize:l=>l-18})})})]})}function fe(){return e.jsxs(e.Fragment,{children:[e.jsx(he,{children:e.jsx("title",{children:" Campaign Create"})}),e.jsx(Se,{})]})}export{fe as default};
